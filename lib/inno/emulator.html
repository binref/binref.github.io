<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.11.6" />
<title>the refinery.lib.inno.emulator documentation</title>
<meta name="description" content="On a Mission to Refine Binaries" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow-night-bright.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{background-color:#0D0D0D;color:#EEEEEE;font-size:16pt}@font-face{font-family:"FixedSysEx";src:local('Fixedsys Excelsior 3.01-L2'),local('Fixedsys Excelsior 3.01'),local('FixedSysEx'),url(../../FixedSysEx.ttf) format('truetype')}code,pre,body,html{font-family:FixedSysEx,monospace}b,strong{font-weight:normal}#content{padding:20px}#sidebar{padding:1vw;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #EEEEEE;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}hr{display:none}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#EE8080;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#EEEEEE}// .title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#BB4040}pre code{background:#000000;display:block;padding:1px 0px 4px 0px;line-height:100%}code{background:#000000;padding:1px 0px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#000000;border:0;border-top:1px solid #EEEEEE;border-bottom:1px solid #EEEEEE;margin:1em 0;padding:1ex;overflow-x:auto}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index ul{list-style-type:square;padding:0}// #index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 10px}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#000000;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#0D0D0D}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#EEEEEE;border-left:5px solid #EEEEEE;padding-left:1em}.inheritance em{font-style:normal}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1ch}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition.note,.admonition.info,.admonition.todo,.admonition.versionadded,.admonition.important,.admonition.tip,.admonition.hint{background:#054000}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#998800}.admonition.error,.admonition.danger,.admonition.caution{background:#300000}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:1vw}main{display:flex;flex-direction:row;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #EEEEEE;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>refinery.lib.inno.emulator</code></h1>
</header>
<section id="section-intro">
<p>An emulator for Inno Setup executables. The implementation is unlikely to be 100% correct as it
was engineered by making various malicious scripts execute reasonably well, not by implementing
an exact copy of <a href="https://github.com/remobjects/pascalscript">the (only) reference implementation</a>. This grew and grew as I wrote it,
and seems mildly insane in hindsight.</p>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1-L2159" class="git-link">Browse git</a>
</summary>
<pre><code class="python">&#34;&#34;&#34;
An emulator for Inno Setup executables. The implementation is unlikely to be 100% correct as it
was engineered by making various malicious scripts execute reasonably well, not by implementing
an exact copy of [the (only) reference implementation][PS]. This grew and grew as I wrote it,
and seems mildly insane in hindsight.

[PS]: https://github.com/remobjects/pascalscript
&#34;&#34;&#34;
from __future__ import annotations

import fnmatch
import hashlib
import inspect
import io
import math
import operator
import random
import re
import struct

from dataclasses import dataclass, field
from datetime import datetime, timedelta
from enum import Enum, IntFlag, auto
from functools import cached_property, partial, wraps
from pathlib import Path
from string import Formatter
from time import process_time
from typing import (
    TYPE_CHECKING,
    Any,
    Callable,
    ClassVar,
    Generator,
    Generic,
    NamedTuple,
    Sequence,
    TypeVar,
    get_origin,
)
from urllib.parse import unquote

from refinery.lib.annotations import evaluate
from refinery.lib.inno import CaseInsensitiveDict
from refinery.lib.inno.archive import Flags, InnoArchive
from refinery.lib.inno.ifps import (
    TC,
    AOp,
    COp,
    EHType,
    Function,
    IFPSFile,
    IFPSType,
    Instruction,
    Op,
    Operand,
    OperandType,
    TArray,
    TPrimitive,
    TRecord,
    TStaticArray,
    Value,
    VariableBase,
    VariableSpec,
    VariableType,
)
from refinery.lib.patterns import formats
from refinery.lib.types import AST, INF, NoMask

if TYPE_CHECKING:
    from typing import ParamSpec
    _P = ParamSpec(&#39;_P&#39;)

_T = TypeVar(&#39;_T&#39;)
_Y = TypeVar(&#39;_Y&#39;)


class OleObject:
    &#34;&#34;&#34;
    A dummy object representing an OLE interface created by an IFPS script. All it does so far is
    to remember the name of the object that was requested.
    &#34;&#34;&#34;
    def __init__(self, name):
        self.name = name

    def __repr__(self):
        return F&#39;OleObject({self.name!r})&#39;

    def __str__(self):
        return self.name


_VariantType = TPrimitive(TC.Variant)


class Variable(VariableBase, Generic[_T]):
    &#34;&#34;&#34;
    This class represents a global or stack variable in the IFPS runtime.
    &#34;&#34;&#34;
    data: list[Variable] | _T | None
    &#34;&#34;&#34;
    The variable&#39;s value. This is a list of `refinery.lib.inno.emulator.Variable`s for container
    types, a `refinery.lib.inno.emulator.Variable` for pointer types, and a basic type otherwise.
    &#34;&#34;&#34;
    path: tuple[int, ...]
    &#34;&#34;&#34;
    A tuple of integers that specify the seuqnce of indices required to access it, relative to the
    base variable given via `spec`.
    &#34;&#34;&#34;

    __slots__ = (
        &#39;data&#39;,
        &#39;path&#39;,
        &#39;_int_size&#39;,
        &#39;_int_mask&#39;,
        &#39;_int_bits&#39;,
        &#39;_int_good&#39;,
    )

    @property
    def container(self):
        &#34;&#34;&#34;
        A boolean indicating whether the given variable is a container.
        &#34;&#34;&#34;
        return self.type.container

    @property
    def pointer(self):
        &#34;&#34;&#34;
        A boolean indicating whether the given variable is a pointer.
        &#34;&#34;&#34;
        return self.type.code == TC.Pointer

    def __len__(self):
        return len(self.data)

    def __bool__(self):
        return True

    def __getitem__(self, key: int):
        var = self.deref()
        if var.container:
            return var.at(key).get()
        else:
            return var.data[key]

    def __setitem__(self, key: int, v: _T):
        var = self.deref()
        if var.container:
            var.at(key).set(v)
        else:
            var.data[key] = var._wrap(v)

    def at(self, k: int):
        &#34;&#34;&#34;
        Provides index access for the variable. If the variable is a pointer, it is dereferenced
        before accessing the data.
        &#34;&#34;&#34;
        return self.deref().data[k]

    def deref(var):
        &#34;&#34;&#34;
        Dereferences the variable until it is no longer a pointer and returns the result. If the
        variable is not a pointer, this function returns the variable itself.
        &#34;&#34;&#34;
        while True:
            val = var.data
            if not isinstance(val, Variable):
                return var
            var = val

    def __init__(
        self,
        type: IFPSType,
        spec: VariableSpec | None = None,
        path: tuple[int, ...] = (),
        data: _T | list | None = None
    ):
        super().__init__(type, spec)
        self.path = path

        self._int_size = _size = {
            TC.U08: +1,
            TC.U16: +1,
            TC.U32: +1,
            TC.S08: -1,
            TC.S16: -1,
            TC.S32: -1,
            TC.S64: -1,
        }.get((code := type.code), 0) * code.width
        if _size:
            bits = abs(_size) * 8
            umax = (1 &lt;&lt; bits)
            self._int_bits = bits
            self._int_mask = umax - 1
            if _size &lt; 0:
                self._int_good = range(-(umax &gt;&gt; 1), (umax &gt;&gt; 1))
            else:
                self._int_good = range(umax)
        else:
            self._int_mask = NoMask
            self._int_bits = INF
            self._int_good = AST

        if data is None:
            self.setdefault()
        else:
            self.set(data)

    def setdefault(self):
        &#34;&#34;&#34;
        Set this variable&#39;s data to the default value for its type. This also initializes the
        values of any contained variables recursively.
        &#34;&#34;&#34;
        spec = self.spec
        path = self.path

        def default(type: IFPSType, *sub_path):
            if isinstance(type, TRecord):
                return [Variable(t, spec, (*path, *sub_path, k)) for k, t in enumerate(type.members)]
            if isinstance(type, TStaticArray):
                t = type.type
                return [Variable(t, spec, (*path, *sub_path, k)) for k in range(type.size)]
            if isinstance(type, TArray):
                return []
            if sub_path:
                return Variable(type, spec, (*path, *sub_path))
            elif type.code == TC.Pointer:
                return Variable(_VariantType)
            else:
                return type.default()

        self.data = default(self.type)

    def _wrap(self, value: Value | _T, key: int | None = None) -&gt; _T:
        if (t := self.type.py_type(key)) and not isinstance(value, t):
            if issubclass(t, int):
                if isinstance(value, str) and len(value) == 1:
                    return ord(value[0])
                if isinstance(value, float):
                    return int(value)
            elif isinstance(value, int):
                if issubclass(t, str):
                    return chr(value)
                if issubclass(t, float):
                    return float(value)
            raise TypeError(F&#39;Assigning value {value!r} to variable of type {self.type}.&#39;)
        if s := self._int_size and value not in self._int_good:
            mask = self._int_mask
            value &amp;= mask
            if s &lt; 0 and (value &gt;&gt; (self._int_bits - 1)):
                value = -(-value &amp; mask)
        return value

    def resize(self, n: int):
        &#34;&#34;&#34;
        This function is only valid for container type variables. It re-sizes the data list to
        ensure that the container stores exactly `n` sub-variables.
        &#34;&#34;&#34;
        t = self.type
        m = n - len(self.data)
        if t.code != TC.Array:
            if t.code not in (TC.StaticArray, TC.Record):
                raise TypeError
            if n == t.size:
                return
            raise ValueError(F&#39;Attempt to resize {t} of size {t.size} to {n}.&#39;)
        if m &lt;= 0:
            del self.data[n:]
            return
        for k in range(m):
            self.data.append(Variable(t.type, self.spec, (*self.path, k)))

    def setptr(self, var: Variable, copy: bool = False):
        &#34;&#34;&#34;
        This method is used to point a pointer variable to a target. This is different from calling
        the `refinery.lib.inno.emulator.Variable.set` method as the latter would try to dereference
        the pointer and assign to its target; this method sets the value of the pointer itself.
        &#34;&#34;&#34;
        if not self.pointer:
            raise TypeError
        if not isinstance(var, Variable):
            raise TypeError
        if copy:
            var = Variable(var.type, data=var.get())
        self.data = var

    def set(self, value: _T | Sequence | Variable):
        &#34;&#34;&#34;
        Assign a new value to the variable. This can either be an immediate value or a variable.
        For container types, it can also be a sequence of those.
        &#34;&#34;&#34;
        if isinstance(value, Variable):
            value = value.get()
        elif isinstance(value, (Enum, Value)):
            value = value.value
        if self.pointer:
            return self.deref().set(value)
        elif self.container:
            if not isinstance(value, (list, tuple)):
                raise TypeError
            self.resize(len(value))
            for k, v in enumerate(value):
                self.data[k].set(v)
        else:
            self.data = self._wrap(value)

    def get(self) -&gt; _T:
        &#34;&#34;&#34;
        Return a representation of this variable that consists only of base types. For example, the
        result for a container type will not be a list of `refinery.lib.inno.emulator.Variable`s,
        but a list of their contents.
        &#34;&#34;&#34;
        if self.pointer:
            return self.deref().get()
        if self.container:
            data: list[Variable] = self.data
            return [v.get() for v in data]
        return self.data

    @property
    def name(self):
        &#34;&#34;&#34;
        Return the name of the variable as given by its spec.
        &#34;&#34;&#34;
        if self.spec is None:
            return &#39;Unbound&#39;
        name = F&#39;{self.spec!s}&#39;
        for k in self.path:
            name = F&#39;{name}[{k}]&#39;
        return name

    def __repr__(self):
        rep = self.name
        if (val := self.data) is None:
            return rep
        if self.type.code is TC.Set:
            val = F&#39;{val:b}&#39;
        elif self.pointer:
            val: Variable
            return F&#39;{rep} -&gt; {val.name}&#39;
        elif isinstance(val, (str, int, float, list)):
            val = repr(self.get())
        else:
            return rep
        return F&#39;{rep} = {val}&#39;


class NeedSymbol(NotImplementedError):
    &#34;&#34;&#34;
    An exception raised by `refinery.lib.inno.emulator.IFPSEmulator` if the runtime calls out to
    an external symbol that is not implemented.
    &#34;&#34;&#34;


class OpCodeNotImplemented(NotImplementedError):
    &#34;&#34;&#34;
    An exception raised by `refinery.lib.inno.emulator.IFPSEmulator` if an unsupported opcode is
    encountered during emulation.
    &#34;&#34;&#34;


class EmulatorException(RuntimeError):
    &#34;&#34;&#34;
    A generic exception representing any error that occurs during emulation.
    &#34;&#34;&#34;


class AbortEmulation(Exception):
    &#34;&#34;&#34;
    This exception can be raised by an external function handler to signal the emulator that script
    execution should be aborted.
    &#34;&#34;&#34;


class IFPSException(RuntimeError):
    &#34;&#34;&#34;
    This class represents an exception within the IFPS runtime, i.e. an exception that is subject
    to IFPS exception handling.
    &#34;&#34;&#34;
    def __init__(self, msg: str, parent: BaseException | None = None):
        super().__init__(msg)
        self.parent = parent


class EmulatorTimeout(TimeoutError):
    &#34;&#34;&#34;
    The emulation timed out based on the given time limit in the configuration.
    &#34;&#34;&#34;


class EmulatorExecutionLimit(TimeoutError):
    &#34;&#34;&#34;
    The emulation timed out based on the given execution limit in the configuration.
    &#34;&#34;&#34;


class EmulatorMaxStack(MemoryError):
    &#34;&#34;&#34;
    The emulation was aborted because the stack limit given in the configuration was exceeded.
    &#34;&#34;&#34;


class EmulatorMaxCalls(MemoryError):
    &#34;&#34;&#34;
    The emulation was aborted because the call stack limit given in the configuration was exceeded.
    &#34;&#34;&#34;


@dataclass
class ExceptionHandler:
    &#34;&#34;&#34;
    This class represents an exception handler within the IFPS runtime.
    &#34;&#34;&#34;
    finally_one: int | None
    &#34;&#34;&#34;
    Code offset of the first finally handler.
    &#34;&#34;&#34;
    catch_error: int | None
    &#34;&#34;&#34;
    Code offset of the catch handler.
    &#34;&#34;&#34;
    finally_two: int | None
    &#34;&#34;&#34;
    Code offset of the second finally handler.
    &#34;&#34;&#34;
    handler_end: int
    &#34;&#34;&#34;
    Code offset of the first instruction that is no longer covered.
    &#34;&#34;&#34;
    current: EHType = EHType.Try
    &#34;&#34;&#34;
    Represents the current state of this exception handler.
    &#34;&#34;&#34;


class IFPSEmulatedFunction(NamedTuple):
    &#34;&#34;&#34;
    Represents an emulated external symbol.
    &#34;&#34;&#34;
    call: Callable
    &#34;&#34;&#34;
    The actual callable function that implements the symbol.
    &#34;&#34;&#34;
    spec: list[bool]
    &#34;&#34;&#34;
    A list of boolean values, one for each parameter of the function. Each boolean indicates
    whether the parameter at that index is passed by reference.
    &#34;&#34;&#34;
    static: bool
    &#34;&#34;&#34;
    Indicates whether the handler is static. If this value is `False`, the callable expects an
    additional `self` parameter of type `refinery.lib.inno.emulator.IFPSEmulator`.
    &#34;&#34;&#34;
    void: bool = False
    &#34;&#34;&#34;
    Indicates whether the handler implements a procedure rather than a function in the IFPS
    runtime.
    &#34;&#34;&#34;

    @property
    def argc(self):
        &#34;&#34;&#34;
        The argument count for this handler.
        &#34;&#34;&#34;
        return len(self.spec)


@dataclass
class IFPSEmulatorConfig:
    &#34;&#34;&#34;
    The configuration for `refinery.lib.inno.emulator.IFPSEmulator`s.
    &#34;&#34;&#34;
    x64: bool = True
    admin: bool = True
    windows_os_version: tuple[int, int, int] = (10, 0, 10240)
    windows_sp_version: tuple[int, int] = (2, 0)
    throw_abort: bool = False
    log_calls: bool = False
    log_passwords: bool = True
    log_mutexes: bool = True
    log_opcodes: bool = False
    wizard_silent: bool = True
    max_opcodes: int = 0
    max_seconds: int = 10
    start_time: datetime = field(default_factory=datetime.now)
    milliseconds_per_instruction: float = 0.0001
    sleep_scale: float = 0.0
    max_data_stack: int = 1_000_000
    max_call_stack: int = 4096
    environment: dict[str, str] = field(default_factory=dict)
    user_name: str = &#39;Frank&#39;
    temp_path: str = &#39;&#39;
    host_name: str = &#39;Frank-PC&#39;
    inno_name: str = &#39;ThisInstall&#39;
    language: str = &#39;en&#39;
    executable: str = &#39;C:\\Install.exe&#39;
    install_to: str = &#39;I:\\&#39;
    lcid: int = 0x0409

    @property
    def cwd(self):
        return Path(self.executable).parent


class TSetupStep(int, Enum):
    &#34;&#34;&#34;
    An IFPS enumeration that classifies different setup steps.
    &#34;&#34;&#34;
    ssPreInstall = 0
    ssInstall = auto()
    ssPostInstall = auto()
    ssDone = auto()


class TSplitType(int, Enum):
    &#34;&#34;&#34;
    An IFPS enumeration that classifies different strategies for splitting strings.
    &#34;&#34;&#34;
    stAll = 0
    stExcludeEmpty = auto()
    stExcludeLastEmpty = auto()


class TUninstallStep(int, Enum):
    &#34;&#34;&#34;
    An IFPS enumeration that classifies uninstaller steps.
    &#34;&#34;&#34;
    usAppMutexCheck = 0
    usUninstall = auto()
    usPostUninstall = auto()
    usDone = auto()


class TSetupProcessorArchitecture(int, Enum):
    &#34;&#34;&#34;
    An IFPS enumeration that classifies different processor architectures.
    &#34;&#34;&#34;
    paUnknown = 0
    paX86 = auto()
    paX64 = auto()
    paArm32 = auto()
    paArm64 = auto()


class PageID(int, Enum):
    &#34;&#34;&#34;
    An IFPS enumeration that classifies the different installer pages.
    &#34;&#34;&#34;
    wpWelcome = 1
    wpLicense = auto()
    wpPassword = auto()
    wpInfoBefore = auto()
    wpUserInfo = auto()
    wpSelectDir = auto()
    wpSelectComponents = auto()
    wpSelectProgramGroup = auto()
    wpSelectTasks = auto()
    wpReady = auto()
    wpPreparing = auto()
    wpInstalling = auto()
    wpInfoAfter = auto()
    wpFinished = auto()


class NewFunctionCall(NamedTuple):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` which
    represents a call to the function with the given name and arguments.
    &#34;&#34;&#34;
    name: str
    args: tuple


class NewPassword(str):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` for each
    password that is entered by the emulated setup script to a password edit control.
    &#34;&#34;&#34;


class NewMutex(str):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` for each
    mutex registered by the script.
    &#34;&#34;&#34;


class NewInstruction(NamedTuple):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` for each
    executed instruction.
    &#34;&#34;&#34;
    function: Function
    instruction: Instruction


class EventCall(Generic[_Y, _T]):
    &#34;&#34;&#34;
    This class is a wrapper for generator functions that can also capture their return value.
    It is used for `refinery.lib.inno.emulator.IFPSEmulator.emulate_function`.
    &#34;&#34;&#34;

    value: _T
    &#34;&#34;&#34;
    The return value of the wrapped function.
    &#34;&#34;&#34;

    def __init__(self, call: Generator[_Y, Any, _T]):
        self._call = call
        self._done = False
        self._buffer: list[_Y] = []
        self._value = None

    @classmethod
    def Wrap(cls, method: Callable[_P, Generator[_Y, Any, _T]]) -&gt; Callable[_P, EventCall[_Y, _T]]:
        &#34;&#34;&#34;
        Used for decorating generator functions.
        &#34;&#34;&#34;
        @wraps(method)
        def wrapped(*args, **kwargs):
            return cls(method(*args, **kwargs))
        return wrapped

    @property
    def value(self):
        if not self._done:
            self._buffer = list(self)
        return self._value

    def __iter__(self):
        if self._done:
            yield from self._buffer
            assert self._value is not None
            self._buffer.clear()
        else:
            self._value = yield from self._call
            self._done = True
        return self._value


class FPUControl(IntFlag):
    &#34;&#34;&#34;
    An integer flag representing FPU control words.
    &#34;&#34;&#34;
    InvalidOperation    = 0b0_00_0_00_00_00_000001 # noqa
    DenormalizedOperand = 0b0_00_0_00_00_00_000010 # noqa
    ZeroDivide          = 0b0_00_0_00_00_00_000100 # noqa
    Overflow            = 0b0_00_0_00_00_00_001000 # noqa
    Underflow           = 0b0_00_0_00_00_00_010000 # noqa
    PrecisionError      = 0b0_00_0_00_00_00_100000 # noqa
    Reserved1           = 0b0_00_0_00_00_01_000000 # noqa
    Reserved2           = 0b0_00_0_00_00_10_000000 # noqa
    ExtendPrecision     = 0b0_00_0_00_01_00_000000 # noqa
    DoublePrecision     = 0b0_00_0_00_10_00_000000 # noqa
    MaxPrecision        = 0b0_00_0_00_11_00_000000 # noqa
    RoundDown           = 0b0_00_0_01_00_00_000000 # noqa
    RoundUp             = 0b0_00_0_10_00_00_000000 # noqa
    RoundTowardZero     = 0b0_00_0_11_00_00_000000 # noqa
    AffineInfinity      = 0b0_00_1_00_00_00_000000 # noqa
    Reserved3           = 0b0_01_0_00_00_00_000000 # noqa
    Reserved4           = 0b0_10_0_00_00_00_000000 # noqa
    ReservedBits        = 0b0_11_0_00_00_11_000000 # noqa


class IFPSEmulator:
    &#34;&#34;&#34;
    The core IFPS emulator.
    &#34;&#34;&#34;

    def __init__(
        self,
        archive: InnoArchive | IFPSFile,
        options: IFPSEmulatorConfig | None = None,
        **more
    ):
        if isinstance(archive, InnoArchive):
            self.inno = archive
            self.ifps = ifps = archive.ifps
            if ifps is None:
                raise ValueError(&#39;The input archive does not contain a script.&#39;)
        else:
            self.inno = None
            self.ifps = ifps = archive
        self.config = options or IFPSEmulatorConfig(**more)
        self.globals = [Variable(v.type, v.spec) for v in ifps.globals]
        self.stack: list[Variable] = []
        self.mutexes: set[str] = set()
        self.symbols: dict[str, Function] = CaseInsensitiveDict()
        self.reset()
        for pfn in ifps.functions:
            self.symbols[pfn.name] = pfn

    def __repr__(self):
        return self.__class__.__name__

    def reset(self):
        &#34;&#34;&#34;
        Reset the emulator timing, FPU word, mutexes, trace, and stack. All global variables are
        set to their default values.
        &#34;&#34;&#34;
        self.seconds_slept = 0.0
        self.clock = 0
        self.fpucw = FPUControl.MaxPrecision | FPUControl.RoundTowardZero
        self.jumpflag = False
        self.mutexes.clear()
        self.stack.clear()
        for v in self.globals:
            v.setdefault()
        return self

    def unimplemented(self, function: Function):
        &#34;&#34;&#34;
        The base IFPS emulator raises `refinery.lib.inno.emulator.NeedSymbol` when an external
        symbol is unimplemented. Child classes can override this function to handle the missing
        symbol differently.
        &#34;&#34;&#34;
        raise NeedSymbol(function.name)

    @EventCall.Wrap
    def emulate_function(self, function: Function, *args):
        &#34;&#34;&#34;
        Emulate a function call to the given function, passing the given arguments. The method
        returns the return value of the emulated function call if it is not a procedure.
        &#34;&#34;&#34;
        self.stack.clear()
        decl = function.decl
        if decl is None:
            raise NotImplementedError(F&#39;Do not know how to call {function!s}.&#39;)
        if (n := len(decl.parameters)) != (m := len(args)):
            raise ValueError(
                F&#39;Function {function!s} expects {n} arguments, only {m} were given.&#39;)
        for index, (argument, parameter) in enumerate(zip(args, decl.parameters), 1):
            variable = Variable(parameter.type, VariableSpec(index, VariableType.Local))
            variable.set(argument)
            self.stack.append(variable)
        self.stack.reverse()
        if not decl.void:
            result = Variable(decl.return_type, VariableSpec(0, VariableType.Argument))
            self.stack.append(result)
        yield from self.call(function)
        self.stack.clear()
        if not decl.void:
            return result.get()

    def call(self, function: Function):
        &#34;&#34;&#34;
        Begin emulating at the start of the given function.
        &#34;&#34;&#34;

        def operator_div(a, b):
            return a // b if isinstance(a, int) and isinstance(b, int) else a / b

        def operator_in(a, b):
            return a in b

        def getvar(op: VariableSpec | Operand) -&gt; Variable:
            if not isinstance(op, Operand):
                v = op
                k = None
            elif op.type is OperandType.Value:
                raise TypeError(&#39;Attempting to retrieve variable for an immediate operand.&#39;)
            else:
                v = op.variable
                k = op.index
                if op.type is OperandType.IndexedByVar:
                    k = getvar(k).get()
            t, i = v.type, v.index
            if t is VariableType.Argument:
                if function.decl.void:
                    i -= 1
                var = self.stack[sp - i]
            elif t is VariableType.Global:
                var = self.globals[i]
            elif t is VariableType.Local:
                var = self.stack[sp + i]
            else:
                raise TypeError
            if k is not None:
                var = var.at(k)
            return var

        def getval(op: Operand):
            if op.immediate:
                return op.value.value
            return getvar(op).get()

        def setval(op: Operand, new):
            if op.immediate:
                raise RuntimeError(&#39;attempt to assign to an immediate&#39;)
            getvar(op).set(new)

        class CallState(NamedTuple):
            fn: Function
            ip: int
            sp: int
            eh: list[ExceptionHandler]

        callstack: list[CallState] = []
        exec_start = process_time()
        stack = self.stack
        _cfg_max_call_stack = self.config.max_call_stack
        _cfg_max_data_stack = self.config.max_data_stack
        _cfg_max_seconds = self.config.max_seconds
        _cfg_max_opcodes = self.config.max_opcodes
        _cfg_log_opcodes = self.config.log_opcodes

        ip: int = 0
        sp: int = len(stack) - 1
        pending_exception = None
        exceptions = []

        while True:
            if 0 &lt; _cfg_max_call_stack &lt; len(callstack):
                raise EmulatorMaxCalls

            if function.body is None:
                namespace = &#39;&#39;

                if decl := function.decl:
                    if decl.is_property:
                        if stack[-1].type.code == TC.Class:
                            function = function.setter
                        else:
                            function = function.getter
                        decl = function.decl
                    namespace = (
                        decl.classname or decl.module or &#39;&#39;)

                name = function.name
                registry: dict[str, IFPSEmulatedFunction] = self.external_symbols.get(namespace, {})
                handler = registry.get(name)

                if handler:
                    void = handler.void
                    argc = handler.argc
                elif decl:
                    void = decl.void
                    argc = decl.argc
                else:
                    void = True
                    argc = 0

                try:
                    rpos = 0 if void else 1
                    args = [stack[~k] for k in range(rpos, argc + rpos)]
                except IndexError:
                    raise EmulatorException(
                        F&#39;Cannot call {function!s}; {argc} arguments + {rpos} return values expected,&#39;
                        F&#39; but stack size is only {len(stack)}.&#39;)

                if self.config.log_calls:
                    yield NewFunctionCall(str(function), tuple(a.get() for a in args))

                if handler is None:
                    self.unimplemented(function)
                else:
                    if decl and (decl.void != handler.void or decl.argc != handler.argc):
                        ok = False
                        if 1 + decl.argc - decl.void == 1 + handler.argc - handler.void:
                            if decl.void and not decl.parameters[0].const:
                                ok = True
                            elif handler.void and handler.spec[0]:
                                ok = True
                        if not ok:
                            raise RuntimeError(F&#39;Handler for {function!s} is incompatible with declaration.&#39;)
                    for k, (var, byref) in enumerate(zip(args, handler.spec)):
                        if not byref:
                            args[k] = var.get()
                    if not handler.static:
                        args.insert(0, self)
                    try:
                        return_value = handler.call(*args)
                        if inspect.isgenerator(return_value):
                            return_value = yield from return_value
                    except GeneratorExit:
                        pass
                    except BaseException as b:
                        pending_exception = IFPSException(F&#39;Error calling {function.name}: {b!s}&#39;, b)
                    else:
                        if not handler.void:
                            stack[-1].set(return_value)
                if not callstack:
                    if pending_exception is None:
                        return
                    raise pending_exception
                function, ip, sp, exceptions = callstack.pop()
                continue

            while insn := function.code.get(ip, None):
                if 0 &lt; _cfg_max_seconds &lt; process_time() - exec_start:
                    raise EmulatorTimeout
                if 0 &lt; _cfg_max_opcodes &lt; self.clock:
                    raise EmulatorExecutionLimit
                if 0 &lt; _cfg_max_data_stack &lt; len(stack):
                    raise EmulatorMaxStack
                if _cfg_log_opcodes:
                    yield NewInstruction(function, insn)
                try:
                    if pe := pending_exception:
                        pending_exception = None
                        raise pe

                    opc = insn.opcode
                    ip += insn.size
                    self.clock += 1

                    if opc == Op.Nop:
                        continue
                    elif opc == Op.Assign:
                        dst = getvar(insn.op(0))
                        src = insn.op(1)
                        if src.immediate:
                            dst.set(src.value)
                        else:
                            dst.set(getvar(src))
                    elif opc == Op.Calculate:
                        calculate = {
                            AOp.Add: operator.add,
                            AOp.Sub: operator.sub,
                            AOp.Mul: operator.mul,
                            AOp.Div: operator_div,
                            AOp.Mod: operator.mod,
                            AOp.Shl: operator.lshift,
                            AOp.Shr: operator.rshift,
                            AOp.And: operator.and_,
                            AOp.BOr: operator.or_,
                            AOp.Xor: operator.xor,
                        }[insn.operator]
                        src = insn.op(1)
                        dst = insn.op(0)
                        sv = getval(src)
                        dv = getval(dst)
                        fpu = isinstance(sv, float) or isinstance(dv, float)
                        try:
                            result = calculate(dv, sv)
                            if fpu and not isinstance(result, float):
                                raise FloatingPointError
                        except FloatingPointError as FPE:
                            if not self.fpucw &amp; FPUControl.InvalidOperation:
                                result = float(&#39;nan&#39;)
                            else:
                                raise IFPSException(&#39;invalid operation&#39;, FPE) from FPE
                        except OverflowError as OFE:
                            if fpu and self.fpucw &amp; FPUControl.Overflow:
                                result = float(&#39;nan&#39;)
                            else:
                                raise IFPSException(&#39;arithmetic overflow&#39;, OFE) from OFE
                        except ZeroDivisionError as ZDE:
                            if fpu and self.fpucw &amp; FPUControl.ZeroDivide:
                                result = float(&#39;nan&#39;)
                            else:
                                raise IFPSException(&#39;division by zero&#39;, ZDE) from ZDE
                        setval(dst, result)
                    elif opc == Op.Push:
                        # TODO: I do not actually know how this works
                        stack.append(getval(insn.op(0)))
                    elif opc == Op.PushVar:
                        stack.append(getvar(insn.op(0)))
                    elif opc == Op.Pop:
                        self.temp = stack.pop()
                    elif opc == Op.Call:
                        callstack.append(CallState(function, ip, sp, exceptions))
                        function = insn.operands[0]
                        ip = 0
                        sp = len(stack) - 1
                        exceptions = []
                        break
                    elif opc == Op.Jump:
                        ip = insn.operands[0]
                    elif opc == Op.JumpTrue:
                        if getval(insn.op(1)):
                            ip = insn.operands[0]
                    elif opc == Op.JumpFalse:
                        if not getval(insn.op(1)):
                            ip = insn.operands[0]
                    elif opc == Op.Ret:
                        del stack[sp + 1:]
                        if not callstack:
                            return
                        function, ip, sp, exceptions = callstack.pop()
                        break
                    elif opc == Op.StackType:
                        raise OpCodeNotImplemented(str(opc))
                    elif opc == Op.PushType:
                        stack.append(Variable(
                            insn.operands[0],
                            VariableSpec(len(stack) - sp, VariableType.Local)
                        ))
                    elif opc == Op.Compare:
                        compare = {
                            COp.GE: operator.ge,
                            COp.LE: operator.le,
                            COp.GT: operator.gt,
                            COp.LT: operator.lt,
                            COp.NE: operator.ne,
                            COp.EQ: operator.eq,
                            COp.IN: operator_in,
                            COp.IS: operator.is_,
                        }[insn.operator]
                        d = getvar(insn.op(0))
                        a = getval(insn.op(1))
                        b = getval(insn.op(2))
                        d.set(compare(a, b))
                    elif opc == Op.CallVar:
                        call = getval(insn.op(0))
                        if isinstance(call, int):
                            call = self.ifps.functions[call]
                        if isinstance(call, Function):
                            callstack.append(CallState(function, ip, sp, exceptions))
                            function = call
                            ip = 0
                            sp = len(stack) - 1
                            exceptions = []
                            break
                    elif opc in (Op.SetPtr, Op.SetPtrToCopy):
                        copy = False
                        if opc == Op.SetPtrToCopy:
                            copy = True
                        dst = getvar(insn.op(0))
                        src = getvar(insn.op(1))
                        dst.setptr(src, copy=copy)
                    elif opc == Op.BooleanNot:
                        setval(a := insn.op(0), not getval(a))
                    elif opc == Op.IntegerNot:
                        setval(a := insn.op(0), ~getval(a))
                    elif opc == Op.Neg:
                        setval(a := insn.op(0), -getval(a))
                    elif opc == Op.SetFlag:
                        condition, negated = insn.operands
                        self.jumpflag = getval(condition) ^ negated
                    elif opc == Op.JumpFlag:
                        if self.jumpflag:
                            ip = insn.operands[0]
                    elif opc == Op.PushEH:
                        exceptions.append(ExceptionHandler(*insn.operands))
                    elif opc == Op.PopEH:
                        tp = None
                        et = EHType(insn.operands[0])
                        eh = exceptions[-1]
                        if eh.current != et:
                            raise RuntimeError(F&#39;Expected {eh.current} block to end, but {et} was ended instead.&#39;)
                        while tp is None:
                            if et is None:
                                raise RuntimeError
                            tp, et = {
                                EHType.Catch         : (eh.finally_one, EHType.Finally),
                                EHType.Try           : (eh.finally_one, EHType.Finally),
                                EHType.Finally       : (eh.finally_two, EHType.SecondFinally),
                                EHType.SecondFinally : (eh.handler_end, None),
                            }[et]
                        eh.current = et
                        ip = tp
                        if et is None:
                            exceptions.pop()
                    elif opc == Op.Inc:
                        setval(a := insn.op(0), getval(a) + 1)
                    elif opc == Op.Dec:
                        setval(a := insn.op(0), getval(a) - 1)
                    elif opc == Op.JumpPop1:
                        stack.pop()
                        ip = insn.operands[0]
                    elif opc == Op.JumpPop2:
                        stack.pop()
                        stack.pop()
                        ip = insn.operands[0]
                    else:
                        raise RuntimeError(F&#39;Function contains invalid opcode at 0x{ip:X}.&#39;)
                except IFPSException as EE:
                    try:
                        eh = exceptions[-1]
                    except IndexError:
                        raise EE
                    et = EHType.Try
                    tp = None
                    while tp is None:
                        if et is None:
                            raise RuntimeError
                        tp, et = {
                            EHType.Try           : (eh.catch_error, EHType.Catch),
                            EHType.Catch         : (eh.finally_one, EHType.Finally),
                            EHType.Finally       : (eh.finally_two, EHType.SecondFinally),
                            EHType.SecondFinally : (eh.handler_end, None),
                        }[et]
                    if et is None:
                        raise EE
                    eh.current = et
                    ip = tp
                except AbortEmulation:
                    raise
                except EmulatorException:
                    raise
                except Exception as RE:
                    raise EmulatorException(
                        F&#39;In {function.symbol} at 0x{insn.offset:X} (cycle {self.clock}), &#39;
                        F&#39;emulation of {insn!r} failed: {RE!s}&#39;)
            if ip is None:
                raise RuntimeError(F&#39;Instruction pointer moved out of bounds to 0x{ip:X}.&#39;)

    external_symbols: ClassVar[
        dict[str,                        # class name for methods or empty string for functions
        dict[str, IFPSEmulatedFunction]] # method or function name to emulation info
    ] = CaseInsensitiveDict()

    def external(*args, static=True, __reg: dict = external_symbols, **kwargs):
        def decorator(pfn):
            signature = inspect.signature(pfn)
            name: str = kwargs.get(&#39;name&#39;, pfn.__name__)
            csep: str = &#39;.&#39;
            if csep not in name:
                csep = &#39;__&#39;
            classname, _, name = name.rpartition(csep)
            if (registry := __reg.get(classname)) is None:
                registry = __reg[classname] = CaseInsensitiveDict()

            docs = F&#39;{classname}::{name}&#39; if classname else name
            docs = F&#39;An emulated handler for the external symbol {docs}.&#39;
            pfn.__doc__ = docs

            void = kwargs.get(&#39;void&#39;, signature.return_annotation == signature.empty)
            parameters: list[bool] = []
            specs = iter(signature.parameters.values())
            if not static:
                next(specs)
            for spec in specs:
                try:
                    hint = evaluate(spec.annotation, globals(), locals())
                except Exception as E:
                    raise RuntimeError(F&#39;Invalid signature: {signature}&#39;) from E
                if not isinstance(hint, type):
                    hint = get_origin(hint)
                var = isinstance(hint, type) and issubclass(hint, Variable)
                parameters.append(var)
            registry[name] = e = IFPSEmulatedFunction(pfn, parameters, static, void)
            aliases = kwargs.get(&#39;alias&#39;, [])
            if isinstance(aliases, str):
                aliases = [aliases]
            for name in aliases:
                registry[name] = e
            if static:
                pfn = staticmethod(pfn)
            return pfn
        return decorator(args[0]) if args else decorator

    @external
    def TInputDirWizardPage__GetValues(this: object, k: int) -&gt; str:
        return F&#39;$InputDir{k}&#39;

    @external
    def TInputFileWizardPage__GetValues(this: object, k: int) -&gt; str:
        return F&#39;$InputFile{k}&#39;

    @external(static=False)
    def TPasswordEdit__SetText(self, this: object, value: str):
        if value:
            yield NewPassword(value)
        return value

    @external(static=False)
    def kernel32__GetTickCount(self) -&gt; int:
        tick = self.clock
        tick *= self.config.milliseconds_per_instruction
        tick += self.seconds_slept * 1000
        return int(tick)

    @external
    def user32__GetSystemMetrics(index: int) -&gt; int:
        if index == 80:
            return 1
        if index == 43:
            return 2
        return 0

    @external
    def IsX86Compatible() -&gt; bool:
        return True

    @external(alias=[
        &#39;sArm64&#39;,
        &#39;IsArm32Compatible&#39;,
        &#39;Debugging&#39;,
        &#39;IsUninstaller&#39;,
    ])
    def Terminated() -&gt; bool:
        return False

    @external(static=False)
    def IsAdmin(self) -&gt; bool:
        return self.config.admin

    @external(static=False, alias=&#39;Sleep&#39;)
    def kernel32__Sleep(self, ms: int):
        seconds = ms / 1000.0
        self.seconds_slept += seconds

    @external
    def Random(top: int) -&gt; int:
        return random.randrange(0, top)

    @external(alias=&#39;StrGet&#39;)
    def WStrGet(string: Variable[str], index: int) -&gt; str:
        if index &lt;= 0:
            raise ValueError
        return string[index - 1:index]

    @external(alias=&#39;StrSet&#39;)
    def WStrSet(char: str, index: int, dst: Variable[str]):
        old = dst.get()
        index -= 1
        dst.set(old[:index] + char + old[index:])

    @external(static=False)
    def GetEnv(self, name: str) -&gt; str:
        return self.config.environment.get(name, F&#39;%{name}%&#39;)

    @external
    def Beep():
        pass

    @external(static=False)
    def Abort(self):
        if self.config.throw_abort:
            raise AbortEmulation

    @external
    def DirExists(path: str) -&gt; bool:
        return True

    @external
    def ForceDirectories(path: str) -&gt; bool:
        return True

    @external(alias=&#39;LoadStringFromLockedFile&#39;)
    def LoadStringFromFile(path: str, out: Variable[str]) -&gt; bool:
        return True

    @external(alias=&#39;LoadStringsFromLockedFile&#39;)
    def LoadStringsFromFile(path: str, out: Variable[str]) -&gt; bool:
        return True

    @cached_property
    def constant_map(self) -&gt; dict[str, str]:
        cfg = self.config
        tmp = cfg.temp_path
        if not tmp:
            tmp = &#39;&#39;.join(random.choices(&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;, k=5))
            tmp = RF&#39;C:\Windows\Temp\IS-{tmp}&#39;
        map = {
            &#39;app&#39;               : cfg.install_to,
            &#39;win&#39;               : R&#39;C:\Windows&#39;,
            &#39;sys&#39;               : R&#39;C:\Windows\System&#39;,
            &#39;sysnative&#39;         : R&#39;C:\Windows\System32&#39;,
            &#39;src&#39;               : str(Path(cfg.executable).parent),
            &#39;sd&#39;                : R&#39;C:&#39;,
            &#39;commonpf&#39;          : R&#39;C:\Program Files&#39;,
            &#39;commoncf&#39;          : R&#39;C:\Program Files\Common Files&#39;,
            &#39;tmp&#39;               : tmp,
            &#39;commonfonts&#39;       : R&#39;C:\Windows\Fonts&#39;,
            &#39;dao&#39;               : R&#39;C:\Program Files\Common Files\Microsoft Shared\DAO&#39;,
            &#39;dotnet11&#39;          : R&#39;C:\Windows\Microsoft.NET\Framework\v1.1.4322&#39;,
            &#39;dotnet20&#39;          : R&#39;C:\Windows\Microsoft.NET\Framework\v3.0&#39;,
            &#39;dotnet2032&#39;        : R&#39;C:\Windows\Microsoft.NET\Framework\v3.0&#39;,
            &#39;dotnet40&#39;          : R&#39;C:\Windows\Microsoft.NET\Framework\v4.0.30319&#39;,
            &#39;dotnet4032&#39;        : R&#39;C:\Windows\Microsoft.NET\Framework\v4.0.30319&#39;,
            &#39;group&#39;             : RF&#39;C:\Users\{cfg.user_name}\Start Menu\Programs\{cfg.inno_name}&#39;,
            &#39;localappdata&#39;      : RF&#39;C:\Users\{cfg.user_name}\AppData\Local&#39;,
            &#39;userappdata&#39;       : RF&#39;C:\Users\{cfg.user_name}\AppData\Roaming&#39;,
            &#39;userdesktop&#39;       : RF&#39;C:\Users\{cfg.user_name}\Desktop&#39;,
            &#39;userdocs&#39;          : RF&#39;C:\Users\{cfg.user_name}\Documents&#39;,
            &#39;userfavourites&#39;    : RF&#39;C:\Users\{cfg.user_name}\Favourites&#39;,
            &#39;usersavedgames&#39;    : RF&#39;C:\Users\{cfg.user_name}\Saved Games&#39;,
            &#39;usersendto&#39;        : RF&#39;C:\Users\{cfg.user_name}\SendTo&#39;,
            &#39;userstartmenu&#39;     : RF&#39;C:\Users\{cfg.user_name}\Start Menu&#39;,
            &#39;userprograms&#39;      : RF&#39;C:\Users\{cfg.user_name}\Start Menu\Programs&#39;,
            &#39;userstartup&#39;       : RF&#39;C:\Users\{cfg.user_name}\Start Menu\Programs\Startup&#39;,
            &#39;usertemplates&#39;     : RF&#39;C:\Users\{cfg.user_name}\Templates&#39;,
            &#39;commonappdata&#39;     : R&#39;C:\ProgramData&#39;,
            &#39;commondesktop&#39;     : R&#39;C:\ProgramData\Microsoft\Windows\Desktop&#39;,
            &#39;commondocs&#39;        : R&#39;C:\ProgramData\Microsoft\Windows\Documents&#39;,
            &#39;commonstartmenu&#39;   : R&#39;C:\ProgramData\Microsoft\Windows\Start Menu&#39;,
            &#39;commonprograms&#39;    : R&#39;C:\ProgramData\Microsoft\Windows\Start Menu\Programs&#39;,
            &#39;commonstartup&#39;     : R&#39;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup&#39;,
            &#39;commontemplates&#39;   : R&#39;C:\ProgramData\Microsoft\Windows\Templates&#39;,
            &#39;cmd&#39;               : R&#39;C:\Windows\System32\cmd.exe&#39;,
            &#39;computername&#39;      : cfg.host_name,
            &#39;groupname&#39;         : cfg.inno_name,
            &#39;hwnd&#39;              : &#39;0&#39;,
            &#39;wizardhwnd&#39;        : &#39;0&#39;,
            &#39;language&#39;          : cfg.language,
            &#39;srcexe&#39;            : cfg.executable,
            &#39;sysuserinfoname&#39;   : &#39;{sysuserinfoname}&#39;,
            &#39;sysuserinfoorg&#39;    : &#39;{sysuserinfoorg}&#39;,
            &#39;userinfoname&#39;      : &#39;{userinfoname}&#39;,
            &#39;userinfoorg&#39;       : &#39;{userinfoorg}&#39;,
            &#39;userinfoserial&#39;    : &#39;{userinfoserial}&#39;,
            &#39;username&#39;          : cfg.user_name,
            &#39;log&#39;               : &#39;&#39;,
        }

        if (inno := self.inno) is None or (inno.setup_info.Header.Flags &amp; Flags.Uninstallable):
            map[&#39;uninstallexe&#39;] = RF&#39;{cfg.install_to}\unins000.exe&#39;

        if cfg.x64:
            map[&#39;syswow64&#39;] = R&#39;C:\Windows\SysWOW64&#39;
            map[&#39;commonpf32&#39;] = R&#39;C:\Program Files (x86)&#39;
            map[&#39;commoncf32&#39;] = R&#39;C:\Program Files (x86)\Common Files&#39;
            map[&#39;commonpf64&#39;] = R&#39;C:\Program Files&#39;
            map[&#39;commoncf64&#39;] = R&#39;C:\Program Files\Common Files&#39;
            map[&#39;dotnet2064&#39;] = R&#39;C:\Windows\Microsoft.NET\Framework64\v3.0&#39;
            map[&#39;dotnet4064&#39;] = R&#39;C:\Windows\Microsoft.NET\Framework64\v4.0.30319&#39;
        else:
            map[&#39;syswow64&#39;] = R&#39;C:\Windows\System32&#39;
            map[&#39;commonpf32&#39;] = R&#39;C:\Program Files&#39;
            map[&#39;commoncf32&#39;] = R&#39;C:\Program Files\Common Files&#39;

        if cfg.windows_os_version[0] &gt;= 10:
            map[&#39;userfonts&#39;] = RF&#39;{map[&#34;localappdata&#34;]}\Microsoft\Windows\Fonts&#39;

        if cfg.windows_os_version[0] &gt;= 7:
            map[&#39;usercf&#39;] = RF&#39;{map[&#34;localappdata&#34;]}\Programs\Common&#39;
            map[&#39;userpf&#39;] = RF&#39;{map[&#34;localappdata&#34;]}\Programs&#39;

        for auto_var, admin_var, user_var in [
            (&#39;autoappdata&#39;,       &#39;commonappdata&#39;,       &#39;userappdata&#39;,   ), # noqa
            (&#39;autocf&#39;,            &#39;commoncf&#39;,            &#39;usercf&#39;,        ), # noqa
            (&#39;autocf32&#39;,          &#39;commoncf32&#39;,          &#39;usercf&#39;,        ), # noqa
            (&#39;autocf64&#39;,          &#39;commoncf64&#39;,          &#39;usercf&#39;,        ), # noqa
            (&#39;autodesktop&#39;,       &#39;commondesktop&#39;,       &#39;userdesktop&#39;,   ), # noqa
            (&#39;autodocs&#39;,          &#39;commondocs&#39;,          &#39;userdocs&#39;,      ), # noqa
            (&#39;autofonts&#39;,         &#39;commonfonts&#39;,         &#39;userfonts&#39;,     ), # noqa
            (&#39;autopf&#39;,            &#39;commonpf&#39;,            &#39;userpf&#39;,        ), # noqa
            (&#39;autopf32&#39;,          &#39;commonpf32&#39;,          &#39;userpf&#39;,        ), # noqa
            (&#39;autopf64&#39;,          &#39;commonpf64&#39;,          &#39;userpf&#39;,        ), # noqa
            (&#39;autoprograms&#39;,      &#39;commonprograms&#39;,      &#39;userprograms&#39;,  ), # noqa
            (&#39;autostartmenu&#39;,     &#39;commonstartmenu&#39;,     &#39;userstartmenu&#39;, ), # noqa
            (&#39;autostartup&#39;,       &#39;commonstartup&#39;,       &#39;userstartup&#39;,   ), # noqa
            (&#39;autotemplates&#39;,     &#39;commontemplates&#39;,     &#39;usertemplates&#39;, ), # noqa
        ]:
            try:
                map[auto_var] = map[admin_var] if cfg.admin else map[user_var]
            except KeyError:
                continue

        for legacy, new in [
            (&#39;cf&#39;,     &#39;commoncf&#39;,    ), # noqa
            (&#39;cf32&#39;,   &#39;commoncf32&#39;,  ), # noqa
            (&#39;cf64&#39;,   &#39;commoncf64&#39;,  ), # noqa
            (&#39;fonts&#39;,  &#39;commonfonts&#39;, ), # noqa
            (&#39;pf&#39;,     &#39;commonpf&#39;,    ), # noqa
            (&#39;pf32&#39;,   &#39;commonpf32&#39;,  ), # noqa
            (&#39;pf64&#39;,   &#39;commonpf64&#39;,  ), # noqa
            (&#39;sendto&#39;, &#39;usersendto&#39;,  ), # noqa
        ]:
            try:
                map[legacy] = map[new]
            except KeyError:
                continue

        return map

    @external(static=False)
    def ExpandConstant(self, string: str) -&gt; str:
        return self.expand_constant(string)

    @external(static=False)
    def ExpandConstantEx(self, string: str, custom_var: str, custom_val: str) -&gt; str:
        return self.expand_constant(string, custom_var, custom_val)

    def expand_constant(
        self,
        string: str,
        custom_var: str | None = None,
        custom_val: str | None = None,
        unescape: bool = False
    ):
        config = self.config
        expand = partial(self.expand_constant, unescape=True)
        string = re.sub(r&#39;(\{\{.*?\}(?!\}))&#39;, &#39;\\1}&#39;, string)

        with io.StringIO() as result:
            constants = self.constant_map
            formatter = Formatter()
            backslash = False
            try:
                parsed = list(formatter.parse(string))
            except ValueError as VE:
                raise IFPSException(F&#39;invalid format string: {string!r}&#39;, VE) from VE
            for prefix, spec, modifier, conversion in parsed:
                if backslash and prefix[:1] == &#39;\\&#39;:
                    prefix = prefix[1:]
                if unescape:
                    prefix = unquote(prefix)
                result.write(prefix)
                if spec is None:
                    continue
                elif spec == &#39;\\&#39;:
                    if modifier or conversion:
                        raise IFPSException(&#39;Invalid format string.&#39;, ValueError(string))
                    value = spec
                elif spec == custom_var:
                    value = custom_val
                elif spec.startswith(&#39;%&#39;):
                    name, p, default = spec[1:].partition(&#39;|&#39;)
                    name = expand(name)
                    default = expand(default)
                    try:
                        value = config.environment[name]
                    except KeyError:
                        value = default if p else F&#39;%{name}%&#39;
                elif spec == &#39;drive&#39;:
                    value = self.ExtractFileDrive(expand(modifier))
                elif spec == &#39;ini&#39;:
                    # {ini:Filename,Section,Key|DefaultValue}
                    _, _, default = modifier.partition(&#39;|&#39;)
                    value = expand(default)
                elif spec == &#39;code&#39;:
                    # {code:FunctionName|Param}
                    symbol, _, param = modifier.partition(&#39;|&#39;)
                    param = expand(param)
                    try:
                        function = self.symbols[symbol]
                    except KeyError as KE:
                        raise IFPSException(F&#39;String formatter references missing function {symbol}.&#39;, KE) from KE
                    emulation = self.emulate_function(function, param)
                    value = str(emulation.value)
                elif spec == &#39;cm&#39;:
                    # {cm:LaunchProgram,Inno Setup}
                    # The example above translates to &#34;Launch Inno Setup&#34; if English is the active language.
                    name, _, placeholders = modifier.partition(&#39;,&#39;)
                    value = self.CustomMessage(expand(name))
                    if placeholders:
                        def _placeholder(match: re.Match[str]):
                            try:
                                return placeholders[int(match[1]) - 1]
                            except Exception:
                                return match[0]
                        placeholders = [ph.strip() for ph in placeholders.split(&#39;,&#39;)]
                        value = re.sub(&#39;(?&lt;!%)%([1-9]\\d*)&#39;, _placeholder, value)
                elif spec == &#39;reg&#39;:
                    # {reg:HKXX\SubkeyName,ValueName|DefaultValue}
                    _, _, default = modifier.partition(&#39;|&#39;)
                    value = expand(default)
                elif spec == &#39;param&#39;:
                    # {param:ParamName|DefaultValue}
                    _, _, default = modifier.partition(&#39;|&#39;)
                    value = expand(default)
                else:
                    try:
                        value = constants[spec]
                    except KeyError as KE:
                        raise IFPSException(F&#39;invalid format field {spec}&#39;, KE) from KE
                backslash = value.endswith(&#39;\\&#39;)
                result.write(value)
            return result.getvalue()

    @external
    def DeleteFile(path: str) -&gt; bool:
        return True

    @external
    def FileExists(file_name: str) -&gt; bool:
        return False

    @external
    def Log(log: str):
        ...

    @external
    def Inc(p: Variable[Variable[int]]):
        p.set(p.get() + 1)

    @external
    def Dec(p: Variable[Variable[int]]):
        p.set(p.get() - 1)

    @external
    def FindFirst(file_name: str, frec: Variable) -&gt; bool:
        return False

    @external
    def Trunc(x: float) -&gt; float:
        return math.trunc(x)

    @external
    def GetSpaceOnDisk(
        path: str,
        in_megabytes: bool,
        avail: Variable[int],
        space: Variable[int],
    ) -&gt; bool:
        _a = 3_000_000
        _t = 5_000_000
        if not in_megabytes:
            _a *= 1000
            _t *= 1000
        avail.set(_a)
        space.set(_t)
        return True

    @external
    def GetSpaceOnDisk64(
        path: str,
        avail: Variable[int],
        space: Variable[int],
    ) -&gt; bool:
        avail.set(3_000_000_000)
        space.set(5_000_000_000)
        return True

    @external
    def Exec(
        exe: str,
        cmd: str,
        cwd: str,
        show: int,
        wait: int,
        out: Variable[int],
    ) -&gt; bool:
        out.set(0)
        return True

    @external
    def GetCmdTail() -&gt; str:
        return &#39;&#39;

    @external
    def ParamCount() -&gt; int:
        return 0

    @external
    def ParamStr(index: int) -&gt; str:
        return &#39;&#39;

    @external
    def ActiveLanguage() -&gt; str:
        return &#39;en&#39;

    @external(static=False)
    def CustomMessage(self, msg_name: str) -&gt; str:
        by_language = {}
        for msg in self.inno.setup_info.Messages:
            if msg.EncodedName == msg_name:
                lng = msg.get_language_value().Name
                if lng == self.config.language:
                    return msg.Value
                by_language[lng] = msg.Value
        try:
            return by_language[0]
        except KeyError:
            pass
        try:
            return next(iter(by_language.values()))
        except StopIteration:
            raise IFPSException(F&#39;Custom message with name {msg_name} not found.&#39;)

    @external
    def FmtMessage(fmt: str, args: list[str]) -&gt; str:
        fmt = fmt.replace(&#39;{&#39;, &#39;{{&#39;)
        fmt = fmt.replace(&#39;}&#39;, &#39;}}&#39;)
        fmt = &#39;%&#39;.join(re.sub(&#39;%(\\d+)&#39;, &#39;{\\1}&#39;, p) for p in fmt.split(&#39;%%&#39;))
        return fmt.format(*args)

    @external
    def Format(fmt: str, args: list[str | int | float]) -&gt; str:
        try:
            formatted = fmt % tuple(args)
        except Exception:
            raise IFPSException(&#39;invalid format&#39;)
        else:
            return formatted

    @external(static=False)
    def SetupMessage(self, id: int) -&gt; str:
        try:
            return self.inno.setup_info.Messages[id].Value
        except (AttributeError, IndexError):
            return &#39;&#39;

    @external(static=False, alias=[&#39;Is64BitInstallMode&#39;, &#39;IsX64Compatible&#39;, &#39;IsX64OS&#39;])
    def IsWin64(self) -&gt; bool:
        return self.config.x64

    @external(static=False)
    def IsX86OS(self) -&gt; bool:
        return not self.config.x64

    @external
    def RaiseException(msg: str):
        raise IFPSException(msg)

    @external(static=False)
    def ProcessorArchitecture(self) -&gt; int:
        if self.config.x64:
            return TSetupProcessorArchitecture.paX64.value
        else:
            return TSetupProcessorArchitecture.paX86.value

    @external(static=False)
    def GetUserNameString(self) -&gt; str:
        return self.config.user_name

    @external(static=False)
    def GetComputerNameString(self) -&gt; str:
        return self.config.host_name

    @external(static=False)
    def GetUILanguage(self) -&gt; str:
        return self.config.lcid

    @external
    def GetArrayLength(array: Variable) -&gt; int:
        array = array.deref()
        return len(array)

    @external
    def SetArrayLength(array: Variable, n: int):
        a = array.deref()
        a.resize(n)

    @external(static=False)
    def WizardForm(self) -&gt; object:
        return self

    @external
    def Unassigned() -&gt; None:
        return None

    @external
    def Null() -&gt; None:
        return None

    @external(static=False)
    def Set8087CW(self, cw: int):
        self.fpucw = FPUControl(cw)

    @external(static=False)
    def Get8087CW(self) -&gt; int:
        return self.fpucw.value

    @external(static=False)
    def GetDateTimeString(
        self,
        fmt: str,
        date_separator: str,
        time_separator: str,
    ) -&gt; str:

        now = self.config.start_time
        now = now + timedelta(
            milliseconds=(self.config.milliseconds_per_instruction * self.clock))
        now = now + timedelta(seconds=self.seconds_slept)

        date_separator = date_separator.lstrip(&#39;\0&#39;)
        time_separator = time_separator.lstrip(&#39;\0&#39;)

        def dt(m: re.Match[str]):
            spec = m[1]
            ampm = m[2]
            if ampm:
                am, _, pm = ampm.partition(&#39;/&#39;)
                spec = spec.upper()
                suffix = now.strftime(&#39;%p&#39;).lower()
                suffix = {&#39;am&#39;: am, &#39;pm&#39;: pm}[suffix]
            else:
                suffix = &#39;&#39;
            if spec == &#39;dddddd&#39; or spec == &#39;ddddd&#39;:
                return now.date().isoformat()
            if spec == &#39;t&#39;:
                return now.time().isoformat(&#39;minutes&#39;)
            if spec == &#39;tt&#39;:
                return now.time().isoformat(&#39;seconds&#39;)
            if spec == &#39;d&#39;:
                return str(now.day)
            if spec == &#39;m&#39;:
                return str(now.month)
            if spec == &#39;h&#39;:
                return str(now.hour)
            if spec == &#39;n&#39;:
                return str(now.minute)
            if spec == &#39;s&#39;:
                return str(now.second)
            if spec == &#39;H&#39;:
                return now.strftime(&#39;%I&#39;).lstrip(&#39;0&#39;) + suffix
            if spec == &#39;/&#39;:
                return date_separator or spec
            if spec == &#39;:&#39;:
                return time_separator or spec
            return now.strftime({
                &#39;dddd&#39;  : &#39;%A&#39;,
                &#39;ddd&#39;   : &#39;%a&#39;,
                &#39;dd&#39;    : &#39;%d&#39;,
                &#39;mmmm&#39;  : &#39;%B&#39;,
                &#39;mmm&#39;   : &#39;%b&#39;,
                &#39;mm&#39;    : &#39;%m&#39;,
                &#39;yyyy&#39;  : &#39;%Y&#39;,
                &#39;yy&#39;    : &#39;%y&#39;,
                &#39;hh&#39;    : &#39;%H&#39;,
                &#39;HH&#39;    : &#39;%I&#39; + suffix,
                &#39;nn&#39;    : &#39;%M&#39;,
                &#39;ss&#39;    : &#39;%S&#39;,
            }.get(spec, m[0]))

        split = re.split(F&#39;({formats.string!s})&#39;, fmt)
        for k in range(0, len(split), 2):
            split[k] = re.sub(&#39;([dmyhnst]+)((?:[aA][mM]?/[pP][mM]?)?)&#39;, dt, split[k])
        for k in range(1, len(split), 2):
            split[k] = split[k][1:-1]
        return &#39;&#39;.join(split)

    @external
    def Chr(b: int) -&gt; str:
        return chr(b)

    @external
    def Ord(c: str) -&gt; int:
        return ord(c)

    @external
    def Copy(string: str, index: int, count: int) -&gt; str:
        index -= 1
        return string[index:index + count]

    @external
    def Length(string: str) -&gt; int:
        return len(string)

    @external(alias=&#39;AnsiLowercase&#39;)
    def Lowercase(string: str) -&gt; str:
        return string.lower()

    @external(alias=&#39;AnsiUppercase&#39;)
    def Uppercase(string: str) -&gt; str:
        return string.upper()

    @external
    def StringOfChar(c: str, count: int) -&gt; str:
        return c * count

    @external
    def Delete(string: Variable[str], index: int, count: int):
        index -= 1
        old = string.get()
        string.set(old[:index] + old[index + count:])

    @external
    def Insert(string: str, dest: Variable[str], index: int):
        index -= 1
        old = dest.get()
        dest.set(old[:index] + string + old[index:])

    @external(static=False)
    def StringChange(self, string: Variable[str], old: str, new: str) -&gt; int:
        return self.StringChangeEx(string, old, new, False)

    @external
    def StringChangeEx(string: Variable[str], old: str, new: str, _: bool) -&gt; int:
        haystack = string.get()
        count = haystack.count(old)
        string.set(haystack.replace(old, new))
        return count

    @external
    def Pos(string: str, sub: str) -&gt; int:
        return string.find(sub) + 1

    @external
    def AddQuotes(string: str) -&gt; str:
        if string and (string[0] != &#39;&#34;&#39; or string[~0] != &#39;&#34;&#39;) and &#39; &#39; in string:
            string = F&#39;&#34;{string}&#34;&#39;
        return string

    @external
    def RemoveQuotes(string: str) -&gt; str:
        if string and string[0] == &#39;&#34;&#39; and string[~0] == &#39;&#34;&#39;:
            string = string[1:-1]
        return string

    @external(static=False)
    def CompareText(self, a: str, b: str) -&gt; int:
        return self.CompareStr(a.casefold(), b.casefold())

    @external
    def CompareStr(a: str, b: str) -&gt; int:
        if a &gt; b:
            return +1
        if a &lt; b:
            return -1
        return 0

    @external
    def SameText(a: str, b: str) -&gt; bool:
        return a.casefold() == b.casefold()

    @external
    def SameStr(a: str, b: str) -&gt; bool:
        return a == b

    @external
    def IsWildcard(pattern: str) -&gt; bool:
        return &#39;*&#39; in pattern or &#39;?&#39; in pattern

    @external
    def WildcardMatch(text: str, pattern: str) -&gt; bool:
        return fnmatch.fnmatch(text, pattern)

    @external
    def Trim(string: str) -&gt; str:
        return string.strip()

    @external
    def TrimLeft(string: str) -&gt; str:
        return string.lstrip()

    @external
    def TrimRight(string: str) -&gt; str:
        return string.rstrip()

    @external
    def StringJoin(sep: str, values: list[str]) -&gt; str:
        return sep.join(values)

    @external
    def StringSplitEx(string: str, separators: list[str], quote: str, how: TSplitType) -&gt; list[str]:
        if not quote:
            parts = [string]
        else:
            quote = re.escape(quote)
            parts = re.split(F&#39;({quote}.*?{quote})&#39;, string)
        sep = &#39;|&#39;.join(re.escape(s) for s in separators)
        out = []
        if how == TSplitType.stExcludeEmpty:
            sep = F&#39;(?:{sep})+&#39;
        for k in range(0, len(parts)):
            if k &amp; 1 == 1:
                out.append(parts[k])
                continue
            out.extend(re.split(sep, string))
        if how == TSplitType.stExcludeLastEmpty:
            for k in reversed(range(len(out))):
                if not out[k]:
                    out.pop(k)
                    break
        return out

    @external(static=False)
    def StringSplit(self, string: str, separators: list[str], how: TSplitType) -&gt; list[str]:
        return self.StringSplitEx(string, separators, None, how)

    @external(alias=&#39;StrToInt64&#39;)
    def StrToInt(s: str) -&gt; int:
        return int(s)

    @external(alias=&#39;StrToInt64Def&#39;)
    def StrToIntDef(s: str, d: int) -&gt; int:
        try:
            return int(s)
        except Exception:
            return d

    @external
    def StrToFloat(s: str) -&gt; float:
        return float(s)

    @external(alias=&#39;FloatToStr&#39;)
    def IntToStr(i: int) -&gt; str:
        return str(i)

    @external
    def StrToVersion(s: str, v: Variable[int]) -&gt; bool:
        try:
            packed = bytes(map(int, s.split(&#39;.&#39;)))
        except Exception:
            return False
        if len(packed) != 4:
            return False
        v.set(int.from_bytes(packed, &#39;little&#39;))
        return True

    @external
    def CharLength(string: str, index: int) -&gt; int:
        return 1

    @external
    def AddBackslash(string: str) -&gt; str:
        if string and string[~0] != &#39;\\&#39;:
            string = F&#39;{string}\\&#39;
        return string

    @external
    def AddPeriod(string: str) -&gt; str:
        if string and string[~0] != &#39;.&#39;:
            string = F&#39;{string}.&#39;
        return string

    @external(static=False)
    def RemoveBackslashUnlessRoot(self, string: str) -&gt; str:
        path = Path(string)
        if len(path.parts) == 1:
            return str(path)
        return self.RemoveBackslash(string)

    @external
    def RemoveBackslash(string: str) -&gt; str:
        return string.rstrip(&#39;\\/&#39;)

    @external
    def ChangeFileExt(name: str, ext: str) -&gt; str:
        if not ext.startswith(&#39;.&#39;):
            ext = F&#39;.{ext}&#39;
        return str(Path(name).with_suffix(ext))

    @external
    def ExtractFileExt(name: str) -&gt; str:
        return Path(name).suffix

    @external(alias=&#39;ExtractFilePath&#39;)
    def ExtractFileDir(name: str) -&gt; str:
        dirname = str(Path(name).parent)
        return &#39;&#39; if dirname == &#39;.&#39; else dirname

    @external
    def ExtractFileName(name: str) -&gt; str:
        if name:
            name = Path(name).parts[-1]
        return name

    @external
    def ExtractFileDrive(name: str) -&gt; str:
        if name:
            parts = Path(name).parts
            if len(parts) &gt;= 2 and parts[0] == &#39;\\&#39; and parts[1] == &#39;?&#39;:
                parts = parts[2:]
            if parts[0] == &#39;\\&#39;:
                if len(parts) &gt;= 3:
                    return &#39;\\&#39;.join(parts[:3])
            else:
                root = parts[0]
                if len(root) == 2 and root[1] == &#39;:&#39;:
                    return root
        return &#39;&#39;

    @external
    def ExtractRelativePath(base: str, dst: str) -&gt; str:
        return str(Path(dst).relative_to(base))

    @external(static=False, alias=&#39;ExpandUNCFileName&#39;)
    def ExpandFileName(self, name: str) -&gt; str:
        if self.ExtractFileDrive(name):
            return name
        return str(self.config.cwd / name)

    @external
    def SetLength(string: Variable[str], size: int):
        old = string.get()
        old = old.ljust(size, &#39;\0&#39;)
        string.set(old[:size])

    @external(alias=&#39;OemToCharBuff&#39;)
    def CharToOemBuff(string: str) -&gt; str:
        # TODO
        return string

    @external
    def Utf8Encode(string: str) -&gt; str:
        return string.encode(&#39;utf8&#39;).decode(&#39;latin1&#39;)

    @external
    def Utf8Decode(string: str) -&gt; str:
        return string.encode(&#39;latin1&#39;).decode(&#39;utf8&#39;)

    @external
    def GetMD5OfString(string: str) -&gt; str:
        return hashlib.md5(string.encode(&#39;latin1&#39;)).hexdigest()

    @external
    def GetMD5OfUnicodeString(string: str) -&gt; str:
        return hashlib.md5(string.encode(&#39;utf8&#39;)).hexdigest()

    @external
    def GetSHA1OfString(string: str) -&gt; str:
        return hashlib.sha1(string.encode(&#39;latin1&#39;)).hexdigest()

    @external
    def GetSHA1OfUnicodeString(string: str) -&gt; str:
        return hashlib.sha1(string.encode(&#39;utf8&#39;)).hexdigest()

    @external
    def GetSHA256OfString(string: str) -&gt; str:
        return hashlib.sha256(string.encode(&#39;latin1&#39;)).hexdigest()

    @external
    def GetSHA256OfUnicodeString(string: str) -&gt; str:
        return hashlib.sha256(string.encode(&#39;utf8&#39;)).hexdigest()

    @external
    def SysErrorMessage(code: int) -&gt; str:
        return F&#39;[description for error {code:08X}]&#39;

    @external
    def MinimizePathName(path: str, font: object, max_len: int) -&gt; str:
        return path

    @external(static=False)
    def CheckForMutexes(self, mutexes: str) -&gt; bool:
        return any(m in self.mutexes for m in mutexes.split(&#39;,&#39;))

    @external(static=False)
    def CreateMutex(self, name: str):
        if self.config.log_mutexes:
            yield NewMutex(name)
        self.mutexes.add(name)

    @external(static=False)
    def GetWinDir(self) -&gt; str:
        return self.expand_constant(&#39;{win}&#39;)

    @external(static=False)
    def GetSystemDir(self) -&gt; str:
        return self.expand_constant(&#39;{sys}&#39;)

    @external(static=False)
    def GetWindowsVersion(self) -&gt; int:
        version = int.from_bytes(
            struct.pack(&#39;&gt;BBH&#39;, *self.config.windows_os_version), &#39;big&#39;)
        return version

    @external(static=False)
    def GetWindowsVersionEx(self, tv: Variable[int | bool]):
        tv[0], tv[1], tv[2] = self.config.windows_os_version # noqa
        tv[3], tv[4]        = self.config.windows_sp_version # noqa
        tv[5], tv[6], tv[7] = True, 0, 0

    @external(static=False)
    def GetWindowsVersionString(self) -&gt; str:
        return &#39;{}.{:02d}.{:04d}&#39;.format(*self.config.windows_os_version)

    @external
    def CreateOleObject(name: str) -&gt; OleObject:
        return OleObject(name)

    @external
    def GetActiveOleObject(name: str) -&gt; OleObject:
        return OleObject(name)

    @external
    def IDispatchInvoke(ole: OleObject, prop_set: bool, name: str, value: Any) -&gt; int:
        return 0

    @external
    def FindWindowByClassName(name: str) -&gt; int:
        return 0

    @external
    def FindWindowByWindowName(name: str) -&gt; int:
        return 0

    @external(static=False)
    def WizardSilent(self) -&gt; bool:
        return self.config.wizard_silent

    @external(static=False)
    def SizeOf(self, var: Variable) -&gt; int:
        if var.pointer:
            return (self.config.x64 + 1) * 4
        if var.container:
            return sum(self.SizeOf(x) for x in var.data)
        return var.type.code.width

    del external


class InnoSetupEmulator(IFPSEmulator):
    &#34;&#34;&#34;
    A specialized `refinery.lib.emulator.IFPSEmulator` that can emulate the InnoSetup installation
    with a focus on continuing execution as much as possible.
    &#34;&#34;&#34;

    def emulate_installation(self, password=&#39;&#39;):
        &#34;&#34;&#34;
        To the best of the author&#39;s knowledge, this function emulates the sequence of calls into
        the script that the IFPS runtime would make during a setup install.
        &#34;&#34;&#34;

        class SetupDispatcher:

            InitializeSetup: Callable
            InitializeWizard: Callable
            CurStepChanged: Callable
            ShouldSkipPage: Callable
            CurPageChanged: Callable
            PrepareToInstall: Callable
            CheckPassword: Callable
            NextButtonClick: Callable
            DeinitializeSetup: Callable

            def __getattr__(_, name):
                if pfn := self.symbols.get(name):
                    def emulated(*a):
                        return (yield from self.emulate_function(pfn, *a))
                else:
                    def emulated(*a):
                        yield from ()
                        return False
                return emulated

        Setup = SetupDispatcher()

        yield from Setup.InitializeSetup()
        yield from Setup.InitializeWizard()
        yield from Setup.CurStepChanged(TSetupStep.ssPreInstall)

        for page in PageID:

            skip = yield from Setup.ShouldSkipPage(page)

            if not skip:
                yield from Setup.CurPageChanged(page)
                if page == PageID.wpPreparing:
                    yield from Setup.PrepareToInstall(False)
                if page == PageID.wpPassword:
                    yield from Setup.CheckPassword(password)

            yield from Setup.NextButtonClick(page)

            if page == PageID.wpPreparing:
                yield from Setup.CurStepChanged(TSetupStep.ssInstall)
            if page == PageID.wpInfoAfter:
                yield from Setup.CurStepChanged(TSetupStep.ssPostInstall)

        yield from Setup.CurStepChanged(TSetupStep.ssDone)
        yield from Setup.DeinitializeSetup()

    def unimplemented(self, function: Function):
        &#34;&#34;&#34;
        Any unimplemented function is essentially skipped. Any arguments passed by reference and
        all return values that are of type integer are set to `1` in an attempt to indicate success
        wherever possible.
        &#34;&#34;&#34;
        decl = function.decl
        if decl is None:
            return
        if not decl.void:
            rc = 1
            rv = self.stack[-1]
            if not rv.container:
                rt = rv.type.py_type()
                if isinstance(rt, type) and issubclass(rt, int):
                    rv.set(1)
        else:
            rc = 0
        for k in range(rc, rc + len(decl.parameters)):
            ptr: Variable[Variable] = self.stack[-k]
            if not ptr.pointer:
                continue
            var = ptr.deref()
            if var.container:
                continue
            vt = var.type.py_type()
            if isinstance(vt, type) and issubclass(vt, int):
                var.set(1)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="refinery.lib.inno.emulator.OleObject"><code class="flex name class">
<span>class <span class="ident">OleObject</span></span>
<span>(</span><span>name)</span>
</code></dt>
<dd>
<section class="desc"><p>A dummy object representing an OLE interface created by an IFPS script. All it does so far is
to remember the name of the object that was requested.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L77-L89" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class OleObject:
    &#34;&#34;&#34;
    A dummy object representing an OLE interface created by an IFPS script. All it does so far is
    to remember the name of the object that was requested.
    &#34;&#34;&#34;
    def __init__(self, name):
        self.name = name

    def __repr__(self):
        return F&#39;OleObject({self.name!r})&#39;

    def __str__(self):
        return self.name</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.Variable"><code class="flex name class">
<span>class <span class="ident">Variable</span></span>
<span>(</span><span>type, spec=None, path=(), data=None)</span>
</code></dt>
<dd>
<section class="desc"><p>This class represents a global or stack variable in the IFPS runtime.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L95-L345" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class Variable(VariableBase, Generic[_T]):
    &#34;&#34;&#34;
    This class represents a global or stack variable in the IFPS runtime.
    &#34;&#34;&#34;
    data: list[Variable] | _T | None
    &#34;&#34;&#34;
    The variable&#39;s value. This is a list of `refinery.lib.inno.emulator.Variable`s for container
    types, a `refinery.lib.inno.emulator.Variable` for pointer types, and a basic type otherwise.
    &#34;&#34;&#34;
    path: tuple[int, ...]
    &#34;&#34;&#34;
    A tuple of integers that specify the seuqnce of indices required to access it, relative to the
    base variable given via `spec`.
    &#34;&#34;&#34;

    __slots__ = (
        &#39;data&#39;,
        &#39;path&#39;,
        &#39;_int_size&#39;,
        &#39;_int_mask&#39;,
        &#39;_int_bits&#39;,
        &#39;_int_good&#39;,
    )

    @property
    def container(self):
        &#34;&#34;&#34;
        A boolean indicating whether the given variable is a container.
        &#34;&#34;&#34;
        return self.type.container

    @property
    def pointer(self):
        &#34;&#34;&#34;
        A boolean indicating whether the given variable is a pointer.
        &#34;&#34;&#34;
        return self.type.code == TC.Pointer

    def __len__(self):
        return len(self.data)

    def __bool__(self):
        return True

    def __getitem__(self, key: int):
        var = self.deref()
        if var.container:
            return var.at(key).get()
        else:
            return var.data[key]

    def __setitem__(self, key: int, v: _T):
        var = self.deref()
        if var.container:
            var.at(key).set(v)
        else:
            var.data[key] = var._wrap(v)

    def at(self, k: int):
        &#34;&#34;&#34;
        Provides index access for the variable. If the variable is a pointer, it is dereferenced
        before accessing the data.
        &#34;&#34;&#34;
        return self.deref().data[k]

    def deref(var):
        &#34;&#34;&#34;
        Dereferences the variable until it is no longer a pointer and returns the result. If the
        variable is not a pointer, this function returns the variable itself.
        &#34;&#34;&#34;
        while True:
            val = var.data
            if not isinstance(val, Variable):
                return var
            var = val

    def __init__(
        self,
        type: IFPSType,
        spec: VariableSpec | None = None,
        path: tuple[int, ...] = (),
        data: _T | list | None = None
    ):
        super().__init__(type, spec)
        self.path = path

        self._int_size = _size = {
            TC.U08: +1,
            TC.U16: +1,
            TC.U32: +1,
            TC.S08: -1,
            TC.S16: -1,
            TC.S32: -1,
            TC.S64: -1,
        }.get((code := type.code), 0) * code.width
        if _size:
            bits = abs(_size) * 8
            umax = (1 &lt;&lt; bits)
            self._int_bits = bits
            self._int_mask = umax - 1
            if _size &lt; 0:
                self._int_good = range(-(umax &gt;&gt; 1), (umax &gt;&gt; 1))
            else:
                self._int_good = range(umax)
        else:
            self._int_mask = NoMask
            self._int_bits = INF
            self._int_good = AST

        if data is None:
            self.setdefault()
        else:
            self.set(data)

    def setdefault(self):
        &#34;&#34;&#34;
        Set this variable&#39;s data to the default value for its type. This also initializes the
        values of any contained variables recursively.
        &#34;&#34;&#34;
        spec = self.spec
        path = self.path

        def default(type: IFPSType, *sub_path):
            if isinstance(type, TRecord):
                return [Variable(t, spec, (*path, *sub_path, k)) for k, t in enumerate(type.members)]
            if isinstance(type, TStaticArray):
                t = type.type
                return [Variable(t, spec, (*path, *sub_path, k)) for k in range(type.size)]
            if isinstance(type, TArray):
                return []
            if sub_path:
                return Variable(type, spec, (*path, *sub_path))
            elif type.code == TC.Pointer:
                return Variable(_VariantType)
            else:
                return type.default()

        self.data = default(self.type)

    def _wrap(self, value: Value | _T, key: int | None = None) -&gt; _T:
        if (t := self.type.py_type(key)) and not isinstance(value, t):
            if issubclass(t, int):
                if isinstance(value, str) and len(value) == 1:
                    return ord(value[0])
                if isinstance(value, float):
                    return int(value)
            elif isinstance(value, int):
                if issubclass(t, str):
                    return chr(value)
                if issubclass(t, float):
                    return float(value)
            raise TypeError(F&#39;Assigning value {value!r} to variable of type {self.type}.&#39;)
        if s := self._int_size and value not in self._int_good:
            mask = self._int_mask
            value &amp;= mask
            if s &lt; 0 and (value &gt;&gt; (self._int_bits - 1)):
                value = -(-value &amp; mask)
        return value

    def resize(self, n: int):
        &#34;&#34;&#34;
        This function is only valid for container type variables. It re-sizes the data list to
        ensure that the container stores exactly `n` sub-variables.
        &#34;&#34;&#34;
        t = self.type
        m = n - len(self.data)
        if t.code != TC.Array:
            if t.code not in (TC.StaticArray, TC.Record):
                raise TypeError
            if n == t.size:
                return
            raise ValueError(F&#39;Attempt to resize {t} of size {t.size} to {n}.&#39;)
        if m &lt;= 0:
            del self.data[n:]
            return
        for k in range(m):
            self.data.append(Variable(t.type, self.spec, (*self.path, k)))

    def setptr(self, var: Variable, copy: bool = False):
        &#34;&#34;&#34;
        This method is used to point a pointer variable to a target. This is different from calling
        the `refinery.lib.inno.emulator.Variable.set` method as the latter would try to dereference
        the pointer and assign to its target; this method sets the value of the pointer itself.
        &#34;&#34;&#34;
        if not self.pointer:
            raise TypeError
        if not isinstance(var, Variable):
            raise TypeError
        if copy:
            var = Variable(var.type, data=var.get())
        self.data = var

    def set(self, value: _T | Sequence | Variable):
        &#34;&#34;&#34;
        Assign a new value to the variable. This can either be an immediate value or a variable.
        For container types, it can also be a sequence of those.
        &#34;&#34;&#34;
        if isinstance(value, Variable):
            value = value.get()
        elif isinstance(value, (Enum, Value)):
            value = value.value
        if self.pointer:
            return self.deref().set(value)
        elif self.container:
            if not isinstance(value, (list, tuple)):
                raise TypeError
            self.resize(len(value))
            for k, v in enumerate(value):
                self.data[k].set(v)
        else:
            self.data = self._wrap(value)

    def get(self) -&gt; _T:
        &#34;&#34;&#34;
        Return a representation of this variable that consists only of base types. For example, the
        result for a container type will not be a list of `refinery.lib.inno.emulator.Variable`s,
        but a list of their contents.
        &#34;&#34;&#34;
        if self.pointer:
            return self.deref().get()
        if self.container:
            data: list[Variable] = self.data
            return [v.get() for v in data]
        return self.data

    @property
    def name(self):
        &#34;&#34;&#34;
        Return the name of the variable as given by its spec.
        &#34;&#34;&#34;
        if self.spec is None:
            return &#39;Unbound&#39;
        name = F&#39;{self.spec!s}&#39;
        for k in self.path:
            name = F&#39;{name}[{k}]&#39;
        return name

    def __repr__(self):
        rep = self.name
        if (val := self.data) is None:
            return rep
        if self.type.code is TC.Set:
            val = F&#39;{val:b}&#39;
        elif self.pointer:
            val: Variable
            return F&#39;{rep} -&gt; {val.name}&#39;
        elif isinstance(val, (str, int, float, list)):
            val = repr(self.get())
        else:
            return rep
        return F&#39;{rep} = {val}&#39;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.lib.inno.ifps.VariableBase" href="ifps.html#refinery.lib.inno.ifps.VariableBase">VariableBase</a></li>
<li>typing.Generic</li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.Variable.container"><code class="name">var <span class="ident">container</span></code></dt>
<dd>
<section class="desc"><p>A boolean indicating whether the given variable is a container.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L119-L124" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def container(self):
    &#34;&#34;&#34;
    A boolean indicating whether the given variable is a container.
    &#34;&#34;&#34;
    return self.type.container</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.Variable.pointer"><code class="name">var <span class="ident">pointer</span></code></dt>
<dd>
<section class="desc"><p>A boolean indicating whether the given variable is a pointer.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L126-L131" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def pointer(self):
    &#34;&#34;&#34;
    A boolean indicating whether the given variable is a pointer.
    &#34;&#34;&#34;
    return self.type.code == TC.Pointer</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.Variable.name"><code class="name">var <span class="ident">name</span></code></dt>
<dd>
<section class="desc"><p>Return the name of the variable as given by its spec.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L320-L330" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def name(self):
    &#34;&#34;&#34;
    Return the name of the variable as given by its spec.
    &#34;&#34;&#34;
    if self.spec is None:
        return &#39;Unbound&#39;
    name = F&#39;{self.spec!s}&#39;
    for k in self.path:
        name = F&#39;{name}[{k}]&#39;
    return name</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.Variable.data"><code class="name">var <span class="ident">data</span></code></dt>
<dd>
<section class="desc"><p>The variable's value. This is a list of <code><a title="refinery.lib.inno.emulator.Variable" href="#refinery.lib.inno.emulator.Variable">Variable</a></code>s for container
types, a <code><a title="refinery.lib.inno.emulator.Variable" href="#refinery.lib.inno.emulator.Variable">Variable</a></code> for pointer types, and a basic type otherwise.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L95-L345" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class Variable(VariableBase, Generic[_T]):
    &#34;&#34;&#34;
    This class represents a global or stack variable in the IFPS runtime.
    &#34;&#34;&#34;
    data: list[Variable] | _T | None
    &#34;&#34;&#34;
    The variable&#39;s value. This is a list of `refinery.lib.inno.emulator.Variable`s for container
    types, a `refinery.lib.inno.emulator.Variable` for pointer types, and a basic type otherwise.
    &#34;&#34;&#34;
    path: tuple[int, ...]
    &#34;&#34;&#34;
    A tuple of integers that specify the seuqnce of indices required to access it, relative to the
    base variable given via `spec`.
    &#34;&#34;&#34;

    __slots__ = (
        &#39;data&#39;,
        &#39;path&#39;,
        &#39;_int_size&#39;,
        &#39;_int_mask&#39;,
        &#39;_int_bits&#39;,
        &#39;_int_good&#39;,
    )

    @property
    def container(self):
        &#34;&#34;&#34;
        A boolean indicating whether the given variable is a container.
        &#34;&#34;&#34;
        return self.type.container

    @property
    def pointer(self):
        &#34;&#34;&#34;
        A boolean indicating whether the given variable is a pointer.
        &#34;&#34;&#34;
        return self.type.code == TC.Pointer

    def __len__(self):
        return len(self.data)

    def __bool__(self):
        return True

    def __getitem__(self, key: int):
        var = self.deref()
        if var.container:
            return var.at(key).get()
        else:
            return var.data[key]

    def __setitem__(self, key: int, v: _T):
        var = self.deref()
        if var.container:
            var.at(key).set(v)
        else:
            var.data[key] = var._wrap(v)

    def at(self, k: int):
        &#34;&#34;&#34;
        Provides index access for the variable. If the variable is a pointer, it is dereferenced
        before accessing the data.
        &#34;&#34;&#34;
        return self.deref().data[k]

    def deref(var):
        &#34;&#34;&#34;
        Dereferences the variable until it is no longer a pointer and returns the result. If the
        variable is not a pointer, this function returns the variable itself.
        &#34;&#34;&#34;
        while True:
            val = var.data
            if not isinstance(val, Variable):
                return var
            var = val

    def __init__(
        self,
        type: IFPSType,
        spec: VariableSpec | None = None,
        path: tuple[int, ...] = (),
        data: _T | list | None = None
    ):
        super().__init__(type, spec)
        self.path = path

        self._int_size = _size = {
            TC.U08: +1,
            TC.U16: +1,
            TC.U32: +1,
            TC.S08: -1,
            TC.S16: -1,
            TC.S32: -1,
            TC.S64: -1,
        }.get((code := type.code), 0) * code.width
        if _size:
            bits = abs(_size) * 8
            umax = (1 &lt;&lt; bits)
            self._int_bits = bits
            self._int_mask = umax - 1
            if _size &lt; 0:
                self._int_good = range(-(umax &gt;&gt; 1), (umax &gt;&gt; 1))
            else:
                self._int_good = range(umax)
        else:
            self._int_mask = NoMask
            self._int_bits = INF
            self._int_good = AST

        if data is None:
            self.setdefault()
        else:
            self.set(data)

    def setdefault(self):
        &#34;&#34;&#34;
        Set this variable&#39;s data to the default value for its type. This also initializes the
        values of any contained variables recursively.
        &#34;&#34;&#34;
        spec = self.spec
        path = self.path

        def default(type: IFPSType, *sub_path):
            if isinstance(type, TRecord):
                return [Variable(t, spec, (*path, *sub_path, k)) for k, t in enumerate(type.members)]
            if isinstance(type, TStaticArray):
                t = type.type
                return [Variable(t, spec, (*path, *sub_path, k)) for k in range(type.size)]
            if isinstance(type, TArray):
                return []
            if sub_path:
                return Variable(type, spec, (*path, *sub_path))
            elif type.code == TC.Pointer:
                return Variable(_VariantType)
            else:
                return type.default()

        self.data = default(self.type)

    def _wrap(self, value: Value | _T, key: int | None = None) -&gt; _T:
        if (t := self.type.py_type(key)) and not isinstance(value, t):
            if issubclass(t, int):
                if isinstance(value, str) and len(value) == 1:
                    return ord(value[0])
                if isinstance(value, float):
                    return int(value)
            elif isinstance(value, int):
                if issubclass(t, str):
                    return chr(value)
                if issubclass(t, float):
                    return float(value)
            raise TypeError(F&#39;Assigning value {value!r} to variable of type {self.type}.&#39;)
        if s := self._int_size and value not in self._int_good:
            mask = self._int_mask
            value &amp;= mask
            if s &lt; 0 and (value &gt;&gt; (self._int_bits - 1)):
                value = -(-value &amp; mask)
        return value

    def resize(self, n: int):
        &#34;&#34;&#34;
        This function is only valid for container type variables. It re-sizes the data list to
        ensure that the container stores exactly `n` sub-variables.
        &#34;&#34;&#34;
        t = self.type
        m = n - len(self.data)
        if t.code != TC.Array:
            if t.code not in (TC.StaticArray, TC.Record):
                raise TypeError
            if n == t.size:
                return
            raise ValueError(F&#39;Attempt to resize {t} of size {t.size} to {n}.&#39;)
        if m &lt;= 0:
            del self.data[n:]
            return
        for k in range(m):
            self.data.append(Variable(t.type, self.spec, (*self.path, k)))

    def setptr(self, var: Variable, copy: bool = False):
        &#34;&#34;&#34;
        This method is used to point a pointer variable to a target. This is different from calling
        the `refinery.lib.inno.emulator.Variable.set` method as the latter would try to dereference
        the pointer and assign to its target; this method sets the value of the pointer itself.
        &#34;&#34;&#34;
        if not self.pointer:
            raise TypeError
        if not isinstance(var, Variable):
            raise TypeError
        if copy:
            var = Variable(var.type, data=var.get())
        self.data = var

    def set(self, value: _T | Sequence | Variable):
        &#34;&#34;&#34;
        Assign a new value to the variable. This can either be an immediate value or a variable.
        For container types, it can also be a sequence of those.
        &#34;&#34;&#34;
        if isinstance(value, Variable):
            value = value.get()
        elif isinstance(value, (Enum, Value)):
            value = value.value
        if self.pointer:
            return self.deref().set(value)
        elif self.container:
            if not isinstance(value, (list, tuple)):
                raise TypeError
            self.resize(len(value))
            for k, v in enumerate(value):
                self.data[k].set(v)
        else:
            self.data = self._wrap(value)

    def get(self) -&gt; _T:
        &#34;&#34;&#34;
        Return a representation of this variable that consists only of base types. For example, the
        result for a container type will not be a list of `refinery.lib.inno.emulator.Variable`s,
        but a list of their contents.
        &#34;&#34;&#34;
        if self.pointer:
            return self.deref().get()
        if self.container:
            data: list[Variable] = self.data
            return [v.get() for v in data]
        return self.data

    @property
    def name(self):
        &#34;&#34;&#34;
        Return the name of the variable as given by its spec.
        &#34;&#34;&#34;
        if self.spec is None:
            return &#39;Unbound&#39;
        name = F&#39;{self.spec!s}&#39;
        for k in self.path:
            name = F&#39;{name}[{k}]&#39;
        return name

    def __repr__(self):
        rep = self.name
        if (val := self.data) is None:
            return rep
        if self.type.code is TC.Set:
            val = F&#39;{val:b}&#39;
        elif self.pointer:
            val: Variable
            return F&#39;{rep} -&gt; {val.name}&#39;
        elif isinstance(val, (str, int, float, list)):
            val = repr(self.get())
        else:
            return rep
        return F&#39;{rep} = {val}&#39;</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.Variable.path"><code class="name">var <span class="ident">path</span></code></dt>
<dd>
<section class="desc"><p>A tuple of integers that specify the seuqnce of indices required to access it, relative to the
base variable given via <code>spec</code>.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L95-L345" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class Variable(VariableBase, Generic[_T]):
    &#34;&#34;&#34;
    This class represents a global or stack variable in the IFPS runtime.
    &#34;&#34;&#34;
    data: list[Variable] | _T | None
    &#34;&#34;&#34;
    The variable&#39;s value. This is a list of `refinery.lib.inno.emulator.Variable`s for container
    types, a `refinery.lib.inno.emulator.Variable` for pointer types, and a basic type otherwise.
    &#34;&#34;&#34;
    path: tuple[int, ...]
    &#34;&#34;&#34;
    A tuple of integers that specify the seuqnce of indices required to access it, relative to the
    base variable given via `spec`.
    &#34;&#34;&#34;

    __slots__ = (
        &#39;data&#39;,
        &#39;path&#39;,
        &#39;_int_size&#39;,
        &#39;_int_mask&#39;,
        &#39;_int_bits&#39;,
        &#39;_int_good&#39;,
    )

    @property
    def container(self):
        &#34;&#34;&#34;
        A boolean indicating whether the given variable is a container.
        &#34;&#34;&#34;
        return self.type.container

    @property
    def pointer(self):
        &#34;&#34;&#34;
        A boolean indicating whether the given variable is a pointer.
        &#34;&#34;&#34;
        return self.type.code == TC.Pointer

    def __len__(self):
        return len(self.data)

    def __bool__(self):
        return True

    def __getitem__(self, key: int):
        var = self.deref()
        if var.container:
            return var.at(key).get()
        else:
            return var.data[key]

    def __setitem__(self, key: int, v: _T):
        var = self.deref()
        if var.container:
            var.at(key).set(v)
        else:
            var.data[key] = var._wrap(v)

    def at(self, k: int):
        &#34;&#34;&#34;
        Provides index access for the variable. If the variable is a pointer, it is dereferenced
        before accessing the data.
        &#34;&#34;&#34;
        return self.deref().data[k]

    def deref(var):
        &#34;&#34;&#34;
        Dereferences the variable until it is no longer a pointer and returns the result. If the
        variable is not a pointer, this function returns the variable itself.
        &#34;&#34;&#34;
        while True:
            val = var.data
            if not isinstance(val, Variable):
                return var
            var = val

    def __init__(
        self,
        type: IFPSType,
        spec: VariableSpec | None = None,
        path: tuple[int, ...] = (),
        data: _T | list | None = None
    ):
        super().__init__(type, spec)
        self.path = path

        self._int_size = _size = {
            TC.U08: +1,
            TC.U16: +1,
            TC.U32: +1,
            TC.S08: -1,
            TC.S16: -1,
            TC.S32: -1,
            TC.S64: -1,
        }.get((code := type.code), 0) * code.width
        if _size:
            bits = abs(_size) * 8
            umax = (1 &lt;&lt; bits)
            self._int_bits = bits
            self._int_mask = umax - 1
            if _size &lt; 0:
                self._int_good = range(-(umax &gt;&gt; 1), (umax &gt;&gt; 1))
            else:
                self._int_good = range(umax)
        else:
            self._int_mask = NoMask
            self._int_bits = INF
            self._int_good = AST

        if data is None:
            self.setdefault()
        else:
            self.set(data)

    def setdefault(self):
        &#34;&#34;&#34;
        Set this variable&#39;s data to the default value for its type. This also initializes the
        values of any contained variables recursively.
        &#34;&#34;&#34;
        spec = self.spec
        path = self.path

        def default(type: IFPSType, *sub_path):
            if isinstance(type, TRecord):
                return [Variable(t, spec, (*path, *sub_path, k)) for k, t in enumerate(type.members)]
            if isinstance(type, TStaticArray):
                t = type.type
                return [Variable(t, spec, (*path, *sub_path, k)) for k in range(type.size)]
            if isinstance(type, TArray):
                return []
            if sub_path:
                return Variable(type, spec, (*path, *sub_path))
            elif type.code == TC.Pointer:
                return Variable(_VariantType)
            else:
                return type.default()

        self.data = default(self.type)

    def _wrap(self, value: Value | _T, key: int | None = None) -&gt; _T:
        if (t := self.type.py_type(key)) and not isinstance(value, t):
            if issubclass(t, int):
                if isinstance(value, str) and len(value) == 1:
                    return ord(value[0])
                if isinstance(value, float):
                    return int(value)
            elif isinstance(value, int):
                if issubclass(t, str):
                    return chr(value)
                if issubclass(t, float):
                    return float(value)
            raise TypeError(F&#39;Assigning value {value!r} to variable of type {self.type}.&#39;)
        if s := self._int_size and value not in self._int_good:
            mask = self._int_mask
            value &amp;= mask
            if s &lt; 0 and (value &gt;&gt; (self._int_bits - 1)):
                value = -(-value &amp; mask)
        return value

    def resize(self, n: int):
        &#34;&#34;&#34;
        This function is only valid for container type variables. It re-sizes the data list to
        ensure that the container stores exactly `n` sub-variables.
        &#34;&#34;&#34;
        t = self.type
        m = n - len(self.data)
        if t.code != TC.Array:
            if t.code not in (TC.StaticArray, TC.Record):
                raise TypeError
            if n == t.size:
                return
            raise ValueError(F&#39;Attempt to resize {t} of size {t.size} to {n}.&#39;)
        if m &lt;= 0:
            del self.data[n:]
            return
        for k in range(m):
            self.data.append(Variable(t.type, self.spec, (*self.path, k)))

    def setptr(self, var: Variable, copy: bool = False):
        &#34;&#34;&#34;
        This method is used to point a pointer variable to a target. This is different from calling
        the `refinery.lib.inno.emulator.Variable.set` method as the latter would try to dereference
        the pointer and assign to its target; this method sets the value of the pointer itself.
        &#34;&#34;&#34;
        if not self.pointer:
            raise TypeError
        if not isinstance(var, Variable):
            raise TypeError
        if copy:
            var = Variable(var.type, data=var.get())
        self.data = var

    def set(self, value: _T | Sequence | Variable):
        &#34;&#34;&#34;
        Assign a new value to the variable. This can either be an immediate value or a variable.
        For container types, it can also be a sequence of those.
        &#34;&#34;&#34;
        if isinstance(value, Variable):
            value = value.get()
        elif isinstance(value, (Enum, Value)):
            value = value.value
        if self.pointer:
            return self.deref().set(value)
        elif self.container:
            if not isinstance(value, (list, tuple)):
                raise TypeError
            self.resize(len(value))
            for k, v in enumerate(value):
                self.data[k].set(v)
        else:
            self.data = self._wrap(value)

    def get(self) -&gt; _T:
        &#34;&#34;&#34;
        Return a representation of this variable that consists only of base types. For example, the
        result for a container type will not be a list of `refinery.lib.inno.emulator.Variable`s,
        but a list of their contents.
        &#34;&#34;&#34;
        if self.pointer:
            return self.deref().get()
        if self.container:
            data: list[Variable] = self.data
            return [v.get() for v in data]
        return self.data

    @property
    def name(self):
        &#34;&#34;&#34;
        Return the name of the variable as given by its spec.
        &#34;&#34;&#34;
        if self.spec is None:
            return &#39;Unbound&#39;
        name = F&#39;{self.spec!s}&#39;
        for k in self.path:
            name = F&#39;{name}[{k}]&#39;
        return name

    def __repr__(self):
        rep = self.name
        if (val := self.data) is None:
            return rep
        if self.type.code is TC.Set:
            val = F&#39;{val:b}&#39;
        elif self.pointer:
            val: Variable
            return F&#39;{rep} -&gt; {val.name}&#39;
        elif isinstance(val, (str, int, float, list)):
            val = repr(self.get())
        else:
            return rep
        return F&#39;{rep} = {val}&#39;</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="refinery.lib.inno.emulator.Variable.at"><code class="name flex">
<span>def <span class="ident">at</span></span>(<span>self, k)</span>
</code></dt>
<dd>
<section class="desc"><p>Provides index access for the variable. If the variable is a pointer, it is dereferenced
before accessing the data.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L153-L158" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def at(self, k: int):
    &#34;&#34;&#34;
    Provides index access for the variable. If the variable is a pointer, it is dereferenced
    before accessing the data.
    &#34;&#34;&#34;
    return self.deref().data[k]</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.Variable.deref"><code class="name flex">
<span>def <span class="ident">deref</span></span>(<span>var)</span>
</code></dt>
<dd>
<section class="desc"><p>Dereferences the variable until it is no longer a pointer and returns the result. If the
variable is not a pointer, this function returns the variable itself.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L160-L169" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def deref(var):
    &#34;&#34;&#34;
    Dereferences the variable until it is no longer a pointer and returns the result. If the
    variable is not a pointer, this function returns the variable itself.
    &#34;&#34;&#34;
    while True:
        val = var.data
        if not isinstance(val, Variable):
            return var
        var = val</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.Variable.setdefault"><code class="name flex">
<span>def <span class="ident">setdefault</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Set this variable's data to the default value for its type. This also initializes the
values of any contained variables recursively.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L209-L232" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def setdefault(self):
    &#34;&#34;&#34;
    Set this variable&#39;s data to the default value for its type. This also initializes the
    values of any contained variables recursively.
    &#34;&#34;&#34;
    spec = self.spec
    path = self.path

    def default(type: IFPSType, *sub_path):
        if isinstance(type, TRecord):
            return [Variable(t, spec, (*path, *sub_path, k)) for k, t in enumerate(type.members)]
        if isinstance(type, TStaticArray):
            t = type.type
            return [Variable(t, spec, (*path, *sub_path, k)) for k in range(type.size)]
        if isinstance(type, TArray):
            return []
        if sub_path:
            return Variable(type, spec, (*path, *sub_path))
        elif type.code == TC.Pointer:
            return Variable(_VariantType)
        else:
            return type.default()

    self.data = default(self.type)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.Variable.resize"><code class="name flex">
<span>def <span class="ident">resize</span></span>(<span>self, n)</span>
</code></dt>
<dd>
<section class="desc"><p>This function is only valid for container type variables. It re-sizes the data list to
ensure that the container stores exactly <code>n</code> sub-variables.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L254-L271" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def resize(self, n: int):
    &#34;&#34;&#34;
    This function is only valid for container type variables. It re-sizes the data list to
    ensure that the container stores exactly `n` sub-variables.
    &#34;&#34;&#34;
    t = self.type
    m = n - len(self.data)
    if t.code != TC.Array:
        if t.code not in (TC.StaticArray, TC.Record):
            raise TypeError
        if n == t.size:
            return
        raise ValueError(F&#39;Attempt to resize {t} of size {t.size} to {n}.&#39;)
    if m &lt;= 0:
        del self.data[n:]
        return
    for k in range(m):
        self.data.append(Variable(t.type, self.spec, (*self.path, k)))</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.Variable.setptr"><code class="name flex">
<span>def <span class="ident">setptr</span></span>(<span>self, var, copy=False)</span>
</code></dt>
<dd>
<section class="desc"><p>This method is used to point a pointer variable to a target. This is different from calling
the <code><a title="refinery.lib.inno.emulator.Variable.set" href="#refinery.lib.inno.emulator.Variable.set">Variable.set()</a></code> method as the latter would try to dereference
the pointer and assign to its target; this method sets the value of the pointer itself.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L273-L285" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def setptr(self, var: Variable, copy: bool = False):
    &#34;&#34;&#34;
    This method is used to point a pointer variable to a target. This is different from calling
    the `refinery.lib.inno.emulator.Variable.set` method as the latter would try to dereference
    the pointer and assign to its target; this method sets the value of the pointer itself.
    &#34;&#34;&#34;
    if not self.pointer:
        raise TypeError
    if not isinstance(var, Variable):
        raise TypeError
    if copy:
        var = Variable(var.type, data=var.get())
    self.data = var</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.Variable.set"><code class="name flex">
<span>def <span class="ident">set</span></span>(<span>self, value)</span>
</code></dt>
<dd>
<section class="desc"><p>Assign a new value to the variable. This can either be an immediate value or a variable.
For container types, it can also be a sequence of those.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L287-L305" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def set(self, value: _T | Sequence | Variable):
    &#34;&#34;&#34;
    Assign a new value to the variable. This can either be an immediate value or a variable.
    For container types, it can also be a sequence of those.
    &#34;&#34;&#34;
    if isinstance(value, Variable):
        value = value.get()
    elif isinstance(value, (Enum, Value)):
        value = value.value
    if self.pointer:
        return self.deref().set(value)
    elif self.container:
        if not isinstance(value, (list, tuple)):
            raise TypeError
        self.resize(len(value))
        for k, v in enumerate(value):
            self.data[k].set(v)
    else:
        self.data = self._wrap(value)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.Variable.get"><code class="name flex">
<span>def <span class="ident">get</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Return a representation of this variable that consists only of base types. For example, the
result for a container type will not be a list of <code><a title="refinery.lib.inno.emulator.Variable" href="#refinery.lib.inno.emulator.Variable">Variable</a></code>s,
but a list of their contents.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L307-L318" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get(self) -&gt; _T:
    &#34;&#34;&#34;
    Return a representation of this variable that consists only of base types. For example, the
    result for a container type will not be a list of `refinery.lib.inno.emulator.Variable`s,
    but a list of their contents.
    &#34;&#34;&#34;
    if self.pointer:
        return self.deref().get()
    if self.container:
        data: list[Variable] = self.data
        return [v.get() for v in data]
    return self.data</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="refinery.lib.inno.ifps.VariableBase" href="ifps.html#refinery.lib.inno.ifps.VariableBase">VariableBase</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.lib.inno.ifps.VariableBase.spec" href="ifps.html#refinery.lib.inno.ifps.VariableBase.spec">spec</a></code></li>
<li><code><a title="refinery.lib.inno.ifps.VariableBase.type" href="ifps.html#refinery.lib.inno.ifps.VariableBase.type">type</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.NeedSymbol"><code class="flex name class">
<span>class <span class="ident">NeedSymbol</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>An exception raised by <code><a title="refinery.lib.inno.emulator.IFPSEmulator" href="#refinery.lib.inno.emulator.IFPSEmulator">IFPSEmulator</a></code> if the runtime calls out to
an external symbol that is not implemented.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L348-L352" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class NeedSymbol(NotImplementedError):
    &#34;&#34;&#34;
    An exception raised by `refinery.lib.inno.emulator.IFPSEmulator` if the runtime calls out to
    an external symbol that is not implemented.
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.NotImplementedError</li>
<li>builtins.RuntimeError</li>
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.OpCodeNotImplemented"><code class="flex name class">
<span>class <span class="ident">OpCodeNotImplemented</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>An exception raised by <code><a title="refinery.lib.inno.emulator.IFPSEmulator" href="#refinery.lib.inno.emulator.IFPSEmulator">IFPSEmulator</a></code> if an unsupported opcode is
encountered during emulation.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L355-L359" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class OpCodeNotImplemented(NotImplementedError):
    &#34;&#34;&#34;
    An exception raised by `refinery.lib.inno.emulator.IFPSEmulator` if an unsupported opcode is
    encountered during emulation.
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.NotImplementedError</li>
<li>builtins.RuntimeError</li>
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.EmulatorException"><code class="flex name class">
<span>class <span class="ident">EmulatorException</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>A generic exception representing any error that occurs during emulation.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L362-L365" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class EmulatorException(RuntimeError):
    &#34;&#34;&#34;
    A generic exception representing any error that occurs during emulation.
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.RuntimeError</li>
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.AbortEmulation"><code class="flex name class">
<span>class <span class="ident">AbortEmulation</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>This exception can be raised by an external function handler to signal the emulator that script
execution should be aborted.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L368-L372" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class AbortEmulation(Exception):
    &#34;&#34;&#34;
    This exception can be raised by an external function handler to signal the emulator that script
    execution should be aborted.
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSException"><code class="flex name class">
<span>class <span class="ident">IFPSException</span></span>
<span>(</span><span>msg, parent=None)</span>
</code></dt>
<dd>
<section class="desc"><p>This class represents an exception within the IFPS runtime, i.e. an exception that is subject
to IFPS exception handling.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L375-L382" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class IFPSException(RuntimeError):
    &#34;&#34;&#34;
    This class represents an exception within the IFPS runtime, i.e. an exception that is subject
    to IFPS exception handling.
    &#34;&#34;&#34;
    def __init__(self, msg: str, parent: BaseException | None = None):
        super().__init__(msg)
        self.parent = parent</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.RuntimeError</li>
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.EmulatorTimeout"><code class="flex name class">
<span>class <span class="ident">EmulatorTimeout</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>The emulation timed out based on the given time limit in the configuration.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L385-L388" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class EmulatorTimeout(TimeoutError):
    &#34;&#34;&#34;
    The emulation timed out based on the given time limit in the configuration.
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.TimeoutError</li>
<li>builtins.OSError</li>
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.EmulatorExecutionLimit"><code class="flex name class">
<span>class <span class="ident">EmulatorExecutionLimit</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>The emulation timed out based on the given execution limit in the configuration.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L391-L394" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class EmulatorExecutionLimit(TimeoutError):
    &#34;&#34;&#34;
    The emulation timed out based on the given execution limit in the configuration.
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.TimeoutError</li>
<li>builtins.OSError</li>
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.EmulatorMaxStack"><code class="flex name class">
<span>class <span class="ident">EmulatorMaxStack</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>The emulation was aborted because the stack limit given in the configuration was exceeded.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L397-L400" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class EmulatorMaxStack(MemoryError):
    &#34;&#34;&#34;
    The emulation was aborted because the stack limit given in the configuration was exceeded.
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.MemoryError</li>
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.EmulatorMaxCalls"><code class="flex name class">
<span>class <span class="ident">EmulatorMaxCalls</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>The emulation was aborted because the call stack limit given in the configuration was exceeded.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L403-L406" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class EmulatorMaxCalls(MemoryError):
    &#34;&#34;&#34;
    The emulation was aborted because the call stack limit given in the configuration was exceeded.
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.MemoryError</li>
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.ExceptionHandler"><code class="flex name class">
<span>class <span class="ident">ExceptionHandler</span></span>
<span>(</span><span>finally_one, catch_error, finally_two, handler_end, current=Try)</span>
</code></dt>
<dd>
<section class="desc"><p>This class represents an exception handler within the IFPS runtime.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L409-L433" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@dataclass
class ExceptionHandler:
    &#34;&#34;&#34;
    This class represents an exception handler within the IFPS runtime.
    &#34;&#34;&#34;
    finally_one: int | None
    &#34;&#34;&#34;
    Code offset of the first finally handler.
    &#34;&#34;&#34;
    catch_error: int | None
    &#34;&#34;&#34;
    Code offset of the catch handler.
    &#34;&#34;&#34;
    finally_two: int | None
    &#34;&#34;&#34;
    Code offset of the second finally handler.
    &#34;&#34;&#34;
    handler_end: int
    &#34;&#34;&#34;
    Code offset of the first instruction that is no longer covered.
    &#34;&#34;&#34;
    current: EHType = EHType.Try
    &#34;&#34;&#34;
    Represents the current state of this exception handler.
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.ExceptionHandler.finally_one"><code class="name">var <span class="ident">finally_one</span></code></dt>
<dd>
<section class="desc"><p>Code offset of the first finally handler.</p></section>
</dd>
<dt id="refinery.lib.inno.emulator.ExceptionHandler.catch_error"><code class="name">var <span class="ident">catch_error</span></code></dt>
<dd>
<section class="desc"><p>Code offset of the catch handler.</p></section>
</dd>
<dt id="refinery.lib.inno.emulator.ExceptionHandler.finally_two"><code class="name">var <span class="ident">finally_two</span></code></dt>
<dd>
<section class="desc"><p>Code offset of the second finally handler.</p></section>
</dd>
<dt id="refinery.lib.inno.emulator.ExceptionHandler.handler_end"><code class="name">var <span class="ident">handler_end</span></code></dt>
<dd>
<section class="desc"><p>Code offset of the first instruction that is no longer covered.</p></section>
</dd>
<dt id="refinery.lib.inno.emulator.ExceptionHandler.current"><code class="name">var <span class="ident">current</span></code></dt>
<dd>
<section class="desc"><p>Represents the current state of this exception handler.</p></section>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatedFunction"><code class="flex name class">
<span>class <span class="ident">IFPSEmulatedFunction</span></span>
<span>(</span><span>call, spec, static, void=False)</span>
</code></dt>
<dd>
<section class="desc"><p>Represents an emulated external symbol.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L436-L465" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class IFPSEmulatedFunction(NamedTuple):
    &#34;&#34;&#34;
    Represents an emulated external symbol.
    &#34;&#34;&#34;
    call: Callable
    &#34;&#34;&#34;
    The actual callable function that implements the symbol.
    &#34;&#34;&#34;
    spec: list[bool]
    &#34;&#34;&#34;
    A list of boolean values, one for each parameter of the function. Each boolean indicates
    whether the parameter at that index is passed by reference.
    &#34;&#34;&#34;
    static: bool
    &#34;&#34;&#34;
    Indicates whether the handler is static. If this value is `False`, the callable expects an
    additional `self` parameter of type `refinery.lib.inno.emulator.IFPSEmulator`.
    &#34;&#34;&#34;
    void: bool = False
    &#34;&#34;&#34;
    Indicates whether the handler implements a procedure rather than a function in the IFPS
    runtime.
    &#34;&#34;&#34;

    @property
    def argc(self):
        &#34;&#34;&#34;
        The argument count for this handler.
        &#34;&#34;&#34;
        return len(self.spec)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.tuple</li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.IFPSEmulatedFunction.call"><code class="name">var <span class="ident">call</span></code></dt>
<dd>
<section class="desc"><p>The actual callable function that implements the symbol.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L436-L465" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class IFPSEmulatedFunction(NamedTuple):
    &#34;&#34;&#34;
    Represents an emulated external symbol.
    &#34;&#34;&#34;
    call: Callable
    &#34;&#34;&#34;
    The actual callable function that implements the symbol.
    &#34;&#34;&#34;
    spec: list[bool]
    &#34;&#34;&#34;
    A list of boolean values, one for each parameter of the function. Each boolean indicates
    whether the parameter at that index is passed by reference.
    &#34;&#34;&#34;
    static: bool
    &#34;&#34;&#34;
    Indicates whether the handler is static. If this value is `False`, the callable expects an
    additional `self` parameter of type `refinery.lib.inno.emulator.IFPSEmulator`.
    &#34;&#34;&#34;
    void: bool = False
    &#34;&#34;&#34;
    Indicates whether the handler implements a procedure rather than a function in the IFPS
    runtime.
    &#34;&#34;&#34;

    @property
    def argc(self):
        &#34;&#34;&#34;
        The argument count for this handler.
        &#34;&#34;&#34;
        return len(self.spec)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatedFunction.spec"><code class="name">var <span class="ident">spec</span></code></dt>
<dd>
<section class="desc"><p>A list of boolean values, one for each parameter of the function. Each boolean indicates
whether the parameter at that index is passed by reference.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L436-L465" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class IFPSEmulatedFunction(NamedTuple):
    &#34;&#34;&#34;
    Represents an emulated external symbol.
    &#34;&#34;&#34;
    call: Callable
    &#34;&#34;&#34;
    The actual callable function that implements the symbol.
    &#34;&#34;&#34;
    spec: list[bool]
    &#34;&#34;&#34;
    A list of boolean values, one for each parameter of the function. Each boolean indicates
    whether the parameter at that index is passed by reference.
    &#34;&#34;&#34;
    static: bool
    &#34;&#34;&#34;
    Indicates whether the handler is static. If this value is `False`, the callable expects an
    additional `self` parameter of type `refinery.lib.inno.emulator.IFPSEmulator`.
    &#34;&#34;&#34;
    void: bool = False
    &#34;&#34;&#34;
    Indicates whether the handler implements a procedure rather than a function in the IFPS
    runtime.
    &#34;&#34;&#34;

    @property
    def argc(self):
        &#34;&#34;&#34;
        The argument count for this handler.
        &#34;&#34;&#34;
        return len(self.spec)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatedFunction.static"><code class="name">var <span class="ident">static</span></code></dt>
<dd>
<section class="desc"><p>Indicates whether the handler is static. If this value is <code>False</code>, the callable expects an
additional <code>self</code> parameter of type <code><a title="refinery.lib.inno.emulator.IFPSEmulator" href="#refinery.lib.inno.emulator.IFPSEmulator">IFPSEmulator</a></code>.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L436-L465" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class IFPSEmulatedFunction(NamedTuple):
    &#34;&#34;&#34;
    Represents an emulated external symbol.
    &#34;&#34;&#34;
    call: Callable
    &#34;&#34;&#34;
    The actual callable function that implements the symbol.
    &#34;&#34;&#34;
    spec: list[bool]
    &#34;&#34;&#34;
    A list of boolean values, one for each parameter of the function. Each boolean indicates
    whether the parameter at that index is passed by reference.
    &#34;&#34;&#34;
    static: bool
    &#34;&#34;&#34;
    Indicates whether the handler is static. If this value is `False`, the callable expects an
    additional `self` parameter of type `refinery.lib.inno.emulator.IFPSEmulator`.
    &#34;&#34;&#34;
    void: bool = False
    &#34;&#34;&#34;
    Indicates whether the handler implements a procedure rather than a function in the IFPS
    runtime.
    &#34;&#34;&#34;

    @property
    def argc(self):
        &#34;&#34;&#34;
        The argument count for this handler.
        &#34;&#34;&#34;
        return len(self.spec)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatedFunction.void"><code class="name">var <span class="ident">void</span></code></dt>
<dd>
<section class="desc"><p>Indicates whether the handler implements a procedure rather than a function in the IFPS
runtime.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L436-L465" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class IFPSEmulatedFunction(NamedTuple):
    &#34;&#34;&#34;
    Represents an emulated external symbol.
    &#34;&#34;&#34;
    call: Callable
    &#34;&#34;&#34;
    The actual callable function that implements the symbol.
    &#34;&#34;&#34;
    spec: list[bool]
    &#34;&#34;&#34;
    A list of boolean values, one for each parameter of the function. Each boolean indicates
    whether the parameter at that index is passed by reference.
    &#34;&#34;&#34;
    static: bool
    &#34;&#34;&#34;
    Indicates whether the handler is static. If this value is `False`, the callable expects an
    additional `self` parameter of type `refinery.lib.inno.emulator.IFPSEmulator`.
    &#34;&#34;&#34;
    void: bool = False
    &#34;&#34;&#34;
    Indicates whether the handler implements a procedure rather than a function in the IFPS
    runtime.
    &#34;&#34;&#34;

    @property
    def argc(self):
        &#34;&#34;&#34;
        The argument count for this handler.
        &#34;&#34;&#34;
        return len(self.spec)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatedFunction.argc"><code class="name">var <span class="ident">argc</span></code></dt>
<dd>
<section class="desc"><p>The argument count for this handler.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L460-L465" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def argc(self):
    &#34;&#34;&#34;
    The argument count for this handler.
    &#34;&#34;&#34;
    return len(self.spec)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig"><code class="flex name class">
<span>class <span class="ident">IFPSEmulatorConfig</span></span>
<span>(</span><span>x64=True, admin=True, windows_os_version=(10, 0, 10240), windows_sp_version=(2, 0), throw_abort=False, log_calls=False, log_passwords=True, log_mutexes=True, log_opcodes=False, wizard_silent=True, max_opcodes=0, max_seconds=10, start_time=&lt;factory&gt;, milliseconds_per_instruction=0.0001, sleep_scale=0.0, max_data_stack=1000000, max_call_stack=4096, environment=&lt;factory&gt;, user_name='Frank', temp_path='', host_name='Frank-PC', inno_name='ThisInstall', language='en', executable='C:\\Install.exe', install_to='I:\\', lcid=1033)</span>
</code></dt>
<dd>
<section class="desc"><p>The configuration for <code><a title="refinery.lib.inno.emulator.IFPSEmulator" href="#refinery.lib.inno.emulator.IFPSEmulator">IFPSEmulator</a></code>s.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L468-L502" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@dataclass
class IFPSEmulatorConfig:
    &#34;&#34;&#34;
    The configuration for `refinery.lib.inno.emulator.IFPSEmulator`s.
    &#34;&#34;&#34;
    x64: bool = True
    admin: bool = True
    windows_os_version: tuple[int, int, int] = (10, 0, 10240)
    windows_sp_version: tuple[int, int] = (2, 0)
    throw_abort: bool = False
    log_calls: bool = False
    log_passwords: bool = True
    log_mutexes: bool = True
    log_opcodes: bool = False
    wizard_silent: bool = True
    max_opcodes: int = 0
    max_seconds: int = 10
    start_time: datetime = field(default_factory=datetime.now)
    milliseconds_per_instruction: float = 0.0001
    sleep_scale: float = 0.0
    max_data_stack: int = 1_000_000
    max_call_stack: int = 4096
    environment: dict[str, str] = field(default_factory=dict)
    user_name: str = &#39;Frank&#39;
    temp_path: str = &#39;&#39;
    host_name: str = &#39;Frank-PC&#39;
    inno_name: str = &#39;ThisInstall&#39;
    language: str = &#39;en&#39;
    executable: str = &#39;C:\\Install.exe&#39;
    install_to: str = &#39;I:\\&#39;
    lcid: int = 0x0409

    @property
    def cwd(self):
        return Path(self.executable).parent</code></pre>
</details>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.start_time"><code class="name">var <span class="ident">start_time</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.environment"><code class="name">var <span class="ident">environment</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.x64"><code class="name">var <span class="ident">x64</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.admin"><code class="name">var <span class="ident">admin</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.windows_os_version"><code class="name">var <span class="ident">windows_os_version</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.windows_sp_version"><code class="name">var <span class="ident">windows_sp_version</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.throw_abort"><code class="name">var <span class="ident">throw_abort</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.log_calls"><code class="name">var <span class="ident">log_calls</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.log_passwords"><code class="name">var <span class="ident">log_passwords</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.log_mutexes"><code class="name">var <span class="ident">log_mutexes</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.log_opcodes"><code class="name">var <span class="ident">log_opcodes</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.wizard_silent"><code class="name">var <span class="ident">wizard_silent</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.max_opcodes"><code class="name">var <span class="ident">max_opcodes</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.max_seconds"><code class="name">var <span class="ident">max_seconds</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.milliseconds_per_instruction"><code class="name">var <span class="ident">milliseconds_per_instruction</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.sleep_scale"><code class="name">var <span class="ident">sleep_scale</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.max_data_stack"><code class="name">var <span class="ident">max_data_stack</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.max_call_stack"><code class="name">var <span class="ident">max_call_stack</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.user_name"><code class="name">var <span class="ident">user_name</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.temp_path"><code class="name">var <span class="ident">temp_path</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.host_name"><code class="name">var <span class="ident">host_name</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.inno_name"><code class="name">var <span class="ident">inno_name</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.language"><code class="name">var <span class="ident">language</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.executable"><code class="name">var <span class="ident">executable</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.install_to"><code class="name">var <span class="ident">install_to</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.lcid"><code class="name">var <span class="ident">lcid</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulatorConfig.cwd"><code class="name">var <span class="ident">cwd</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L500-L502" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def cwd(self):
    return Path(self.executable).parent</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.TSetupStep"><code class="flex name class">
<span>class <span class="ident">TSetupStep</span></span>
<span>(</span><span>*args, **kwds)</span>
</code></dt>
<dd>
<section class="desc"><p>An IFPS enumeration that classifies different setup steps.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L505-L512" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class TSetupStep(int, Enum):
    &#34;&#34;&#34;
    An IFPS enumeration that classifies different setup steps.
    &#34;&#34;&#34;
    ssPreInstall = 0
    ssInstall = auto()
    ssPostInstall = auto()
    ssDone = auto()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.int</li>
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.TSetupStep.ssPreInstall"><code class="name">var <span class="ident">ssPreInstall</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TSetupStep.ssInstall"><code class="name">var <span class="ident">ssInstall</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TSetupStep.ssPostInstall"><code class="name">var <span class="ident">ssPostInstall</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TSetupStep.ssDone"><code class="name">var <span class="ident">ssDone</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.TSplitType"><code class="flex name class">
<span>class <span class="ident">TSplitType</span></span>
<span>(</span><span>*args, **kwds)</span>
</code></dt>
<dd>
<section class="desc"><p>An IFPS enumeration that classifies different strategies for splitting strings.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L515-L521" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class TSplitType(int, Enum):
    &#34;&#34;&#34;
    An IFPS enumeration that classifies different strategies for splitting strings.
    &#34;&#34;&#34;
    stAll = 0
    stExcludeEmpty = auto()
    stExcludeLastEmpty = auto()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.int</li>
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.TSplitType.stAll"><code class="name">var <span class="ident">stAll</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TSplitType.stExcludeEmpty"><code class="name">var <span class="ident">stExcludeEmpty</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TSplitType.stExcludeLastEmpty"><code class="name">var <span class="ident">stExcludeLastEmpty</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.TUninstallStep"><code class="flex name class">
<span>class <span class="ident">TUninstallStep</span></span>
<span>(</span><span>*args, **kwds)</span>
</code></dt>
<dd>
<section class="desc"><p>An IFPS enumeration that classifies uninstaller steps.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L524-L531" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class TUninstallStep(int, Enum):
    &#34;&#34;&#34;
    An IFPS enumeration that classifies uninstaller steps.
    &#34;&#34;&#34;
    usAppMutexCheck = 0
    usUninstall = auto()
    usPostUninstall = auto()
    usDone = auto()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.int</li>
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.TUninstallStep.usAppMutexCheck"><code class="name">var <span class="ident">usAppMutexCheck</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TUninstallStep.usUninstall"><code class="name">var <span class="ident">usUninstall</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TUninstallStep.usPostUninstall"><code class="name">var <span class="ident">usPostUninstall</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TUninstallStep.usDone"><code class="name">var <span class="ident">usDone</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.TSetupProcessorArchitecture"><code class="flex name class">
<span>class <span class="ident">TSetupProcessorArchitecture</span></span>
<span>(</span><span>*args, **kwds)</span>
</code></dt>
<dd>
<section class="desc"><p>An IFPS enumeration that classifies different processor architectures.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L534-L542" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class TSetupProcessorArchitecture(int, Enum):
    &#34;&#34;&#34;
    An IFPS enumeration that classifies different processor architectures.
    &#34;&#34;&#34;
    paUnknown = 0
    paX86 = auto()
    paX64 = auto()
    paArm32 = auto()
    paArm64 = auto()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.int</li>
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.TSetupProcessorArchitecture.paUnknown"><code class="name">var <span class="ident">paUnknown</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TSetupProcessorArchitecture.paX86"><code class="name">var <span class="ident">paX86</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TSetupProcessorArchitecture.paX64"><code class="name">var <span class="ident">paX64</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TSetupProcessorArchitecture.paArm32"><code class="name">var <span class="ident">paArm32</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.TSetupProcessorArchitecture.paArm64"><code class="name">var <span class="ident">paArm64</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.PageID"><code class="flex name class">
<span>class <span class="ident">PageID</span></span>
<span>(</span><span>*args, **kwds)</span>
</code></dt>
<dd>
<section class="desc"><p>An IFPS enumeration that classifies the different installer pages.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L545-L562" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class PageID(int, Enum):
    &#34;&#34;&#34;
    An IFPS enumeration that classifies the different installer pages.
    &#34;&#34;&#34;
    wpWelcome = 1
    wpLicense = auto()
    wpPassword = auto()
    wpInfoBefore = auto()
    wpUserInfo = auto()
    wpSelectDir = auto()
    wpSelectComponents = auto()
    wpSelectProgramGroup = auto()
    wpSelectTasks = auto()
    wpReady = auto()
    wpPreparing = auto()
    wpInstalling = auto()
    wpInfoAfter = auto()
    wpFinished = auto()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.int</li>
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.PageID.wpWelcome"><code class="name">var <span class="ident">wpWelcome</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpLicense"><code class="name">var <span class="ident">wpLicense</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpPassword"><code class="name">var <span class="ident">wpPassword</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpInfoBefore"><code class="name">var <span class="ident">wpInfoBefore</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpUserInfo"><code class="name">var <span class="ident">wpUserInfo</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpSelectDir"><code class="name">var <span class="ident">wpSelectDir</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpSelectComponents"><code class="name">var <span class="ident">wpSelectComponents</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpSelectProgramGroup"><code class="name">var <span class="ident">wpSelectProgramGroup</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpSelectTasks"><code class="name">var <span class="ident">wpSelectTasks</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpReady"><code class="name">var <span class="ident">wpReady</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpPreparing"><code class="name">var <span class="ident">wpPreparing</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpInstalling"><code class="name">var <span class="ident">wpInstalling</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpInfoAfter"><code class="name">var <span class="ident">wpInfoAfter</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.PageID.wpFinished"><code class="name">var <span class="ident">wpFinished</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.NewFunctionCall"><code class="flex name class">
<span>class <span class="ident">NewFunctionCall</span></span>
<span>(</span><span>name, args)</span>
</code></dt>
<dd>
<section class="desc"><p>An event generated by <code><a title="refinery.lib.inno.emulator.IFPSEmulator.emulate_function" href="#refinery.lib.inno.emulator.IFPSEmulator.emulate_function">IFPSEmulator.emulate_function()</a></code> which
represents a call to the function with the given name and arguments.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L565-L571" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class NewFunctionCall(NamedTuple):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` which
    represents a call to the function with the given name and arguments.
    &#34;&#34;&#34;
    name: str
    args: tuple</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.tuple</li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.NewFunctionCall.name"><code class="name">var <span class="ident">name</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 0</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L565-L571" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class NewFunctionCall(NamedTuple):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` which
    represents a call to the function with the given name and arguments.
    &#34;&#34;&#34;
    name: str
    args: tuple</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.NewFunctionCall.args"><code class="name">var <span class="ident">args</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 1</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L565-L571" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class NewFunctionCall(NamedTuple):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` which
    represents a call to the function with the given name and arguments.
    &#34;&#34;&#34;
    name: str
    args: tuple</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.NewPassword"><code class="flex name class">
<span>class <span class="ident">NewPassword</span></span>
<span>(</span><span>...)</span>
</code></dt>
<dd>
<section class="desc"><p>An event generated by <code><a title="refinery.lib.inno.emulator.IFPSEmulator.emulate_function" href="#refinery.lib.inno.emulator.IFPSEmulator.emulate_function">IFPSEmulator.emulate_function()</a></code> for each
password that is entered by the emulated setup script to a password edit control.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L574-L578" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class NewPassword(str):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` for each
    password that is entered by the emulated setup script to a password edit control.
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.str</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.NewMutex"><code class="flex name class">
<span>class <span class="ident">NewMutex</span></span>
<span>(</span><span>...)</span>
</code></dt>
<dd>
<section class="desc"><p>An event generated by <code><a title="refinery.lib.inno.emulator.IFPSEmulator.emulate_function" href="#refinery.lib.inno.emulator.IFPSEmulator.emulate_function">IFPSEmulator.emulate_function()</a></code> for each
mutex registered by the script.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L581-L585" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class NewMutex(str):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` for each
    mutex registered by the script.
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.str</li>
</ul>
</dd>
<dt id="refinery.lib.inno.emulator.NewInstruction"><code class="flex name class">
<span>class <span class="ident">NewInstruction</span></span>
<span>(</span><span>function, instruction)</span>
</code></dt>
<dd>
<section class="desc"><p>An event generated by <code><a title="refinery.lib.inno.emulator.IFPSEmulator.emulate_function" href="#refinery.lib.inno.emulator.IFPSEmulator.emulate_function">IFPSEmulator.emulate_function()</a></code> for each
executed instruction.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L588-L594" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class NewInstruction(NamedTuple):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` for each
    executed instruction.
    &#34;&#34;&#34;
    function: Function
    instruction: Instruction</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.tuple</li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.NewInstruction.function"><code class="name">var <span class="ident">function</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 0</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L588-L594" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class NewInstruction(NamedTuple):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` for each
    executed instruction.
    &#34;&#34;&#34;
    function: Function
    instruction: Instruction</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.NewInstruction.instruction"><code class="name">var <span class="ident">instruction</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 1</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L588-L594" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class NewInstruction(NamedTuple):
    &#34;&#34;&#34;
    An event generated by `refinery.lib.inno.emulator.IFPSEmulator.emulate_function` for each
    executed instruction.
    &#34;&#34;&#34;
    function: Function
    instruction: Instruction</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.EventCall"><code class="flex name class">
<span>class <span class="ident">EventCall</span></span>
<span>(</span><span>call)</span>
</code></dt>
<dd>
<section class="desc"><p>This class is a wrapper for generator functions that can also capture their return value.
It is used for <code><a title="refinery.lib.inno.emulator.IFPSEmulator.emulate_function" href="#refinery.lib.inno.emulator.IFPSEmulator.emulate_function">IFPSEmulator.emulate_function()</a></code>.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L597-L638" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class EventCall(Generic[_Y, _T]):
    &#34;&#34;&#34;
    This class is a wrapper for generator functions that can also capture their return value.
    It is used for `refinery.lib.inno.emulator.IFPSEmulator.emulate_function`.
    &#34;&#34;&#34;

    value: _T
    &#34;&#34;&#34;
    The return value of the wrapped function.
    &#34;&#34;&#34;

    def __init__(self, call: Generator[_Y, Any, _T]):
        self._call = call
        self._done = False
        self._buffer: list[_Y] = []
        self._value = None

    @classmethod
    def Wrap(cls, method: Callable[_P, Generator[_Y, Any, _T]]) -&gt; Callable[_P, EventCall[_Y, _T]]:
        &#34;&#34;&#34;
        Used for decorating generator functions.
        &#34;&#34;&#34;
        @wraps(method)
        def wrapped(*args, **kwargs):
            return cls(method(*args, **kwargs))
        return wrapped

    @property
    def value(self):
        if not self._done:
            self._buffer = list(self)
        return self._value

    def __iter__(self):
        if self._done:
            yield from self._buffer
            assert self._value is not None
            self._buffer.clear()
        else:
            self._value = yield from self._call
            self._done = True
        return self._value</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>typing.Generic</li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="refinery.lib.inno.emulator.EventCall.Wrap"><code class="name flex">
<span>def <span class="ident">Wrap</span></span>(<span>method)</span>
</code></dt>
<dd>
<section class="desc"><p>Used for decorating generator functions.</p></section>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.EventCall.value"><code class="name">var <span class="ident">value</span></code></dt>
<dd>
<section class="desc"><p>The return value of the wrapped function.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L624-L628" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def value(self):
    if not self._done:
        self._buffer = list(self)
    return self._value</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl"><code class="flex name class">
<span>class <span class="ident">FPUControl</span></span>
<span>(</span><span>*args, **kwds)</span>
</code></dt>
<dd>
<section class="desc"><p>An integer flag representing FPU control words.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L641-L662" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class FPUControl(IntFlag):
    &#34;&#34;&#34;
    An integer flag representing FPU control words.
    &#34;&#34;&#34;
    InvalidOperation    = 0b0_00_0_00_00_00_000001 # noqa
    DenormalizedOperand = 0b0_00_0_00_00_00_000010 # noqa
    ZeroDivide          = 0b0_00_0_00_00_00_000100 # noqa
    Overflow            = 0b0_00_0_00_00_00_001000 # noqa
    Underflow           = 0b0_00_0_00_00_00_010000 # noqa
    PrecisionError      = 0b0_00_0_00_00_00_100000 # noqa
    Reserved1           = 0b0_00_0_00_00_01_000000 # noqa
    Reserved2           = 0b0_00_0_00_00_10_000000 # noqa
    ExtendPrecision     = 0b0_00_0_00_01_00_000000 # noqa
    DoublePrecision     = 0b0_00_0_00_10_00_000000 # noqa
    MaxPrecision        = 0b0_00_0_00_11_00_000000 # noqa
    RoundDown           = 0b0_00_0_01_00_00_000000 # noqa
    RoundUp             = 0b0_00_0_10_00_00_000000 # noqa
    RoundTowardZero     = 0b0_00_0_11_00_00_000000 # noqa
    AffineInfinity      = 0b0_00_1_00_00_00_000000 # noqa
    Reserved3           = 0b0_01_0_00_00_00_000000 # noqa
    Reserved4           = 0b0_10_0_00_00_00_000000 # noqa
    ReservedBits        = 0b0_11_0_00_00_11_000000 # noqa</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>enum.IntFlag</li>
<li>builtins.int</li>
<li>enum.ReprEnum</li>
<li>enum.Flag</li>
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.FPUControl.InvalidOperation"><code class="name">var <span class="ident">InvalidOperation</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.DenormalizedOperand"><code class="name">var <span class="ident">DenormalizedOperand</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.ZeroDivide"><code class="name">var <span class="ident">ZeroDivide</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.Overflow"><code class="name">var <span class="ident">Overflow</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.Underflow"><code class="name">var <span class="ident">Underflow</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.PrecisionError"><code class="name">var <span class="ident">PrecisionError</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.Reserved1"><code class="name">var <span class="ident">Reserved1</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.Reserved2"><code class="name">var <span class="ident">Reserved2</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.ExtendPrecision"><code class="name">var <span class="ident">ExtendPrecision</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.DoublePrecision"><code class="name">var <span class="ident">DoublePrecision</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.MaxPrecision"><code class="name">var <span class="ident">MaxPrecision</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.RoundDown"><code class="name">var <span class="ident">RoundDown</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.RoundUp"><code class="name">var <span class="ident">RoundUp</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.RoundTowardZero"><code class="name">var <span class="ident">RoundTowardZero</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.AffineInfinity"><code class="name">var <span class="ident">AffineInfinity</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.Reserved3"><code class="name">var <span class="ident">Reserved3</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.Reserved4"><code class="name">var <span class="ident">Reserved4</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.lib.inno.emulator.FPUControl.ReservedBits"><code class="name">var <span class="ident">ReservedBits</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator"><code class="flex name class">
<span>class <span class="ident">IFPSEmulator</span></span>
<span>(</span><span>archive, options=None, **more)</span>
</code></dt>
<dd>
<section class="desc"><p>The core IFPS emulator.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L665-L2068" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class IFPSEmulator:
    &#34;&#34;&#34;
    The core IFPS emulator.
    &#34;&#34;&#34;

    def __init__(
        self,
        archive: InnoArchive | IFPSFile,
        options: IFPSEmulatorConfig | None = None,
        **more
    ):
        if isinstance(archive, InnoArchive):
            self.inno = archive
            self.ifps = ifps = archive.ifps
            if ifps is None:
                raise ValueError(&#39;The input archive does not contain a script.&#39;)
        else:
            self.inno = None
            self.ifps = ifps = archive
        self.config = options or IFPSEmulatorConfig(**more)
        self.globals = [Variable(v.type, v.spec) for v in ifps.globals]
        self.stack: list[Variable] = []
        self.mutexes: set[str] = set()
        self.symbols: dict[str, Function] = CaseInsensitiveDict()
        self.reset()
        for pfn in ifps.functions:
            self.symbols[pfn.name] = pfn

    def __repr__(self):
        return self.__class__.__name__

    def reset(self):
        &#34;&#34;&#34;
        Reset the emulator timing, FPU word, mutexes, trace, and stack. All global variables are
        set to their default values.
        &#34;&#34;&#34;
        self.seconds_slept = 0.0
        self.clock = 0
        self.fpucw = FPUControl.MaxPrecision | FPUControl.RoundTowardZero
        self.jumpflag = False
        self.mutexes.clear()
        self.stack.clear()
        for v in self.globals:
            v.setdefault()
        return self

    def unimplemented(self, function: Function):
        &#34;&#34;&#34;
        The base IFPS emulator raises `refinery.lib.inno.emulator.NeedSymbol` when an external
        symbol is unimplemented. Child classes can override this function to handle the missing
        symbol differently.
        &#34;&#34;&#34;
        raise NeedSymbol(function.name)

    @EventCall.Wrap
    def emulate_function(self, function: Function, *args):
        &#34;&#34;&#34;
        Emulate a function call to the given function, passing the given arguments. The method
        returns the return value of the emulated function call if it is not a procedure.
        &#34;&#34;&#34;
        self.stack.clear()
        decl = function.decl
        if decl is None:
            raise NotImplementedError(F&#39;Do not know how to call {function!s}.&#39;)
        if (n := len(decl.parameters)) != (m := len(args)):
            raise ValueError(
                F&#39;Function {function!s} expects {n} arguments, only {m} were given.&#39;)
        for index, (argument, parameter) in enumerate(zip(args, decl.parameters), 1):
            variable = Variable(parameter.type, VariableSpec(index, VariableType.Local))
            variable.set(argument)
            self.stack.append(variable)
        self.stack.reverse()
        if not decl.void:
            result = Variable(decl.return_type, VariableSpec(0, VariableType.Argument))
            self.stack.append(result)
        yield from self.call(function)
        self.stack.clear()
        if not decl.void:
            return result.get()

    def call(self, function: Function):
        &#34;&#34;&#34;
        Begin emulating at the start of the given function.
        &#34;&#34;&#34;

        def operator_div(a, b):
            return a // b if isinstance(a, int) and isinstance(b, int) else a / b

        def operator_in(a, b):
            return a in b

        def getvar(op: VariableSpec | Operand) -&gt; Variable:
            if not isinstance(op, Operand):
                v = op
                k = None
            elif op.type is OperandType.Value:
                raise TypeError(&#39;Attempting to retrieve variable for an immediate operand.&#39;)
            else:
                v = op.variable
                k = op.index
                if op.type is OperandType.IndexedByVar:
                    k = getvar(k).get()
            t, i = v.type, v.index
            if t is VariableType.Argument:
                if function.decl.void:
                    i -= 1
                var = self.stack[sp - i]
            elif t is VariableType.Global:
                var = self.globals[i]
            elif t is VariableType.Local:
                var = self.stack[sp + i]
            else:
                raise TypeError
            if k is not None:
                var = var.at(k)
            return var

        def getval(op: Operand):
            if op.immediate:
                return op.value.value
            return getvar(op).get()

        def setval(op: Operand, new):
            if op.immediate:
                raise RuntimeError(&#39;attempt to assign to an immediate&#39;)
            getvar(op).set(new)

        class CallState(NamedTuple):
            fn: Function
            ip: int
            sp: int
            eh: list[ExceptionHandler]

        callstack: list[CallState] = []
        exec_start = process_time()
        stack = self.stack
        _cfg_max_call_stack = self.config.max_call_stack
        _cfg_max_data_stack = self.config.max_data_stack
        _cfg_max_seconds = self.config.max_seconds
        _cfg_max_opcodes = self.config.max_opcodes
        _cfg_log_opcodes = self.config.log_opcodes

        ip: int = 0
        sp: int = len(stack) - 1
        pending_exception = None
        exceptions = []

        while True:
            if 0 &lt; _cfg_max_call_stack &lt; len(callstack):
                raise EmulatorMaxCalls

            if function.body is None:
                namespace = &#39;&#39;

                if decl := function.decl:
                    if decl.is_property:
                        if stack[-1].type.code == TC.Class:
                            function = function.setter
                        else:
                            function = function.getter
                        decl = function.decl
                    namespace = (
                        decl.classname or decl.module or &#39;&#39;)

                name = function.name
                registry: dict[str, IFPSEmulatedFunction] = self.external_symbols.get(namespace, {})
                handler = registry.get(name)

                if handler:
                    void = handler.void
                    argc = handler.argc
                elif decl:
                    void = decl.void
                    argc = decl.argc
                else:
                    void = True
                    argc = 0

                try:
                    rpos = 0 if void else 1
                    args = [stack[~k] for k in range(rpos, argc + rpos)]
                except IndexError:
                    raise EmulatorException(
                        F&#39;Cannot call {function!s}; {argc} arguments + {rpos} return values expected,&#39;
                        F&#39; but stack size is only {len(stack)}.&#39;)

                if self.config.log_calls:
                    yield NewFunctionCall(str(function), tuple(a.get() for a in args))

                if handler is None:
                    self.unimplemented(function)
                else:
                    if decl and (decl.void != handler.void or decl.argc != handler.argc):
                        ok = False
                        if 1 + decl.argc - decl.void == 1 + handler.argc - handler.void:
                            if decl.void and not decl.parameters[0].const:
                                ok = True
                            elif handler.void and handler.spec[0]:
                                ok = True
                        if not ok:
                            raise RuntimeError(F&#39;Handler for {function!s} is incompatible with declaration.&#39;)
                    for k, (var, byref) in enumerate(zip(args, handler.spec)):
                        if not byref:
                            args[k] = var.get()
                    if not handler.static:
                        args.insert(0, self)
                    try:
                        return_value = handler.call(*args)
                        if inspect.isgenerator(return_value):
                            return_value = yield from return_value
                    except GeneratorExit:
                        pass
                    except BaseException as b:
                        pending_exception = IFPSException(F&#39;Error calling {function.name}: {b!s}&#39;, b)
                    else:
                        if not handler.void:
                            stack[-1].set(return_value)
                if not callstack:
                    if pending_exception is None:
                        return
                    raise pending_exception
                function, ip, sp, exceptions = callstack.pop()
                continue

            while insn := function.code.get(ip, None):
                if 0 &lt; _cfg_max_seconds &lt; process_time() - exec_start:
                    raise EmulatorTimeout
                if 0 &lt; _cfg_max_opcodes &lt; self.clock:
                    raise EmulatorExecutionLimit
                if 0 &lt; _cfg_max_data_stack &lt; len(stack):
                    raise EmulatorMaxStack
                if _cfg_log_opcodes:
                    yield NewInstruction(function, insn)
                try:
                    if pe := pending_exception:
                        pending_exception = None
                        raise pe

                    opc = insn.opcode
                    ip += insn.size
                    self.clock += 1

                    if opc == Op.Nop:
                        continue
                    elif opc == Op.Assign:
                        dst = getvar(insn.op(0))
                        src = insn.op(1)
                        if src.immediate:
                            dst.set(src.value)
                        else:
                            dst.set(getvar(src))
                    elif opc == Op.Calculate:
                        calculate = {
                            AOp.Add: operator.add,
                            AOp.Sub: operator.sub,
                            AOp.Mul: operator.mul,
                            AOp.Div: operator_div,
                            AOp.Mod: operator.mod,
                            AOp.Shl: operator.lshift,
                            AOp.Shr: operator.rshift,
                            AOp.And: operator.and_,
                            AOp.BOr: operator.or_,
                            AOp.Xor: operator.xor,
                        }[insn.operator]
                        src = insn.op(1)
                        dst = insn.op(0)
                        sv = getval(src)
                        dv = getval(dst)
                        fpu = isinstance(sv, float) or isinstance(dv, float)
                        try:
                            result = calculate(dv, sv)
                            if fpu and not isinstance(result, float):
                                raise FloatingPointError
                        except FloatingPointError as FPE:
                            if not self.fpucw &amp; FPUControl.InvalidOperation:
                                result = float(&#39;nan&#39;)
                            else:
                                raise IFPSException(&#39;invalid operation&#39;, FPE) from FPE
                        except OverflowError as OFE:
                            if fpu and self.fpucw &amp; FPUControl.Overflow:
                                result = float(&#39;nan&#39;)
                            else:
                                raise IFPSException(&#39;arithmetic overflow&#39;, OFE) from OFE
                        except ZeroDivisionError as ZDE:
                            if fpu and self.fpucw &amp; FPUControl.ZeroDivide:
                                result = float(&#39;nan&#39;)
                            else:
                                raise IFPSException(&#39;division by zero&#39;, ZDE) from ZDE
                        setval(dst, result)
                    elif opc == Op.Push:
                        # TODO: I do not actually know how this works
                        stack.append(getval(insn.op(0)))
                    elif opc == Op.PushVar:
                        stack.append(getvar(insn.op(0)))
                    elif opc == Op.Pop:
                        self.temp = stack.pop()
                    elif opc == Op.Call:
                        callstack.append(CallState(function, ip, sp, exceptions))
                        function = insn.operands[0]
                        ip = 0
                        sp = len(stack) - 1
                        exceptions = []
                        break
                    elif opc == Op.Jump:
                        ip = insn.operands[0]
                    elif opc == Op.JumpTrue:
                        if getval(insn.op(1)):
                            ip = insn.operands[0]
                    elif opc == Op.JumpFalse:
                        if not getval(insn.op(1)):
                            ip = insn.operands[0]
                    elif opc == Op.Ret:
                        del stack[sp + 1:]
                        if not callstack:
                            return
                        function, ip, sp, exceptions = callstack.pop()
                        break
                    elif opc == Op.StackType:
                        raise OpCodeNotImplemented(str(opc))
                    elif opc == Op.PushType:
                        stack.append(Variable(
                            insn.operands[0],
                            VariableSpec(len(stack) - sp, VariableType.Local)
                        ))
                    elif opc == Op.Compare:
                        compare = {
                            COp.GE: operator.ge,
                            COp.LE: operator.le,
                            COp.GT: operator.gt,
                            COp.LT: operator.lt,
                            COp.NE: operator.ne,
                            COp.EQ: operator.eq,
                            COp.IN: operator_in,
                            COp.IS: operator.is_,
                        }[insn.operator]
                        d = getvar(insn.op(0))
                        a = getval(insn.op(1))
                        b = getval(insn.op(2))
                        d.set(compare(a, b))
                    elif opc == Op.CallVar:
                        call = getval(insn.op(0))
                        if isinstance(call, int):
                            call = self.ifps.functions[call]
                        if isinstance(call, Function):
                            callstack.append(CallState(function, ip, sp, exceptions))
                            function = call
                            ip = 0
                            sp = len(stack) - 1
                            exceptions = []
                            break
                    elif opc in (Op.SetPtr, Op.SetPtrToCopy):
                        copy = False
                        if opc == Op.SetPtrToCopy:
                            copy = True
                        dst = getvar(insn.op(0))
                        src = getvar(insn.op(1))
                        dst.setptr(src, copy=copy)
                    elif opc == Op.BooleanNot:
                        setval(a := insn.op(0), not getval(a))
                    elif opc == Op.IntegerNot:
                        setval(a := insn.op(0), ~getval(a))
                    elif opc == Op.Neg:
                        setval(a := insn.op(0), -getval(a))
                    elif opc == Op.SetFlag:
                        condition, negated = insn.operands
                        self.jumpflag = getval(condition) ^ negated
                    elif opc == Op.JumpFlag:
                        if self.jumpflag:
                            ip = insn.operands[0]
                    elif opc == Op.PushEH:
                        exceptions.append(ExceptionHandler(*insn.operands))
                    elif opc == Op.PopEH:
                        tp = None
                        et = EHType(insn.operands[0])
                        eh = exceptions[-1]
                        if eh.current != et:
                            raise RuntimeError(F&#39;Expected {eh.current} block to end, but {et} was ended instead.&#39;)
                        while tp is None:
                            if et is None:
                                raise RuntimeError
                            tp, et = {
                                EHType.Catch         : (eh.finally_one, EHType.Finally),
                                EHType.Try           : (eh.finally_one, EHType.Finally),
                                EHType.Finally       : (eh.finally_two, EHType.SecondFinally),
                                EHType.SecondFinally : (eh.handler_end, None),
                            }[et]
                        eh.current = et
                        ip = tp
                        if et is None:
                            exceptions.pop()
                    elif opc == Op.Inc:
                        setval(a := insn.op(0), getval(a) + 1)
                    elif opc == Op.Dec:
                        setval(a := insn.op(0), getval(a) - 1)
                    elif opc == Op.JumpPop1:
                        stack.pop()
                        ip = insn.operands[0]
                    elif opc == Op.JumpPop2:
                        stack.pop()
                        stack.pop()
                        ip = insn.operands[0]
                    else:
                        raise RuntimeError(F&#39;Function contains invalid opcode at 0x{ip:X}.&#39;)
                except IFPSException as EE:
                    try:
                        eh = exceptions[-1]
                    except IndexError:
                        raise EE
                    et = EHType.Try
                    tp = None
                    while tp is None:
                        if et is None:
                            raise RuntimeError
                        tp, et = {
                            EHType.Try           : (eh.catch_error, EHType.Catch),
                            EHType.Catch         : (eh.finally_one, EHType.Finally),
                            EHType.Finally       : (eh.finally_two, EHType.SecondFinally),
                            EHType.SecondFinally : (eh.handler_end, None),
                        }[et]
                    if et is None:
                        raise EE
                    eh.current = et
                    ip = tp
                except AbortEmulation:
                    raise
                except EmulatorException:
                    raise
                except Exception as RE:
                    raise EmulatorException(
                        F&#39;In {function.symbol} at 0x{insn.offset:X} (cycle {self.clock}), &#39;
                        F&#39;emulation of {insn!r} failed: {RE!s}&#39;)
            if ip is None:
                raise RuntimeError(F&#39;Instruction pointer moved out of bounds to 0x{ip:X}.&#39;)

    external_symbols: ClassVar[
        dict[str,                        # class name for methods or empty string for functions
        dict[str, IFPSEmulatedFunction]] # method or function name to emulation info
    ] = CaseInsensitiveDict()

    def external(*args, static=True, __reg: dict = external_symbols, **kwargs):
        def decorator(pfn):
            signature = inspect.signature(pfn)
            name: str = kwargs.get(&#39;name&#39;, pfn.__name__)
            csep: str = &#39;.&#39;
            if csep not in name:
                csep = &#39;__&#39;
            classname, _, name = name.rpartition(csep)
            if (registry := __reg.get(classname)) is None:
                registry = __reg[classname] = CaseInsensitiveDict()

            docs = F&#39;{classname}::{name}&#39; if classname else name
            docs = F&#39;An emulated handler for the external symbol {docs}.&#39;
            pfn.__doc__ = docs

            void = kwargs.get(&#39;void&#39;, signature.return_annotation == signature.empty)
            parameters: list[bool] = []
            specs = iter(signature.parameters.values())
            if not static:
                next(specs)
            for spec in specs:
                try:
                    hint = evaluate(spec.annotation, globals(), locals())
                except Exception as E:
                    raise RuntimeError(F&#39;Invalid signature: {signature}&#39;) from E
                if not isinstance(hint, type):
                    hint = get_origin(hint)
                var = isinstance(hint, type) and issubclass(hint, Variable)
                parameters.append(var)
            registry[name] = e = IFPSEmulatedFunction(pfn, parameters, static, void)
            aliases = kwargs.get(&#39;alias&#39;, [])
            if isinstance(aliases, str):
                aliases = [aliases]
            for name in aliases:
                registry[name] = e
            if static:
                pfn = staticmethod(pfn)
            return pfn
        return decorator(args[0]) if args else decorator

    @external
    def TInputDirWizardPage__GetValues(this: object, k: int) -&gt; str:
        return F&#39;$InputDir{k}&#39;

    @external
    def TInputFileWizardPage__GetValues(this: object, k: int) -&gt; str:
        return F&#39;$InputFile{k}&#39;

    @external(static=False)
    def TPasswordEdit__SetText(self, this: object, value: str):
        if value:
            yield NewPassword(value)
        return value

    @external(static=False)
    def kernel32__GetTickCount(self) -&gt; int:
        tick = self.clock
        tick *= self.config.milliseconds_per_instruction
        tick += self.seconds_slept * 1000
        return int(tick)

    @external
    def user32__GetSystemMetrics(index: int) -&gt; int:
        if index == 80:
            return 1
        if index == 43:
            return 2
        return 0

    @external
    def IsX86Compatible() -&gt; bool:
        return True

    @external(alias=[
        &#39;sArm64&#39;,
        &#39;IsArm32Compatible&#39;,
        &#39;Debugging&#39;,
        &#39;IsUninstaller&#39;,
    ])
    def Terminated() -&gt; bool:
        return False

    @external(static=False)
    def IsAdmin(self) -&gt; bool:
        return self.config.admin

    @external(static=False, alias=&#39;Sleep&#39;)
    def kernel32__Sleep(self, ms: int):
        seconds = ms / 1000.0
        self.seconds_slept += seconds

    @external
    def Random(top: int) -&gt; int:
        return random.randrange(0, top)

    @external(alias=&#39;StrGet&#39;)
    def WStrGet(string: Variable[str], index: int) -&gt; str:
        if index &lt;= 0:
            raise ValueError
        return string[index - 1:index]

    @external(alias=&#39;StrSet&#39;)
    def WStrSet(char: str, index: int, dst: Variable[str]):
        old = dst.get()
        index -= 1
        dst.set(old[:index] + char + old[index:])

    @external(static=False)
    def GetEnv(self, name: str) -&gt; str:
        return self.config.environment.get(name, F&#39;%{name}%&#39;)

    @external
    def Beep():
        pass

    @external(static=False)
    def Abort(self):
        if self.config.throw_abort:
            raise AbortEmulation

    @external
    def DirExists(path: str) -&gt; bool:
        return True

    @external
    def ForceDirectories(path: str) -&gt; bool:
        return True

    @external(alias=&#39;LoadStringFromLockedFile&#39;)
    def LoadStringFromFile(path: str, out: Variable[str]) -&gt; bool:
        return True

    @external(alias=&#39;LoadStringsFromLockedFile&#39;)
    def LoadStringsFromFile(path: str, out: Variable[str]) -&gt; bool:
        return True

    @cached_property
    def constant_map(self) -&gt; dict[str, str]:
        cfg = self.config
        tmp = cfg.temp_path
        if not tmp:
            tmp = &#39;&#39;.join(random.choices(&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;, k=5))
            tmp = RF&#39;C:\Windows\Temp\IS-{tmp}&#39;
        map = {
            &#39;app&#39;               : cfg.install_to,
            &#39;win&#39;               : R&#39;C:\Windows&#39;,
            &#39;sys&#39;               : R&#39;C:\Windows\System&#39;,
            &#39;sysnative&#39;         : R&#39;C:\Windows\System32&#39;,
            &#39;src&#39;               : str(Path(cfg.executable).parent),
            &#39;sd&#39;                : R&#39;C:&#39;,
            &#39;commonpf&#39;          : R&#39;C:\Program Files&#39;,
            &#39;commoncf&#39;          : R&#39;C:\Program Files\Common Files&#39;,
            &#39;tmp&#39;               : tmp,
            &#39;commonfonts&#39;       : R&#39;C:\Windows\Fonts&#39;,
            &#39;dao&#39;               : R&#39;C:\Program Files\Common Files\Microsoft Shared\DAO&#39;,
            &#39;dotnet11&#39;          : R&#39;C:\Windows\Microsoft.NET\Framework\v1.1.4322&#39;,
            &#39;dotnet20&#39;          : R&#39;C:\Windows\Microsoft.NET\Framework\v3.0&#39;,
            &#39;dotnet2032&#39;        : R&#39;C:\Windows\Microsoft.NET\Framework\v3.0&#39;,
            &#39;dotnet40&#39;          : R&#39;C:\Windows\Microsoft.NET\Framework\v4.0.30319&#39;,
            &#39;dotnet4032&#39;        : R&#39;C:\Windows\Microsoft.NET\Framework\v4.0.30319&#39;,
            &#39;group&#39;             : RF&#39;C:\Users\{cfg.user_name}\Start Menu\Programs\{cfg.inno_name}&#39;,
            &#39;localappdata&#39;      : RF&#39;C:\Users\{cfg.user_name}\AppData\Local&#39;,
            &#39;userappdata&#39;       : RF&#39;C:\Users\{cfg.user_name}\AppData\Roaming&#39;,
            &#39;userdesktop&#39;       : RF&#39;C:\Users\{cfg.user_name}\Desktop&#39;,
            &#39;userdocs&#39;          : RF&#39;C:\Users\{cfg.user_name}\Documents&#39;,
            &#39;userfavourites&#39;    : RF&#39;C:\Users\{cfg.user_name}\Favourites&#39;,
            &#39;usersavedgames&#39;    : RF&#39;C:\Users\{cfg.user_name}\Saved Games&#39;,
            &#39;usersendto&#39;        : RF&#39;C:\Users\{cfg.user_name}\SendTo&#39;,
            &#39;userstartmenu&#39;     : RF&#39;C:\Users\{cfg.user_name}\Start Menu&#39;,
            &#39;userprograms&#39;      : RF&#39;C:\Users\{cfg.user_name}\Start Menu\Programs&#39;,
            &#39;userstartup&#39;       : RF&#39;C:\Users\{cfg.user_name}\Start Menu\Programs\Startup&#39;,
            &#39;usertemplates&#39;     : RF&#39;C:\Users\{cfg.user_name}\Templates&#39;,
            &#39;commonappdata&#39;     : R&#39;C:\ProgramData&#39;,
            &#39;commondesktop&#39;     : R&#39;C:\ProgramData\Microsoft\Windows\Desktop&#39;,
            &#39;commondocs&#39;        : R&#39;C:\ProgramData\Microsoft\Windows\Documents&#39;,
            &#39;commonstartmenu&#39;   : R&#39;C:\ProgramData\Microsoft\Windows\Start Menu&#39;,
            &#39;commonprograms&#39;    : R&#39;C:\ProgramData\Microsoft\Windows\Start Menu\Programs&#39;,
            &#39;commonstartup&#39;     : R&#39;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup&#39;,
            &#39;commontemplates&#39;   : R&#39;C:\ProgramData\Microsoft\Windows\Templates&#39;,
            &#39;cmd&#39;               : R&#39;C:\Windows\System32\cmd.exe&#39;,
            &#39;computername&#39;      : cfg.host_name,
            &#39;groupname&#39;         : cfg.inno_name,
            &#39;hwnd&#39;              : &#39;0&#39;,
            &#39;wizardhwnd&#39;        : &#39;0&#39;,
            &#39;language&#39;          : cfg.language,
            &#39;srcexe&#39;            : cfg.executable,
            &#39;sysuserinfoname&#39;   : &#39;{sysuserinfoname}&#39;,
            &#39;sysuserinfoorg&#39;    : &#39;{sysuserinfoorg}&#39;,
            &#39;userinfoname&#39;      : &#39;{userinfoname}&#39;,
            &#39;userinfoorg&#39;       : &#39;{userinfoorg}&#39;,
            &#39;userinfoserial&#39;    : &#39;{userinfoserial}&#39;,
            &#39;username&#39;          : cfg.user_name,
            &#39;log&#39;               : &#39;&#39;,
        }

        if (inno := self.inno) is None or (inno.setup_info.Header.Flags &amp; Flags.Uninstallable):
            map[&#39;uninstallexe&#39;] = RF&#39;{cfg.install_to}\unins000.exe&#39;

        if cfg.x64:
            map[&#39;syswow64&#39;] = R&#39;C:\Windows\SysWOW64&#39;
            map[&#39;commonpf32&#39;] = R&#39;C:\Program Files (x86)&#39;
            map[&#39;commoncf32&#39;] = R&#39;C:\Program Files (x86)\Common Files&#39;
            map[&#39;commonpf64&#39;] = R&#39;C:\Program Files&#39;
            map[&#39;commoncf64&#39;] = R&#39;C:\Program Files\Common Files&#39;
            map[&#39;dotnet2064&#39;] = R&#39;C:\Windows\Microsoft.NET\Framework64\v3.0&#39;
            map[&#39;dotnet4064&#39;] = R&#39;C:\Windows\Microsoft.NET\Framework64\v4.0.30319&#39;
        else:
            map[&#39;syswow64&#39;] = R&#39;C:\Windows\System32&#39;
            map[&#39;commonpf32&#39;] = R&#39;C:\Program Files&#39;
            map[&#39;commoncf32&#39;] = R&#39;C:\Program Files\Common Files&#39;

        if cfg.windows_os_version[0] &gt;= 10:
            map[&#39;userfonts&#39;] = RF&#39;{map[&#34;localappdata&#34;]}\Microsoft\Windows\Fonts&#39;

        if cfg.windows_os_version[0] &gt;= 7:
            map[&#39;usercf&#39;] = RF&#39;{map[&#34;localappdata&#34;]}\Programs\Common&#39;
            map[&#39;userpf&#39;] = RF&#39;{map[&#34;localappdata&#34;]}\Programs&#39;

        for auto_var, admin_var, user_var in [
            (&#39;autoappdata&#39;,       &#39;commonappdata&#39;,       &#39;userappdata&#39;,   ), # noqa
            (&#39;autocf&#39;,            &#39;commoncf&#39;,            &#39;usercf&#39;,        ), # noqa
            (&#39;autocf32&#39;,          &#39;commoncf32&#39;,          &#39;usercf&#39;,        ), # noqa
            (&#39;autocf64&#39;,          &#39;commoncf64&#39;,          &#39;usercf&#39;,        ), # noqa
            (&#39;autodesktop&#39;,       &#39;commondesktop&#39;,       &#39;userdesktop&#39;,   ), # noqa
            (&#39;autodocs&#39;,          &#39;commondocs&#39;,          &#39;userdocs&#39;,      ), # noqa
            (&#39;autofonts&#39;,         &#39;commonfonts&#39;,         &#39;userfonts&#39;,     ), # noqa
            (&#39;autopf&#39;,            &#39;commonpf&#39;,            &#39;userpf&#39;,        ), # noqa
            (&#39;autopf32&#39;,          &#39;commonpf32&#39;,          &#39;userpf&#39;,        ), # noqa
            (&#39;autopf64&#39;,          &#39;commonpf64&#39;,          &#39;userpf&#39;,        ), # noqa
            (&#39;autoprograms&#39;,      &#39;commonprograms&#39;,      &#39;userprograms&#39;,  ), # noqa
            (&#39;autostartmenu&#39;,     &#39;commonstartmenu&#39;,     &#39;userstartmenu&#39;, ), # noqa
            (&#39;autostartup&#39;,       &#39;commonstartup&#39;,       &#39;userstartup&#39;,   ), # noqa
            (&#39;autotemplates&#39;,     &#39;commontemplates&#39;,     &#39;usertemplates&#39;, ), # noqa
        ]:
            try:
                map[auto_var] = map[admin_var] if cfg.admin else map[user_var]
            except KeyError:
                continue

        for legacy, new in [
            (&#39;cf&#39;,     &#39;commoncf&#39;,    ), # noqa
            (&#39;cf32&#39;,   &#39;commoncf32&#39;,  ), # noqa
            (&#39;cf64&#39;,   &#39;commoncf64&#39;,  ), # noqa
            (&#39;fonts&#39;,  &#39;commonfonts&#39;, ), # noqa
            (&#39;pf&#39;,     &#39;commonpf&#39;,    ), # noqa
            (&#39;pf32&#39;,   &#39;commonpf32&#39;,  ), # noqa
            (&#39;pf64&#39;,   &#39;commonpf64&#39;,  ), # noqa
            (&#39;sendto&#39;, &#39;usersendto&#39;,  ), # noqa
        ]:
            try:
                map[legacy] = map[new]
            except KeyError:
                continue

        return map

    @external(static=False)
    def ExpandConstant(self, string: str) -&gt; str:
        return self.expand_constant(string)

    @external(static=False)
    def ExpandConstantEx(self, string: str, custom_var: str, custom_val: str) -&gt; str:
        return self.expand_constant(string, custom_var, custom_val)

    def expand_constant(
        self,
        string: str,
        custom_var: str | None = None,
        custom_val: str | None = None,
        unescape: bool = False
    ):
        config = self.config
        expand = partial(self.expand_constant, unescape=True)
        string = re.sub(r&#39;(\{\{.*?\}(?!\}))&#39;, &#39;\\1}&#39;, string)

        with io.StringIO() as result:
            constants = self.constant_map
            formatter = Formatter()
            backslash = False
            try:
                parsed = list(formatter.parse(string))
            except ValueError as VE:
                raise IFPSException(F&#39;invalid format string: {string!r}&#39;, VE) from VE
            for prefix, spec, modifier, conversion in parsed:
                if backslash and prefix[:1] == &#39;\\&#39;:
                    prefix = prefix[1:]
                if unescape:
                    prefix = unquote(prefix)
                result.write(prefix)
                if spec is None:
                    continue
                elif spec == &#39;\\&#39;:
                    if modifier or conversion:
                        raise IFPSException(&#39;Invalid format string.&#39;, ValueError(string))
                    value = spec
                elif spec == custom_var:
                    value = custom_val
                elif spec.startswith(&#39;%&#39;):
                    name, p, default = spec[1:].partition(&#39;|&#39;)
                    name = expand(name)
                    default = expand(default)
                    try:
                        value = config.environment[name]
                    except KeyError:
                        value = default if p else F&#39;%{name}%&#39;
                elif spec == &#39;drive&#39;:
                    value = self.ExtractFileDrive(expand(modifier))
                elif spec == &#39;ini&#39;:
                    # {ini:Filename,Section,Key|DefaultValue}
                    _, _, default = modifier.partition(&#39;|&#39;)
                    value = expand(default)
                elif spec == &#39;code&#39;:
                    # {code:FunctionName|Param}
                    symbol, _, param = modifier.partition(&#39;|&#39;)
                    param = expand(param)
                    try:
                        function = self.symbols[symbol]
                    except KeyError as KE:
                        raise IFPSException(F&#39;String formatter references missing function {symbol}.&#39;, KE) from KE
                    emulation = self.emulate_function(function, param)
                    value = str(emulation.value)
                elif spec == &#39;cm&#39;:
                    # {cm:LaunchProgram,Inno Setup}
                    # The example above translates to &#34;Launch Inno Setup&#34; if English is the active language.
                    name, _, placeholders = modifier.partition(&#39;,&#39;)
                    value = self.CustomMessage(expand(name))
                    if placeholders:
                        def _placeholder(match: re.Match[str]):
                            try:
                                return placeholders[int(match[1]) - 1]
                            except Exception:
                                return match[0]
                        placeholders = [ph.strip() for ph in placeholders.split(&#39;,&#39;)]
                        value = re.sub(&#39;(?&lt;!%)%([1-9]\\d*)&#39;, _placeholder, value)
                elif spec == &#39;reg&#39;:
                    # {reg:HKXX\SubkeyName,ValueName|DefaultValue}
                    _, _, default = modifier.partition(&#39;|&#39;)
                    value = expand(default)
                elif spec == &#39;param&#39;:
                    # {param:ParamName|DefaultValue}
                    _, _, default = modifier.partition(&#39;|&#39;)
                    value = expand(default)
                else:
                    try:
                        value = constants[spec]
                    except KeyError as KE:
                        raise IFPSException(F&#39;invalid format field {spec}&#39;, KE) from KE
                backslash = value.endswith(&#39;\\&#39;)
                result.write(value)
            return result.getvalue()

    @external
    def DeleteFile(path: str) -&gt; bool:
        return True

    @external
    def FileExists(file_name: str) -&gt; bool:
        return False

    @external
    def Log(log: str):
        ...

    @external
    def Inc(p: Variable[Variable[int]]):
        p.set(p.get() + 1)

    @external
    def Dec(p: Variable[Variable[int]]):
        p.set(p.get() - 1)

    @external
    def FindFirst(file_name: str, frec: Variable) -&gt; bool:
        return False

    @external
    def Trunc(x: float) -&gt; float:
        return math.trunc(x)

    @external
    def GetSpaceOnDisk(
        path: str,
        in_megabytes: bool,
        avail: Variable[int],
        space: Variable[int],
    ) -&gt; bool:
        _a = 3_000_000
        _t = 5_000_000
        if not in_megabytes:
            _a *= 1000
            _t *= 1000
        avail.set(_a)
        space.set(_t)
        return True

    @external
    def GetSpaceOnDisk64(
        path: str,
        avail: Variable[int],
        space: Variable[int],
    ) -&gt; bool:
        avail.set(3_000_000_000)
        space.set(5_000_000_000)
        return True

    @external
    def Exec(
        exe: str,
        cmd: str,
        cwd: str,
        show: int,
        wait: int,
        out: Variable[int],
    ) -&gt; bool:
        out.set(0)
        return True

    @external
    def GetCmdTail() -&gt; str:
        return &#39;&#39;

    @external
    def ParamCount() -&gt; int:
        return 0

    @external
    def ParamStr(index: int) -&gt; str:
        return &#39;&#39;

    @external
    def ActiveLanguage() -&gt; str:
        return &#39;en&#39;

    @external(static=False)
    def CustomMessage(self, msg_name: str) -&gt; str:
        by_language = {}
        for msg in self.inno.setup_info.Messages:
            if msg.EncodedName == msg_name:
                lng = msg.get_language_value().Name
                if lng == self.config.language:
                    return msg.Value
                by_language[lng] = msg.Value
        try:
            return by_language[0]
        except KeyError:
            pass
        try:
            return next(iter(by_language.values()))
        except StopIteration:
            raise IFPSException(F&#39;Custom message with name {msg_name} not found.&#39;)

    @external
    def FmtMessage(fmt: str, args: list[str]) -&gt; str:
        fmt = fmt.replace(&#39;{&#39;, &#39;{{&#39;)
        fmt = fmt.replace(&#39;}&#39;, &#39;}}&#39;)
        fmt = &#39;%&#39;.join(re.sub(&#39;%(\\d+)&#39;, &#39;{\\1}&#39;, p) for p in fmt.split(&#39;%%&#39;))
        return fmt.format(*args)

    @external
    def Format(fmt: str, args: list[str | int | float]) -&gt; str:
        try:
            formatted = fmt % tuple(args)
        except Exception:
            raise IFPSException(&#39;invalid format&#39;)
        else:
            return formatted

    @external(static=False)
    def SetupMessage(self, id: int) -&gt; str:
        try:
            return self.inno.setup_info.Messages[id].Value
        except (AttributeError, IndexError):
            return &#39;&#39;

    @external(static=False, alias=[&#39;Is64BitInstallMode&#39;, &#39;IsX64Compatible&#39;, &#39;IsX64OS&#39;])
    def IsWin64(self) -&gt; bool:
        return self.config.x64

    @external(static=False)
    def IsX86OS(self) -&gt; bool:
        return not self.config.x64

    @external
    def RaiseException(msg: str):
        raise IFPSException(msg)

    @external(static=False)
    def ProcessorArchitecture(self) -&gt; int:
        if self.config.x64:
            return TSetupProcessorArchitecture.paX64.value
        else:
            return TSetupProcessorArchitecture.paX86.value

    @external(static=False)
    def GetUserNameString(self) -&gt; str:
        return self.config.user_name

    @external(static=False)
    def GetComputerNameString(self) -&gt; str:
        return self.config.host_name

    @external(static=False)
    def GetUILanguage(self) -&gt; str:
        return self.config.lcid

    @external
    def GetArrayLength(array: Variable) -&gt; int:
        array = array.deref()
        return len(array)

    @external
    def SetArrayLength(array: Variable, n: int):
        a = array.deref()
        a.resize(n)

    @external(static=False)
    def WizardForm(self) -&gt; object:
        return self

    @external
    def Unassigned() -&gt; None:
        return None

    @external
    def Null() -&gt; None:
        return None

    @external(static=False)
    def Set8087CW(self, cw: int):
        self.fpucw = FPUControl(cw)

    @external(static=False)
    def Get8087CW(self) -&gt; int:
        return self.fpucw.value

    @external(static=False)
    def GetDateTimeString(
        self,
        fmt: str,
        date_separator: str,
        time_separator: str,
    ) -&gt; str:

        now = self.config.start_time
        now = now + timedelta(
            milliseconds=(self.config.milliseconds_per_instruction * self.clock))
        now = now + timedelta(seconds=self.seconds_slept)

        date_separator = date_separator.lstrip(&#39;\0&#39;)
        time_separator = time_separator.lstrip(&#39;\0&#39;)

        def dt(m: re.Match[str]):
            spec = m[1]
            ampm = m[2]
            if ampm:
                am, _, pm = ampm.partition(&#39;/&#39;)
                spec = spec.upper()
                suffix = now.strftime(&#39;%p&#39;).lower()
                suffix = {&#39;am&#39;: am, &#39;pm&#39;: pm}[suffix]
            else:
                suffix = &#39;&#39;
            if spec == &#39;dddddd&#39; or spec == &#39;ddddd&#39;:
                return now.date().isoformat()
            if spec == &#39;t&#39;:
                return now.time().isoformat(&#39;minutes&#39;)
            if spec == &#39;tt&#39;:
                return now.time().isoformat(&#39;seconds&#39;)
            if spec == &#39;d&#39;:
                return str(now.day)
            if spec == &#39;m&#39;:
                return str(now.month)
            if spec == &#39;h&#39;:
                return str(now.hour)
            if spec == &#39;n&#39;:
                return str(now.minute)
            if spec == &#39;s&#39;:
                return str(now.second)
            if spec == &#39;H&#39;:
                return now.strftime(&#39;%I&#39;).lstrip(&#39;0&#39;) + suffix
            if spec == &#39;/&#39;:
                return date_separator or spec
            if spec == &#39;:&#39;:
                return time_separator or spec
            return now.strftime({
                &#39;dddd&#39;  : &#39;%A&#39;,
                &#39;ddd&#39;   : &#39;%a&#39;,
                &#39;dd&#39;    : &#39;%d&#39;,
                &#39;mmmm&#39;  : &#39;%B&#39;,
                &#39;mmm&#39;   : &#39;%b&#39;,
                &#39;mm&#39;    : &#39;%m&#39;,
                &#39;yyyy&#39;  : &#39;%Y&#39;,
                &#39;yy&#39;    : &#39;%y&#39;,
                &#39;hh&#39;    : &#39;%H&#39;,
                &#39;HH&#39;    : &#39;%I&#39; + suffix,
                &#39;nn&#39;    : &#39;%M&#39;,
                &#39;ss&#39;    : &#39;%S&#39;,
            }.get(spec, m[0]))

        split = re.split(F&#39;({formats.string!s})&#39;, fmt)
        for k in range(0, len(split), 2):
            split[k] = re.sub(&#39;([dmyhnst]+)((?:[aA][mM]?/[pP][mM]?)?)&#39;, dt, split[k])
        for k in range(1, len(split), 2):
            split[k] = split[k][1:-1]
        return &#39;&#39;.join(split)

    @external
    def Chr(b: int) -&gt; str:
        return chr(b)

    @external
    def Ord(c: str) -&gt; int:
        return ord(c)

    @external
    def Copy(string: str, index: int, count: int) -&gt; str:
        index -= 1
        return string[index:index + count]

    @external
    def Length(string: str) -&gt; int:
        return len(string)

    @external(alias=&#39;AnsiLowercase&#39;)
    def Lowercase(string: str) -&gt; str:
        return string.lower()

    @external(alias=&#39;AnsiUppercase&#39;)
    def Uppercase(string: str) -&gt; str:
        return string.upper()

    @external
    def StringOfChar(c: str, count: int) -&gt; str:
        return c * count

    @external
    def Delete(string: Variable[str], index: int, count: int):
        index -= 1
        old = string.get()
        string.set(old[:index] + old[index + count:])

    @external
    def Insert(string: str, dest: Variable[str], index: int):
        index -= 1
        old = dest.get()
        dest.set(old[:index] + string + old[index:])

    @external(static=False)
    def StringChange(self, string: Variable[str], old: str, new: str) -&gt; int:
        return self.StringChangeEx(string, old, new, False)

    @external
    def StringChangeEx(string: Variable[str], old: str, new: str, _: bool) -&gt; int:
        haystack = string.get()
        count = haystack.count(old)
        string.set(haystack.replace(old, new))
        return count

    @external
    def Pos(string: str, sub: str) -&gt; int:
        return string.find(sub) + 1

    @external
    def AddQuotes(string: str) -&gt; str:
        if string and (string[0] != &#39;&#34;&#39; or string[~0] != &#39;&#34;&#39;) and &#39; &#39; in string:
            string = F&#39;&#34;{string}&#34;&#39;
        return string

    @external
    def RemoveQuotes(string: str) -&gt; str:
        if string and string[0] == &#39;&#34;&#39; and string[~0] == &#39;&#34;&#39;:
            string = string[1:-1]
        return string

    @external(static=False)
    def CompareText(self, a: str, b: str) -&gt; int:
        return self.CompareStr(a.casefold(), b.casefold())

    @external
    def CompareStr(a: str, b: str) -&gt; int:
        if a &gt; b:
            return +1
        if a &lt; b:
            return -1
        return 0

    @external
    def SameText(a: str, b: str) -&gt; bool:
        return a.casefold() == b.casefold()

    @external
    def SameStr(a: str, b: str) -&gt; bool:
        return a == b

    @external
    def IsWildcard(pattern: str) -&gt; bool:
        return &#39;*&#39; in pattern or &#39;?&#39; in pattern

    @external
    def WildcardMatch(text: str, pattern: str) -&gt; bool:
        return fnmatch.fnmatch(text, pattern)

    @external
    def Trim(string: str) -&gt; str:
        return string.strip()

    @external
    def TrimLeft(string: str) -&gt; str:
        return string.lstrip()

    @external
    def TrimRight(string: str) -&gt; str:
        return string.rstrip()

    @external
    def StringJoin(sep: str, values: list[str]) -&gt; str:
        return sep.join(values)

    @external
    def StringSplitEx(string: str, separators: list[str], quote: str, how: TSplitType) -&gt; list[str]:
        if not quote:
            parts = [string]
        else:
            quote = re.escape(quote)
            parts = re.split(F&#39;({quote}.*?{quote})&#39;, string)
        sep = &#39;|&#39;.join(re.escape(s) for s in separators)
        out = []
        if how == TSplitType.stExcludeEmpty:
            sep = F&#39;(?:{sep})+&#39;
        for k in range(0, len(parts)):
            if k &amp; 1 == 1:
                out.append(parts[k])
                continue
            out.extend(re.split(sep, string))
        if how == TSplitType.stExcludeLastEmpty:
            for k in reversed(range(len(out))):
                if not out[k]:
                    out.pop(k)
                    break
        return out

    @external(static=False)
    def StringSplit(self, string: str, separators: list[str], how: TSplitType) -&gt; list[str]:
        return self.StringSplitEx(string, separators, None, how)

    @external(alias=&#39;StrToInt64&#39;)
    def StrToInt(s: str) -&gt; int:
        return int(s)

    @external(alias=&#39;StrToInt64Def&#39;)
    def StrToIntDef(s: str, d: int) -&gt; int:
        try:
            return int(s)
        except Exception:
            return d

    @external
    def StrToFloat(s: str) -&gt; float:
        return float(s)

    @external(alias=&#39;FloatToStr&#39;)
    def IntToStr(i: int) -&gt; str:
        return str(i)

    @external
    def StrToVersion(s: str, v: Variable[int]) -&gt; bool:
        try:
            packed = bytes(map(int, s.split(&#39;.&#39;)))
        except Exception:
            return False
        if len(packed) != 4:
            return False
        v.set(int.from_bytes(packed, &#39;little&#39;))
        return True

    @external
    def CharLength(string: str, index: int) -&gt; int:
        return 1

    @external
    def AddBackslash(string: str) -&gt; str:
        if string and string[~0] != &#39;\\&#39;:
            string = F&#39;{string}\\&#39;
        return string

    @external
    def AddPeriod(string: str) -&gt; str:
        if string and string[~0] != &#39;.&#39;:
            string = F&#39;{string}.&#39;
        return string

    @external(static=False)
    def RemoveBackslashUnlessRoot(self, string: str) -&gt; str:
        path = Path(string)
        if len(path.parts) == 1:
            return str(path)
        return self.RemoveBackslash(string)

    @external
    def RemoveBackslash(string: str) -&gt; str:
        return string.rstrip(&#39;\\/&#39;)

    @external
    def ChangeFileExt(name: str, ext: str) -&gt; str:
        if not ext.startswith(&#39;.&#39;):
            ext = F&#39;.{ext}&#39;
        return str(Path(name).with_suffix(ext))

    @external
    def ExtractFileExt(name: str) -&gt; str:
        return Path(name).suffix

    @external(alias=&#39;ExtractFilePath&#39;)
    def ExtractFileDir(name: str) -&gt; str:
        dirname = str(Path(name).parent)
        return &#39;&#39; if dirname == &#39;.&#39; else dirname

    @external
    def ExtractFileName(name: str) -&gt; str:
        if name:
            name = Path(name).parts[-1]
        return name

    @external
    def ExtractFileDrive(name: str) -&gt; str:
        if name:
            parts = Path(name).parts
            if len(parts) &gt;= 2 and parts[0] == &#39;\\&#39; and parts[1] == &#39;?&#39;:
                parts = parts[2:]
            if parts[0] == &#39;\\&#39;:
                if len(parts) &gt;= 3:
                    return &#39;\\&#39;.join(parts[:3])
            else:
                root = parts[0]
                if len(root) == 2 and root[1] == &#39;:&#39;:
                    return root
        return &#39;&#39;

    @external
    def ExtractRelativePath(base: str, dst: str) -&gt; str:
        return str(Path(dst).relative_to(base))

    @external(static=False, alias=&#39;ExpandUNCFileName&#39;)
    def ExpandFileName(self, name: str) -&gt; str:
        if self.ExtractFileDrive(name):
            return name
        return str(self.config.cwd / name)

    @external
    def SetLength(string: Variable[str], size: int):
        old = string.get()
        old = old.ljust(size, &#39;\0&#39;)
        string.set(old[:size])

    @external(alias=&#39;OemToCharBuff&#39;)
    def CharToOemBuff(string: str) -&gt; str:
        # TODO
        return string

    @external
    def Utf8Encode(string: str) -&gt; str:
        return string.encode(&#39;utf8&#39;).decode(&#39;latin1&#39;)

    @external
    def Utf8Decode(string: str) -&gt; str:
        return string.encode(&#39;latin1&#39;).decode(&#39;utf8&#39;)

    @external
    def GetMD5OfString(string: str) -&gt; str:
        return hashlib.md5(string.encode(&#39;latin1&#39;)).hexdigest()

    @external
    def GetMD5OfUnicodeString(string: str) -&gt; str:
        return hashlib.md5(string.encode(&#39;utf8&#39;)).hexdigest()

    @external
    def GetSHA1OfString(string: str) -&gt; str:
        return hashlib.sha1(string.encode(&#39;latin1&#39;)).hexdigest()

    @external
    def GetSHA1OfUnicodeString(string: str) -&gt; str:
        return hashlib.sha1(string.encode(&#39;utf8&#39;)).hexdigest()

    @external
    def GetSHA256OfString(string: str) -&gt; str:
        return hashlib.sha256(string.encode(&#39;latin1&#39;)).hexdigest()

    @external
    def GetSHA256OfUnicodeString(string: str) -&gt; str:
        return hashlib.sha256(string.encode(&#39;utf8&#39;)).hexdigest()

    @external
    def SysErrorMessage(code: int) -&gt; str:
        return F&#39;[description for error {code:08X}]&#39;

    @external
    def MinimizePathName(path: str, font: object, max_len: int) -&gt; str:
        return path

    @external(static=False)
    def CheckForMutexes(self, mutexes: str) -&gt; bool:
        return any(m in self.mutexes for m in mutexes.split(&#39;,&#39;))

    @external(static=False)
    def CreateMutex(self, name: str):
        if self.config.log_mutexes:
            yield NewMutex(name)
        self.mutexes.add(name)

    @external(static=False)
    def GetWinDir(self) -&gt; str:
        return self.expand_constant(&#39;{win}&#39;)

    @external(static=False)
    def GetSystemDir(self) -&gt; str:
        return self.expand_constant(&#39;{sys}&#39;)

    @external(static=False)
    def GetWindowsVersion(self) -&gt; int:
        version = int.from_bytes(
            struct.pack(&#39;&gt;BBH&#39;, *self.config.windows_os_version), &#39;big&#39;)
        return version

    @external(static=False)
    def GetWindowsVersionEx(self, tv: Variable[int | bool]):
        tv[0], tv[1], tv[2] = self.config.windows_os_version # noqa
        tv[3], tv[4]        = self.config.windows_sp_version # noqa
        tv[5], tv[6], tv[7] = True, 0, 0

    @external(static=False)
    def GetWindowsVersionString(self) -&gt; str:
        return &#39;{}.{:02d}.{:04d}&#39;.format(*self.config.windows_os_version)

    @external
    def CreateOleObject(name: str) -&gt; OleObject:
        return OleObject(name)

    @external
    def GetActiveOleObject(name: str) -&gt; OleObject:
        return OleObject(name)

    @external
    def IDispatchInvoke(ole: OleObject, prop_set: bool, name: str, value: Any) -&gt; int:
        return 0

    @external
    def FindWindowByClassName(name: str) -&gt; int:
        return 0

    @external
    def FindWindowByWindowName(name: str) -&gt; int:
        return 0

    @external(static=False)
    def WizardSilent(self) -&gt; bool:
        return self.config.wizard_silent

    @external(static=False)
    def SizeOf(self, var: Variable) -&gt; int:
        if var.pointer:
            return (self.config.x64 + 1) * 4
        if var.container:
            return sum(self.SizeOf(x) for x in var.data)
        return var.type.code.width

    del external</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="refinery.lib.inno.emulator.InnoSetupEmulator" href="#refinery.lib.inno.emulator.InnoSetupEmulator">InnoSetupEmulator</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.external_symbols"><code class="name">var <span class="ident">external_symbols</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Static methods</h3>
<dl>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.TInputDirWizardPage__GetValues"><code class="name flex">
<span>def <span class="ident">TInputDirWizardPage__GetValues</span></span>(<span>this, k)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol TInputDirWizardPage::GetValues.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1144-L1146" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def TInputDirWizardPage__GetValues(this: object, k: int) -&gt; str:
    return F&#39;$InputDir{k}&#39;</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.TInputFileWizardPage__GetValues"><code class="name flex">
<span>def <span class="ident">TInputFileWizardPage__GetValues</span></span>(<span>this, k)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol TInputFileWizardPage::GetValues.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1148-L1150" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def TInputFileWizardPage__GetValues(this: object, k: int) -&gt; str:
    return F&#39;$InputFile{k}&#39;</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.user32__GetSystemMetrics"><code class="name flex">
<span>def <span class="ident">user32__GetSystemMetrics</span></span>(<span>index)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol user32::GetSystemMetrics.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1165-L1171" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def user32__GetSystemMetrics(index: int) -&gt; int:
    if index == 80:
        return 1
    if index == 43:
        return 2
    return 0</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.IsX86Compatible"><code class="name flex">
<span>def <span class="ident">IsX86Compatible</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol IsX86Compatible.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1173-L1175" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def IsX86Compatible() -&gt; bool:
    return True</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Terminated"><code class="name flex">
<span>def <span class="ident">Terminated</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Terminated.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1177-L1184" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=[
    &#39;sArm64&#39;,
    &#39;IsArm32Compatible&#39;,
    &#39;Debugging&#39;,
    &#39;IsUninstaller&#39;,
])
def Terminated() -&gt; bool:
    return False</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Random"><code class="name flex">
<span>def <span class="ident">Random</span></span>(<span>top)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Random.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1195-L1197" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Random(top: int) -&gt; int:
    return random.randrange(0, top)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.WStrGet"><code class="name flex">
<span>def <span class="ident">WStrGet</span></span>(<span>string, index)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol WStrGet.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1199-L1203" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=&#39;StrGet&#39;)
def WStrGet(string: Variable[str], index: int) -&gt; str:
    if index &lt;= 0:
        raise ValueError
    return string[index - 1:index]</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.WStrSet"><code class="name flex">
<span>def <span class="ident">WStrSet</span></span>(<span>char, index, dst)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol WStrSet.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1205-L1209" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=&#39;StrSet&#39;)
def WStrSet(char: str, index: int, dst: Variable[str]):
    old = dst.get()
    index -= 1
    dst.set(old[:index] + char + old[index:])</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Beep"><code class="name flex">
<span>def <span class="ident">Beep</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Beep.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1215-L1217" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Beep():
    pass</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.DirExists"><code class="name flex">
<span>def <span class="ident">DirExists</span></span>(<span>path)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol DirExists.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1224-L1226" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def DirExists(path: str) -&gt; bool:
    return True</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ForceDirectories"><code class="name flex">
<span>def <span class="ident">ForceDirectories</span></span>(<span>path)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ForceDirectories.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1228-L1230" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def ForceDirectories(path: str) -&gt; bool:
    return True</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.LoadStringFromFile"><code class="name flex">
<span>def <span class="ident">LoadStringFromFile</span></span>(<span>path, out)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol LoadStringFromFile.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1232-L1234" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=&#39;LoadStringFromLockedFile&#39;)
def LoadStringFromFile(path: str, out: Variable[str]) -&gt; bool:
    return True</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.LoadStringsFromFile"><code class="name flex">
<span>def <span class="ident">LoadStringsFromFile</span></span>(<span>path, out)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol LoadStringsFromFile.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1236-L1238" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=&#39;LoadStringsFromLockedFile&#39;)
def LoadStringsFromFile(path: str, out: Variable[str]) -&gt; bool:
    return True</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.DeleteFile"><code class="name flex">
<span>def <span class="ident">DeleteFile</span></span>(<span>path)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol DeleteFile.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1455-L1457" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def DeleteFile(path: str) -&gt; bool:
    return True</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.FileExists"><code class="name flex">
<span>def <span class="ident">FileExists</span></span>(<span>file_name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol FileExists.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1459-L1461" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def FileExists(file_name: str) -&gt; bool:
    return False</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Log"><code class="name flex">
<span>def <span class="ident">Log</span></span>(<span>log)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Log.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1463-L1465" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Log(log: str):
    ...</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Inc"><code class="name flex">
<span>def <span class="ident">Inc</span></span>(<span>p)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Inc.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1467-L1469" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Inc(p: Variable[Variable[int]]):
    p.set(p.get() + 1)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Dec"><code class="name flex">
<span>def <span class="ident">Dec</span></span>(<span>p)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Dec.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1471-L1473" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Dec(p: Variable[Variable[int]]):
    p.set(p.get() - 1)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.FindFirst"><code class="name flex">
<span>def <span class="ident">FindFirst</span></span>(<span>file_name, frec)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol FindFirst.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1475-L1477" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def FindFirst(file_name: str, frec: Variable) -&gt; bool:
    return False</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Trunc"><code class="name flex">
<span>def <span class="ident">Trunc</span></span>(<span>x)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Trunc.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1479-L1481" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Trunc(x: float) -&gt; float:
    return math.trunc(x)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetSpaceOnDisk"><code class="name flex">
<span>def <span class="ident">GetSpaceOnDisk</span></span>(<span>path, in_megabytes, avail, space)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetSpaceOnDisk.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1483-L1497" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def GetSpaceOnDisk(
    path: str,
    in_megabytes: bool,
    avail: Variable[int],
    space: Variable[int],
) -&gt; bool:
    _a = 3_000_000
    _t = 5_000_000
    if not in_megabytes:
        _a *= 1000
        _t *= 1000
    avail.set(_a)
    space.set(_t)
    return True</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetSpaceOnDisk64"><code class="name flex">
<span>def <span class="ident">GetSpaceOnDisk64</span></span>(<span>path, avail, space)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetSpaceOnDisk64.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1499-L1507" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def GetSpaceOnDisk64(
    path: str,
    avail: Variable[int],
    space: Variable[int],
) -&gt; bool:
    avail.set(3_000_000_000)
    space.set(5_000_000_000)
    return True</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Exec"><code class="name flex">
<span>def <span class="ident">Exec</span></span>(<span>exe, cmd, cwd, show, wait, out)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Exec.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1509-L1519" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Exec(
    exe: str,
    cmd: str,
    cwd: str,
    show: int,
    wait: int,
    out: Variable[int],
) -&gt; bool:
    out.set(0)
    return True</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetCmdTail"><code class="name flex">
<span>def <span class="ident">GetCmdTail</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetCmdTail.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1521-L1523" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def GetCmdTail() -&gt; str:
    return &#39;&#39;</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ParamCount"><code class="name flex">
<span>def <span class="ident">ParamCount</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ParamCount.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1525-L1527" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def ParamCount() -&gt; int:
    return 0</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ParamStr"><code class="name flex">
<span>def <span class="ident">ParamStr</span></span>(<span>index)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ParamStr.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1529-L1531" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def ParamStr(index: int) -&gt; str:
    return &#39;&#39;</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ActiveLanguage"><code class="name flex">
<span>def <span class="ident">ActiveLanguage</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ActiveLanguage.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1533-L1535" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def ActiveLanguage() -&gt; str:
    return &#39;en&#39;</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.FmtMessage"><code class="name flex">
<span>def <span class="ident">FmtMessage</span></span>(<span>fmt, args)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol FmtMessage.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1555-L1560" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def FmtMessage(fmt: str, args: list[str]) -&gt; str:
    fmt = fmt.replace(&#39;{&#39;, &#39;{{&#39;)
    fmt = fmt.replace(&#39;}&#39;, &#39;}}&#39;)
    fmt = &#39;%&#39;.join(re.sub(&#39;%(\\d+)&#39;, &#39;{\\1}&#39;, p) for p in fmt.split(&#39;%%&#39;))
    return fmt.format(*args)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Format"><code class="name flex">
<span>def <span class="ident">Format</span></span>(<span>fmt, args)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Format.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1562-L1569" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Format(fmt: str, args: list[str | int | float]) -&gt; str:
    try:
        formatted = fmt % tuple(args)
    except Exception:
        raise IFPSException(&#39;invalid format&#39;)
    else:
        return formatted</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.RaiseException"><code class="name flex">
<span>def <span class="ident">RaiseException</span></span>(<span>msg)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol RaiseException.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1586-L1588" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def RaiseException(msg: str):
    raise IFPSException(msg)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetArrayLength"><code class="name flex">
<span>def <span class="ident">GetArrayLength</span></span>(<span>array)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetArrayLength.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1609-L1612" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def GetArrayLength(array: Variable) -&gt; int:
    array = array.deref()
    return len(array)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.SetArrayLength"><code class="name flex">
<span>def <span class="ident">SetArrayLength</span></span>(<span>array, n)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol SetArrayLength.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1614-L1617" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def SetArrayLength(array: Variable, n: int):
    a = array.deref()
    a.resize(n)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Unassigned"><code class="name flex">
<span>def <span class="ident">Unassigned</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Unassigned.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1623-L1625" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Unassigned() -&gt; None:
    return None</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Null"><code class="name flex">
<span>def <span class="ident">Null</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Null.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1627-L1629" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Null() -&gt; None:
    return None</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Chr"><code class="name flex">
<span>def <span class="ident">Chr</span></span>(<span>b)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Chr.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1709-L1711" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Chr(b: int) -&gt; str:
    return chr(b)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Ord"><code class="name flex">
<span>def <span class="ident">Ord</span></span>(<span>c)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Ord.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1713-L1715" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Ord(c: str) -&gt; int:
    return ord(c)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Copy"><code class="name flex">
<span>def <span class="ident">Copy</span></span>(<span>string, index, count)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Copy.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1717-L1720" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Copy(string: str, index: int, count: int) -&gt; str:
    index -= 1
    return string[index:index + count]</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Length"><code class="name flex">
<span>def <span class="ident">Length</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Length.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1722-L1724" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Length(string: str) -&gt; int:
    return len(string)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Lowercase"><code class="name flex">
<span>def <span class="ident">Lowercase</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Lowercase.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1726-L1728" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=&#39;AnsiLowercase&#39;)
def Lowercase(string: str) -&gt; str:
    return string.lower()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Uppercase"><code class="name flex">
<span>def <span class="ident">Uppercase</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Uppercase.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1730-L1732" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=&#39;AnsiUppercase&#39;)
def Uppercase(string: str) -&gt; str:
    return string.upper()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.StringOfChar"><code class="name flex">
<span>def <span class="ident">StringOfChar</span></span>(<span>c, count)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol StringOfChar.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1734-L1736" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def StringOfChar(c: str, count: int) -&gt; str:
    return c * count</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Delete"><code class="name flex">
<span>def <span class="ident">Delete</span></span>(<span>string, index, count)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Delete.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1738-L1742" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Delete(string: Variable[str], index: int, count: int):
    index -= 1
    old = string.get()
    string.set(old[:index] + old[index + count:])</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Insert"><code class="name flex">
<span>def <span class="ident">Insert</span></span>(<span>string, dest, index)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Insert.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1744-L1748" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Insert(string: str, dest: Variable[str], index: int):
    index -= 1
    old = dest.get()
    dest.set(old[:index] + string + old[index:])</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.StringChangeEx"><code class="name flex">
<span>def <span class="ident">StringChangeEx</span></span>(<span>string, old, new, _)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol StringChangeEx.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1754-L1759" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def StringChangeEx(string: Variable[str], old: str, new: str, _: bool) -&gt; int:
    haystack = string.get()
    count = haystack.count(old)
    string.set(haystack.replace(old, new))
    return count</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Pos"><code class="name flex">
<span>def <span class="ident">Pos</span></span>(<span>string, sub)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Pos.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1761-L1763" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Pos(string: str, sub: str) -&gt; int:
    return string.find(sub) + 1</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.AddQuotes"><code class="name flex">
<span>def <span class="ident">AddQuotes</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol AddQuotes.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1765-L1769" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def AddQuotes(string: str) -&gt; str:
    if string and (string[0] != &#39;&#34;&#39; or string[~0] != &#39;&#34;&#39;) and &#39; &#39; in string:
        string = F&#39;&#34;{string}&#34;&#39;
    return string</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.RemoveQuotes"><code class="name flex">
<span>def <span class="ident">RemoveQuotes</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol RemoveQuotes.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1771-L1775" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def RemoveQuotes(string: str) -&gt; str:
    if string and string[0] == &#39;&#34;&#39; and string[~0] == &#39;&#34;&#39;:
        string = string[1:-1]
    return string</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.CompareStr"><code class="name flex">
<span>def <span class="ident">CompareStr</span></span>(<span>a, b)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol CompareStr.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1781-L1787" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def CompareStr(a: str, b: str) -&gt; int:
    if a &gt; b:
        return +1
    if a &lt; b:
        return -1
    return 0</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.SameText"><code class="name flex">
<span>def <span class="ident">SameText</span></span>(<span>a, b)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol SameText.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1789-L1791" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def SameText(a: str, b: str) -&gt; bool:
    return a.casefold() == b.casefold()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.SameStr"><code class="name flex">
<span>def <span class="ident">SameStr</span></span>(<span>a, b)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol SameStr.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1793-L1795" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def SameStr(a: str, b: str) -&gt; bool:
    return a == b</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.IsWildcard"><code class="name flex">
<span>def <span class="ident">IsWildcard</span></span>(<span>pattern)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol IsWildcard.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1797-L1799" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def IsWildcard(pattern: str) -&gt; bool:
    return &#39;*&#39; in pattern or &#39;?&#39; in pattern</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.WildcardMatch"><code class="name flex">
<span>def <span class="ident">WildcardMatch</span></span>(<span>text, pattern)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol WildcardMatch.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1801-L1803" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def WildcardMatch(text: str, pattern: str) -&gt; bool:
    return fnmatch.fnmatch(text, pattern)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Trim"><code class="name flex">
<span>def <span class="ident">Trim</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Trim.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1805-L1807" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Trim(string: str) -&gt; str:
    return string.strip()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.TrimLeft"><code class="name flex">
<span>def <span class="ident">TrimLeft</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol TrimLeft.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1809-L1811" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def TrimLeft(string: str) -&gt; str:
    return string.lstrip()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.TrimRight"><code class="name flex">
<span>def <span class="ident">TrimRight</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol TrimRight.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1813-L1815" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def TrimRight(string: str) -&gt; str:
    return string.rstrip()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.StringJoin"><code class="name flex">
<span>def <span class="ident">StringJoin</span></span>(<span>sep, values)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol StringJoin.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1817-L1819" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def StringJoin(sep: str, values: list[str]) -&gt; str:
    return sep.join(values)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.StringSplitEx"><code class="name flex">
<span>def <span class="ident">StringSplitEx</span></span>(<span>string, separators, quote, how)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol StringSplitEx.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1821-L1842" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def StringSplitEx(string: str, separators: list[str], quote: str, how: TSplitType) -&gt; list[str]:
    if not quote:
        parts = [string]
    else:
        quote = re.escape(quote)
        parts = re.split(F&#39;({quote}.*?{quote})&#39;, string)
    sep = &#39;|&#39;.join(re.escape(s) for s in separators)
    out = []
    if how == TSplitType.stExcludeEmpty:
        sep = F&#39;(?:{sep})+&#39;
    for k in range(0, len(parts)):
        if k &amp; 1 == 1:
            out.append(parts[k])
            continue
        out.extend(re.split(sep, string))
    if how == TSplitType.stExcludeLastEmpty:
        for k in reversed(range(len(out))):
            if not out[k]:
                out.pop(k)
                break
    return out</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.StrToInt"><code class="name flex">
<span>def <span class="ident">StrToInt</span></span>(<span>s)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol StrToInt.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1848-L1850" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=&#39;StrToInt64&#39;)
def StrToInt(s: str) -&gt; int:
    return int(s)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.StrToIntDef"><code class="name flex">
<span>def <span class="ident">StrToIntDef</span></span>(<span>s, d)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol StrToIntDef.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1852-L1857" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=&#39;StrToInt64Def&#39;)
def StrToIntDef(s: str, d: int) -&gt; int:
    try:
        return int(s)
    except Exception:
        return d</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.StrToFloat"><code class="name flex">
<span>def <span class="ident">StrToFloat</span></span>(<span>s)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol StrToFloat.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1859-L1861" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def StrToFloat(s: str) -&gt; float:
    return float(s)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.IntToStr"><code class="name flex">
<span>def <span class="ident">IntToStr</span></span>(<span>i)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol IntToStr.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1863-L1865" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=&#39;FloatToStr&#39;)
def IntToStr(i: int) -&gt; str:
    return str(i)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.StrToVersion"><code class="name flex">
<span>def <span class="ident">StrToVersion</span></span>(<span>s, v)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol StrToVersion.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1867-L1876" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def StrToVersion(s: str, v: Variable[int]) -&gt; bool:
    try:
        packed = bytes(map(int, s.split(&#39;.&#39;)))
    except Exception:
        return False
    if len(packed) != 4:
        return False
    v.set(int.from_bytes(packed, &#39;little&#39;))
    return True</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.CharLength"><code class="name flex">
<span>def <span class="ident">CharLength</span></span>(<span>string, index)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol CharLength.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1878-L1880" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def CharLength(string: str, index: int) -&gt; int:
    return 1</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.AddBackslash"><code class="name flex">
<span>def <span class="ident">AddBackslash</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol AddBackslash.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1882-L1886" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def AddBackslash(string: str) -&gt; str:
    if string and string[~0] != &#39;\\&#39;:
        string = F&#39;{string}\\&#39;
    return string</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.AddPeriod"><code class="name flex">
<span>def <span class="ident">AddPeriod</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol AddPeriod.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1888-L1892" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def AddPeriod(string: str) -&gt; str:
    if string and string[~0] != &#39;.&#39;:
        string = F&#39;{string}.&#39;
    return string</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.RemoveBackslash"><code class="name flex">
<span>def <span class="ident">RemoveBackslash</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol RemoveBackslash.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1901-L1903" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def RemoveBackslash(string: str) -&gt; str:
    return string.rstrip(&#39;\\/&#39;)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ChangeFileExt"><code class="name flex">
<span>def <span class="ident">ChangeFileExt</span></span>(<span>name, ext)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ChangeFileExt.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1905-L1909" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def ChangeFileExt(name: str, ext: str) -&gt; str:
    if not ext.startswith(&#39;.&#39;):
        ext = F&#39;.{ext}&#39;
    return str(Path(name).with_suffix(ext))</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileExt"><code class="name flex">
<span>def <span class="ident">ExtractFileExt</span></span>(<span>name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ExtractFileExt.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1911-L1913" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def ExtractFileExt(name: str) -&gt; str:
    return Path(name).suffix</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileDir"><code class="name flex">
<span>def <span class="ident">ExtractFileDir</span></span>(<span>name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ExtractFileDir.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1915-L1918" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=&#39;ExtractFilePath&#39;)
def ExtractFileDir(name: str) -&gt; str:
    dirname = str(Path(name).parent)
    return &#39;&#39; if dirname == &#39;.&#39; else dirname</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileName"><code class="name flex">
<span>def <span class="ident">ExtractFileName</span></span>(<span>name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ExtractFileName.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1920-L1924" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def ExtractFileName(name: str) -&gt; str:
    if name:
        name = Path(name).parts[-1]
    return name</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileDrive"><code class="name flex">
<span>def <span class="ident">ExtractFileDrive</span></span>(<span>name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ExtractFileDrive.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1926-L1939" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def ExtractFileDrive(name: str) -&gt; str:
    if name:
        parts = Path(name).parts
        if len(parts) &gt;= 2 and parts[0] == &#39;\\&#39; and parts[1] == &#39;?&#39;:
            parts = parts[2:]
        if parts[0] == &#39;\\&#39;:
            if len(parts) &gt;= 3:
                return &#39;\\&#39;.join(parts[:3])
        else:
            root = parts[0]
            if len(root) == 2 and root[1] == &#39;:&#39;:
                return root
    return &#39;&#39;</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ExtractRelativePath"><code class="name flex">
<span>def <span class="ident">ExtractRelativePath</span></span>(<span>base, dst)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ExtractRelativePath.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1941-L1943" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def ExtractRelativePath(base: str, dst: str) -&gt; str:
    return str(Path(dst).relative_to(base))</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.SetLength"><code class="name flex">
<span>def <span class="ident">SetLength</span></span>(<span>string, size)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol SetLength.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1951-L1955" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def SetLength(string: Variable[str], size: int):
    old = string.get()
    old = old.ljust(size, &#39;\0&#39;)
    string.set(old[:size])</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.CharToOemBuff"><code class="name flex">
<span>def <span class="ident">CharToOemBuff</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol CharToOemBuff.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1957-L1960" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(alias=&#39;OemToCharBuff&#39;)
def CharToOemBuff(string: str) -&gt; str:
    # TODO
    return string</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Utf8Encode"><code class="name flex">
<span>def <span class="ident">Utf8Encode</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Utf8Encode.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1962-L1964" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Utf8Encode(string: str) -&gt; str:
    return string.encode(&#39;utf8&#39;).decode(&#39;latin1&#39;)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Utf8Decode"><code class="name flex">
<span>def <span class="ident">Utf8Decode</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Utf8Decode.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1966-L1968" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def Utf8Decode(string: str) -&gt; str:
    return string.encode(&#39;latin1&#39;).decode(&#39;utf8&#39;)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetMD5OfString"><code class="name flex">
<span>def <span class="ident">GetMD5OfString</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetMD5OfString.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1970-L1972" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def GetMD5OfString(string: str) -&gt; str:
    return hashlib.md5(string.encode(&#39;latin1&#39;)).hexdigest()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetMD5OfUnicodeString"><code class="name flex">
<span>def <span class="ident">GetMD5OfUnicodeString</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetMD5OfUnicodeString.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1974-L1976" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def GetMD5OfUnicodeString(string: str) -&gt; str:
    return hashlib.md5(string.encode(&#39;utf8&#39;)).hexdigest()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetSHA1OfString"><code class="name flex">
<span>def <span class="ident">GetSHA1OfString</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetSHA1OfString.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1978-L1980" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def GetSHA1OfString(string: str) -&gt; str:
    return hashlib.sha1(string.encode(&#39;latin1&#39;)).hexdigest()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetSHA1OfUnicodeString"><code class="name flex">
<span>def <span class="ident">GetSHA1OfUnicodeString</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetSHA1OfUnicodeString.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1982-L1984" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def GetSHA1OfUnicodeString(string: str) -&gt; str:
    return hashlib.sha1(string.encode(&#39;utf8&#39;)).hexdigest()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetSHA256OfString"><code class="name flex">
<span>def <span class="ident">GetSHA256OfString</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetSHA256OfString.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1986-L1988" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def GetSHA256OfString(string: str) -&gt; str:
    return hashlib.sha256(string.encode(&#39;latin1&#39;)).hexdigest()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetSHA256OfUnicodeString"><code class="name flex">
<span>def <span class="ident">GetSHA256OfUnicodeString</span></span>(<span>string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetSHA256OfUnicodeString.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1990-L1992" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def GetSHA256OfUnicodeString(string: str) -&gt; str:
    return hashlib.sha256(string.encode(&#39;utf8&#39;)).hexdigest()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.SysErrorMessage"><code class="name flex">
<span>def <span class="ident">SysErrorMessage</span></span>(<span>code)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol SysErrorMessage.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1994-L1996" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def SysErrorMessage(code: int) -&gt; str:
    return F&#39;[description for error {code:08X}]&#39;</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.MinimizePathName"><code class="name flex">
<span>def <span class="ident">MinimizePathName</span></span>(<span>path, font, max_len)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol MinimizePathName.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1998-L2000" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def MinimizePathName(path: str, font: object, max_len: int) -&gt; str:
    return path</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.CreateOleObject"><code class="name flex">
<span>def <span class="ident">CreateOleObject</span></span>(<span>name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol CreateOleObject.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2036-L2038" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def CreateOleObject(name: str) -&gt; OleObject:
    return OleObject(name)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetActiveOleObject"><code class="name flex">
<span>def <span class="ident">GetActiveOleObject</span></span>(<span>name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetActiveOleObject.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2040-L2042" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def GetActiveOleObject(name: str) -&gt; OleObject:
    return OleObject(name)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.IDispatchInvoke"><code class="name flex">
<span>def <span class="ident">IDispatchInvoke</span></span>(<span>ole, prop_set, name, value)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol IDispatchInvoke.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2044-L2046" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def IDispatchInvoke(ole: OleObject, prop_set: bool, name: str, value: Any) -&gt; int:
    return 0</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.FindWindowByClassName"><code class="name flex">
<span>def <span class="ident">FindWindowByClassName</span></span>(<span>name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol FindWindowByClassName.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2048-L2050" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def FindWindowByClassName(name: str) -&gt; int:
    return 0</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.FindWindowByWindowName"><code class="name flex">
<span>def <span class="ident">FindWindowByWindowName</span></span>(<span>name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol FindWindowByWindowName.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2052-L2054" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external
def FindWindowByWindowName(name: str) -&gt; int:
    return 0</code></pre>
</details>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.constant_map"><code class="name">var <span class="ident">constant_map</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1240-L1358" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@cached_property
def constant_map(self) -&gt; dict[str, str]:
    cfg = self.config
    tmp = cfg.temp_path
    if not tmp:
        tmp = &#39;&#39;.join(random.choices(&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;, k=5))
        tmp = RF&#39;C:\Windows\Temp\IS-{tmp}&#39;
    map = {
        &#39;app&#39;               : cfg.install_to,
        &#39;win&#39;               : R&#39;C:\Windows&#39;,
        &#39;sys&#39;               : R&#39;C:\Windows\System&#39;,
        &#39;sysnative&#39;         : R&#39;C:\Windows\System32&#39;,
        &#39;src&#39;               : str(Path(cfg.executable).parent),
        &#39;sd&#39;                : R&#39;C:&#39;,
        &#39;commonpf&#39;          : R&#39;C:\Program Files&#39;,
        &#39;commoncf&#39;          : R&#39;C:\Program Files\Common Files&#39;,
        &#39;tmp&#39;               : tmp,
        &#39;commonfonts&#39;       : R&#39;C:\Windows\Fonts&#39;,
        &#39;dao&#39;               : R&#39;C:\Program Files\Common Files\Microsoft Shared\DAO&#39;,
        &#39;dotnet11&#39;          : R&#39;C:\Windows\Microsoft.NET\Framework\v1.1.4322&#39;,
        &#39;dotnet20&#39;          : R&#39;C:\Windows\Microsoft.NET\Framework\v3.0&#39;,
        &#39;dotnet2032&#39;        : R&#39;C:\Windows\Microsoft.NET\Framework\v3.0&#39;,
        &#39;dotnet40&#39;          : R&#39;C:\Windows\Microsoft.NET\Framework\v4.0.30319&#39;,
        &#39;dotnet4032&#39;        : R&#39;C:\Windows\Microsoft.NET\Framework\v4.0.30319&#39;,
        &#39;group&#39;             : RF&#39;C:\Users\{cfg.user_name}\Start Menu\Programs\{cfg.inno_name}&#39;,
        &#39;localappdata&#39;      : RF&#39;C:\Users\{cfg.user_name}\AppData\Local&#39;,
        &#39;userappdata&#39;       : RF&#39;C:\Users\{cfg.user_name}\AppData\Roaming&#39;,
        &#39;userdesktop&#39;       : RF&#39;C:\Users\{cfg.user_name}\Desktop&#39;,
        &#39;userdocs&#39;          : RF&#39;C:\Users\{cfg.user_name}\Documents&#39;,
        &#39;userfavourites&#39;    : RF&#39;C:\Users\{cfg.user_name}\Favourites&#39;,
        &#39;usersavedgames&#39;    : RF&#39;C:\Users\{cfg.user_name}\Saved Games&#39;,
        &#39;usersendto&#39;        : RF&#39;C:\Users\{cfg.user_name}\SendTo&#39;,
        &#39;userstartmenu&#39;     : RF&#39;C:\Users\{cfg.user_name}\Start Menu&#39;,
        &#39;userprograms&#39;      : RF&#39;C:\Users\{cfg.user_name}\Start Menu\Programs&#39;,
        &#39;userstartup&#39;       : RF&#39;C:\Users\{cfg.user_name}\Start Menu\Programs\Startup&#39;,
        &#39;usertemplates&#39;     : RF&#39;C:\Users\{cfg.user_name}\Templates&#39;,
        &#39;commonappdata&#39;     : R&#39;C:\ProgramData&#39;,
        &#39;commondesktop&#39;     : R&#39;C:\ProgramData\Microsoft\Windows\Desktop&#39;,
        &#39;commondocs&#39;        : R&#39;C:\ProgramData\Microsoft\Windows\Documents&#39;,
        &#39;commonstartmenu&#39;   : R&#39;C:\ProgramData\Microsoft\Windows\Start Menu&#39;,
        &#39;commonprograms&#39;    : R&#39;C:\ProgramData\Microsoft\Windows\Start Menu\Programs&#39;,
        &#39;commonstartup&#39;     : R&#39;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup&#39;,
        &#39;commontemplates&#39;   : R&#39;C:\ProgramData\Microsoft\Windows\Templates&#39;,
        &#39;cmd&#39;               : R&#39;C:\Windows\System32\cmd.exe&#39;,
        &#39;computername&#39;      : cfg.host_name,
        &#39;groupname&#39;         : cfg.inno_name,
        &#39;hwnd&#39;              : &#39;0&#39;,
        &#39;wizardhwnd&#39;        : &#39;0&#39;,
        &#39;language&#39;          : cfg.language,
        &#39;srcexe&#39;            : cfg.executable,
        &#39;sysuserinfoname&#39;   : &#39;{sysuserinfoname}&#39;,
        &#39;sysuserinfoorg&#39;    : &#39;{sysuserinfoorg}&#39;,
        &#39;userinfoname&#39;      : &#39;{userinfoname}&#39;,
        &#39;userinfoorg&#39;       : &#39;{userinfoorg}&#39;,
        &#39;userinfoserial&#39;    : &#39;{userinfoserial}&#39;,
        &#39;username&#39;          : cfg.user_name,
        &#39;log&#39;               : &#39;&#39;,
    }

    if (inno := self.inno) is None or (inno.setup_info.Header.Flags &amp; Flags.Uninstallable):
        map[&#39;uninstallexe&#39;] = RF&#39;{cfg.install_to}\unins000.exe&#39;

    if cfg.x64:
        map[&#39;syswow64&#39;] = R&#39;C:\Windows\SysWOW64&#39;
        map[&#39;commonpf32&#39;] = R&#39;C:\Program Files (x86)&#39;
        map[&#39;commoncf32&#39;] = R&#39;C:\Program Files (x86)\Common Files&#39;
        map[&#39;commonpf64&#39;] = R&#39;C:\Program Files&#39;
        map[&#39;commoncf64&#39;] = R&#39;C:\Program Files\Common Files&#39;
        map[&#39;dotnet2064&#39;] = R&#39;C:\Windows\Microsoft.NET\Framework64\v3.0&#39;
        map[&#39;dotnet4064&#39;] = R&#39;C:\Windows\Microsoft.NET\Framework64\v4.0.30319&#39;
    else:
        map[&#39;syswow64&#39;] = R&#39;C:\Windows\System32&#39;
        map[&#39;commonpf32&#39;] = R&#39;C:\Program Files&#39;
        map[&#39;commoncf32&#39;] = R&#39;C:\Program Files\Common Files&#39;

    if cfg.windows_os_version[0] &gt;= 10:
        map[&#39;userfonts&#39;] = RF&#39;{map[&#34;localappdata&#34;]}\Microsoft\Windows\Fonts&#39;

    if cfg.windows_os_version[0] &gt;= 7:
        map[&#39;usercf&#39;] = RF&#39;{map[&#34;localappdata&#34;]}\Programs\Common&#39;
        map[&#39;userpf&#39;] = RF&#39;{map[&#34;localappdata&#34;]}\Programs&#39;

    for auto_var, admin_var, user_var in [
        (&#39;autoappdata&#39;,       &#39;commonappdata&#39;,       &#39;userappdata&#39;,   ), # noqa
        (&#39;autocf&#39;,            &#39;commoncf&#39;,            &#39;usercf&#39;,        ), # noqa
        (&#39;autocf32&#39;,          &#39;commoncf32&#39;,          &#39;usercf&#39;,        ), # noqa
        (&#39;autocf64&#39;,          &#39;commoncf64&#39;,          &#39;usercf&#39;,        ), # noqa
        (&#39;autodesktop&#39;,       &#39;commondesktop&#39;,       &#39;userdesktop&#39;,   ), # noqa
        (&#39;autodocs&#39;,          &#39;commondocs&#39;,          &#39;userdocs&#39;,      ), # noqa
        (&#39;autofonts&#39;,         &#39;commonfonts&#39;,         &#39;userfonts&#39;,     ), # noqa
        (&#39;autopf&#39;,            &#39;commonpf&#39;,            &#39;userpf&#39;,        ), # noqa
        (&#39;autopf32&#39;,          &#39;commonpf32&#39;,          &#39;userpf&#39;,        ), # noqa
        (&#39;autopf64&#39;,          &#39;commonpf64&#39;,          &#39;userpf&#39;,        ), # noqa
        (&#39;autoprograms&#39;,      &#39;commonprograms&#39;,      &#39;userprograms&#39;,  ), # noqa
        (&#39;autostartmenu&#39;,     &#39;commonstartmenu&#39;,     &#39;userstartmenu&#39;, ), # noqa
        (&#39;autostartup&#39;,       &#39;commonstartup&#39;,       &#39;userstartup&#39;,   ), # noqa
        (&#39;autotemplates&#39;,     &#39;commontemplates&#39;,     &#39;usertemplates&#39;, ), # noqa
    ]:
        try:
            map[auto_var] = map[admin_var] if cfg.admin else map[user_var]
        except KeyError:
            continue

    for legacy, new in [
        (&#39;cf&#39;,     &#39;commoncf&#39;,    ), # noqa
        (&#39;cf32&#39;,   &#39;commoncf32&#39;,  ), # noqa
        (&#39;cf64&#39;,   &#39;commoncf64&#39;,  ), # noqa
        (&#39;fonts&#39;,  &#39;commonfonts&#39;, ), # noqa
        (&#39;pf&#39;,     &#39;commonpf&#39;,    ), # noqa
        (&#39;pf32&#39;,   &#39;commonpf32&#39;,  ), # noqa
        (&#39;pf64&#39;,   &#39;commonpf64&#39;,  ), # noqa
        (&#39;sendto&#39;, &#39;usersendto&#39;,  ), # noqa
    ]:
        try:
            map[legacy] = map[new]
        except KeyError:
            continue

    return map</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.reset"><code class="name flex">
<span>def <span class="ident">reset</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Reset the emulator timing, FPU word, mutexes, trace, and stack. All global variables are
set to their default values.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L696-L709" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def reset(self):
    &#34;&#34;&#34;
    Reset the emulator timing, FPU word, mutexes, trace, and stack. All global variables are
    set to their default values.
    &#34;&#34;&#34;
    self.seconds_slept = 0.0
    self.clock = 0
    self.fpucw = FPUControl.MaxPrecision | FPUControl.RoundTowardZero
    self.jumpflag = False
    self.mutexes.clear()
    self.stack.clear()
    for v in self.globals:
        v.setdefault()
    return self</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.unimplemented"><code class="name flex">
<span>def <span class="ident">unimplemented</span></span>(<span>self, function)</span>
</code></dt>
<dd>
<section class="desc"><p>The base IFPS emulator raises <code><a title="refinery.lib.inno.emulator.NeedSymbol" href="#refinery.lib.inno.emulator.NeedSymbol">NeedSymbol</a></code> when an external
symbol is unimplemented. Child classes can override this function to handle the missing
symbol differently.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L711-L717" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def unimplemented(self, function: Function):
    &#34;&#34;&#34;
    The base IFPS emulator raises `refinery.lib.inno.emulator.NeedSymbol` when an external
    symbol is unimplemented. Child classes can override this function to handle the missing
    symbol differently.
    &#34;&#34;&#34;
    raise NeedSymbol(function.name)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.emulate_function"><code class="name flex">
<span>def <span class="ident">emulate_function</span></span>(<span>self, function, *args)</span>
</code></dt>
<dd>
<section class="desc"><p>Emulate a function call to the given function, passing the given arguments. The method
returns the return value of the emulated function call if it is not a procedure.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L719-L743" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@EventCall.Wrap
def emulate_function(self, function: Function, *args):
    &#34;&#34;&#34;
    Emulate a function call to the given function, passing the given arguments. The method
    returns the return value of the emulated function call if it is not a procedure.
    &#34;&#34;&#34;
    self.stack.clear()
    decl = function.decl
    if decl is None:
        raise NotImplementedError(F&#39;Do not know how to call {function!s}.&#39;)
    if (n := len(decl.parameters)) != (m := len(args)):
        raise ValueError(
            F&#39;Function {function!s} expects {n} arguments, only {m} were given.&#39;)
    for index, (argument, parameter) in enumerate(zip(args, decl.parameters), 1):
        variable = Variable(parameter.type, VariableSpec(index, VariableType.Local))
        variable.set(argument)
        self.stack.append(variable)
    self.stack.reverse()
    if not decl.void:
        result = Variable(decl.return_type, VariableSpec(0, VariableType.Argument))
        self.stack.append(result)
    yield from self.call(function)
    self.stack.clear()
    if not decl.void:
        return result.get()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.call"><code class="name flex">
<span>def <span class="ident">call</span></span>(<span>self, function)</span>
</code></dt>
<dd>
<section class="desc"><p>Begin emulating at the start of the given function.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L745-L1097" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def call(self, function: Function):
    &#34;&#34;&#34;
    Begin emulating at the start of the given function.
    &#34;&#34;&#34;

    def operator_div(a, b):
        return a // b if isinstance(a, int) and isinstance(b, int) else a / b

    def operator_in(a, b):
        return a in b

    def getvar(op: VariableSpec | Operand) -&gt; Variable:
        if not isinstance(op, Operand):
            v = op
            k = None
        elif op.type is OperandType.Value:
            raise TypeError(&#39;Attempting to retrieve variable for an immediate operand.&#39;)
        else:
            v = op.variable
            k = op.index
            if op.type is OperandType.IndexedByVar:
                k = getvar(k).get()
        t, i = v.type, v.index
        if t is VariableType.Argument:
            if function.decl.void:
                i -= 1
            var = self.stack[sp - i]
        elif t is VariableType.Global:
            var = self.globals[i]
        elif t is VariableType.Local:
            var = self.stack[sp + i]
        else:
            raise TypeError
        if k is not None:
            var = var.at(k)
        return var

    def getval(op: Operand):
        if op.immediate:
            return op.value.value
        return getvar(op).get()

    def setval(op: Operand, new):
        if op.immediate:
            raise RuntimeError(&#39;attempt to assign to an immediate&#39;)
        getvar(op).set(new)

    class CallState(NamedTuple):
        fn: Function
        ip: int
        sp: int
        eh: list[ExceptionHandler]

    callstack: list[CallState] = []
    exec_start = process_time()
    stack = self.stack
    _cfg_max_call_stack = self.config.max_call_stack
    _cfg_max_data_stack = self.config.max_data_stack
    _cfg_max_seconds = self.config.max_seconds
    _cfg_max_opcodes = self.config.max_opcodes
    _cfg_log_opcodes = self.config.log_opcodes

    ip: int = 0
    sp: int = len(stack) - 1
    pending_exception = None
    exceptions = []

    while True:
        if 0 &lt; _cfg_max_call_stack &lt; len(callstack):
            raise EmulatorMaxCalls

        if function.body is None:
            namespace = &#39;&#39;

            if decl := function.decl:
                if decl.is_property:
                    if stack[-1].type.code == TC.Class:
                        function = function.setter
                    else:
                        function = function.getter
                    decl = function.decl
                namespace = (
                    decl.classname or decl.module or &#39;&#39;)

            name = function.name
            registry: dict[str, IFPSEmulatedFunction] = self.external_symbols.get(namespace, {})
            handler = registry.get(name)

            if handler:
                void = handler.void
                argc = handler.argc
            elif decl:
                void = decl.void
                argc = decl.argc
            else:
                void = True
                argc = 0

            try:
                rpos = 0 if void else 1
                args = [stack[~k] for k in range(rpos, argc + rpos)]
            except IndexError:
                raise EmulatorException(
                    F&#39;Cannot call {function!s}; {argc} arguments + {rpos} return values expected,&#39;
                    F&#39; but stack size is only {len(stack)}.&#39;)

            if self.config.log_calls:
                yield NewFunctionCall(str(function), tuple(a.get() for a in args))

            if handler is None:
                self.unimplemented(function)
            else:
                if decl and (decl.void != handler.void or decl.argc != handler.argc):
                    ok = False
                    if 1 + decl.argc - decl.void == 1 + handler.argc - handler.void:
                        if decl.void and not decl.parameters[0].const:
                            ok = True
                        elif handler.void and handler.spec[0]:
                            ok = True
                    if not ok:
                        raise RuntimeError(F&#39;Handler for {function!s} is incompatible with declaration.&#39;)
                for k, (var, byref) in enumerate(zip(args, handler.spec)):
                    if not byref:
                        args[k] = var.get()
                if not handler.static:
                    args.insert(0, self)
                try:
                    return_value = handler.call(*args)
                    if inspect.isgenerator(return_value):
                        return_value = yield from return_value
                except GeneratorExit:
                    pass
                except BaseException as b:
                    pending_exception = IFPSException(F&#39;Error calling {function.name}: {b!s}&#39;, b)
                else:
                    if not handler.void:
                        stack[-1].set(return_value)
            if not callstack:
                if pending_exception is None:
                    return
                raise pending_exception
            function, ip, sp, exceptions = callstack.pop()
            continue

        while insn := function.code.get(ip, None):
            if 0 &lt; _cfg_max_seconds &lt; process_time() - exec_start:
                raise EmulatorTimeout
            if 0 &lt; _cfg_max_opcodes &lt; self.clock:
                raise EmulatorExecutionLimit
            if 0 &lt; _cfg_max_data_stack &lt; len(stack):
                raise EmulatorMaxStack
            if _cfg_log_opcodes:
                yield NewInstruction(function, insn)
            try:
                if pe := pending_exception:
                    pending_exception = None
                    raise pe

                opc = insn.opcode
                ip += insn.size
                self.clock += 1

                if opc == Op.Nop:
                    continue
                elif opc == Op.Assign:
                    dst = getvar(insn.op(0))
                    src = insn.op(1)
                    if src.immediate:
                        dst.set(src.value)
                    else:
                        dst.set(getvar(src))
                elif opc == Op.Calculate:
                    calculate = {
                        AOp.Add: operator.add,
                        AOp.Sub: operator.sub,
                        AOp.Mul: operator.mul,
                        AOp.Div: operator_div,
                        AOp.Mod: operator.mod,
                        AOp.Shl: operator.lshift,
                        AOp.Shr: operator.rshift,
                        AOp.And: operator.and_,
                        AOp.BOr: operator.or_,
                        AOp.Xor: operator.xor,
                    }[insn.operator]
                    src = insn.op(1)
                    dst = insn.op(0)
                    sv = getval(src)
                    dv = getval(dst)
                    fpu = isinstance(sv, float) or isinstance(dv, float)
                    try:
                        result = calculate(dv, sv)
                        if fpu and not isinstance(result, float):
                            raise FloatingPointError
                    except FloatingPointError as FPE:
                        if not self.fpucw &amp; FPUControl.InvalidOperation:
                            result = float(&#39;nan&#39;)
                        else:
                            raise IFPSException(&#39;invalid operation&#39;, FPE) from FPE
                    except OverflowError as OFE:
                        if fpu and self.fpucw &amp; FPUControl.Overflow:
                            result = float(&#39;nan&#39;)
                        else:
                            raise IFPSException(&#39;arithmetic overflow&#39;, OFE) from OFE
                    except ZeroDivisionError as ZDE:
                        if fpu and self.fpucw &amp; FPUControl.ZeroDivide:
                            result = float(&#39;nan&#39;)
                        else:
                            raise IFPSException(&#39;division by zero&#39;, ZDE) from ZDE
                    setval(dst, result)
                elif opc == Op.Push:
                    # TODO: I do not actually know how this works
                    stack.append(getval(insn.op(0)))
                elif opc == Op.PushVar:
                    stack.append(getvar(insn.op(0)))
                elif opc == Op.Pop:
                    self.temp = stack.pop()
                elif opc == Op.Call:
                    callstack.append(CallState(function, ip, sp, exceptions))
                    function = insn.operands[0]
                    ip = 0
                    sp = len(stack) - 1
                    exceptions = []
                    break
                elif opc == Op.Jump:
                    ip = insn.operands[0]
                elif opc == Op.JumpTrue:
                    if getval(insn.op(1)):
                        ip = insn.operands[0]
                elif opc == Op.JumpFalse:
                    if not getval(insn.op(1)):
                        ip = insn.operands[0]
                elif opc == Op.Ret:
                    del stack[sp + 1:]
                    if not callstack:
                        return
                    function, ip, sp, exceptions = callstack.pop()
                    break
                elif opc == Op.StackType:
                    raise OpCodeNotImplemented(str(opc))
                elif opc == Op.PushType:
                    stack.append(Variable(
                        insn.operands[0],
                        VariableSpec(len(stack) - sp, VariableType.Local)
                    ))
                elif opc == Op.Compare:
                    compare = {
                        COp.GE: operator.ge,
                        COp.LE: operator.le,
                        COp.GT: operator.gt,
                        COp.LT: operator.lt,
                        COp.NE: operator.ne,
                        COp.EQ: operator.eq,
                        COp.IN: operator_in,
                        COp.IS: operator.is_,
                    }[insn.operator]
                    d = getvar(insn.op(0))
                    a = getval(insn.op(1))
                    b = getval(insn.op(2))
                    d.set(compare(a, b))
                elif opc == Op.CallVar:
                    call = getval(insn.op(0))
                    if isinstance(call, int):
                        call = self.ifps.functions[call]
                    if isinstance(call, Function):
                        callstack.append(CallState(function, ip, sp, exceptions))
                        function = call
                        ip = 0
                        sp = len(stack) - 1
                        exceptions = []
                        break
                elif opc in (Op.SetPtr, Op.SetPtrToCopy):
                    copy = False
                    if opc == Op.SetPtrToCopy:
                        copy = True
                    dst = getvar(insn.op(0))
                    src = getvar(insn.op(1))
                    dst.setptr(src, copy=copy)
                elif opc == Op.BooleanNot:
                    setval(a := insn.op(0), not getval(a))
                elif opc == Op.IntegerNot:
                    setval(a := insn.op(0), ~getval(a))
                elif opc == Op.Neg:
                    setval(a := insn.op(0), -getval(a))
                elif opc == Op.SetFlag:
                    condition, negated = insn.operands
                    self.jumpflag = getval(condition) ^ negated
                elif opc == Op.JumpFlag:
                    if self.jumpflag:
                        ip = insn.operands[0]
                elif opc == Op.PushEH:
                    exceptions.append(ExceptionHandler(*insn.operands))
                elif opc == Op.PopEH:
                    tp = None
                    et = EHType(insn.operands[0])
                    eh = exceptions[-1]
                    if eh.current != et:
                        raise RuntimeError(F&#39;Expected {eh.current} block to end, but {et} was ended instead.&#39;)
                    while tp is None:
                        if et is None:
                            raise RuntimeError
                        tp, et = {
                            EHType.Catch         : (eh.finally_one, EHType.Finally),
                            EHType.Try           : (eh.finally_one, EHType.Finally),
                            EHType.Finally       : (eh.finally_two, EHType.SecondFinally),
                            EHType.SecondFinally : (eh.handler_end, None),
                        }[et]
                    eh.current = et
                    ip = tp
                    if et is None:
                        exceptions.pop()
                elif opc == Op.Inc:
                    setval(a := insn.op(0), getval(a) + 1)
                elif opc == Op.Dec:
                    setval(a := insn.op(0), getval(a) - 1)
                elif opc == Op.JumpPop1:
                    stack.pop()
                    ip = insn.operands[0]
                elif opc == Op.JumpPop2:
                    stack.pop()
                    stack.pop()
                    ip = insn.operands[0]
                else:
                    raise RuntimeError(F&#39;Function contains invalid opcode at 0x{ip:X}.&#39;)
            except IFPSException as EE:
                try:
                    eh = exceptions[-1]
                except IndexError:
                    raise EE
                et = EHType.Try
                tp = None
                while tp is None:
                    if et is None:
                        raise RuntimeError
                    tp, et = {
                        EHType.Try           : (eh.catch_error, EHType.Catch),
                        EHType.Catch         : (eh.finally_one, EHType.Finally),
                        EHType.Finally       : (eh.finally_two, EHType.SecondFinally),
                        EHType.SecondFinally : (eh.handler_end, None),
                    }[et]
                if et is None:
                    raise EE
                eh.current = et
                ip = tp
            except AbortEmulation:
                raise
            except EmulatorException:
                raise
            except Exception as RE:
                raise EmulatorException(
                    F&#39;In {function.symbol} at 0x{insn.offset:X} (cycle {self.clock}), &#39;
                    F&#39;emulation of {insn!r} failed: {RE!s}&#39;)
        if ip is None:
            raise RuntimeError(F&#39;Instruction pointer moved out of bounds to 0x{ip:X}.&#39;)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.TPasswordEdit__SetText"><code class="name flex">
<span>def <span class="ident">TPasswordEdit__SetText</span></span>(<span>self, this, value)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol TPasswordEdit::SetText.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1152-L1156" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def TPasswordEdit__SetText(self, this: object, value: str):
    if value:
        yield NewPassword(value)
    return value</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.kernel32__GetTickCount"><code class="name flex">
<span>def <span class="ident">kernel32__GetTickCount</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol kernel32::GetTickCount.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1158-L1163" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def kernel32__GetTickCount(self) -&gt; int:
    tick = self.clock
    tick *= self.config.milliseconds_per_instruction
    tick += self.seconds_slept * 1000
    return int(tick)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.IsAdmin"><code class="name flex">
<span>def <span class="ident">IsAdmin</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol IsAdmin.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1186-L1188" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def IsAdmin(self) -&gt; bool:
    return self.config.admin</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.kernel32__Sleep"><code class="name flex">
<span>def <span class="ident">kernel32__Sleep</span></span>(<span>self, ms)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol kernel32::Sleep.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1190-L1193" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False, alias=&#39;Sleep&#39;)
def kernel32__Sleep(self, ms: int):
    seconds = ms / 1000.0
    self.seconds_slept += seconds</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetEnv"><code class="name flex">
<span>def <span class="ident">GetEnv</span></span>(<span>self, name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetEnv.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1211-L1213" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def GetEnv(self, name: str) -&gt; str:
    return self.config.environment.get(name, F&#39;%{name}%&#39;)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Abort"><code class="name flex">
<span>def <span class="ident">Abort</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Abort.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1219-L1222" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def Abort(self):
    if self.config.throw_abort:
        raise AbortEmulation</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ExpandConstant"><code class="name flex">
<span>def <span class="ident">ExpandConstant</span></span>(<span>self, string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ExpandConstant.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1360-L1362" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def ExpandConstant(self, string: str) -&gt; str:
    return self.expand_constant(string)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ExpandConstantEx"><code class="name flex">
<span>def <span class="ident">ExpandConstantEx</span></span>(<span>self, string, custom_var, custom_val)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ExpandConstantEx.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1364-L1366" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def ExpandConstantEx(self, string: str, custom_var: str, custom_val: str) -&gt; str:
    return self.expand_constant(string, custom_var, custom_val)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.expand_constant"><code class="name flex">
<span>def <span class="ident">expand_constant</span></span>(<span>self, string, custom_var=None, custom_val=None, unescape=False)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1368-L1453" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def expand_constant(
    self,
    string: str,
    custom_var: str | None = None,
    custom_val: str | None = None,
    unescape: bool = False
):
    config = self.config
    expand = partial(self.expand_constant, unescape=True)
    string = re.sub(r&#39;(\{\{.*?\}(?!\}))&#39;, &#39;\\1}&#39;, string)

    with io.StringIO() as result:
        constants = self.constant_map
        formatter = Formatter()
        backslash = False
        try:
            parsed = list(formatter.parse(string))
        except ValueError as VE:
            raise IFPSException(F&#39;invalid format string: {string!r}&#39;, VE) from VE
        for prefix, spec, modifier, conversion in parsed:
            if backslash and prefix[:1] == &#39;\\&#39;:
                prefix = prefix[1:]
            if unescape:
                prefix = unquote(prefix)
            result.write(prefix)
            if spec is None:
                continue
            elif spec == &#39;\\&#39;:
                if modifier or conversion:
                    raise IFPSException(&#39;Invalid format string.&#39;, ValueError(string))
                value = spec
            elif spec == custom_var:
                value = custom_val
            elif spec.startswith(&#39;%&#39;):
                name, p, default = spec[1:].partition(&#39;|&#39;)
                name = expand(name)
                default = expand(default)
                try:
                    value = config.environment[name]
                except KeyError:
                    value = default if p else F&#39;%{name}%&#39;
            elif spec == &#39;drive&#39;:
                value = self.ExtractFileDrive(expand(modifier))
            elif spec == &#39;ini&#39;:
                # {ini:Filename,Section,Key|DefaultValue}
                _, _, default = modifier.partition(&#39;|&#39;)
                value = expand(default)
            elif spec == &#39;code&#39;:
                # {code:FunctionName|Param}
                symbol, _, param = modifier.partition(&#39;|&#39;)
                param = expand(param)
                try:
                    function = self.symbols[symbol]
                except KeyError as KE:
                    raise IFPSException(F&#39;String formatter references missing function {symbol}.&#39;, KE) from KE
                emulation = self.emulate_function(function, param)
                value = str(emulation.value)
            elif spec == &#39;cm&#39;:
                # {cm:LaunchProgram,Inno Setup}
                # The example above translates to &#34;Launch Inno Setup&#34; if English is the active language.
                name, _, placeholders = modifier.partition(&#39;,&#39;)
                value = self.CustomMessage(expand(name))
                if placeholders:
                    def _placeholder(match: re.Match[str]):
                        try:
                            return placeholders[int(match[1]) - 1]
                        except Exception:
                            return match[0]
                    placeholders = [ph.strip() for ph in placeholders.split(&#39;,&#39;)]
                    value = re.sub(&#39;(?&lt;!%)%([1-9]\\d*)&#39;, _placeholder, value)
            elif spec == &#39;reg&#39;:
                # {reg:HKXX\SubkeyName,ValueName|DefaultValue}
                _, _, default = modifier.partition(&#39;|&#39;)
                value = expand(default)
            elif spec == &#39;param&#39;:
                # {param:ParamName|DefaultValue}
                _, _, default = modifier.partition(&#39;|&#39;)
                value = expand(default)
            else:
                try:
                    value = constants[spec]
                except KeyError as KE:
                    raise IFPSException(F&#39;invalid format field {spec}&#39;, KE) from KE
            backslash = value.endswith(&#39;\\&#39;)
            result.write(value)
        return result.getvalue()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.CustomMessage"><code class="name flex">
<span>def <span class="ident">CustomMessage</span></span>(<span>self, msg_name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol CustomMessage.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1537-L1553" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def CustomMessage(self, msg_name: str) -&gt; str:
    by_language = {}
    for msg in self.inno.setup_info.Messages:
        if msg.EncodedName == msg_name:
            lng = msg.get_language_value().Name
            if lng == self.config.language:
                return msg.Value
            by_language[lng] = msg.Value
    try:
        return by_language[0]
    except KeyError:
        pass
    try:
        return next(iter(by_language.values()))
    except StopIteration:
        raise IFPSException(F&#39;Custom message with name {msg_name} not found.&#39;)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.SetupMessage"><code class="name flex">
<span>def <span class="ident">SetupMessage</span></span>(<span>self, id)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol SetupMessage.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1571-L1576" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def SetupMessage(self, id: int) -&gt; str:
    try:
        return self.inno.setup_info.Messages[id].Value
    except (AttributeError, IndexError):
        return &#39;&#39;</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.IsWin64"><code class="name flex">
<span>def <span class="ident">IsWin64</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol IsWin64.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1578-L1580" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False, alias=[&#39;Is64BitInstallMode&#39;, &#39;IsX64Compatible&#39;, &#39;IsX64OS&#39;])
def IsWin64(self) -&gt; bool:
    return self.config.x64</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.IsX86OS"><code class="name flex">
<span>def <span class="ident">IsX86OS</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol IsX86OS.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1582-L1584" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def IsX86OS(self) -&gt; bool:
    return not self.config.x64</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ProcessorArchitecture"><code class="name flex">
<span>def <span class="ident">ProcessorArchitecture</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ProcessorArchitecture.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1590-L1595" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def ProcessorArchitecture(self) -&gt; int:
    if self.config.x64:
        return TSetupProcessorArchitecture.paX64.value
    else:
        return TSetupProcessorArchitecture.paX86.value</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetUserNameString"><code class="name flex">
<span>def <span class="ident">GetUserNameString</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetUserNameString.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1597-L1599" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def GetUserNameString(self) -&gt; str:
    return self.config.user_name</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetComputerNameString"><code class="name flex">
<span>def <span class="ident">GetComputerNameString</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetComputerNameString.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1601-L1603" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def GetComputerNameString(self) -&gt; str:
    return self.config.host_name</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetUILanguage"><code class="name flex">
<span>def <span class="ident">GetUILanguage</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetUILanguage.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1605-L1607" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def GetUILanguage(self) -&gt; str:
    return self.config.lcid</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.WizardForm"><code class="name flex">
<span>def <span class="ident">WizardForm</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol WizardForm.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1619-L1621" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def WizardForm(self) -&gt; object:
    return self</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Set8087CW"><code class="name flex">
<span>def <span class="ident">Set8087CW</span></span>(<span>self, cw)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Set8087CW.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1631-L1633" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def Set8087CW(self, cw: int):
    self.fpucw = FPUControl(cw)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.Get8087CW"><code class="name flex">
<span>def <span class="ident">Get8087CW</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol Get8087CW.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1635-L1637" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def Get8087CW(self) -&gt; int:
    return self.fpucw.value</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetDateTimeString"><code class="name flex">
<span>def <span class="ident">GetDateTimeString</span></span>(<span>self, fmt, date_separator, time_separator)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetDateTimeString.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1639-L1707" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def GetDateTimeString(
    self,
    fmt: str,
    date_separator: str,
    time_separator: str,
) -&gt; str:

    now = self.config.start_time
    now = now + timedelta(
        milliseconds=(self.config.milliseconds_per_instruction * self.clock))
    now = now + timedelta(seconds=self.seconds_slept)

    date_separator = date_separator.lstrip(&#39;\0&#39;)
    time_separator = time_separator.lstrip(&#39;\0&#39;)

    def dt(m: re.Match[str]):
        spec = m[1]
        ampm = m[2]
        if ampm:
            am, _, pm = ampm.partition(&#39;/&#39;)
            spec = spec.upper()
            suffix = now.strftime(&#39;%p&#39;).lower()
            suffix = {&#39;am&#39;: am, &#39;pm&#39;: pm}[suffix]
        else:
            suffix = &#39;&#39;
        if spec == &#39;dddddd&#39; or spec == &#39;ddddd&#39;:
            return now.date().isoformat()
        if spec == &#39;t&#39;:
            return now.time().isoformat(&#39;minutes&#39;)
        if spec == &#39;tt&#39;:
            return now.time().isoformat(&#39;seconds&#39;)
        if spec == &#39;d&#39;:
            return str(now.day)
        if spec == &#39;m&#39;:
            return str(now.month)
        if spec == &#39;h&#39;:
            return str(now.hour)
        if spec == &#39;n&#39;:
            return str(now.minute)
        if spec == &#39;s&#39;:
            return str(now.second)
        if spec == &#39;H&#39;:
            return now.strftime(&#39;%I&#39;).lstrip(&#39;0&#39;) + suffix
        if spec == &#39;/&#39;:
            return date_separator or spec
        if spec == &#39;:&#39;:
            return time_separator or spec
        return now.strftime({
            &#39;dddd&#39;  : &#39;%A&#39;,
            &#39;ddd&#39;   : &#39;%a&#39;,
            &#39;dd&#39;    : &#39;%d&#39;,
            &#39;mmmm&#39;  : &#39;%B&#39;,
            &#39;mmm&#39;   : &#39;%b&#39;,
            &#39;mm&#39;    : &#39;%m&#39;,
            &#39;yyyy&#39;  : &#39;%Y&#39;,
            &#39;yy&#39;    : &#39;%y&#39;,
            &#39;hh&#39;    : &#39;%H&#39;,
            &#39;HH&#39;    : &#39;%I&#39; + suffix,
            &#39;nn&#39;    : &#39;%M&#39;,
            &#39;ss&#39;    : &#39;%S&#39;,
        }.get(spec, m[0]))

    split = re.split(F&#39;({formats.string!s})&#39;, fmt)
    for k in range(0, len(split), 2):
        split[k] = re.sub(&#39;([dmyhnst]+)((?:[aA][mM]?/[pP][mM]?)?)&#39;, dt, split[k])
    for k in range(1, len(split), 2):
        split[k] = split[k][1:-1]
    return &#39;&#39;.join(split)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.StringChange"><code class="name flex">
<span>def <span class="ident">StringChange</span></span>(<span>self, string, old, new)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol StringChange.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1750-L1752" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def StringChange(self, string: Variable[str], old: str, new: str) -&gt; int:
    return self.StringChangeEx(string, old, new, False)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.CompareText"><code class="name flex">
<span>def <span class="ident">CompareText</span></span>(<span>self, a, b)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol CompareText.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1777-L1779" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def CompareText(self, a: str, b: str) -&gt; int:
    return self.CompareStr(a.casefold(), b.casefold())</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.StringSplit"><code class="name flex">
<span>def <span class="ident">StringSplit</span></span>(<span>self, string, separators, how)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol StringSplit.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1844-L1846" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def StringSplit(self, string: str, separators: list[str], how: TSplitType) -&gt; list[str]:
    return self.StringSplitEx(string, separators, None, how)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.RemoveBackslashUnlessRoot"><code class="name flex">
<span>def <span class="ident">RemoveBackslashUnlessRoot</span></span>(<span>self, string)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol RemoveBackslashUnlessRoot.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1894-L1899" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def RemoveBackslashUnlessRoot(self, string: str) -&gt; str:
    path = Path(string)
    if len(path.parts) == 1:
        return str(path)
    return self.RemoveBackslash(string)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.ExpandFileName"><code class="name flex">
<span>def <span class="ident">ExpandFileName</span></span>(<span>self, name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol ExpandFileName.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L1945-L1949" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False, alias=&#39;ExpandUNCFileName&#39;)
def ExpandFileName(self, name: str) -&gt; str:
    if self.ExtractFileDrive(name):
        return name
    return str(self.config.cwd / name)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.CheckForMutexes"><code class="name flex">
<span>def <span class="ident">CheckForMutexes</span></span>(<span>self, mutexes)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol CheckForMutexes.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2002-L2004" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def CheckForMutexes(self, mutexes: str) -&gt; bool:
    return any(m in self.mutexes for m in mutexes.split(&#39;,&#39;))</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.CreateMutex"><code class="name flex">
<span>def <span class="ident">CreateMutex</span></span>(<span>self, name)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol CreateMutex.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2006-L2010" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def CreateMutex(self, name: str):
    if self.config.log_mutexes:
        yield NewMutex(name)
    self.mutexes.add(name)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetWinDir"><code class="name flex">
<span>def <span class="ident">GetWinDir</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetWinDir.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2012-L2014" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def GetWinDir(self) -&gt; str:
    return self.expand_constant(&#39;{win}&#39;)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetSystemDir"><code class="name flex">
<span>def <span class="ident">GetSystemDir</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetSystemDir.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2016-L2018" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def GetSystemDir(self) -&gt; str:
    return self.expand_constant(&#39;{sys}&#39;)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersion"><code class="name flex">
<span>def <span class="ident">GetWindowsVersion</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetWindowsVersion.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2020-L2024" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def GetWindowsVersion(self) -&gt; int:
    version = int.from_bytes(
        struct.pack(&#39;&gt;BBH&#39;, *self.config.windows_os_version), &#39;big&#39;)
    return version</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersionEx"><code class="name flex">
<span>def <span class="ident">GetWindowsVersionEx</span></span>(<span>self, tv)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetWindowsVersionEx.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2026-L2030" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def GetWindowsVersionEx(self, tv: Variable[int | bool]):
    tv[0], tv[1], tv[2] = self.config.windows_os_version # noqa
    tv[3], tv[4]        = self.config.windows_sp_version # noqa
    tv[5], tv[6], tv[7] = True, 0, 0</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersionString"><code class="name flex">
<span>def <span class="ident">GetWindowsVersionString</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol GetWindowsVersionString.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2032-L2034" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def GetWindowsVersionString(self) -&gt; str:
    return &#39;{}.{:02d}.{:04d}&#39;.format(*self.config.windows_os_version)</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.WizardSilent"><code class="name flex">
<span>def <span class="ident">WizardSilent</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol WizardSilent.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2056-L2058" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def WizardSilent(self) -&gt; bool:
    return self.config.wizard_silent</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.IFPSEmulator.SizeOf"><code class="name flex">
<span>def <span class="ident">SizeOf</span></span>(<span>self, var)</span>
</code></dt>
<dd>
<section class="desc"><p>An emulated handler for the external symbol SizeOf.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2060-L2066" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@external(static=False)
def SizeOf(self, var: Variable) -&gt; int:
    if var.pointer:
        return (self.config.x64 + 1) * 4
    if var.container:
        return sum(self.SizeOf(x) for x in var.data)
    return var.type.code.width</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="refinery.lib.inno.emulator.InnoSetupEmulator"><code class="flex name class">
<span>class <span class="ident">InnoSetupEmulator</span></span>
<span>(</span><span>archive, options=None, **more)</span>
</code></dt>
<dd>
<section class="desc"><p>A specialized <code>refinery.lib.emulator.IFPSEmulator</code> that can emulate the InnoSetup installation
with a focus on continuing execution as much as possible.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2071-L2159" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class InnoSetupEmulator(IFPSEmulator):
    &#34;&#34;&#34;
    A specialized `refinery.lib.emulator.IFPSEmulator` that can emulate the InnoSetup installation
    with a focus on continuing execution as much as possible.
    &#34;&#34;&#34;

    def emulate_installation(self, password=&#39;&#39;):
        &#34;&#34;&#34;
        To the best of the author&#39;s knowledge, this function emulates the sequence of calls into
        the script that the IFPS runtime would make during a setup install.
        &#34;&#34;&#34;

        class SetupDispatcher:

            InitializeSetup: Callable
            InitializeWizard: Callable
            CurStepChanged: Callable
            ShouldSkipPage: Callable
            CurPageChanged: Callable
            PrepareToInstall: Callable
            CheckPassword: Callable
            NextButtonClick: Callable
            DeinitializeSetup: Callable

            def __getattr__(_, name):
                if pfn := self.symbols.get(name):
                    def emulated(*a):
                        return (yield from self.emulate_function(pfn, *a))
                else:
                    def emulated(*a):
                        yield from ()
                        return False
                return emulated

        Setup = SetupDispatcher()

        yield from Setup.InitializeSetup()
        yield from Setup.InitializeWizard()
        yield from Setup.CurStepChanged(TSetupStep.ssPreInstall)

        for page in PageID:

            skip = yield from Setup.ShouldSkipPage(page)

            if not skip:
                yield from Setup.CurPageChanged(page)
                if page == PageID.wpPreparing:
                    yield from Setup.PrepareToInstall(False)
                if page == PageID.wpPassword:
                    yield from Setup.CheckPassword(password)

            yield from Setup.NextButtonClick(page)

            if page == PageID.wpPreparing:
                yield from Setup.CurStepChanged(TSetupStep.ssInstall)
            if page == PageID.wpInfoAfter:
                yield from Setup.CurStepChanged(TSetupStep.ssPostInstall)

        yield from Setup.CurStepChanged(TSetupStep.ssDone)
        yield from Setup.DeinitializeSetup()

    def unimplemented(self, function: Function):
        &#34;&#34;&#34;
        Any unimplemented function is essentially skipped. Any arguments passed by reference and
        all return values that are of type integer are set to `1` in an attempt to indicate success
        wherever possible.
        &#34;&#34;&#34;
        decl = function.decl
        if decl is None:
            return
        if not decl.void:
            rc = 1
            rv = self.stack[-1]
            if not rv.container:
                rt = rv.type.py_type()
                if isinstance(rt, type) and issubclass(rt, int):
                    rv.set(1)
        else:
            rc = 0
        for k in range(rc, rc + len(decl.parameters)):
            ptr: Variable[Variable] = self.stack[-k]
            if not ptr.pointer:
                continue
            var = ptr.deref()
            if var.container:
                continue
            vt = var.type.py_type()
            if isinstance(vt, type) and issubclass(vt, int):
                var.set(1)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.lib.inno.emulator.IFPSEmulator" href="#refinery.lib.inno.emulator.IFPSEmulator">IFPSEmulator</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="refinery.lib.inno.emulator.InnoSetupEmulator.emulate_installation"><code class="name flex">
<span>def <span class="ident">emulate_installation</span></span>(<span>self, password='')</span>
</code></dt>
<dd>
<section class="desc"><p>To the best of the author's knowledge, this function emulates the sequence of calls into
the script that the IFPS runtime would make during a setup install.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2077-L2130" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def emulate_installation(self, password=&#39;&#39;):
    &#34;&#34;&#34;
    To the best of the author&#39;s knowledge, this function emulates the sequence of calls into
    the script that the IFPS runtime would make during a setup install.
    &#34;&#34;&#34;

    class SetupDispatcher:

        InitializeSetup: Callable
        InitializeWizard: Callable
        CurStepChanged: Callable
        ShouldSkipPage: Callable
        CurPageChanged: Callable
        PrepareToInstall: Callable
        CheckPassword: Callable
        NextButtonClick: Callable
        DeinitializeSetup: Callable

        def __getattr__(_, name):
            if pfn := self.symbols.get(name):
                def emulated(*a):
                    return (yield from self.emulate_function(pfn, *a))
            else:
                def emulated(*a):
                    yield from ()
                    return False
            return emulated

    Setup = SetupDispatcher()

    yield from Setup.InitializeSetup()
    yield from Setup.InitializeWizard()
    yield from Setup.CurStepChanged(TSetupStep.ssPreInstall)

    for page in PageID:

        skip = yield from Setup.ShouldSkipPage(page)

        if not skip:
            yield from Setup.CurPageChanged(page)
            if page == PageID.wpPreparing:
                yield from Setup.PrepareToInstall(False)
            if page == PageID.wpPassword:
                yield from Setup.CheckPassword(password)

        yield from Setup.NextButtonClick(page)

        if page == PageID.wpPreparing:
            yield from Setup.CurStepChanged(TSetupStep.ssInstall)
        if page == PageID.wpInfoAfter:
            yield from Setup.CurStepChanged(TSetupStep.ssPostInstall)

    yield from Setup.CurStepChanged(TSetupStep.ssDone)
    yield from Setup.DeinitializeSetup()</code></pre>
</details>
</dd>
<dt id="refinery.lib.inno.emulator.InnoSetupEmulator.unimplemented"><code class="name flex">
<span>def <span class="ident">unimplemented</span></span>(<span>self, function)</span>
</code></dt>
<dd>
<section class="desc"><p>Any unimplemented function is essentially skipped. Any arguments passed by reference and
all return values that are of type integer are set to <code>1</code> in an attempt to indicate success
wherever possible.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/lib/inno/emulator.py#L2132-L2159" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def unimplemented(self, function: Function):
    &#34;&#34;&#34;
    Any unimplemented function is essentially skipped. Any arguments passed by reference and
    all return values that are of type integer are set to `1` in an attempt to indicate success
    wherever possible.
    &#34;&#34;&#34;
    decl = function.decl
    if decl is None:
        return
    if not decl.void:
        rc = 1
        rv = self.stack[-1]
        if not rv.container:
            rt = rv.type.py_type()
            if isinstance(rt, type) and issubclass(rt, int):
                rv.set(1)
    else:
        rc = 0
    for k in range(rc, rc + len(decl.parameters)):
        ptr: Variable[Variable] = self.stack[-k]
        if not ptr.pointer:
            continue
        var = ptr.deref()
        if var.container:
            continue
        vt = var.type.py_type()
        if isinstance(vt, type) and issubclass(vt, int):
            var.set(1)</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="refinery.lib.inno.emulator.IFPSEmulator" href="#refinery.lib.inno.emulator.IFPSEmulator">IFPSEmulator</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Abort" href="#refinery.lib.inno.emulator.IFPSEmulator.Abort">Abort</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ActiveLanguage" href="#refinery.lib.inno.emulator.IFPSEmulator.ActiveLanguage">ActiveLanguage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.AddBackslash" href="#refinery.lib.inno.emulator.IFPSEmulator.AddBackslash">AddBackslash</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.AddPeriod" href="#refinery.lib.inno.emulator.IFPSEmulator.AddPeriod">AddPeriod</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.AddQuotes" href="#refinery.lib.inno.emulator.IFPSEmulator.AddQuotes">AddQuotes</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Beep" href="#refinery.lib.inno.emulator.IFPSEmulator.Beep">Beep</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ChangeFileExt" href="#refinery.lib.inno.emulator.IFPSEmulator.ChangeFileExt">ChangeFileExt</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CharLength" href="#refinery.lib.inno.emulator.IFPSEmulator.CharLength">CharLength</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CharToOemBuff" href="#refinery.lib.inno.emulator.IFPSEmulator.CharToOemBuff">CharToOemBuff</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CheckForMutexes" href="#refinery.lib.inno.emulator.IFPSEmulator.CheckForMutexes">CheckForMutexes</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Chr" href="#refinery.lib.inno.emulator.IFPSEmulator.Chr">Chr</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CompareStr" href="#refinery.lib.inno.emulator.IFPSEmulator.CompareStr">CompareStr</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CompareText" href="#refinery.lib.inno.emulator.IFPSEmulator.CompareText">CompareText</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Copy" href="#refinery.lib.inno.emulator.IFPSEmulator.Copy">Copy</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CreateMutex" href="#refinery.lib.inno.emulator.IFPSEmulator.CreateMutex">CreateMutex</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CreateOleObject" href="#refinery.lib.inno.emulator.IFPSEmulator.CreateOleObject">CreateOleObject</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CustomMessage" href="#refinery.lib.inno.emulator.IFPSEmulator.CustomMessage">CustomMessage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Dec" href="#refinery.lib.inno.emulator.IFPSEmulator.Dec">Dec</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Delete" href="#refinery.lib.inno.emulator.IFPSEmulator.Delete">Delete</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.DeleteFile" href="#refinery.lib.inno.emulator.IFPSEmulator.DeleteFile">DeleteFile</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.DirExists" href="#refinery.lib.inno.emulator.IFPSEmulator.DirExists">DirExists</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Exec" href="#refinery.lib.inno.emulator.IFPSEmulator.Exec">Exec</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExpandConstant" href="#refinery.lib.inno.emulator.IFPSEmulator.ExpandConstant">ExpandConstant</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExpandConstantEx" href="#refinery.lib.inno.emulator.IFPSEmulator.ExpandConstantEx">ExpandConstantEx</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExpandFileName" href="#refinery.lib.inno.emulator.IFPSEmulator.ExpandFileName">ExpandFileName</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileDir" href="#refinery.lib.inno.emulator.IFPSEmulator.ExtractFileDir">ExtractFileDir</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileDrive" href="#refinery.lib.inno.emulator.IFPSEmulator.ExtractFileDrive">ExtractFileDrive</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileExt" href="#refinery.lib.inno.emulator.IFPSEmulator.ExtractFileExt">ExtractFileExt</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileName" href="#refinery.lib.inno.emulator.IFPSEmulator.ExtractFileName">ExtractFileName</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExtractRelativePath" href="#refinery.lib.inno.emulator.IFPSEmulator.ExtractRelativePath">ExtractRelativePath</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.FileExists" href="#refinery.lib.inno.emulator.IFPSEmulator.FileExists">FileExists</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.FindFirst" href="#refinery.lib.inno.emulator.IFPSEmulator.FindFirst">FindFirst</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.FindWindowByClassName" href="#refinery.lib.inno.emulator.IFPSEmulator.FindWindowByClassName">FindWindowByClassName</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.FindWindowByWindowName" href="#refinery.lib.inno.emulator.IFPSEmulator.FindWindowByWindowName">FindWindowByWindowName</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.FmtMessage" href="#refinery.lib.inno.emulator.IFPSEmulator.FmtMessage">FmtMessage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ForceDirectories" href="#refinery.lib.inno.emulator.IFPSEmulator.ForceDirectories">ForceDirectories</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Format" href="#refinery.lib.inno.emulator.IFPSEmulator.Format">Format</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Get8087CW" href="#refinery.lib.inno.emulator.IFPSEmulator.Get8087CW">Get8087CW</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetActiveOleObject" href="#refinery.lib.inno.emulator.IFPSEmulator.GetActiveOleObject">GetActiveOleObject</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetArrayLength" href="#refinery.lib.inno.emulator.IFPSEmulator.GetArrayLength">GetArrayLength</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetCmdTail" href="#refinery.lib.inno.emulator.IFPSEmulator.GetCmdTail">GetCmdTail</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetComputerNameString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetComputerNameString">GetComputerNameString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetDateTimeString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetDateTimeString">GetDateTimeString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetEnv" href="#refinery.lib.inno.emulator.IFPSEmulator.GetEnv">GetEnv</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetMD5OfString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetMD5OfString">GetMD5OfString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetMD5OfUnicodeString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetMD5OfUnicodeString">GetMD5OfUnicodeString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSHA1OfString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSHA1OfString">GetSHA1OfString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSHA1OfUnicodeString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSHA1OfUnicodeString">GetSHA1OfUnicodeString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSHA256OfString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSHA256OfString">GetSHA256OfString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSHA256OfUnicodeString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSHA256OfUnicodeString">GetSHA256OfUnicodeString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSpaceOnDisk" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSpaceOnDisk">GetSpaceOnDisk</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSpaceOnDisk64" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSpaceOnDisk64">GetSpaceOnDisk64</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSystemDir" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSystemDir">GetSystemDir</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetUILanguage" href="#refinery.lib.inno.emulator.IFPSEmulator.GetUILanguage">GetUILanguage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetUserNameString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetUserNameString">GetUserNameString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetWinDir" href="#refinery.lib.inno.emulator.IFPSEmulator.GetWinDir">GetWinDir</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersion" href="#refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersion">GetWindowsVersion</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersionEx" href="#refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersionEx">GetWindowsVersionEx</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersionString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersionString">GetWindowsVersionString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IDispatchInvoke" href="#refinery.lib.inno.emulator.IFPSEmulator.IDispatchInvoke">IDispatchInvoke</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Inc" href="#refinery.lib.inno.emulator.IFPSEmulator.Inc">Inc</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Insert" href="#refinery.lib.inno.emulator.IFPSEmulator.Insert">Insert</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IntToStr" href="#refinery.lib.inno.emulator.IFPSEmulator.IntToStr">IntToStr</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IsAdmin" href="#refinery.lib.inno.emulator.IFPSEmulator.IsAdmin">IsAdmin</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IsWildcard" href="#refinery.lib.inno.emulator.IFPSEmulator.IsWildcard">IsWildcard</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IsWin64" href="#refinery.lib.inno.emulator.IFPSEmulator.IsWin64">IsWin64</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IsX86Compatible" href="#refinery.lib.inno.emulator.IFPSEmulator.IsX86Compatible">IsX86Compatible</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IsX86OS" href="#refinery.lib.inno.emulator.IFPSEmulator.IsX86OS">IsX86OS</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Length" href="#refinery.lib.inno.emulator.IFPSEmulator.Length">Length</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.LoadStringFromFile" href="#refinery.lib.inno.emulator.IFPSEmulator.LoadStringFromFile">LoadStringFromFile</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.LoadStringsFromFile" href="#refinery.lib.inno.emulator.IFPSEmulator.LoadStringsFromFile">LoadStringsFromFile</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Log" href="#refinery.lib.inno.emulator.IFPSEmulator.Log">Log</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Lowercase" href="#refinery.lib.inno.emulator.IFPSEmulator.Lowercase">Lowercase</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.MinimizePathName" href="#refinery.lib.inno.emulator.IFPSEmulator.MinimizePathName">MinimizePathName</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Null" href="#refinery.lib.inno.emulator.IFPSEmulator.Null">Null</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Ord" href="#refinery.lib.inno.emulator.IFPSEmulator.Ord">Ord</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ParamCount" href="#refinery.lib.inno.emulator.IFPSEmulator.ParamCount">ParamCount</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ParamStr" href="#refinery.lib.inno.emulator.IFPSEmulator.ParamStr">ParamStr</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Pos" href="#refinery.lib.inno.emulator.IFPSEmulator.Pos">Pos</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ProcessorArchitecture" href="#refinery.lib.inno.emulator.IFPSEmulator.ProcessorArchitecture">ProcessorArchitecture</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.RaiseException" href="#refinery.lib.inno.emulator.IFPSEmulator.RaiseException">RaiseException</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Random" href="#refinery.lib.inno.emulator.IFPSEmulator.Random">Random</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.RemoveBackslash" href="#refinery.lib.inno.emulator.IFPSEmulator.RemoveBackslash">RemoveBackslash</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.RemoveBackslashUnlessRoot" href="#refinery.lib.inno.emulator.IFPSEmulator.RemoveBackslashUnlessRoot">RemoveBackslashUnlessRoot</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.RemoveQuotes" href="#refinery.lib.inno.emulator.IFPSEmulator.RemoveQuotes">RemoveQuotes</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SameStr" href="#refinery.lib.inno.emulator.IFPSEmulator.SameStr">SameStr</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SameText" href="#refinery.lib.inno.emulator.IFPSEmulator.SameText">SameText</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Set8087CW" href="#refinery.lib.inno.emulator.IFPSEmulator.Set8087CW">Set8087CW</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SetArrayLength" href="#refinery.lib.inno.emulator.IFPSEmulator.SetArrayLength">SetArrayLength</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SetLength" href="#refinery.lib.inno.emulator.IFPSEmulator.SetLength">SetLength</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SetupMessage" href="#refinery.lib.inno.emulator.IFPSEmulator.SetupMessage">SetupMessage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SizeOf" href="#refinery.lib.inno.emulator.IFPSEmulator.SizeOf">SizeOf</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StrToFloat" href="#refinery.lib.inno.emulator.IFPSEmulator.StrToFloat">StrToFloat</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StrToInt" href="#refinery.lib.inno.emulator.IFPSEmulator.StrToInt">StrToInt</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StrToIntDef" href="#refinery.lib.inno.emulator.IFPSEmulator.StrToIntDef">StrToIntDef</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StrToVersion" href="#refinery.lib.inno.emulator.IFPSEmulator.StrToVersion">StrToVersion</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringChange" href="#refinery.lib.inno.emulator.IFPSEmulator.StringChange">StringChange</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringChangeEx" href="#refinery.lib.inno.emulator.IFPSEmulator.StringChangeEx">StringChangeEx</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringJoin" href="#refinery.lib.inno.emulator.IFPSEmulator.StringJoin">StringJoin</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringOfChar" href="#refinery.lib.inno.emulator.IFPSEmulator.StringOfChar">StringOfChar</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringSplit" href="#refinery.lib.inno.emulator.IFPSEmulator.StringSplit">StringSplit</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringSplitEx" href="#refinery.lib.inno.emulator.IFPSEmulator.StringSplitEx">StringSplitEx</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SysErrorMessage" href="#refinery.lib.inno.emulator.IFPSEmulator.SysErrorMessage">SysErrorMessage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.TInputDirWizardPage__GetValues" href="#refinery.lib.inno.emulator.IFPSEmulator.TInputDirWizardPage__GetValues">TInputDirWizardPage__GetValues</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.TInputFileWizardPage__GetValues" href="#refinery.lib.inno.emulator.IFPSEmulator.TInputFileWizardPage__GetValues">TInputFileWizardPage__GetValues</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.TPasswordEdit__SetText" href="#refinery.lib.inno.emulator.IFPSEmulator.TPasswordEdit__SetText">TPasswordEdit__SetText</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Terminated" href="#refinery.lib.inno.emulator.IFPSEmulator.Terminated">Terminated</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Trim" href="#refinery.lib.inno.emulator.IFPSEmulator.Trim">Trim</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.TrimLeft" href="#refinery.lib.inno.emulator.IFPSEmulator.TrimLeft">TrimLeft</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.TrimRight" href="#refinery.lib.inno.emulator.IFPSEmulator.TrimRight">TrimRight</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Trunc" href="#refinery.lib.inno.emulator.IFPSEmulator.Trunc">Trunc</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Unassigned" href="#refinery.lib.inno.emulator.IFPSEmulator.Unassigned">Unassigned</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Uppercase" href="#refinery.lib.inno.emulator.IFPSEmulator.Uppercase">Uppercase</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Utf8Decode" href="#refinery.lib.inno.emulator.IFPSEmulator.Utf8Decode">Utf8Decode</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Utf8Encode" href="#refinery.lib.inno.emulator.IFPSEmulator.Utf8Encode">Utf8Encode</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.WStrGet" href="#refinery.lib.inno.emulator.IFPSEmulator.WStrGet">WStrGet</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.WStrSet" href="#refinery.lib.inno.emulator.IFPSEmulator.WStrSet">WStrSet</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.WildcardMatch" href="#refinery.lib.inno.emulator.IFPSEmulator.WildcardMatch">WildcardMatch</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.WizardForm" href="#refinery.lib.inno.emulator.IFPSEmulator.WizardForm">WizardForm</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.WizardSilent" href="#refinery.lib.inno.emulator.IFPSEmulator.WizardSilent">WizardSilent</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.call" href="#refinery.lib.inno.emulator.IFPSEmulator.call">call</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.emulate_function" href="#refinery.lib.inno.emulator.IFPSEmulator.emulate_function">emulate_function</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.kernel32__GetTickCount" href="#refinery.lib.inno.emulator.IFPSEmulator.kernel32__GetTickCount">kernel32__GetTickCount</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.kernel32__Sleep" href="#refinery.lib.inno.emulator.IFPSEmulator.kernel32__Sleep">kernel32__Sleep</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.reset" href="#refinery.lib.inno.emulator.IFPSEmulator.reset">reset</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.user32__GetSystemMetrics" href="#refinery.lib.inno.emulator.IFPSEmulator.user32__GetSystemMetrics">user32__GetSystemMetrics</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="refinery.lib.inno" href="index.html">refinery.lib.inno</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="refinery.lib.inno.emulator.OleObject" href="#refinery.lib.inno.emulator.OleObject">OleObject</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.Variable" href="#refinery.lib.inno.emulator.Variable">Variable</a></code></h4>
<ul class="two-column">
<li><code><a title="refinery.lib.inno.emulator.Variable.at" href="#refinery.lib.inno.emulator.Variable.at">at</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.Variable.deref" href="#refinery.lib.inno.emulator.Variable.deref">deref</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.Variable.setdefault" href="#refinery.lib.inno.emulator.Variable.setdefault">setdefault</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.Variable.resize" href="#refinery.lib.inno.emulator.Variable.resize">resize</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.Variable.setptr" href="#refinery.lib.inno.emulator.Variable.setptr">setptr</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.Variable.set" href="#refinery.lib.inno.emulator.Variable.set">set</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.Variable.get" href="#refinery.lib.inno.emulator.Variable.get">get</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.NeedSymbol" href="#refinery.lib.inno.emulator.NeedSymbol">NeedSymbol</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.OpCodeNotImplemented" href="#refinery.lib.inno.emulator.OpCodeNotImplemented">OpCodeNotImplemented</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.EmulatorException" href="#refinery.lib.inno.emulator.EmulatorException">EmulatorException</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.AbortEmulation" href="#refinery.lib.inno.emulator.AbortEmulation">AbortEmulation</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.IFPSException" href="#refinery.lib.inno.emulator.IFPSException">IFPSException</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.EmulatorTimeout" href="#refinery.lib.inno.emulator.EmulatorTimeout">EmulatorTimeout</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.EmulatorExecutionLimit" href="#refinery.lib.inno.emulator.EmulatorExecutionLimit">EmulatorExecutionLimit</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.EmulatorMaxStack" href="#refinery.lib.inno.emulator.EmulatorMaxStack">EmulatorMaxStack</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.EmulatorMaxCalls" href="#refinery.lib.inno.emulator.EmulatorMaxCalls">EmulatorMaxCalls</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.ExceptionHandler" href="#refinery.lib.inno.emulator.ExceptionHandler">ExceptionHandler</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.IFPSEmulatedFunction" href="#refinery.lib.inno.emulator.IFPSEmulatedFunction">IFPSEmulatedFunction</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.IFPSEmulatorConfig" href="#refinery.lib.inno.emulator.IFPSEmulatorConfig">IFPSEmulatorConfig</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.TSetupStep" href="#refinery.lib.inno.emulator.TSetupStep">TSetupStep</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.TSplitType" href="#refinery.lib.inno.emulator.TSplitType">TSplitType</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.TUninstallStep" href="#refinery.lib.inno.emulator.TUninstallStep">TUninstallStep</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.TSetupProcessorArchitecture" href="#refinery.lib.inno.emulator.TSetupProcessorArchitecture">TSetupProcessorArchitecture</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.PageID" href="#refinery.lib.inno.emulator.PageID">PageID</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.NewFunctionCall" href="#refinery.lib.inno.emulator.NewFunctionCall">NewFunctionCall</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.NewPassword" href="#refinery.lib.inno.emulator.NewPassword">NewPassword</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.NewMutex" href="#refinery.lib.inno.emulator.NewMutex">NewMutex</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.NewInstruction" href="#refinery.lib.inno.emulator.NewInstruction">NewInstruction</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.EventCall" href="#refinery.lib.inno.emulator.EventCall">EventCall</a></code></h4>
<ul class="">
<li><code><a title="refinery.lib.inno.emulator.EventCall.Wrap" href="#refinery.lib.inno.emulator.EventCall.Wrap">Wrap</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.FPUControl" href="#refinery.lib.inno.emulator.FPUControl">FPUControl</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.IFPSEmulator" href="#refinery.lib.inno.emulator.IFPSEmulator">IFPSEmulator</a></code></h4>
<ul class="">
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.TInputDirWizardPage__GetValues" href="#refinery.lib.inno.emulator.IFPSEmulator.TInputDirWizardPage__GetValues">TInputDirWizardPage__GetValues</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.TInputFileWizardPage__GetValues" href="#refinery.lib.inno.emulator.IFPSEmulator.TInputFileWizardPage__GetValues">TInputFileWizardPage__GetValues</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.user32__GetSystemMetrics" href="#refinery.lib.inno.emulator.IFPSEmulator.user32__GetSystemMetrics">user32__GetSystemMetrics</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IsX86Compatible" href="#refinery.lib.inno.emulator.IFPSEmulator.IsX86Compatible">IsX86Compatible</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Terminated" href="#refinery.lib.inno.emulator.IFPSEmulator.Terminated">Terminated</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Random" href="#refinery.lib.inno.emulator.IFPSEmulator.Random">Random</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.WStrGet" href="#refinery.lib.inno.emulator.IFPSEmulator.WStrGet">WStrGet</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.WStrSet" href="#refinery.lib.inno.emulator.IFPSEmulator.WStrSet">WStrSet</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Beep" href="#refinery.lib.inno.emulator.IFPSEmulator.Beep">Beep</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.DirExists" href="#refinery.lib.inno.emulator.IFPSEmulator.DirExists">DirExists</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ForceDirectories" href="#refinery.lib.inno.emulator.IFPSEmulator.ForceDirectories">ForceDirectories</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.LoadStringFromFile" href="#refinery.lib.inno.emulator.IFPSEmulator.LoadStringFromFile">LoadStringFromFile</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.LoadStringsFromFile" href="#refinery.lib.inno.emulator.IFPSEmulator.LoadStringsFromFile">LoadStringsFromFile</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.DeleteFile" href="#refinery.lib.inno.emulator.IFPSEmulator.DeleteFile">DeleteFile</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.FileExists" href="#refinery.lib.inno.emulator.IFPSEmulator.FileExists">FileExists</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Log" href="#refinery.lib.inno.emulator.IFPSEmulator.Log">Log</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Inc" href="#refinery.lib.inno.emulator.IFPSEmulator.Inc">Inc</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Dec" href="#refinery.lib.inno.emulator.IFPSEmulator.Dec">Dec</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.FindFirst" href="#refinery.lib.inno.emulator.IFPSEmulator.FindFirst">FindFirst</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Trunc" href="#refinery.lib.inno.emulator.IFPSEmulator.Trunc">Trunc</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSpaceOnDisk" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSpaceOnDisk">GetSpaceOnDisk</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSpaceOnDisk64" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSpaceOnDisk64">GetSpaceOnDisk64</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Exec" href="#refinery.lib.inno.emulator.IFPSEmulator.Exec">Exec</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetCmdTail" href="#refinery.lib.inno.emulator.IFPSEmulator.GetCmdTail">GetCmdTail</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ParamCount" href="#refinery.lib.inno.emulator.IFPSEmulator.ParamCount">ParamCount</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ParamStr" href="#refinery.lib.inno.emulator.IFPSEmulator.ParamStr">ParamStr</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ActiveLanguage" href="#refinery.lib.inno.emulator.IFPSEmulator.ActiveLanguage">ActiveLanguage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.FmtMessage" href="#refinery.lib.inno.emulator.IFPSEmulator.FmtMessage">FmtMessage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Format" href="#refinery.lib.inno.emulator.IFPSEmulator.Format">Format</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.RaiseException" href="#refinery.lib.inno.emulator.IFPSEmulator.RaiseException">RaiseException</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetArrayLength" href="#refinery.lib.inno.emulator.IFPSEmulator.GetArrayLength">GetArrayLength</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SetArrayLength" href="#refinery.lib.inno.emulator.IFPSEmulator.SetArrayLength">SetArrayLength</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Unassigned" href="#refinery.lib.inno.emulator.IFPSEmulator.Unassigned">Unassigned</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Null" href="#refinery.lib.inno.emulator.IFPSEmulator.Null">Null</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Chr" href="#refinery.lib.inno.emulator.IFPSEmulator.Chr">Chr</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Ord" href="#refinery.lib.inno.emulator.IFPSEmulator.Ord">Ord</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Copy" href="#refinery.lib.inno.emulator.IFPSEmulator.Copy">Copy</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Length" href="#refinery.lib.inno.emulator.IFPSEmulator.Length">Length</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Lowercase" href="#refinery.lib.inno.emulator.IFPSEmulator.Lowercase">Lowercase</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Uppercase" href="#refinery.lib.inno.emulator.IFPSEmulator.Uppercase">Uppercase</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringOfChar" href="#refinery.lib.inno.emulator.IFPSEmulator.StringOfChar">StringOfChar</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Delete" href="#refinery.lib.inno.emulator.IFPSEmulator.Delete">Delete</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Insert" href="#refinery.lib.inno.emulator.IFPSEmulator.Insert">Insert</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringChangeEx" href="#refinery.lib.inno.emulator.IFPSEmulator.StringChangeEx">StringChangeEx</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Pos" href="#refinery.lib.inno.emulator.IFPSEmulator.Pos">Pos</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.AddQuotes" href="#refinery.lib.inno.emulator.IFPSEmulator.AddQuotes">AddQuotes</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.RemoveQuotes" href="#refinery.lib.inno.emulator.IFPSEmulator.RemoveQuotes">RemoveQuotes</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CompareStr" href="#refinery.lib.inno.emulator.IFPSEmulator.CompareStr">CompareStr</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SameText" href="#refinery.lib.inno.emulator.IFPSEmulator.SameText">SameText</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SameStr" href="#refinery.lib.inno.emulator.IFPSEmulator.SameStr">SameStr</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IsWildcard" href="#refinery.lib.inno.emulator.IFPSEmulator.IsWildcard">IsWildcard</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.WildcardMatch" href="#refinery.lib.inno.emulator.IFPSEmulator.WildcardMatch">WildcardMatch</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Trim" href="#refinery.lib.inno.emulator.IFPSEmulator.Trim">Trim</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.TrimLeft" href="#refinery.lib.inno.emulator.IFPSEmulator.TrimLeft">TrimLeft</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.TrimRight" href="#refinery.lib.inno.emulator.IFPSEmulator.TrimRight">TrimRight</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringJoin" href="#refinery.lib.inno.emulator.IFPSEmulator.StringJoin">StringJoin</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringSplitEx" href="#refinery.lib.inno.emulator.IFPSEmulator.StringSplitEx">StringSplitEx</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StrToInt" href="#refinery.lib.inno.emulator.IFPSEmulator.StrToInt">StrToInt</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StrToIntDef" href="#refinery.lib.inno.emulator.IFPSEmulator.StrToIntDef">StrToIntDef</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StrToFloat" href="#refinery.lib.inno.emulator.IFPSEmulator.StrToFloat">StrToFloat</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IntToStr" href="#refinery.lib.inno.emulator.IFPSEmulator.IntToStr">IntToStr</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StrToVersion" href="#refinery.lib.inno.emulator.IFPSEmulator.StrToVersion">StrToVersion</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CharLength" href="#refinery.lib.inno.emulator.IFPSEmulator.CharLength">CharLength</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.AddBackslash" href="#refinery.lib.inno.emulator.IFPSEmulator.AddBackslash">AddBackslash</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.AddPeriod" href="#refinery.lib.inno.emulator.IFPSEmulator.AddPeriod">AddPeriod</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.RemoveBackslash" href="#refinery.lib.inno.emulator.IFPSEmulator.RemoveBackslash">RemoveBackslash</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ChangeFileExt" href="#refinery.lib.inno.emulator.IFPSEmulator.ChangeFileExt">ChangeFileExt</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileExt" href="#refinery.lib.inno.emulator.IFPSEmulator.ExtractFileExt">ExtractFileExt</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileDir" href="#refinery.lib.inno.emulator.IFPSEmulator.ExtractFileDir">ExtractFileDir</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileName" href="#refinery.lib.inno.emulator.IFPSEmulator.ExtractFileName">ExtractFileName</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExtractFileDrive" href="#refinery.lib.inno.emulator.IFPSEmulator.ExtractFileDrive">ExtractFileDrive</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExtractRelativePath" href="#refinery.lib.inno.emulator.IFPSEmulator.ExtractRelativePath">ExtractRelativePath</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SetLength" href="#refinery.lib.inno.emulator.IFPSEmulator.SetLength">SetLength</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CharToOemBuff" href="#refinery.lib.inno.emulator.IFPSEmulator.CharToOemBuff">CharToOemBuff</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Utf8Encode" href="#refinery.lib.inno.emulator.IFPSEmulator.Utf8Encode">Utf8Encode</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Utf8Decode" href="#refinery.lib.inno.emulator.IFPSEmulator.Utf8Decode">Utf8Decode</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetMD5OfString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetMD5OfString">GetMD5OfString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetMD5OfUnicodeString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetMD5OfUnicodeString">GetMD5OfUnicodeString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSHA1OfString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSHA1OfString">GetSHA1OfString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSHA1OfUnicodeString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSHA1OfUnicodeString">GetSHA1OfUnicodeString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSHA256OfString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSHA256OfString">GetSHA256OfString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSHA256OfUnicodeString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSHA256OfUnicodeString">GetSHA256OfUnicodeString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SysErrorMessage" href="#refinery.lib.inno.emulator.IFPSEmulator.SysErrorMessage">SysErrorMessage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.MinimizePathName" href="#refinery.lib.inno.emulator.IFPSEmulator.MinimizePathName">MinimizePathName</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CreateOleObject" href="#refinery.lib.inno.emulator.IFPSEmulator.CreateOleObject">CreateOleObject</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetActiveOleObject" href="#refinery.lib.inno.emulator.IFPSEmulator.GetActiveOleObject">GetActiveOleObject</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IDispatchInvoke" href="#refinery.lib.inno.emulator.IFPSEmulator.IDispatchInvoke">IDispatchInvoke</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.FindWindowByClassName" href="#refinery.lib.inno.emulator.IFPSEmulator.FindWindowByClassName">FindWindowByClassName</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.FindWindowByWindowName" href="#refinery.lib.inno.emulator.IFPSEmulator.FindWindowByWindowName">FindWindowByWindowName</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.reset" href="#refinery.lib.inno.emulator.IFPSEmulator.reset">reset</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.unimplemented" href="#refinery.lib.inno.emulator.IFPSEmulator.unimplemented">unimplemented</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.emulate_function" href="#refinery.lib.inno.emulator.IFPSEmulator.emulate_function">emulate_function</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.call" href="#refinery.lib.inno.emulator.IFPSEmulator.call">call</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.TPasswordEdit__SetText" href="#refinery.lib.inno.emulator.IFPSEmulator.TPasswordEdit__SetText">TPasswordEdit__SetText</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.kernel32__GetTickCount" href="#refinery.lib.inno.emulator.IFPSEmulator.kernel32__GetTickCount">kernel32__GetTickCount</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IsAdmin" href="#refinery.lib.inno.emulator.IFPSEmulator.IsAdmin">IsAdmin</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.kernel32__Sleep" href="#refinery.lib.inno.emulator.IFPSEmulator.kernel32__Sleep">kernel32__Sleep</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetEnv" href="#refinery.lib.inno.emulator.IFPSEmulator.GetEnv">GetEnv</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Abort" href="#refinery.lib.inno.emulator.IFPSEmulator.Abort">Abort</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExpandConstant" href="#refinery.lib.inno.emulator.IFPSEmulator.ExpandConstant">ExpandConstant</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExpandConstantEx" href="#refinery.lib.inno.emulator.IFPSEmulator.ExpandConstantEx">ExpandConstantEx</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.expand_constant" href="#refinery.lib.inno.emulator.IFPSEmulator.expand_constant">expand_constant</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CustomMessage" href="#refinery.lib.inno.emulator.IFPSEmulator.CustomMessage">CustomMessage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SetupMessage" href="#refinery.lib.inno.emulator.IFPSEmulator.SetupMessage">SetupMessage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IsWin64" href="#refinery.lib.inno.emulator.IFPSEmulator.IsWin64">IsWin64</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.IsX86OS" href="#refinery.lib.inno.emulator.IFPSEmulator.IsX86OS">IsX86OS</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ProcessorArchitecture" href="#refinery.lib.inno.emulator.IFPSEmulator.ProcessorArchitecture">ProcessorArchitecture</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetUserNameString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetUserNameString">GetUserNameString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetComputerNameString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetComputerNameString">GetComputerNameString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetUILanguage" href="#refinery.lib.inno.emulator.IFPSEmulator.GetUILanguage">GetUILanguage</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.WizardForm" href="#refinery.lib.inno.emulator.IFPSEmulator.WizardForm">WizardForm</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Set8087CW" href="#refinery.lib.inno.emulator.IFPSEmulator.Set8087CW">Set8087CW</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.Get8087CW" href="#refinery.lib.inno.emulator.IFPSEmulator.Get8087CW">Get8087CW</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetDateTimeString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetDateTimeString">GetDateTimeString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringChange" href="#refinery.lib.inno.emulator.IFPSEmulator.StringChange">StringChange</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CompareText" href="#refinery.lib.inno.emulator.IFPSEmulator.CompareText">CompareText</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.StringSplit" href="#refinery.lib.inno.emulator.IFPSEmulator.StringSplit">StringSplit</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.RemoveBackslashUnlessRoot" href="#refinery.lib.inno.emulator.IFPSEmulator.RemoveBackslashUnlessRoot">RemoveBackslashUnlessRoot</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.ExpandFileName" href="#refinery.lib.inno.emulator.IFPSEmulator.ExpandFileName">ExpandFileName</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CheckForMutexes" href="#refinery.lib.inno.emulator.IFPSEmulator.CheckForMutexes">CheckForMutexes</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.CreateMutex" href="#refinery.lib.inno.emulator.IFPSEmulator.CreateMutex">CreateMutex</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetWinDir" href="#refinery.lib.inno.emulator.IFPSEmulator.GetWinDir">GetWinDir</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetSystemDir" href="#refinery.lib.inno.emulator.IFPSEmulator.GetSystemDir">GetSystemDir</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersion" href="#refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersion">GetWindowsVersion</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersionEx" href="#refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersionEx">GetWindowsVersionEx</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersionString" href="#refinery.lib.inno.emulator.IFPSEmulator.GetWindowsVersionString">GetWindowsVersionString</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.WizardSilent" href="#refinery.lib.inno.emulator.IFPSEmulator.WizardSilent">WizardSilent</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.IFPSEmulator.SizeOf" href="#refinery.lib.inno.emulator.IFPSEmulator.SizeOf">SizeOf</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="refinery.lib.inno.emulator.InnoSetupEmulator" href="#refinery.lib.inno.emulator.InnoSetupEmulator">InnoSetupEmulator</a></code></h4>
<ul class="">
<li><code><a title="refinery.lib.inno.emulator.InnoSetupEmulator.emulate_installation" href="#refinery.lib.inno.emulator.InnoSetupEmulator.emulate_installation">emulate_installation</a></code></li>
<li><code><a title="refinery.lib.inno.emulator.InnoSetupEmulator.unimplemented" href="#refinery.lib.inno.emulator.InnoSetupEmulator.unimplemented">unimplemented</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>
hljs.configure({languages: []})
hljs.initHighlightingOnLoad()
</script>
</body>
</html>
