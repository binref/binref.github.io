<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.11.6" />
<title>the refinery.units.blockwise documentation</title>
<meta name="description" content="On a Mission to Refine Binaries" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow-night-bright.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{background-color:#0D0D0D;color:#EEEEEE;font-size:16pt}@font-face{font-family:"FixedSysEx";src:local('Fixedsys Excelsior 3.01-L2'),local('Fixedsys Excelsior 3.01'),local('FixedSysEx'),url(../../FixedSysEx.ttf) format('truetype')}code,pre,body,html{font-family:FixedSysEx,monospace}b,strong{font-weight:normal}#content{padding:20px}#sidebar{padding:1vw;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #EEEEEE;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}hr{display:none}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#EE8080;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#EEEEEE}// .title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#BB4040}pre code{background:#000000;display:block;padding:1px 0px 4px 0px;line-height:100%}code{background:#000000;padding:1px 0px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#000000;border:0;border-top:1px solid #EEEEEE;border-bottom:1px solid #EEEEEE;margin:1em 0;padding:1ex;overflow-x:auto}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index ul{list-style-type:square;padding:0}// #index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 10px}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#000000;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#0D0D0D}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#EEEEEE;border-left:5px solid #EEEEEE;padding-left:1em}.inheritance em{font-style:normal}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1ch}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition.note,.admonition.info,.admonition.todo,.admonition.versionadded,.admonition.important,.admonition.tip,.admonition.hint{background:#054000}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#998800}.admonition.error,.admonition.danger,.admonition.caution{background:#300000}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:1vw}main{display:flex;flex-direction:row;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #EEEEEE;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>refinery.units.blockwise</code></h1>
</header>
<section id="section-intro">
<p>Contains all units that can work on blocks a fixed length. Note that block cipher
algorithms can be found in <code><a title="refinery.units.crypto.cipher" href="../crypto/cipher/index.html">refinery.units.crypto.cipher</a></code>.</p>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L1-L414" class="git-link">Browse git</a>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Contains all units that can work on blocks a fixed length. Note that block cipher
algorithms can be found in `refinery.units.crypto.cipher`.
&#34;&#34;&#34;
from __future__ import annotations

import abc
import itertools

from functools import cached_property
from typing import TYPE_CHECKING

from refinery.lib import chunks
from refinery.lib.inline import iterspread
from refinery.lib.tools import asbuffer, infinitize
from refinery.lib.types import INF, NoMask, Param, buf, isq
from refinery.units import Arg, Unit

if TYPE_CHECKING:
    from typing import Generator, Iterable, Literal, Union

    from numpy import ndarray
    _I = Union[Iterable[int], int]


class FastBlockError(Exception):
    pass


class BlockTransformationBase(Unit, abstract=True):

    def __init__(
        self,
        bigendian: Param[bool, Arg.Switch(&#39;-E&#39;, help=&#39;Read chunks in big endian.&#39;)] = False,
        blocksize: Param[int, Arg.Number(&#39;-B&#39;, help=(
            &#39;The size of each block in bytes. The default is {default}.&#39;
        ))] = 1,
        precision: Param[int, Arg.Number(&#39;-P&#39;, help=(
            &#39;The size of the variables used for computing the result. By default, this is equal to the block size. &#39;
            &#39;The value may be zero, indicating that arbitrary precision is required.&#39;))] = -1,
        _truncate: Arg.Delete() = 0,
        **keywords
    ):
        self._truncate = _truncate
        super().__init__(bigendian=bigendian, blocksize=blocksize, precision=precision, **keywords)

    @cached_property
    def _byte_order_symbol(self):
        if self.args.bigendian:
            return &#39;&gt;&#39;
        else:
            return &#39;&lt;&#39;

    @cached_property
    def _byte_order_adjective(self) -&gt; Literal[&#39;big&#39;, &#39;little&#39;]:
        return &#39;big&#39; if self.args.bigendian else &#39;little&#39;

    @property
    def bytestream(self):
        &#34;&#34;&#34;
        Indicates whether or not the block size is equal to 1, i.e. whether the unit is operating
        on a stream of bytes. In this case, many operations can be simplified.
        &#34;&#34;&#34;
        return self.blocksize == 1

    @property
    def blocksize(self) -&gt; int:
        return self.args.blocksize or 1

    @property
    def precision(self) -&gt; int | Literal[INF]:
        precision = self.args.precision
        if precision &lt; 0:
            return self.blocksize
        if precision == 0:
            return INF
        return precision

    @property
    def fbits(self):
        return 8 * self.precision

    @property
    def fmask(self) -&gt; int | Literal[NoMask]:
        fbits = self.fbits
        if fbits == INF:
            return NoMask
        return (1 &lt;&lt; fbits) - 1

    def rest(self, data: bytearray):
        &#34;&#34;&#34;
        Returns all excess bytes at the end of the input data that do not form a full block, based on
        the current operational block size of the unit.
        &#34;&#34;&#34;
        if self.bytestream:
            return B&#39;&#39;
        end = self.blocksize * (len(data) // self.blocksize)
        return data[end:]

    def chunk_into_bytes(self, data: buf) -&gt; Generator[buf]:
        &#34;&#34;&#34;
        Returns an iterator over the blocks of the input data according to the current operational block
        size. The blocks are returned as slices of the input data. Note that zero bytes may be appended if
        auto padding is enabled.
        &#34;&#34;&#34;
        n = len(data)
        b = self.blocksize
        m = n - n % b
        for k in range(0, m, b):
            yield data[k : k + b]
        if self._truncate &gt; 0 or m == n:
            return
        last = bytearray(data[m:])
        last.extend(itertools.repeat(0, -n % b))
        yield last

    def chunk(self, data: bytearray):
        &#34;&#34;&#34;
        Returns an iterator over the blocks of the input data according to the current operational block
        size. The blocks are returned as integers that have been parsed out according to the unit&#39;s byte
        order setting.
        &#34;&#34;&#34;
        pad = self._truncate &lt; 1
        return chunks.unpack(data, self.blocksize, self.args.bigendian, pad=pad)

    def unchunk(self, data: Iterable[int]):
        &#34;&#34;&#34;
        Convert an iterable of integer blocks into a byte string representation based on the operational
        block size and byte order settings of the unit.
        &#34;&#34;&#34;
        if self.precision &gt; self.blocksize:
            mask = (1 &lt;&lt; (8 * self.blocksize)) - 1
            data = (chunk &amp; mask for chunk in data)
        return chunks.pack(data, self.blocksize, self.args.bigendian)


class BlockTransformation(BlockTransformationBase, abstract=True):

    def process(self, data):
        work = self.process_block
        size = len(data)
        temp = (work(b) for b in self.chunk(data))
        out = self.unchunk(temp)
        if self._truncate &lt; 1:
            del out[size:]
        elif self._truncate &lt; 2:
            out.extend(self.rest(data))
        return out

    @abc.abstractmethod
    def process_block(self, block):
        &#34;&#34;&#34;
        A blockwise operation implements this routine to process each block, which
        is given as an integer. The return value is also expected to be an integer.
        &#34;&#34;&#34;
        raise NotImplementedError


class ArithmeticUnit(BlockTransformation, abstract=True):

    def __init__(self, *argument: Param[isq, Arg.NumSeq(help=(
        &#39;A single numeric expression which provides the right argument to the operation, &#39;
        &#39;where the left argument is each block in the input data. This argument can also &#39;
        &#39;contain a sequence of bytes which is then split into blocks of the same size as &#39;
        &#39;the input data and used cyclically.&#39;))],
        bigendian=False, blocksize=1, precision=-1, **kw
    ):
        super().__init__(bigendian=bigendian, blocksize=blocksize, precision=precision, argument=argument, **kw)

    def _argument_parse_hook(self, it: _I) -&gt; tuple[_I, bool]:
        return it, False

    def _infinitize_argument(self, min_size: int, it: _I, masked=False) -&gt; Iterable[int]:
        def _mask(it):
            warnings = 3
            for block in it:
                out = block &amp; self.fmask
                if warnings and out != block:
                    warnings -= 1
                    self.log_warn(F&#39;reduced argument to 0x{out:0{self.fbits // 4}X}; original value was 0x{block:X}&#39;)
                    if not warnings:
                        self.log_warn(&#39;additional warnings are suppressed&#39;)
                yield out
        if isinstance(it, (bytes, bytearray)) and (n := len(it)) &gt; 0x400:
            quotient, remainder = divmod(min_size, n)
            if remainder &gt; 0:
                quotient += 1
            if quotient &gt; 1:
                it = it * quotient
            return it
        if isinstance(it, int):
            it = (it,)
        if not masked:
            it = _mask(it)
        return infinitize(it)

    @abc.abstractmethod
    def operate(self, block, *args) -&gt; int:
        raise NotImplementedError

    @abc.abstractmethod
    def inplace(self, block: ndarray, *args) -&gt; ndarray | None:
        tmp: ndarray = self.operate(block, *args)
        if tmp.dtype != block.dtype:
            tmp = tmp.astype(block.dtype)
        block[:] = tmp

    @Unit.Requires(&#39;numpy&#39;, [&#39;speed&#39;, &#39;default&#39;, &#39;extended&#39;])
    def _numpy():
        import numpy
        return numpy

    def _fastblock(self, data) -&gt; bytes | bytearray:
        &#34;&#34;&#34;
        Attempts to perform the operation more quickly by using numpy arrays.
        &#34;&#34;&#34;
        try:
            numpy = self._numpy
        except ImportError as IE:
            raise FastBlockError from IE

        self.log_debug(&#39;fastblock: parsing and extending arguments&#39;)

        def _execute_hooks():
            for a in self.args.argument:
                it, masked = self._argument_parse_hook(a)
                na = self._infinitize_argument(len(data), it, masked)
                yield it, masked, na

        _hooks_executed = list(_execute_hooks())

        byte_order = self._byte_order_symbol
        num_blocks = len(data) // self.blocksize

        try:
            if self.precision is INF:
                # NumPy type for Python Objects
                dtype = numpy.dtype(&#39;O&#39;)
            else:
                dtype = numpy.dtype(F&#39;{byte_order}u{self.precision!s}&#39;)
        except TypeError as T:
            raise FastBlockError from T

        br_args = []
        np_args = []

        for it, masked, na in _hooks_executed:
            br_args.append(na)
            if isinstance(it, int):
                if not masked:
                    it &amp;= self.fmask
                npa = int(it)
            elif self.precision is INF:
                npa = numpy.array(list(itertools.islice(na, num_blocks)), dtype=dtype)
            elif nb := asbuffer(na):
                npa = numpy.frombuffer(nb, dtype, num_blocks)
            else:
                npa = numpy.fromiter(na, dtype, num_blocks)
            np_args.append(npa)

        if (_truncate := self._truncate) &gt;= 2 or (_t := len(data) - num_blocks * self.blocksize) &lt;= 0:
            rest = ()
        else:
            rest = data[-_t:]
            if _truncate &lt; 1:
                last_ops = [next(a) for a in br_args]
                last_int = int.from_bytes(rest, self._byte_order_adjective)
                dst_tail = self.operate(last_int, *last_ops) &amp; self.fmask
                dst_tail = dst_tail.to_bytes(self.blocksize, self._byte_order_adjective)
                rest = dst_tail[:_t]

        try:
            stype = numpy.dtype(F&#39;{byte_order}u{self.blocksize}&#39;)
        except TypeError as T:
            raise FastBlockError from T

        if not isinstance(data, bytearray):
            data = bytearray(data)

        self.log_debug(F&#39;fastblock: loading {num_blocks} blocks of type {stype} from source data&#39;)

        dst = data
        src = numpy.frombuffer(dst, stype, num_blocks)
        if stype != dtype:
            src = src.astype(dtype)

        tmp = self.inplace(src, *np_args)

        if tmp is not None:
            src = tmp
            dst = None
        if stype != dtype:
            src = src.astype(stype)
            dst = None

        mem = memoryview(src)

        if dst is None:
            dst = bytearray(mem)
        elif (n := mem.nbytes) &lt; len(dst):
            del tmp
            del mem
            del src
            try:
                del dst[n:]
            except BufferError:
                import gc
                gc.collect()
                del dst[n:]

        dst.extend(rest)
        return dst

    def process(self, data):
        try:
            self.log_debug(&#39;attempting to process input using numpy method&#39;)
            result = self._fastblock(data)
        except FastBlockError:
            pass
        except Exception as error:
            if self.log_debug():
                raise
            self.log_warn(&#39;falling back to default method after fast block failed with error:&#39;, error)
        else:
            self.log_debug(&#39;fast block method successful&#39;)
            return result
        arguments = [
            self._infinitize_argument(len(data), *self._argument_parse_hook(a))
            for a in self.args.argument]
        try:
            mask = self.fmask
            size = len(data)
            if mask is NoMask:
                mask = None
            spread = iterspread(self.operate, self.chunk(data), *arguments, mask=mask)
            out = self.unchunk(spread(self))
            if self._truncate &lt; 1:
                del out[size:]
            elif self._truncate &lt; 2:
                out.extend(self.rest(data))
            return out
        except Exception as E:
            self.log_warn(F&#39;unable to inline this operation: {E!s}&#39;)
            self.log_warn(R&#39;falling back all the way to failsafe method&#39;)
            self._arg = arguments
            return super().process(data)

    def process_block(self, block):
        return self.operate(block, *(next(a) for a in self._arg)) &amp; self.fmask


class UnaryOperation(ArithmeticUnit, abstract=True):
    def __init__(self, bigendian=False, blocksize=1, **kw):
        super().__init__(
            bigendian=bigendian, blocksize=blocksize, **kw)

    def inplace(self, block) -&gt; None:
        super().inplace(block)


class BinaryOperation(ArithmeticUnit, abstract=True):
    def __init__(self, *argument, bigendian=False, blocksize=1):
        super().__init__(*argument, bigendian=bigendian, blocksize=blocksize)

    def inplace(self, block, argument) -&gt; None:
        super().inplace(block, argument)


class BinaryOperationWithAutoBlockAdjustment(BinaryOperation, abstract=True):
    def __init__(
        self, *argument, bigendian=False,
        blocksize: Param[int, Arg.Number(help=(
            &#39;The size of each block in bytes. It is chosen, by default, to be the smallest size that can &#39;
            &#39;hold the provided argument without loss of precision. For example, passing the value 0x1234 &#39;
            &#39;will result in a default block size of 2, while passing the value 12 will mean that the &#39;
            &#39;default block size is 1.&#39;
        ))] = 0
    ):
        super().__init__(*argument, bigendian=bigendian, blocksize=blocksize)

    def _argument_parse_hook(self, it: _I) -&gt; tuple[_I, bool]:
        try:
            n = len(it)
        except TypeError:
            pass
        else:
            if n == 1:
                it = it[0]
        if masked := isinstance(it, int):
            if not self.args.blocksize:
                self.log_debug(&#39;detected numeric argument with no specified block size&#39;)
                bits = it.bit_length()
                if bits &gt; self.blocksize * 8:
                    length, r = divmod(bits, 8)
                    length += int(bool(r))
                    self.log_info(F&#39;setting block size to {length} based on the argument bit size&#39;)
                    self._blocksize = length
            else:
                it &amp;= self.fmask
        return it, masked

    @property
    def blocksize(self):
        try:
            blocksize = self._blocksize
        except AttributeError:
            blocksize = 0
        return blocksize or super().blocksize

    def process(self, data):
        try:
            return super().process(data)
        finally:
            self._blocksize = 0</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="refinery.units.blockwise.add" href="add.html">refinery.units.blockwise.add</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.alu" href="alu.html">refinery.units.blockwise.alu</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.bitrev" href="bitrev.html">refinery.units.blockwise.bitrev</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.bitsnip" href="bitsnip.html">refinery.units.blockwise.bitsnip</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.byteswap" href="byteswap.html">refinery.units.blockwise.byteswap</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.map" href="map.html">refinery.units.blockwise.map</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.neg" href="neg.html">refinery.units.blockwise.neg</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.pack" href="pack.html">refinery.units.blockwise.pack</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.rev" href="rev.html">refinery.units.blockwise.rev</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.rotl" href="rotl.html">refinery.units.blockwise.rotl</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.rotr" href="rotr.html">refinery.units.blockwise.rotr</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.shl" href="shl.html">refinery.units.blockwise.shl</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.shr" href="shr.html">refinery.units.blockwise.shr</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.sub" href="sub.html">refinery.units.blockwise.sub</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.terminate" href="terminate.html">refinery.units.blockwise.terminate</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="refinery.units.blockwise.xor" href="xor.html">refinery.units.blockwise.xor</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="refinery.units.blockwise.FastBlockError"><code class="flex name class">
<span>class <span class="ident">FastBlockError</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>Common base class for all non-exit exceptions.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L26-L27" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class FastBlockError(Exception):
    pass</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="refinery.units.blockwise.BlockTransformationBase"><code class="flex name class">
<span>class <span class="ident">BlockTransformationBase</span></span>
<span>(</span><span>bigendian=False, blocksize=1, precision=-1, **keywords)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L30-L134" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class BlockTransformationBase(Unit, abstract=True):

    def __init__(
        self,
        bigendian: Param[bool, Arg.Switch(&#39;-E&#39;, help=&#39;Read chunks in big endian.&#39;)] = False,
        blocksize: Param[int, Arg.Number(&#39;-B&#39;, help=(
            &#39;The size of each block in bytes. The default is {default}.&#39;
        ))] = 1,
        precision: Param[int, Arg.Number(&#39;-P&#39;, help=(
            &#39;The size of the variables used for computing the result. By default, this is equal to the block size. &#39;
            &#39;The value may be zero, indicating that arbitrary precision is required.&#39;))] = -1,
        _truncate: Arg.Delete() = 0,
        **keywords
    ):
        self._truncate = _truncate
        super().__init__(bigendian=bigendian, blocksize=blocksize, precision=precision, **keywords)

    @cached_property
    def _byte_order_symbol(self):
        if self.args.bigendian:
            return &#39;&gt;&#39;
        else:
            return &#39;&lt;&#39;

    @cached_property
    def _byte_order_adjective(self) -&gt; Literal[&#39;big&#39;, &#39;little&#39;]:
        return &#39;big&#39; if self.args.bigendian else &#39;little&#39;

    @property
    def bytestream(self):
        &#34;&#34;&#34;
        Indicates whether or not the block size is equal to 1, i.e. whether the unit is operating
        on a stream of bytes. In this case, many operations can be simplified.
        &#34;&#34;&#34;
        return self.blocksize == 1

    @property
    def blocksize(self) -&gt; int:
        return self.args.blocksize or 1

    @property
    def precision(self) -&gt; int | Literal[INF]:
        precision = self.args.precision
        if precision &lt; 0:
            return self.blocksize
        if precision == 0:
            return INF
        return precision

    @property
    def fbits(self):
        return 8 * self.precision

    @property
    def fmask(self) -&gt; int | Literal[NoMask]:
        fbits = self.fbits
        if fbits == INF:
            return NoMask
        return (1 &lt;&lt; fbits) - 1

    def rest(self, data: bytearray):
        &#34;&#34;&#34;
        Returns all excess bytes at the end of the input data that do not form a full block, based on
        the current operational block size of the unit.
        &#34;&#34;&#34;
        if self.bytestream:
            return B&#39;&#39;
        end = self.blocksize * (len(data) // self.blocksize)
        return data[end:]

    def chunk_into_bytes(self, data: buf) -&gt; Generator[buf]:
        &#34;&#34;&#34;
        Returns an iterator over the blocks of the input data according to the current operational block
        size. The blocks are returned as slices of the input data. Note that zero bytes may be appended if
        auto padding is enabled.
        &#34;&#34;&#34;
        n = len(data)
        b = self.blocksize
        m = n - n % b
        for k in range(0, m, b):
            yield data[k : k + b]
        if self._truncate &gt; 0 or m == n:
            return
        last = bytearray(data[m:])
        last.extend(itertools.repeat(0, -n % b))
        yield last

    def chunk(self, data: bytearray):
        &#34;&#34;&#34;
        Returns an iterator over the blocks of the input data according to the current operational block
        size. The blocks are returned as integers that have been parsed out according to the unit&#39;s byte
        order setting.
        &#34;&#34;&#34;
        pad = self._truncate &lt; 1
        return chunks.unpack(data, self.blocksize, self.args.bigendian, pad=pad)

    def unchunk(self, data: Iterable[int]):
        &#34;&#34;&#34;
        Convert an iterable of integer blocks into a byte string representation based on the operational
        block size and byte order settings of the unit.
        &#34;&#34;&#34;
        if self.precision &gt; self.blocksize:
            mask = (1 &lt;&lt; (8 * self.blocksize)) - 1
            data = (chunk &amp; mask for chunk in data)
        return chunks.pack(data, self.blocksize, self.args.bigendian)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.units.Unit" href="../index.html#refinery.units.Unit">Unit</a></li>
<li><a title="refinery.units.UnitBase" href="../index.html#refinery.units.UnitBase">UnitBase</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="refinery.units.blockwise.BlockTransformation" href="#refinery.units.blockwise.BlockTransformation">BlockTransformation</a></li>
<li><a title="refinery.units.blockwise.bitsnip.bitsnip" href="bitsnip.html#refinery.units.blockwise.bitsnip.bitsnip">bitsnip</a></li>
<li><a title="refinery.units.blockwise.pack.pack" href="pack.html#refinery.units.blockwise.pack.pack">pack</a></li>
<li><a title="refinery.units.blockwise.terminate.terminate" href="terminate.html#refinery.units.blockwise.terminate.terminate">terminate</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.units.blockwise.BlockTransformationBase.required_dependencies"><code class="name">var <span class="ident">required_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.BlockTransformationBase.optional_dependencies"><code class="name">var <span class="ident">optional_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.BlockTransformationBase.console"><code class="name">var <span class="ident">console</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.units.blockwise.BlockTransformationBase.bytestream"><code class="name">var <span class="ident">bytestream</span></code></dt>
<dd>
<section class="desc"><p>Indicates whether or not the block size is equal to 1, i.e. whether the unit is operating
on a stream of bytes. In this case, many operations can be simplified.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L58-L64" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def bytestream(self):
    &#34;&#34;&#34;
    Indicates whether or not the block size is equal to 1, i.e. whether the unit is operating
    on a stream of bytes. In this case, many operations can be simplified.
    &#34;&#34;&#34;
    return self.blocksize == 1</code></pre>
</details>
</dd>
<dt id="refinery.units.blockwise.BlockTransformationBase.blocksize"><code class="name">var <span class="ident">blocksize</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L66-L68" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def blocksize(self) -&gt; int:
    return self.args.blocksize or 1</code></pre>
</details>
</dd>
<dt id="refinery.units.blockwise.BlockTransformationBase.precision"><code class="name">var <span class="ident">precision</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L70-L77" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def precision(self) -&gt; int | Literal[INF]:
    precision = self.args.precision
    if precision &lt; 0:
        return self.blocksize
    if precision == 0:
        return INF
    return precision</code></pre>
</details>
</dd>
<dt id="refinery.units.blockwise.BlockTransformationBase.fbits"><code class="name">var <span class="ident">fbits</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L79-L81" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def fbits(self):
    return 8 * self.precision</code></pre>
</details>
</dd>
<dt id="refinery.units.blockwise.BlockTransformationBase.fmask"><code class="name">var <span class="ident">fmask</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L83-L88" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def fmask(self) -&gt; int | Literal[NoMask]:
    fbits = self.fbits
    if fbits == INF:
        return NoMask
    return (1 &lt;&lt; fbits) - 1</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="refinery.units.blockwise.BlockTransformationBase.rest"><code class="name flex">
<span>def <span class="ident">rest</span></span>(<span>self, data)</span>
</code></dt>
<dd>
<section class="desc"><p>Returns all excess bytes at the end of the input data that do not form a full block, based on
the current operational block size of the unit.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L90-L98" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def rest(self, data: bytearray):
    &#34;&#34;&#34;
    Returns all excess bytes at the end of the input data that do not form a full block, based on
    the current operational block size of the unit.
    &#34;&#34;&#34;
    if self.bytestream:
        return B&#39;&#39;
    end = self.blocksize * (len(data) // self.blocksize)
    return data[end:]</code></pre>
</details>
</dd>
<dt id="refinery.units.blockwise.BlockTransformationBase.chunk_into_bytes"><code class="name flex">
<span>def <span class="ident">chunk_into_bytes</span></span>(<span>self, data)</span>
</code></dt>
<dd>
<section class="desc"><p>Returns an iterator over the blocks of the input data according to the current operational block
size. The blocks are returned as slices of the input data. Note that zero bytes may be appended if
auto padding is enabled.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L100-L115" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def chunk_into_bytes(self, data: buf) -&gt; Generator[buf]:
    &#34;&#34;&#34;
    Returns an iterator over the blocks of the input data according to the current operational block
    size. The blocks are returned as slices of the input data. Note that zero bytes may be appended if
    auto padding is enabled.
    &#34;&#34;&#34;
    n = len(data)
    b = self.blocksize
    m = n - n % b
    for k in range(0, m, b):
        yield data[k : k + b]
    if self._truncate &gt; 0 or m == n:
        return
    last = bytearray(data[m:])
    last.extend(itertools.repeat(0, -n % b))
    yield last</code></pre>
</details>
</dd>
<dt id="refinery.units.blockwise.BlockTransformationBase.chunk"><code class="name flex">
<span>def <span class="ident">chunk</span></span>(<span>self, data)</span>
</code></dt>
<dd>
<section class="desc"><p>Returns an iterator over the blocks of the input data according to the current operational block
size. The blocks are returned as integers that have been parsed out according to the unit's byte
order setting.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L117-L124" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def chunk(self, data: bytearray):
    &#34;&#34;&#34;
    Returns an iterator over the blocks of the input data according to the current operational block
    size. The blocks are returned as integers that have been parsed out according to the unit&#39;s byte
    order setting.
    &#34;&#34;&#34;
    pad = self._truncate &lt; 1
    return chunks.unpack(data, self.blocksize, self.args.bigendian, pad=pad)</code></pre>
</details>
</dd>
<dt id="refinery.units.blockwise.BlockTransformationBase.unchunk"><code class="name flex">
<span>def <span class="ident">unchunk</span></span>(<span>self, data)</span>
</code></dt>
<dd>
<section class="desc"><p>Convert an iterable of integer blocks into a byte string representation based on the operational
block size and byte order settings of the unit.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L126-L134" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def unchunk(self, data: Iterable[int]):
    &#34;&#34;&#34;
    Convert an iterable of integer blocks into a byte string representation based on the operational
    block size and byte order settings of the unit.
    &#34;&#34;&#34;
    if self.precision &gt; self.blocksize:
        mask = (1 &lt;&lt; (8 * self.blocksize)) - 1
        data = (chunk &amp; mask for chunk in data)
    return chunks.pack(data, self.blocksize, self.args.bigendian)</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="refinery.units.Unit" href="../index.html#refinery.units.Unit">Unit</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.Unit.Requires" href="../index.html#refinery.units.Unit.Requires">Requires</a></code></li>
<li><code><a title="refinery.units.Unit.assemble" href="../index.html#refinery.units.Unit.assemble">assemble</a></code></li>
<li><code><a title="refinery.units.Unit.finish" href="../index.html#refinery.units.UnitBase.finish">finish</a></code></li>
<li><code><a title="refinery.units.Unit.handles" href="../index.html#refinery.units.UnitBase.handles">handles</a></code></li>
<li><code><a title="refinery.units.Unit.is_quiet" href="../index.html#refinery.units.Unit.is_quiet">is_quiet</a></code></li>
<li><code><a title="refinery.units.Unit.labelled" href="../index.html#refinery.units.Unit.labelled">labelled</a></code></li>
<li><code><a title="refinery.units.Unit.leniency" href="../index.html#refinery.units.Unit.leniency">leniency</a></code></li>
<li><code><a title="refinery.units.Unit.log_always" href="../index.html#refinery.units.Unit.log_always">log_always</a></code></li>
<li><code><a title="refinery.units.Unit.log_debug" href="../index.html#refinery.units.Unit.log_debug">log_debug</a></code></li>
<li><code><a title="refinery.units.Unit.log_detach" href="../index.html#refinery.units.Unit.log_detach">log_detach</a></code></li>
<li><code><a title="refinery.units.Unit.log_fail" href="../index.html#refinery.units.Unit.log_fail">log_fail</a></code></li>
<li><code><a title="refinery.units.Unit.log_info" href="../index.html#refinery.units.Unit.log_info">log_info</a></code></li>
<li><code><a title="refinery.units.Unit.log_level" href="../index.html#refinery.units.Unit.log_level">log_level</a></code></li>
<li><code><a title="refinery.units.Unit.log_warn" href="../index.html#refinery.units.Unit.log_warn">log_warn</a></code></li>
<li><code><a title="refinery.units.Unit.nozzle" href="../index.html#refinery.units.Unit.nozzle">nozzle</a></code></li>
<li><code><a title="refinery.units.Unit.read" href="../index.html#refinery.units.Unit.read">read</a></code></li>
<li><code><a title="refinery.units.Unit.read1" href="../index.html#refinery.units.Unit.read1">read1</a></code></li>
<li><code><a title="refinery.units.Unit.run" href="../index.html#refinery.units.Unit.run">run</a></code></li>
<li><code><a title="refinery.units.Unit.source" href="../index.html#refinery.units.Unit.source">source</a></code></li>
<li><code><a title="refinery.units.Unit.superinit" href="../index.html#refinery.units.Unit.superinit">superinit</a></code></li>
</ul>
</li>
<li><code><b><a title="refinery.units.UnitBase" href="../index.html#refinery.units.UnitBase">UnitBase</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.UnitBase.filter" href="../index.html#refinery.units.UnitBase.filter">filter</a></code></li>
<li><code><a title="refinery.units.UnitBase.process" href="../index.html#refinery.units.UnitBase.process">process</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="refinery.units.blockwise.BlockTransformation"><code class="flex name class">
<span>class <span class="ident">BlockTransformation</span></span>
<span>(</span><span>bigendian=False, blocksize=1, precision=-1, **keywords)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L137-L156" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class BlockTransformation(BlockTransformationBase, abstract=True):

    def process(self, data):
        work = self.process_block
        size = len(data)
        temp = (work(b) for b in self.chunk(data))
        out = self.unchunk(temp)
        if self._truncate &lt; 1:
            del out[size:]
        elif self._truncate &lt; 2:
            out.extend(self.rest(data))
        return out

    @abc.abstractmethod
    def process_block(self, block):
        &#34;&#34;&#34;
        A blockwise operation implements this routine to process each block, which
        is given as an integer. The return value is also expected to be an integer.
        &#34;&#34;&#34;
        raise NotImplementedError</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.units.blockwise.BlockTransformationBase" href="#refinery.units.blockwise.BlockTransformationBase">BlockTransformationBase</a></li>
<li><a title="refinery.units.Unit" href="../index.html#refinery.units.Unit">Unit</a></li>
<li><a title="refinery.units.UnitBase" href="../index.html#refinery.units.UnitBase">UnitBase</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="refinery.units.blockwise.ArithmeticUnit" href="#refinery.units.blockwise.ArithmeticUnit">ArithmeticUnit</a></li>
<li><a title="refinery.units.blockwise.map.map" href="map.html#refinery.units.blockwise.map.map">map</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.units.blockwise.BlockTransformation.required_dependencies"><code class="name">var <span class="ident">required_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.BlockTransformation.optional_dependencies"><code class="name">var <span class="ident">optional_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.BlockTransformation.console"><code class="name">var <span class="ident">console</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="refinery.units.blockwise.BlockTransformation.process_block"><code class="name flex">
<span>def <span class="ident">process_block</span></span>(<span>self, block)</span>
</code></dt>
<dd>
<section class="desc"><p>A blockwise operation implements this routine to process each block, which
is given as an integer. The return value is also expected to be an integer.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L150-L156" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@abc.abstractmethod
def process_block(self, block):
    &#34;&#34;&#34;
    A blockwise operation implements this routine to process each block, which
    is given as an integer. The return value is also expected to be an integer.
    &#34;&#34;&#34;
    raise NotImplementedError</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="refinery.units.blockwise.BlockTransformationBase" href="#refinery.units.blockwise.BlockTransformationBase">BlockTransformationBase</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.Requires" href="../index.html#refinery.units.Unit.Requires">Requires</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.assemble" href="../index.html#refinery.units.Unit.assemble">assemble</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.bytestream" href="#refinery.units.blockwise.BlockTransformationBase.bytestream">bytestream</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.chunk" href="#refinery.units.blockwise.BlockTransformationBase.chunk">chunk</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.chunk_into_bytes" href="#refinery.units.blockwise.BlockTransformationBase.chunk_into_bytes">chunk_into_bytes</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.filter" href="../index.html#refinery.units.UnitBase.filter">filter</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.finish" href="../index.html#refinery.units.UnitBase.finish">finish</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.handles" href="../index.html#refinery.units.UnitBase.handles">handles</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.is_quiet" href="../index.html#refinery.units.Unit.is_quiet">is_quiet</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.labelled" href="../index.html#refinery.units.Unit.labelled">labelled</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.leniency" href="../index.html#refinery.units.Unit.leniency">leniency</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.log_always" href="../index.html#refinery.units.Unit.log_always">log_always</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.log_debug" href="../index.html#refinery.units.Unit.log_debug">log_debug</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.log_detach" href="../index.html#refinery.units.Unit.log_detach">log_detach</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.log_fail" href="../index.html#refinery.units.Unit.log_fail">log_fail</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.log_info" href="../index.html#refinery.units.Unit.log_info">log_info</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.log_level" href="../index.html#refinery.units.Unit.log_level">log_level</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.log_warn" href="../index.html#refinery.units.Unit.log_warn">log_warn</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.nozzle" href="../index.html#refinery.units.Unit.nozzle">nozzle</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.process" href="../index.html#refinery.units.UnitBase.process">process</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.read" href="../index.html#refinery.units.Unit.read">read</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.read1" href="../index.html#refinery.units.Unit.read1">read1</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.rest" href="#refinery.units.blockwise.BlockTransformationBase.rest">rest</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.run" href="../index.html#refinery.units.Unit.run">run</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.source" href="../index.html#refinery.units.Unit.source">source</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.superinit" href="../index.html#refinery.units.Unit.superinit">superinit</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.unchunk" href="#refinery.units.blockwise.BlockTransformationBase.unchunk">unchunk</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="refinery.units.blockwise.ArithmeticUnit"><code class="flex name class">
<span>class <span class="ident">ArithmeticUnit</span></span>
<span>(</span><span>*argument, bigendian=False, blocksize=1, precision=-1, **kw)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L159-L349" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class ArithmeticUnit(BlockTransformation, abstract=True):

    def __init__(self, *argument: Param[isq, Arg.NumSeq(help=(
        &#39;A single numeric expression which provides the right argument to the operation, &#39;
        &#39;where the left argument is each block in the input data. This argument can also &#39;
        &#39;contain a sequence of bytes which is then split into blocks of the same size as &#39;
        &#39;the input data and used cyclically.&#39;))],
        bigendian=False, blocksize=1, precision=-1, **kw
    ):
        super().__init__(bigendian=bigendian, blocksize=blocksize, precision=precision, argument=argument, **kw)

    def _argument_parse_hook(self, it: _I) -&gt; tuple[_I, bool]:
        return it, False

    def _infinitize_argument(self, min_size: int, it: _I, masked=False) -&gt; Iterable[int]:
        def _mask(it):
            warnings = 3
            for block in it:
                out = block &amp; self.fmask
                if warnings and out != block:
                    warnings -= 1
                    self.log_warn(F&#39;reduced argument to 0x{out:0{self.fbits // 4}X}; original value was 0x{block:X}&#39;)
                    if not warnings:
                        self.log_warn(&#39;additional warnings are suppressed&#39;)
                yield out
        if isinstance(it, (bytes, bytearray)) and (n := len(it)) &gt; 0x400:
            quotient, remainder = divmod(min_size, n)
            if remainder &gt; 0:
                quotient += 1
            if quotient &gt; 1:
                it = it * quotient
            return it
        if isinstance(it, int):
            it = (it,)
        if not masked:
            it = _mask(it)
        return infinitize(it)

    @abc.abstractmethod
    def operate(self, block, *args) -&gt; int:
        raise NotImplementedError

    @abc.abstractmethod
    def inplace(self, block: ndarray, *args) -&gt; ndarray | None:
        tmp: ndarray = self.operate(block, *args)
        if tmp.dtype != block.dtype:
            tmp = tmp.astype(block.dtype)
        block[:] = tmp

    @Unit.Requires(&#39;numpy&#39;, [&#39;speed&#39;, &#39;default&#39;, &#39;extended&#39;])
    def _numpy():
        import numpy
        return numpy

    def _fastblock(self, data) -&gt; bytes | bytearray:
        &#34;&#34;&#34;
        Attempts to perform the operation more quickly by using numpy arrays.
        &#34;&#34;&#34;
        try:
            numpy = self._numpy
        except ImportError as IE:
            raise FastBlockError from IE

        self.log_debug(&#39;fastblock: parsing and extending arguments&#39;)

        def _execute_hooks():
            for a in self.args.argument:
                it, masked = self._argument_parse_hook(a)
                na = self._infinitize_argument(len(data), it, masked)
                yield it, masked, na

        _hooks_executed = list(_execute_hooks())

        byte_order = self._byte_order_symbol
        num_blocks = len(data) // self.blocksize

        try:
            if self.precision is INF:
                # NumPy type for Python Objects
                dtype = numpy.dtype(&#39;O&#39;)
            else:
                dtype = numpy.dtype(F&#39;{byte_order}u{self.precision!s}&#39;)
        except TypeError as T:
            raise FastBlockError from T

        br_args = []
        np_args = []

        for it, masked, na in _hooks_executed:
            br_args.append(na)
            if isinstance(it, int):
                if not masked:
                    it &amp;= self.fmask
                npa = int(it)
            elif self.precision is INF:
                npa = numpy.array(list(itertools.islice(na, num_blocks)), dtype=dtype)
            elif nb := asbuffer(na):
                npa = numpy.frombuffer(nb, dtype, num_blocks)
            else:
                npa = numpy.fromiter(na, dtype, num_blocks)
            np_args.append(npa)

        if (_truncate := self._truncate) &gt;= 2 or (_t := len(data) - num_blocks * self.blocksize) &lt;= 0:
            rest = ()
        else:
            rest = data[-_t:]
            if _truncate &lt; 1:
                last_ops = [next(a) for a in br_args]
                last_int = int.from_bytes(rest, self._byte_order_adjective)
                dst_tail = self.operate(last_int, *last_ops) &amp; self.fmask
                dst_tail = dst_tail.to_bytes(self.blocksize, self._byte_order_adjective)
                rest = dst_tail[:_t]

        try:
            stype = numpy.dtype(F&#39;{byte_order}u{self.blocksize}&#39;)
        except TypeError as T:
            raise FastBlockError from T

        if not isinstance(data, bytearray):
            data = bytearray(data)

        self.log_debug(F&#39;fastblock: loading {num_blocks} blocks of type {stype} from source data&#39;)

        dst = data
        src = numpy.frombuffer(dst, stype, num_blocks)
        if stype != dtype:
            src = src.astype(dtype)

        tmp = self.inplace(src, *np_args)

        if tmp is not None:
            src = tmp
            dst = None
        if stype != dtype:
            src = src.astype(stype)
            dst = None

        mem = memoryview(src)

        if dst is None:
            dst = bytearray(mem)
        elif (n := mem.nbytes) &lt; len(dst):
            del tmp
            del mem
            del src
            try:
                del dst[n:]
            except BufferError:
                import gc
                gc.collect()
                del dst[n:]

        dst.extend(rest)
        return dst

    def process(self, data):
        try:
            self.log_debug(&#39;attempting to process input using numpy method&#39;)
            result = self._fastblock(data)
        except FastBlockError:
            pass
        except Exception as error:
            if self.log_debug():
                raise
            self.log_warn(&#39;falling back to default method after fast block failed with error:&#39;, error)
        else:
            self.log_debug(&#39;fast block method successful&#39;)
            return result
        arguments = [
            self._infinitize_argument(len(data), *self._argument_parse_hook(a))
            for a in self.args.argument]
        try:
            mask = self.fmask
            size = len(data)
            if mask is NoMask:
                mask = None
            spread = iterspread(self.operate, self.chunk(data), *arguments, mask=mask)
            out = self.unchunk(spread(self))
            if self._truncate &lt; 1:
                del out[size:]
            elif self._truncate &lt; 2:
                out.extend(self.rest(data))
            return out
        except Exception as E:
            self.log_warn(F&#39;unable to inline this operation: {E!s}&#39;)
            self.log_warn(R&#39;falling back all the way to failsafe method&#39;)
            self._arg = arguments
            return super().process(data)

    def process_block(self, block):
        return self.operate(block, *(next(a) for a in self._arg)) &amp; self.fmask</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.units.blockwise.BlockTransformation" href="#refinery.units.blockwise.BlockTransformation">BlockTransformation</a></li>
<li><a title="refinery.units.blockwise.BlockTransformationBase" href="#refinery.units.blockwise.BlockTransformationBase">BlockTransformationBase</a></li>
<li><a title="refinery.units.Unit" href="../index.html#refinery.units.Unit">Unit</a></li>
<li><a title="refinery.units.UnitBase" href="../index.html#refinery.units.UnitBase">UnitBase</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="refinery.units.blockwise.BinaryOperation" href="#refinery.units.blockwise.BinaryOperation">BinaryOperation</a></li>
<li><a title="refinery.units.blockwise.UnaryOperation" href="#refinery.units.blockwise.UnaryOperation">UnaryOperation</a></li>
<li><a title="refinery.units.blockwise.alu.alu" href="alu.html#refinery.units.blockwise.alu.alu">alu</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.units.blockwise.ArithmeticUnit.required_dependencies"><code class="name">var <span class="ident">required_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.ArithmeticUnit.console"><code class="name">var <span class="ident">console</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.ArithmeticUnit.optional_dependencies"><code class="name">var <span class="ident">optional_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="refinery.units.blockwise.ArithmeticUnit.operate"><code class="name flex">
<span>def <span class="ident">operate</span></span>(<span>self, block, *args)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L197-L199" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@abc.abstractmethod
def operate(self, block, *args) -&gt; int:
    raise NotImplementedError</code></pre>
</details>
</dd>
<dt id="refinery.units.blockwise.ArithmeticUnit.inplace"><code class="name flex">
<span>def <span class="ident">inplace</span></span>(<span>self, block, *args)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L201-L206" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@abc.abstractmethod
def inplace(self, block: ndarray, *args) -&gt; ndarray | None:
    tmp: ndarray = self.operate(block, *args)
    if tmp.dtype != block.dtype:
        tmp = tmp.astype(block.dtype)
    block[:] = tmp</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="refinery.units.blockwise.BlockTransformation" href="#refinery.units.blockwise.BlockTransformation">BlockTransformation</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.blockwise.BlockTransformation.Requires" href="../index.html#refinery.units.Unit.Requires">Requires</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.assemble" href="../index.html#refinery.units.Unit.assemble">assemble</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.bytestream" href="#refinery.units.blockwise.BlockTransformationBase.bytestream">bytestream</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.chunk" href="#refinery.units.blockwise.BlockTransformationBase.chunk">chunk</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.chunk_into_bytes" href="#refinery.units.blockwise.BlockTransformationBase.chunk_into_bytes">chunk_into_bytes</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.filter" href="../index.html#refinery.units.UnitBase.filter">filter</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.finish" href="../index.html#refinery.units.UnitBase.finish">finish</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.handles" href="../index.html#refinery.units.UnitBase.handles">handles</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.is_quiet" href="../index.html#refinery.units.Unit.is_quiet">is_quiet</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.labelled" href="../index.html#refinery.units.Unit.labelled">labelled</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.leniency" href="../index.html#refinery.units.Unit.leniency">leniency</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.log_always" href="../index.html#refinery.units.Unit.log_always">log_always</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.log_debug" href="../index.html#refinery.units.Unit.log_debug">log_debug</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.log_detach" href="../index.html#refinery.units.Unit.log_detach">log_detach</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.log_fail" href="../index.html#refinery.units.Unit.log_fail">log_fail</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.log_info" href="../index.html#refinery.units.Unit.log_info">log_info</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.log_level" href="../index.html#refinery.units.Unit.log_level">log_level</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.log_warn" href="../index.html#refinery.units.Unit.log_warn">log_warn</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.nozzle" href="../index.html#refinery.units.Unit.nozzle">nozzle</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.process_block" href="#refinery.units.blockwise.BlockTransformation.process_block">process_block</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.read" href="../index.html#refinery.units.Unit.read">read</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.read1" href="../index.html#refinery.units.Unit.read1">read1</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.rest" href="#refinery.units.blockwise.BlockTransformationBase.rest">rest</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.run" href="../index.html#refinery.units.Unit.run">run</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.source" href="../index.html#refinery.units.Unit.source">source</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.superinit" href="../index.html#refinery.units.Unit.superinit">superinit</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformation.unchunk" href="#refinery.units.blockwise.BlockTransformationBase.unchunk">unchunk</a></code></li>
</ul>
</li>
<li><code><b><a title="refinery.units.blockwise.BlockTransformationBase" href="#refinery.units.blockwise.BlockTransformationBase">BlockTransformationBase</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.process" href="../index.html#refinery.units.UnitBase.process">process</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="refinery.units.blockwise.UnaryOperation"><code class="flex name class">
<span>class <span class="ident">UnaryOperation</span></span>
<span>(</span><span>bigendian=False, blocksize=1, **kw)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L352-L358" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class UnaryOperation(ArithmeticUnit, abstract=True):
    def __init__(self, bigendian=False, blocksize=1, **kw):
        super().__init__(
            bigendian=bigendian, blocksize=blocksize, **kw)

    def inplace(self, block) -&gt; None:
        super().inplace(block)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.units.blockwise.ArithmeticUnit" href="#refinery.units.blockwise.ArithmeticUnit">ArithmeticUnit</a></li>
<li><a title="refinery.units.blockwise.BlockTransformation" href="#refinery.units.blockwise.BlockTransformation">BlockTransformation</a></li>
<li><a title="refinery.units.blockwise.BlockTransformationBase" href="#refinery.units.blockwise.BlockTransformationBase">BlockTransformationBase</a></li>
<li><a title="refinery.units.Unit" href="../index.html#refinery.units.Unit">Unit</a></li>
<li><a title="refinery.units.UnitBase" href="../index.html#refinery.units.UnitBase">UnitBase</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="refinery.units.blockwise.bitrev.bitrev" href="bitrev.html#refinery.units.blockwise.bitrev.bitrev">bitrev</a></li>
<li><a title="refinery.units.blockwise.byteswap.byteswap" href="byteswap.html#refinery.units.blockwise.byteswap.byteswap">byteswap</a></li>
<li><a title="refinery.units.blockwise.neg.neg" href="neg.html#refinery.units.blockwise.neg.neg">neg</a></li>
<li><a title="refinery.units.blockwise.rev.rev" href="rev.html#refinery.units.blockwise.rev.rev">rev</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.units.blockwise.UnaryOperation.required_dependencies"><code class="name">var <span class="ident">required_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.UnaryOperation.optional_dependencies"><code class="name">var <span class="ident">optional_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.UnaryOperation.console"><code class="name">var <span class="ident">console</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="refinery.units.blockwise.UnaryOperation.inplace"><code class="name flex">
<span>def <span class="ident">inplace</span></span>(<span>self, block)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L357-L358" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def inplace(self, block) -&gt; None:
    super().inplace(block)</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="refinery.units.blockwise.ArithmeticUnit" href="#refinery.units.blockwise.ArithmeticUnit">ArithmeticUnit</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.Requires" href="../index.html#refinery.units.Unit.Requires">Requires</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.assemble" href="../index.html#refinery.units.Unit.assemble">assemble</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.bytestream" href="#refinery.units.blockwise.BlockTransformationBase.bytestream">bytestream</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.chunk" href="#refinery.units.blockwise.BlockTransformationBase.chunk">chunk</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.chunk_into_bytes" href="#refinery.units.blockwise.BlockTransformationBase.chunk_into_bytes">chunk_into_bytes</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.filter" href="../index.html#refinery.units.UnitBase.filter">filter</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.finish" href="../index.html#refinery.units.UnitBase.finish">finish</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.handles" href="../index.html#refinery.units.UnitBase.handles">handles</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.is_quiet" href="../index.html#refinery.units.Unit.is_quiet">is_quiet</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.labelled" href="../index.html#refinery.units.Unit.labelled">labelled</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.leniency" href="../index.html#refinery.units.Unit.leniency">leniency</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_always" href="../index.html#refinery.units.Unit.log_always">log_always</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_debug" href="../index.html#refinery.units.Unit.log_debug">log_debug</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_detach" href="../index.html#refinery.units.Unit.log_detach">log_detach</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_fail" href="../index.html#refinery.units.Unit.log_fail">log_fail</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_info" href="../index.html#refinery.units.Unit.log_info">log_info</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_level" href="../index.html#refinery.units.Unit.log_level">log_level</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_warn" href="../index.html#refinery.units.Unit.log_warn">log_warn</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.nozzle" href="../index.html#refinery.units.Unit.nozzle">nozzle</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.process_block" href="#refinery.units.blockwise.BlockTransformation.process_block">process_block</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.read" href="../index.html#refinery.units.Unit.read">read</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.read1" href="../index.html#refinery.units.Unit.read1">read1</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.rest" href="#refinery.units.blockwise.BlockTransformationBase.rest">rest</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.run" href="../index.html#refinery.units.Unit.run">run</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.source" href="../index.html#refinery.units.Unit.source">source</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.superinit" href="../index.html#refinery.units.Unit.superinit">superinit</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.unchunk" href="#refinery.units.blockwise.BlockTransformationBase.unchunk">unchunk</a></code></li>
</ul>
</li>
<li><code><b><a title="refinery.units.blockwise.BlockTransformationBase" href="#refinery.units.blockwise.BlockTransformationBase">BlockTransformationBase</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.process" href="../index.html#refinery.units.UnitBase.process">process</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="refinery.units.blockwise.BinaryOperation"><code class="flex name class">
<span>class <span class="ident">BinaryOperation</span></span>
<span>(</span><span>*argument, bigendian=False, blocksize=1)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L361-L366" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class BinaryOperation(ArithmeticUnit, abstract=True):
    def __init__(self, *argument, bigendian=False, blocksize=1):
        super().__init__(*argument, bigendian=bigendian, blocksize=blocksize)

    def inplace(self, block, argument) -&gt; None:
        super().inplace(block, argument)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.units.blockwise.ArithmeticUnit" href="#refinery.units.blockwise.ArithmeticUnit">ArithmeticUnit</a></li>
<li><a title="refinery.units.blockwise.BlockTransformation" href="#refinery.units.blockwise.BlockTransformation">BlockTransformation</a></li>
<li><a title="refinery.units.blockwise.BlockTransformationBase" href="#refinery.units.blockwise.BlockTransformationBase">BlockTransformationBase</a></li>
<li><a title="refinery.units.Unit" href="../index.html#refinery.units.Unit">Unit</a></li>
<li><a title="refinery.units.UnitBase" href="../index.html#refinery.units.UnitBase">UnitBase</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="refinery.units.blockwise.BinaryOperationWithAutoBlockAdjustment" href="#refinery.units.blockwise.BinaryOperationWithAutoBlockAdjustment">BinaryOperationWithAutoBlockAdjustment</a></li>
<li><a title="refinery.units.blockwise.rotl.rotl" href="rotl.html#refinery.units.blockwise.rotl.rotl">rotl</a></li>
<li><a title="refinery.units.blockwise.rotr.rotr" href="rotr.html#refinery.units.blockwise.rotr.rotr">rotr</a></li>
<li><a title="refinery.units.blockwise.shl.shl" href="shl.html#refinery.units.blockwise.shl.shl">shl</a></li>
<li><a title="refinery.units.blockwise.shr.shr" href="shr.html#refinery.units.blockwise.shr.shr">shr</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.units.blockwise.BinaryOperation.required_dependencies"><code class="name">var <span class="ident">required_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.BinaryOperation.optional_dependencies"><code class="name">var <span class="ident">optional_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.BinaryOperation.console"><code class="name">var <span class="ident">console</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="refinery.units.blockwise.BinaryOperation.inplace"><code class="name flex">
<span>def <span class="ident">inplace</span></span>(<span>self, block, argument)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L365-L366" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def inplace(self, block, argument) -&gt; None:
    super().inplace(block, argument)</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="refinery.units.blockwise.ArithmeticUnit" href="#refinery.units.blockwise.ArithmeticUnit">ArithmeticUnit</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.Requires" href="../index.html#refinery.units.Unit.Requires">Requires</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.assemble" href="../index.html#refinery.units.Unit.assemble">assemble</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.bytestream" href="#refinery.units.blockwise.BlockTransformationBase.bytestream">bytestream</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.chunk" href="#refinery.units.blockwise.BlockTransformationBase.chunk">chunk</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.chunk_into_bytes" href="#refinery.units.blockwise.BlockTransformationBase.chunk_into_bytes">chunk_into_bytes</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.filter" href="../index.html#refinery.units.UnitBase.filter">filter</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.finish" href="../index.html#refinery.units.UnitBase.finish">finish</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.handles" href="../index.html#refinery.units.UnitBase.handles">handles</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.is_quiet" href="../index.html#refinery.units.Unit.is_quiet">is_quiet</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.labelled" href="../index.html#refinery.units.Unit.labelled">labelled</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.leniency" href="../index.html#refinery.units.Unit.leniency">leniency</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_always" href="../index.html#refinery.units.Unit.log_always">log_always</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_debug" href="../index.html#refinery.units.Unit.log_debug">log_debug</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_detach" href="../index.html#refinery.units.Unit.log_detach">log_detach</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_fail" href="../index.html#refinery.units.Unit.log_fail">log_fail</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_info" href="../index.html#refinery.units.Unit.log_info">log_info</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_level" href="../index.html#refinery.units.Unit.log_level">log_level</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.log_warn" href="../index.html#refinery.units.Unit.log_warn">log_warn</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.nozzle" href="../index.html#refinery.units.Unit.nozzle">nozzle</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.process_block" href="#refinery.units.blockwise.BlockTransformation.process_block">process_block</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.read" href="../index.html#refinery.units.Unit.read">read</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.read1" href="../index.html#refinery.units.Unit.read1">read1</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.rest" href="#refinery.units.blockwise.BlockTransformationBase.rest">rest</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.run" href="../index.html#refinery.units.Unit.run">run</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.source" href="../index.html#refinery.units.Unit.source">source</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.superinit" href="../index.html#refinery.units.Unit.superinit">superinit</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.unchunk" href="#refinery.units.blockwise.BlockTransformationBase.unchunk">unchunk</a></code></li>
</ul>
</li>
<li><code><b><a title="refinery.units.blockwise.BlockTransformationBase" href="#refinery.units.blockwise.BlockTransformationBase">BlockTransformationBase</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.process" href="../index.html#refinery.units.UnitBase.process">process</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="refinery.units.blockwise.BinaryOperationWithAutoBlockAdjustment"><code class="flex name class">
<span>class <span class="ident">BinaryOperationWithAutoBlockAdjustment</span></span>
<span>(</span><span>*argument, bigendian=False, blocksize=0)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L369-L414" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class BinaryOperationWithAutoBlockAdjustment(BinaryOperation, abstract=True):
    def __init__(
        self, *argument, bigendian=False,
        blocksize: Param[int, Arg.Number(help=(
            &#39;The size of each block in bytes. It is chosen, by default, to be the smallest size that can &#39;
            &#39;hold the provided argument without loss of precision. For example, passing the value 0x1234 &#39;
            &#39;will result in a default block size of 2, while passing the value 12 will mean that the &#39;
            &#39;default block size is 1.&#39;
        ))] = 0
    ):
        super().__init__(*argument, bigendian=bigendian, blocksize=blocksize)

    def _argument_parse_hook(self, it: _I) -&gt; tuple[_I, bool]:
        try:
            n = len(it)
        except TypeError:
            pass
        else:
            if n == 1:
                it = it[0]
        if masked := isinstance(it, int):
            if not self.args.blocksize:
                self.log_debug(&#39;detected numeric argument with no specified block size&#39;)
                bits = it.bit_length()
                if bits &gt; self.blocksize * 8:
                    length, r = divmod(bits, 8)
                    length += int(bool(r))
                    self.log_info(F&#39;setting block size to {length} based on the argument bit size&#39;)
                    self._blocksize = length
            else:
                it &amp;= self.fmask
        return it, masked

    @property
    def blocksize(self):
        try:
            blocksize = self._blocksize
        except AttributeError:
            blocksize = 0
        return blocksize or super().blocksize

    def process(self, data):
        try:
            return super().process(data)
        finally:
            self._blocksize = 0</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.units.blockwise.BinaryOperation" href="#refinery.units.blockwise.BinaryOperation">BinaryOperation</a></li>
<li><a title="refinery.units.blockwise.ArithmeticUnit" href="#refinery.units.blockwise.ArithmeticUnit">ArithmeticUnit</a></li>
<li><a title="refinery.units.blockwise.BlockTransformation" href="#refinery.units.blockwise.BlockTransformation">BlockTransformation</a></li>
<li><a title="refinery.units.blockwise.BlockTransformationBase" href="#refinery.units.blockwise.BlockTransformationBase">BlockTransformationBase</a></li>
<li><a title="refinery.units.Unit" href="../index.html#refinery.units.Unit">Unit</a></li>
<li><a title="refinery.units.UnitBase" href="../index.html#refinery.units.UnitBase">UnitBase</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="refinery.units.blockwise.add.add" href="add.html#refinery.units.blockwise.add.add">add</a></li>
<li><a title="refinery.units.blockwise.sub.sub" href="sub.html#refinery.units.blockwise.sub.sub">sub</a></li>
<li><a title="refinery.units.blockwise.xor.xor" href="xor.html#refinery.units.blockwise.xor.xor">xor</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.units.blockwise.BinaryOperationWithAutoBlockAdjustment.required_dependencies"><code class="name">var <span class="ident">required_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.BinaryOperationWithAutoBlockAdjustment.optional_dependencies"><code class="name">var <span class="ident">optional_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.blockwise.BinaryOperationWithAutoBlockAdjustment.console"><code class="name">var <span class="ident">console</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.units.blockwise.BinaryOperationWithAutoBlockAdjustment.blocksize"><code class="name">var <span class="ident">blocksize</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/blockwise/__init__.py#L402-L408" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def blocksize(self):
    try:
        blocksize = self._blocksize
    except AttributeError:
        blocksize = 0
    return blocksize or super().blocksize</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="refinery.units.blockwise.BinaryOperation" href="#refinery.units.blockwise.BinaryOperation">BinaryOperation</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.blockwise.BinaryOperation.Requires" href="../index.html#refinery.units.Unit.Requires">Requires</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.assemble" href="../index.html#refinery.units.Unit.assemble">assemble</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.bytestream" href="#refinery.units.blockwise.BlockTransformationBase.bytestream">bytestream</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.chunk" href="#refinery.units.blockwise.BlockTransformationBase.chunk">chunk</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.chunk_into_bytes" href="#refinery.units.blockwise.BlockTransformationBase.chunk_into_bytes">chunk_into_bytes</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.filter" href="../index.html#refinery.units.UnitBase.filter">filter</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.finish" href="../index.html#refinery.units.UnitBase.finish">finish</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.handles" href="../index.html#refinery.units.UnitBase.handles">handles</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.is_quiet" href="../index.html#refinery.units.Unit.is_quiet">is_quiet</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.labelled" href="../index.html#refinery.units.Unit.labelled">labelled</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.leniency" href="../index.html#refinery.units.Unit.leniency">leniency</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.log_always" href="../index.html#refinery.units.Unit.log_always">log_always</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.log_debug" href="../index.html#refinery.units.Unit.log_debug">log_debug</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.log_detach" href="../index.html#refinery.units.Unit.log_detach">log_detach</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.log_fail" href="../index.html#refinery.units.Unit.log_fail">log_fail</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.log_info" href="../index.html#refinery.units.Unit.log_info">log_info</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.log_level" href="../index.html#refinery.units.Unit.log_level">log_level</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.log_warn" href="../index.html#refinery.units.Unit.log_warn">log_warn</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.nozzle" href="../index.html#refinery.units.Unit.nozzle">nozzle</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.process" href="../index.html#refinery.units.UnitBase.process">process</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.process_block" href="#refinery.units.blockwise.BlockTransformation.process_block">process_block</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.read" href="../index.html#refinery.units.Unit.read">read</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.read1" href="../index.html#refinery.units.Unit.read1">read1</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.rest" href="#refinery.units.blockwise.BlockTransformationBase.rest">rest</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.run" href="../index.html#refinery.units.Unit.run">run</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.source" href="../index.html#refinery.units.Unit.source">source</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.superinit" href="../index.html#refinery.units.Unit.superinit">superinit</a></code></li>
<li><code><a title="refinery.units.blockwise.BinaryOperation.unchunk" href="#refinery.units.blockwise.BlockTransformationBase.unchunk">unchunk</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="refinery.units" href="../index.html">refinery.units</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="refinery.units.blockwise.add" href="add.html">refinery.units.blockwise.add</a></code></li>
<li><code><a title="refinery.units.blockwise.alu" href="alu.html">refinery.units.blockwise.alu</a></code></li>
<li><code><a title="refinery.units.blockwise.bitrev" href="bitrev.html">refinery.units.blockwise.bitrev</a></code></li>
<li><code><a title="refinery.units.blockwise.bitsnip" href="bitsnip.html">refinery.units.blockwise.bitsnip</a></code></li>
<li><code><a title="refinery.units.blockwise.byteswap" href="byteswap.html">refinery.units.blockwise.byteswap</a></code></li>
<li><code><a title="refinery.units.blockwise.map" href="map.html">refinery.units.blockwise.map</a></code></li>
<li><code><a title="refinery.units.blockwise.neg" href="neg.html">refinery.units.blockwise.neg</a></code></li>
<li><code><a title="refinery.units.blockwise.pack" href="pack.html">refinery.units.blockwise.pack</a></code></li>
<li><code><a title="refinery.units.blockwise.rev" href="rev.html">refinery.units.blockwise.rev</a></code></li>
<li><code><a title="refinery.units.blockwise.rotl" href="rotl.html">refinery.units.blockwise.rotl</a></code></li>
<li><code><a title="refinery.units.blockwise.rotr" href="rotr.html">refinery.units.blockwise.rotr</a></code></li>
<li><code><a title="refinery.units.blockwise.shl" href="shl.html">refinery.units.blockwise.shl</a></code></li>
<li><code><a title="refinery.units.blockwise.shr" href="shr.html">refinery.units.blockwise.shr</a></code></li>
<li><code><a title="refinery.units.blockwise.sub" href="sub.html">refinery.units.blockwise.sub</a></code></li>
<li><code><a title="refinery.units.blockwise.terminate" href="terminate.html">refinery.units.blockwise.terminate</a></code></li>
<li><code><a title="refinery.units.blockwise.xor" href="xor.html">refinery.units.blockwise.xor</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="refinery.units.blockwise.FastBlockError" href="#refinery.units.blockwise.FastBlockError">FastBlockError</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.units.blockwise.BlockTransformationBase" href="#refinery.units.blockwise.BlockTransformationBase">BlockTransformationBase</a></code></h4>
<ul class="">
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.rest" href="#refinery.units.blockwise.BlockTransformationBase.rest">rest</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.chunk_into_bytes" href="#refinery.units.blockwise.BlockTransformationBase.chunk_into_bytes">chunk_into_bytes</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.chunk" href="#refinery.units.blockwise.BlockTransformationBase.chunk">chunk</a></code></li>
<li><code><a title="refinery.units.blockwise.BlockTransformationBase.unchunk" href="#refinery.units.blockwise.BlockTransformationBase.unchunk">unchunk</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="refinery.units.blockwise.BlockTransformation" href="#refinery.units.blockwise.BlockTransformation">BlockTransformation</a></code></h4>
<ul class="">
<li><code><a title="refinery.units.blockwise.BlockTransformation.process_block" href="#refinery.units.blockwise.BlockTransformation.process_block">process_block</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="refinery.units.blockwise.ArithmeticUnit" href="#refinery.units.blockwise.ArithmeticUnit">ArithmeticUnit</a></code></h4>
<ul class="">
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.operate" href="#refinery.units.blockwise.ArithmeticUnit.operate">operate</a></code></li>
<li><code><a title="refinery.units.blockwise.ArithmeticUnit.inplace" href="#refinery.units.blockwise.ArithmeticUnit.inplace">inplace</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="refinery.units.blockwise.UnaryOperation" href="#refinery.units.blockwise.UnaryOperation">UnaryOperation</a></code></h4>
<ul class="">
<li><code><a title="refinery.units.blockwise.UnaryOperation.inplace" href="#refinery.units.blockwise.UnaryOperation.inplace">inplace</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="refinery.units.blockwise.BinaryOperation" href="#refinery.units.blockwise.BinaryOperation">BinaryOperation</a></code></h4>
<ul class="">
<li><code><a title="refinery.units.blockwise.BinaryOperation.inplace" href="#refinery.units.blockwise.BinaryOperation.inplace">inplace</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="refinery.units.blockwise.BinaryOperationWithAutoBlockAdjustment" href="#refinery.units.blockwise.BinaryOperationWithAutoBlockAdjustment">BinaryOperationWithAutoBlockAdjustment</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>
hljs.configure({languages: []})
hljs.initHighlightingOnLoad()
</script>
</body>
</html>
