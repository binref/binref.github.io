<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.11.6" />
<title>the refinery.units.formats.a3x documentation</title>
<meta name="description" content="On a Mission to Refine Binaries" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow-night-bright.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{background-color:#0D0D0D;color:#EEEEEE;font-size:16pt}@font-face{font-family:"FixedSysEx";src:local('Fixedsys Excelsior 3.01-L2'),local('Fixedsys Excelsior 3.01'),local('FixedSysEx'),url(../../FixedSysEx.ttf) format('truetype')}code,pre,body,html{font-family:FixedSysEx,monospace}b,strong{font-weight:normal}#content{padding:20px}#sidebar{padding:1vw;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #EEEEEE;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}hr{display:none}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#EE8080;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#EEEEEE}// .title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#BB4040}pre code{background:#000000;display:block;padding:1px 0px 4px 0px;line-height:100%}code{background:#000000;padding:1px 0px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#000000;border:0;border-top:1px solid #EEEEEE;border-bottom:1px solid #EEEEEE;margin:1em 0;padding:1ex;overflow-x:auto}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index ul{list-style-type:square;padding:0}// #index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 10px}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#000000;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#0D0D0D}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#EEEEEE;border-left:5px solid #EEEEEE;padding-left:1em}.inheritance em{font-style:normal}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1ch}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition.note,.admonition.info,.admonition.todo,.admonition.versionadded,.admonition.important,.admonition.tip,.admonition.hint{background:#054000}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#998800}.admonition.error,.admonition.danger,.admonition.caution{background:#300000}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:1vw}main{display:flex;flex-direction:row;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #EEEEEE;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>refinery.units.formats.a3x</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L1-L1034" class="git-link">Browse git</a>
</summary>
<pre><code class="python">from __future__ import annotations

import io
import math
import struct

from enum import Enum
from typing import Generator, Iterable, NamedTuple

from refinery.lib.id import buffer_contains
from refinery.lib.structures import MemoryFile, Struct, StructReader
from refinery.lib.tools import date_from_timestamp
from refinery.units.formats import PathExtractorUnit, UnpackResult

A3X_KEYWORDS = [
    &#39;&#39;,
    &#39;And&#39;,
    &#39;Or&#39;,
    &#39;Not&#39;,
    &#39;If&#39;,
    &#39;Then&#39;,
    &#39;Else&#39;,
    &#39;ElseIf&#39;,
    &#39;EndIf&#39;,
    &#39;While&#39;,
    &#39;Wend&#39;,
    &#39;Do&#39;,
    &#39;Until&#39;,
    &#39;For&#39;,
    &#39;Next&#39;,
    &#39;To&#39;,
    &#39;Step&#39;,
    &#39;In&#39;,
    &#39;ExitLoop&#39;,
    &#39;ContinueLoop&#39;,
    &#39;Select&#39;,
    &#39;Case&#39;,
    &#39;EndSelect&#39;,
    &#39;Switch&#39;,
    &#39;EndSwitch&#39;,
    &#39;ContinueCase&#39;,
    &#39;Dim&#39;,
    &#39;ReDim&#39;,
    &#39;Local&#39;,
    &#39;Global&#39;,
    &#39;Const&#39;,
    &#39;Static&#39;,
    &#39;Func&#39;,
    &#39;EndFunc&#39;,
    &#39;Return&#39;,
    &#39;Exit&#39;,
    &#39;ByRef&#39;,
    &#39;With&#39;,
    &#39;EndWith&#39;,
    &#39;True&#39;,
    &#39;False&#39;,
    &#39;Default&#39;,
    &#39;Null&#39;,
    &#39;Volatile&#39;,
    &#39;Enum&#39;,
]

A3X_APICALLS = [
    &#39;Abs&#39;,
    &#39;Acos&#39;,
    &#39;AdlibRegister&#39;,
    &#39;AdlibUnRegister&#39;,
    &#39;Asc&#39;,
    &#39;AscW&#39;,
    &#39;ASin&#39;,
    &#39;Assign&#39;,
    &#39;ATan&#39;,
    &#39;AutoItSetOption&#39;,
    &#39;AutoItWinGetTitle&#39;,
    &#39;AutoItWinSetTitle&#39;,
    &#39;Beep&#39;,
    &#39;Binary&#39;,
    &#39;BinaryLen&#39;,
    &#39;BinaryMid&#39;,
    &#39;BinaryToString&#39;,
    &#39;BitAnd&#39;,
    &#39;BitNot&#39;,
    &#39;BitOR&#39;,
    &#39;BitRotate&#39;,
    &#39;BitShift&#39;,
    &#39;BitXOR&#39;,
    &#39;BlockInput&#39;,
    &#39;Break&#39;,
    &#39;Call&#39;,
    &#39;CDTray&#39;,
    &#39;Ceiling&#39;,
    &#39;Chr&#39;,
    &#39;ChrW&#39;,
    &#39;ClipGet&#39;,
    &#39;ClipPut&#39;,
    &#39;ConsoleRead&#39;,
    &#39;ConsoleWrite&#39;,
    &#39;ConsoleWriteError&#39;,
    &#39;ControlClick&#39;,
    &#39;ControlCommand&#39;,
    &#39;ControlDisable&#39;,
    &#39;ControlEnable&#39;,
    &#39;ControlFocus&#39;,
    &#39;ControlGetFocus&#39;,
    &#39;ControlGetHandle&#39;,
    &#39;ControlGetPos&#39;,
    &#39;ControlGetText&#39;,
    &#39;ControlHide&#39;,
    &#39;ControlListView&#39;,
    &#39;ControlMove&#39;,
    &#39;ControlSend&#39;,
    &#39;ControlSetText&#39;,
    &#39;ControlShow&#39;,
    &#39;ControlTreeView&#39;,
    &#39;Cos&#39;,
    &#39;Dec&#39;,
    &#39;DirCopy&#39;,
    &#39;DirCreate&#39;,
    &#39;DirGetSize&#39;,
    &#39;DirMove&#39;,
    &#39;DirRemove&#39;,
    &#39;DllCall&#39;,
    &#39;DllCallAddress&#39;,
    &#39;DllCallbackFree&#39;,
    &#39;DllCallbackGetPtr&#39;,
    &#39;DllCallbackRegister&#39;,
    &#39;DllClose&#39;,
    &#39;DllOpen&#39;,
    &#39;DllStructCreate&#39;,
    &#39;DllStructGetData&#39;,
    &#39;DllStructGetPtr&#39;,
    &#39;DllStructGetSize&#39;,
    &#39;DllStructSetData&#39;,
    &#39;DriveGetDrive&#39;,
    &#39;DriveGetFilesystem&#39;,
    &#39;DriveGetLabel&#39;,
    &#39;DriveGetSerial&#39;,
    &#39;DriveGetType&#39;,
    &#39;DriveMapAdd&#39;,
    &#39;DriveMapDel&#39;,
    &#39;DriveMapGet&#39;,
    &#39;DriveSetLabel&#39;,
    &#39;DriveSpaceFree&#39;,
    &#39;DriveSpaceTotal&#39;,
    &#39;DriveStatus&#39;,
    &#39;DummySpeedTest&#39;,
    &#39;EnvGet&#39;,
    &#39;EnvSet&#39;,
    &#39;EnvUpdate&#39;,
    &#39;Eval&#39;,
    &#39;Execute&#39;,
    &#39;Exp&#39;,
    &#39;FileChangeDir&#39;,
    &#39;FileClose&#39;,
    &#39;FileCopy&#39;,
    &#39;FileCreateNTFSLink&#39;,
    &#39;FileCreateShortcut&#39;,
    &#39;FileDelete&#39;,
    &#39;FileExists&#39;,
    &#39;FileFindFirstFile&#39;,
    &#39;FileFindNextFile&#39;,
    &#39;FileFlush&#39;,
    &#39;FileGetAttrib&#39;,
    &#39;FileGetEncoding&#39;,
    &#39;FileGetLongName&#39;,
    &#39;FileGetPos&#39;,
    &#39;FileGetShortcut&#39;,
    &#39;FileGetShortName&#39;,
    &#39;FileGetSize&#39;,
    &#39;FileGetTime&#39;,
    &#39;FileGetVersion&#39;,
    &#39;FileInstall&#39;,
    &#39;FileMove&#39;,
    &#39;FileOpen&#39;,
    &#39;FileOpenDialog&#39;,
    &#39;FileRead&#39;,
    &#39;FileReadLine&#39;,
    &#39;FileReadToArray&#39;,
    &#39;FileRecycle&#39;,
    &#39;FileRecycleEmpty&#39;,
    &#39;FileSaveDialog&#39;,
    &#39;FileSelectFolder&#39;,
    &#39;FileSetAttrib&#39;,
    &#39;FileSetEnd&#39;,
    &#39;FileSetPos&#39;,
    &#39;FileSetTime&#39;,
    &#39;FileWrite&#39;,
    &#39;FileWriteLine&#39;,
    &#39;Floor&#39;,
    &#39;FtpSetProxy&#39;,
    &#39;Funcname&#39;,
    &#39;GUICreate&#39;,
    &#39;GUICtrlCreateAvi&#39;,
    &#39;GUICtrlCreateButton&#39;,
    &#39;GUICtrlCreateCheckbox&#39;,
    &#39;GUICtrlCreateCombo&#39;,
    &#39;GUICtrlCreateContextMenu&#39;,
    &#39;GUICtrlCreateDate&#39;,
    &#39;GUICtrlCreateDummy&#39;,
    &#39;GUICtrlCreateEdit&#39;,
    &#39;GUICtrlCreateGraphic&#39;,
    &#39;GUICtrlCreateGroup&#39;,
    &#39;GUICtrlCreateIcon&#39;,
    &#39;GUICtrlCreateInput&#39;,
    &#39;GUICtrlCreateLabel&#39;,
    &#39;GUICtrlCreateList&#39;,
    &#39;GUICtrlCreateListView&#39;,
    &#39;GUICtrlCreateListViewItem&#39;,
    &#39;GUICtrlCreateMenu&#39;,
    &#39;GUICtrlCreateMenuItem&#39;,
    &#39;GUICtrlCreateMonthCal&#39;,
    &#39;GUICtrlCreateObj&#39;,
    &#39;GUICtrlCreatePic&#39;,
    &#39;GUICtrlCreateProgress&#39;,
    &#39;GUICtrlCreateRadio&#39;,
    &#39;GUICtrlCreateSlider&#39;,
    &#39;GUICtrlCreateTab&#39;,
    &#39;GUICtrlCreateTabItem&#39;,
    &#39;GUICtrlCreateTreeView&#39;,
    &#39;GUICtrlCreateTreeViewItem&#39;,
    &#39;GUICtrlCreateUpdown&#39;,
    &#39;GUICtrlDelete&#39;,
    &#39;GUICtrlGetHandle&#39;,
    &#39;GUICtrlGetState&#39;,
    &#39;GUICtrlRead&#39;,
    &#39;GUICtrlRecvMsg&#39;,
    &#39;GUICtrlRegisterListViewSort&#39;,
    &#39;GUICtrlSendMsg&#39;,
    &#39;GUICtrlSendToDummy&#39;,
    &#39;GUICtrlSetBkColor&#39;,
    &#39;GUICtrlSetColor&#39;,
    &#39;GUICtrlSetCursor&#39;,
    &#39;GUICtrlSetData&#39;,
    &#39;GUICtrlSetDefBkColor&#39;,
    &#39;GUICtrlSetDefColor&#39;,
    &#39;GUICtrlSetFont&#39;,
    &#39;GUICtrlSetGraphic&#39;,
    &#39;GUICtrlSetImage&#39;,
    &#39;GUICtrlSetLimit&#39;,
    &#39;GUICtrlSetOnEvent&#39;,
    &#39;GUICtrlSetPos&#39;,
    &#39;GUICtrlSetResizing&#39;,
    &#39;GUICtrlSetState&#39;,
    &#39;GUICtrlSetStyle&#39;,
    &#39;GUICtrlSetTip&#39;,
    &#39;GUIDelete&#39;,
    &#39;GUIGetCursorInfo&#39;,
    &#39;GUIGetMsg&#39;,
    &#39;GUIGetStyle&#39;,
    &#39;GUIRegisterMsg&#39;,
    &#39;GUISetAccelerators&#39;,
    &#39;GUISetBkColor&#39;,
    &#39;GUISetCoord&#39;,
    &#39;GUISetCursor&#39;,
    &#39;GUISetFont&#39;,
    &#39;GUISetHelp&#39;,
    &#39;GUISetIcon&#39;,
    &#39;GUISetOnEvent&#39;,
    &#39;GUISetState&#39;,
    &#39;GUISetStyle&#39;,
    &#39;GUIStartGroup&#39;,
    &#39;GUISwitch&#39;,
    &#39;Hex&#39;,
    &#39;HotKeySet&#39;,
    &#39;HttpSetProxy&#39;,
    &#39;HttpSetUserAgent&#39;,
    &#39;Hwnd&#39;,
    &#39;InetClose&#39;,
    &#39;InetGet&#39;,
    &#39;InetGetInfo&#39;,
    &#39;InetGetSize&#39;,
    &#39;InetRead&#39;,
    &#39;IniDelete&#39;,
    &#39;IniRead&#39;,
    &#39;IniReadSection&#39;,
    &#39;IniReadSectionNames&#39;,
    &#39;IniRenameSection&#39;,
    &#39;IniWrite&#39;,
    &#39;IniWriteSection&#39;,
    &#39;InputBox&#39;,
    &#39;Int&#39;,
    &#39;IsAdmin&#39;,
    &#39;IsArray&#39;,
    &#39;IsBinary&#39;,
    &#39;IsBool&#39;,
    &#39;IsDeclared&#39;,
    &#39;IsDllStruct&#39;,
    &#39;IsFloat&#39;,
    &#39;IsFunc&#39;,
    &#39;IsHwnd&#39;,
    &#39;IsInt&#39;,
    &#39;IsKeyword&#39;,
    &#39;IsMap&#39;,
    &#39;IsNumber&#39;,
    &#39;IsObj&#39;,
    &#39;IsPtr&#39;,
    &#39;IsString&#39;,
    &#39;Log&#39;,
    &#39;MapAppend&#39;,
    &#39;MapExists&#39;,
    &#39;MapKeys&#39;,
    &#39;MapRemove&#39;,
    &#39;MemGetStats&#39;,
    &#39;Mod&#39;,
    &#39;MouseClick&#39;,
    &#39;MouseClickDrag&#39;,
    &#39;MouseDown&#39;,
    &#39;MouseGetCursor&#39;,
    &#39;MouseGetPos&#39;,
    &#39;MouseMove&#39;,
    &#39;MouseUp&#39;,
    &#39;MouseWheel&#39;,
    &#39;MsgBox&#39;,
    &#39;Number&#39;,
    &#39;ObjCreate&#39;,
    &#39;ObjCreateInterface&#39;,
    &#39;ObjEvent&#39;,
    &#39;ObjGet&#39;,
    &#39;ObjName&#39;,
    &#39;OnAutoItExitRegister&#39;,
    &#39;OnAutoItExitUnRegister&#39;,
    &#39;Opt&#39;,
    &#39;Ping&#39;,
    &#39;PixelChecksum&#39;,
    &#39;PixelGetColor&#39;,
    &#39;PixelSearch&#39;,
    &#39;ProcessClose&#39;,
    &#39;ProcessExists&#39;,
    &#39;ProcessGetStats&#39;,
    &#39;ProcessList&#39;,
    &#39;ProcessSetPriority&#39;,
    &#39;ProcessWait&#39;,
    &#39;ProcessWaitClose&#39;,
    &#39;ProgressOff&#39;,
    &#39;Progresson&#39;,
    &#39;ProgressSet&#39;,
    &#39;Ptr&#39;,
    &#39;Random&#39;,
    &#39;RegDelete&#39;,
    &#39;RegEnumKey&#39;,
    &#39;RegEnumVal&#39;,
    &#39;RegRead&#39;,
    &#39;RegWrite&#39;,
    &#39;Round&#39;,
    &#39;Run&#39;,
    &#39;RunAs&#39;,
    &#39;RunAsWait&#39;,
    &#39;RunWait&#39;,
    &#39;Send&#39;,
    &#39;SendKeepActive&#39;,
    &#39;SetError&#39;,
    &#39;SetExtended&#39;,
    &#39;ShellExecute&#39;,
    &#39;ShellExecuteWait&#39;,
    &#39;Shutdown&#39;,
    &#39;Sin&#39;,
    &#39;Sleep&#39;,
    &#39;SoundPlay&#39;,
    &#39;SoundSetWaveVolume&#39;,
    &#39;SplashImageOn&#39;,
    &#39;SplashOff&#39;,
    &#39;SplashTextOn&#39;,
    &#39;Sqrt&#39;,
    &#39;SRandom&#39;,
    &#39;StatusBarGetText&#39;,
    &#39;StderrRead&#39;,
    &#39;StdinWrite&#39;,
    &#39;StdioClose&#39;,
    &#39;StdoutRead&#39;,
    &#39;String&#39;,
    &#39;StringAddCR&#39;,
    &#39;StringCompare&#39;,
    &#39;StringFormat&#39;,
    &#39;StringFromASCIIArray&#39;,
    &#39;StringInStr&#39;,
    &#39;StringIsAlNum&#39;,
    &#39;StringIsAlpha&#39;,
    &#39;StringIsASCII&#39;,
    &#39;StringIsDigit&#39;,
    &#39;StringIsFloat&#39;,
    &#39;StringIsInt&#39;,
    &#39;StringIsLower&#39;,
    &#39;StringIsSpace&#39;,
    &#39;StringIsUpper&#39;,
    &#39;StringIsXDigit&#39;,
    &#39;StringLeft&#39;,
    &#39;StringLen&#39;,
    &#39;StringLower&#39;,
    &#39;StringMid&#39;,
    &#39;StringRegExp&#39;,
    &#39;StringRegExpReplace&#39;,
    &#39;StringReplace&#39;,
    &#39;StringReverse&#39;,
    &#39;StringRight&#39;,
    &#39;StringSplit&#39;,
    &#39;StringStripCR&#39;,
    &#39;StringStripWS&#39;,
    &#39;StringToASCIIArray&#39;,
    &#39;StringToBinary&#39;,
    &#39;StringTrimLeft&#39;,
    &#39;StringTrimRight&#39;,
    &#39;StringUpper&#39;,
    &#39;Tan&#39;,
    &#39;TCPAccept&#39;,
    &#39;TCPCloseSocket&#39;,
    &#39;TCPConnect&#39;,
    &#39;TCPListen&#39;,
    &#39;TCPNameToIP&#39;,
    &#39;TCPRecv&#39;,
    &#39;TCPSend&#39;,
    &#39;TCPShutdown&#39;,
    &#39;TCPStartup&#39;,
    &#39;TimerDiff&#39;,
    &#39;TimerInit&#39;,
    &#39;ToolTip&#39;,
    &#39;TrayCreateItem&#39;,
    &#39;TrayCreateMenu&#39;,
    &#39;TrayGetMsg&#39;,
    &#39;TrayItemDelete&#39;,
    &#39;TrayItemGetHandle&#39;,
    &#39;TrayItemGetState&#39;,
    &#39;TrayItemGetText&#39;,
    &#39;TrayItemSetOnEvent&#39;,
    &#39;TrayItemSetState&#39;,
    &#39;TrayItemSetText&#39;,
    &#39;TraySetClick&#39;,
    &#39;TraySetIcon&#39;,
    &#39;TraySetOnEvent&#39;,
    &#39;TraySetPauseIcon&#39;,
    &#39;TraySetState&#39;,
    &#39;TraySetToolTip&#39;,
    &#39;TrayTip&#39;,
    &#39;UBound&#39;,
    &#39;UDPBind&#39;,
    &#39;UDPCloseSocket&#39;,
    &#39;UDPOpen&#39;,
    &#39;UDPRecv&#39;,
    &#39;UDPSend&#39;,
    &#39;UDPShutdown&#39;,
    &#39;UDPStartup&#39;,
    &#39;VarGetType&#39;,
    &#39;WinActivate&#39;,
    &#39;WinActive&#39;,
    &#39;WinClose&#39;,
    &#39;WinExists&#39;,
    &#39;WinFlash&#39;,
    &#39;WinGetCaretPos&#39;,
    &#39;WinGetClassList&#39;,
    &#39;WinGetClientSize&#39;,
    &#39;WinGetHandle&#39;,
    &#39;WinGetPos&#39;,
    &#39;WinGetProcess&#39;,
    &#39;WinGetState&#39;,
    &#39;WinGetText&#39;,
    &#39;WinGetTitle&#39;,
    &#39;WinKill&#39;,
    &#39;WinList&#39;,
    &#39;WinMenuSelectItem&#39;,
    &#39;WinMinimizeAll&#39;,
    &#39;WinMinimizeAllUndo&#39;,
    &#39;WinMove&#39;,
    &#39;WinSetOnTop&#39;,
    &#39;WinSetState&#39;,
    &#39;WinSetTitle&#39;,
    &#39;WinSetTrans&#39;,
    &#39;WinWait&#39;,
    &#39;WinWaitActive&#39;,
    &#39;WinWaitClose&#39;,
    &#39;WinWaitNotActive&#39;,
]

A3X_OPCODES = {
    0x00: R&#39;{k}&#39;,  # KEYWORD
    0x01: R&#39;{a}&#39;,  # API
    0x05: R&#39;{i}&#39;,  # INT
    0x10: R&#39;{q}&#39;,  # INT64
    0x20: R&#39;{d}&#39;,  # DOUBLE
    0x30: R&#39;{s}&#39;,  # CONSTRUCT
    0x31: R&#39;{s}&#39;,  # COMMAND
    0x32: &#39;@{s}&#39;,  # MACRO
    0x33: &#39;${s}&#39;,  # VAR
    0x34: R&#39;{s}&#39;,  # FUNC
    0x35: &#39;.{s}&#39;,  # OBJECT
    0x36: R&#39;{r}&#39;,  # STRING
    0x37: R&#39;{s}&#39;,  # DIRECTIVE
    0x40: &#39;,&#39;,
    0x41: &#39;=&#39;,
    0x42: &#39;&gt;&#39;,
    0x43: &#39;&lt;&#39;,
    0x44: &#39;&lt;&gt;&#39;,
    0x45: &#39;&gt;=&#39;,
    0x46: &#39;&lt;=&#39;,
    0x47: &#39;(&#39;,
    0x48: &#39;)&#39;,
    0x49: &#39;+&#39;,
    0x4a: &#39;-&#39;,
    0x4b: &#39;/&#39;,
    0x4c: &#39;*&#39;,
    0x4d: &#39;&amp;&#39;,
    0x4e: &#39;[&#39;,
    0x4f: &#39;]&#39;,
    0x50: &#39;==&#39;,
    0x51: &#39;^&#39;,
    0x52: &#39;+=&#39;,
    0x53: &#39;-=&#39;,
    0x54: &#39;/=&#39;,
    0x55: &#39;*=&#39;,
    0x56: &#39;&amp;=&#39;,
    0x57: &#39;?&#39;,
    0x58: &#39;:&#39;,
}

_PRETTY: dict[str, str] = {}
_PRETTY.update((name.lower(), name) for name in A3X_APICALLS)
_PRETTY.update((name.lower(), name) for name in A3X_KEYWORDS)


def a3x_number_representation(value: float | int) -&gt; str:
    &#34;&#34;&#34;
    The AutoIt3 compiler will emit constants for -inf/inf/nan. However, AutoIt3 itself has no
    keywords for these values; The output of this function is valid AutoIt3 code that will
    produce these constants.

    https://www.autoitscript.com/autoit3/docs/functions/Dec.htm
    &#34;&#34;&#34;
    if isinstance(value, int):
        return str(value)
    elif math.isnan(value) or math.isinf(value):
        value = struct.pack(&#39;&gt;d&#39;, value).hex().upper()
        return RF&#39;Dec(&#34;{value}&#34;, 3)&#39;
    else:
        return RF&#39;{value!s}&#39;


def a3x_decompile(bytecode: bytearray) -&gt; Generator[tuple[int, str]]:
    class _decompiler(dict):
        def __missing__(self, key):
            if key == &#39;s&#39;:
                string = reader.read_length_prefixed_string()
                return _PRETTY.get(string.lower(), string)
            elif key == &#39;r&#39;:
                string = reader.read_length_prefixed_string()
                return &#39;&#34;{}&#34;&#39;.format(string.replace(&#39;&#34;&#39;, &#39;&#34;&#34;&#39;))
            elif key == &#39;k&#39;:
                return A3X_KEYWORDS[reader.u32()]
            elif key == &#39;a&#39;:
                return A3X_APICALLS[reader.u32()]
            elif key == &#39;i&#39;:
                number = reader.i32()
            elif key == &#39;q&#39;:
                number = reader.i64()
            elif key == &#39;d&#39;:
                number = reader.f64()
            else:
                raise KeyError(key)
            if number &lt; 0 and tokens and tokens[~0] == &#39;+&#39;:
                number = -number
                tokens[~0] = &#39;-&#39;
            return a3x_number_representation(number)

    decompiler = _decompiler()
    reader = A3xReader(bytecode)
    num_lines = reader.u32()
    tokens: list[str] = []
    expected_terminators: list[str] = []
    line = 0

    while line &lt; num_lines and not reader.eof:
        opc = reader.u8()
        if opc == 0x7f:
            if not tokens:
                continue
            indent = len(expected_terminators)
            lt = [t.lower() for t in tokens]
            if lt[0] == &#39;if&#39; and lt[~0] == &#39;then&#39;:
                expected_terminators.append(&#39;endif&#39;)
            elif lt[0] == &#39;else&#39;:
                if not expected_terminators or expected_terminators[~0] != &#39;endif&#39;:
                    raise ValueError(F&#39;Unexpected {tokens[0]} in line {line}.&#39;)
                indent -= 1
            elif lt[0] == &#39;case&#39;:
                if not expected_terminators or not expected_terminators[~0].startswith(&#39;ends&#39;):
                    raise ValueError(F&#39;Unexpected {tokens[0]} in line {line}.&#39;)
                indent -= 1
            elif lt[0] == &#39;while&#39;:
                expected_terminators.append(&#39;wend&#39;)
            elif lt[0] == &#39;do&#39;:
                expected_terminators.append(&#39;until&#39;)
            elif lt[0] == &#39;for&#39;:
                expected_terminators.append(&#39;next&#39;)
            elif lt[0] == &#39;select&#39;:
                expected_terminators.append(&#39;endselect&#39;)
            elif lt[0] == &#39;switch&#39;:
                expected_terminators.append(&#39;endswitch&#39;)
            elif lt[0] == &#39;func&#39;:
                expected_terminators.append(&#39;endfunc&#39;)
            elif lt[0] == &#39;with&#39;:
                expected_terminators.append(&#39;endwith&#39;)
            elif lt[0].startswith(&#39;end&#39;) or lt[0] in {&#39;next&#39;, &#39;until&#39;, &#39;wend&#39;}:
                try:
                    expected = expected_terminators.pop()
                except IndexError:
                    expected = None
                if lt[0] != expected:
                    raise ValueError(F&#39;Unexpected {tokens[0]} in line {line}, expected {_PRETTY[expected]}.&#39;)
                indent -= 1
            if not indent and len(expected_terminators) &gt; 0:
                yield (0, &#39;&#39;)
            output = io.StringIO()
            for k, token in enumerate(tokens):
                space = True
                space = space and k &gt; 0
                space = space and token not in &#39;)],&#39;
                space = space and not (token in &#39;([&#39; and tokens[k - 1][~0].isalnum())
                space = space and tokens[k - 1] not in &#39;([&#39;
                space = space and not token.startswith(&#39;.&#39;)
                if space:
                    output.write(&#39; &#39;)
                output.write(token)
            yield (indent, output.getvalue())
            line += 1
            tokens.clear()
        else:
            tokens.append(A3X_OPCODES.get(opc).format_map(decompiler))
    if expected_terminators:
        raise ValueError(&#39;Script truncated.&#39;)


def a3x_decompress(data: bytearray, is_current: bool) -&gt; bytearray:
    output = MemoryFile()
    cursor = 0
    view = memoryview(data)
    size = int.from_bytes(view[4:8], &#39;big&#39;)
    bit_reader = StructReader(view[8:], bigendian=True)
    bits = bit_reader.read_integer
    while cursor &lt; size:
        check = bits(1)
        if check == is_current:
            output.write_byte(bits(8))
            cursor += 1
            continue
        delta = 0
        offset = bits(15)
        length = bits(2)
        if length == 0b00000011:
            delta = 0x003
            length = bits(3)
            if length == 0b00000111:
                delta = 0x00A
                length = bits(5)
                if length == 0b00011111:
                    delta = 0x029
                    length = bits(8)
                    if length == 0b11111111:
                        delta = 0x128
                        length = bits(8)
        while length == 0b11111111:
            delta += 0xFF
            length = bits(8)
        length += delta + 3
        length &amp;= 0xFFFFFFFF
        output.replay(offset, length)
        cursor += length
    return output.getvalue()


def a3x_decrypt_current(data: memoryview, key: int) -&gt; bytearray:
    a, b, t = 16, 6, []

    for _ in range(17):
        key = 1 - key * 0x53A9B4FB &amp; 0xFFFFFFFF
        t.append(key)

    t.reverse()

    for _ in range(9):
        r = (t[a] &lt;&lt; 9 | t[a] &gt;&gt; 23) + (t[b] &lt;&lt; 13 | t[b] &gt;&gt; 19) &amp; 0xFFFFFFFF
        t[a] = r
        a = (a + 1) % 17
        b = (b + 1) % 17

    def _decrypted():
        nonlocal a, b
        for v in data:
            x = t[a]
            y = t[b]
            t[a] = (x &lt;&lt; 9 | x &gt;&gt; 23) + (y &lt;&lt; 13 | y &gt;&gt; 19) &amp; 0xFFFFFFFF
            a = (a + 1) % 17
            b = (b + 1) % 17
            x = t[a]
            y = t[b]
            r = (x &lt;&lt; 9 | x &gt;&gt; 23) + (y &lt;&lt; 13 | y &gt;&gt; 19) &amp; 0xFFFFFFFF
            t[a] = r
            a = (a + 1) % 17
            b = (b + 1) % 17
            yield (r &gt;&gt; 24) ^ v

    return bytearray(_decrypted())


def a3x_decrypt_legacy(data: memoryview, key: int) -&gt; bytearray:
    a, b, t = 1, 0, []

    t.append(key)
    for i in range(1, 624):
        key = ((((key ^ key &gt;&gt; 30) * 0x6C078965) &amp; 0xFFFFFFFF) + i) &amp; 0xFFFFFFFF
        t.append(key)

    def _refactor_state():
        for i in range(0, 0xe3):
            x = t[i] ^ t[i + 1]
            x &amp;= 0x7FFFFFFE
            x ^= t[i]
            x &gt;&gt;= 1
            y = 0x9908B0DF
            if (t[i + 1] % 2 == 0):
                y = 0
            x ^= y
            x ^= t[i + 397]
            t[i] = x

        for i in range(0xe3, 0x18c + 0xe3):
            x = t[i] ^ t[i + 1]
            x &amp;= 0x7FFFFFFE
            x ^= t[i]
            x &gt;&gt;= 1
            y = 0x9908B0DF
            if (t[i + 1] % 2 == 0):
                y = 0
            x ^= y
            x ^= t[i - 227]
            t[i] = x

        x = t[0]
        y = t[0x18c + 0xe3] ^ x
        y &amp;= 0x7FFFFFFE
        y ^= t[0x18c + 0xe3]
        y &gt;&gt;= 1
        if (x % 2 == 1):
            x = 0x9908B0DF
        else:
            x = 0
        y ^= x
        y ^= t[0x18c + 0xe3 - 227]
        t[0x18c + 0xe3] = y

    def _decrypted():
        nonlocal a, b
        for v in data:
            a -= 1
            b += 1
            if a == 0:
                a = 0x270
                b = 0
                _refactor_state()
            x = t[b]
            x = x ^ x &gt;&gt; 11
            y = ((x &amp; 0xFF3A58AD) &lt;&lt; 7) &amp; 0xFFFFFFFF
            x ^= y
            y = ((x &amp; 0xFFFFDF8C) &lt;&lt; 15) &amp; 0xFFFFFFFF
            x ^= y
            y = x ^ x &gt;&gt; 0x12
            yield ((y &gt;&gt; 1) ^ v) &amp; 0xFF

    return bytearray(_decrypted())


def a3x_decrypt(data: memoryview, key: int, is_current: bool = True) -&gt; bytearray:
    if is_current:
        return a3x_decrypt_current(data, key)
    return a3x_decrypt_legacy(data, key)


class A3xType(str, Enum):
    UNICODE = &#39;AUTOIT UNICODE SCRIPT&#39;
    SCRIPT = &#39;AUTOIT SCRIPT&#39;
    NOEXEC = &#39;AUTOIT NO CMDEXECUTE&#39;
    AHK_SCRIPT = &#39;AUTOHOTKEY SCRIPT&#39;
    AHK_WITH_ICON = &#39;AHK WITH ICON&#39;


class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool


class A3xEncryptionType(A3xEncryptionConstants, Enum):
    EA06 = (b&#39;AU3!EA06&#39;, 0xADBC, 0xB33F, 0xF820, 0xF479, 0x87BC, 0x87BC, 0xA685, 0x2477, True)
    EA05 = (b&#39;AU3!EA05&#39;, 0x29BC, 0xA25E, 0x29AC, 0xF25E, 0x45AA, 0x45AA, 0xC3D2, 0x22AF, False)


class A3xReader(StructReader[memoryview]):

    def read_encrypted_data(self, size_key, seed, is_current=True):
        if is_current:
            size = 2 * (self.u32() ^ size_key)
            seed = int(size // 2) + seed
        else:
            size = (self.u32() ^ size_key)
            seed += size

        return a3x_decrypt(self.read_exactly(size), seed, is_current)

    def read_encrypted_string(self, size_key, seed, is_current=True):
        if is_current:
            return self.read_encrypted_data(size_key, seed).decode(&#39;utf-16le&#39;)
        return self.read_encrypted_data(size_key, seed, is_current=False).decode(&#39;utf-8&#39;)

    def read_time(self):
        H = self.u32()
        L = self.u32()
        T = (H &lt;&lt; 32) | L
        return date_from_timestamp((T - 116444736000000000) / 10000000)

    def read_length_prefixed_string(self):
        length = self.i32()
        return &#39;&#39;.join(chr((self.u16() ^ length) &amp; 0xFFFF) for _ in range(length))


class A3xRecord(Struct, parser=A3xReader):
    MAGIC = b&#39;\x6B\x43\xCA\x52&#39;

    def __init__(self, reader: A3xReader, encryption_type: A3xEncryptionType):
        self.magic = reader.read(4)
        self.encryption_type = encryption_type
        self.type = reader.read_encrypted_string(
            encryption_type.tag_size,
            encryption_type.tag,
            encryption_type.is_current
        ).lstrip(&#39;&gt;&#39;).rstrip(&#39;&lt;&#39;)
        self.src_path = reader.read_encrypted_string(
            encryption_type.path_size,
            encryption_type.path,
            encryption_type.is_current
        )
        self.is_compressed = bool(reader.u8())
        self.is_encrypted = True
        self.size = reader.u32() ^ encryption_type.compressed_size
        self.size_decompressed = reader.u32() ^ encryption_type.decompressed_size
        self.checksum = reader.u32() ^ encryption_type.checksum
        self.created = reader.read_time()
        self.written = reader.read_time()
        self.data = bytes(reader.read_exactly(self.size))

    def __hash__(self):
        return hash((self.path, self.type))

    def __eq__(self, other: A3xRecord):
        return self.path == other.path and self.type == other.type

    def extract(self) -&gt; bytearray:
        output = io.BytesIO()
        it = self.extract_linewise()
        output.write(next(it))
        for line in it:
            output.write(B&#39;\n&#39;)
            output.write(line)
        return output.getvalue()

    def extract_linewise(self) -&gt; Generator[bytes]:
        if self.is_encrypted:
            a3x.log_info(&#39;decryption:&#39;, self.path)
            if self.encryption_type.is_current:
                self.data = a3x_decrypt(self.data, self.encryption_type.data, self.encryption_type.is_current)
            else:
                seed = self.encryption_type.data + 0x849
                self.data = a3x_decrypt(self.data, seed, self.encryption_type.is_current)
            self.is_encrypted = False
        if self.is_compressed:
            a3x.log_info(&#39;decompress:&#39;, self.path)
            self.data = a3x_decompress(self.data, self.encryption_type.is_current)
            self.is_compressed = False
        if not self.is_script():
            yield self.data
            return
        a3x.log_info(&#39;decompiler:&#39;, self.path)
        for indent, line in a3x_decompile(self.data):
            yield F&#39;{indent * 4 * &#34; &#34;}{line}&#39;.encode(a3x.codec)

    def is_script(self):
        return self.type == A3xType.SCRIPT

    @property
    def path(self):
        try:
            tv = A3xType(self.type)
        except Exception:
            return self.type
        if tv is A3xType.SCRIPT:
            return &#39;script.au3&#39;
        if tv is A3xType.UNICODE:
            return &#39;unicode-script.au3&#39;
        if tv is A3xType.NOEXEC:
            return None
        if tv in (A3xType.AHK_WITH_ICON, A3xType.AHK_SCRIPT):
            return &#39;script.ahk&#39;


class A3xScript(Struct, parser=A3xReader):
    MAGIC = b&#39;\xA3\x48\x4B\xBE\x98\x6C\x4A\xA9\x99\x4C\x53\x0A\x86\xD6\x48\x7D&#39;
    WIDTH = 0x28

    def has_valid_magic(self):
        return self.magic == self.MAGIC

    def __init__(self, reader: A3xReader):
        self.magic = reader.read(0x10)
        self.type = bytes(reader.read(8))
        self._unk = reader.read(16)
        self.truncated = False
        if not self.type.startswith(B&#39;AU3!&#39;):
            self.body = []
            return
        self.body: list[A3xRecord] = []
        last_known_good_position = reader.tell()
        types = {at.version: at for at in A3xEncryptionType}
        while not reader.eof:
            pos = reader.tell()
            try:
                rt = types.get(self.type, A3xEncryptionType.EA06)
                self.body.append(A3xRecord(reader, rt))
            except (ValueError, EOFError):
                reader.seekset(pos)
                break
            else:
                last_known_good_position = pos
        if reader.read(8) != self.type:
            self.truncated = True
            reader.seekset(last_known_good_position)
            if self.body:
                self.body.pop()


class a3x(PathExtractorUnit):
    &#34;&#34;&#34;
    Extracts embedded resources from compiled AutoIt scripts and decompiles the embedded script
    bytecode. The unit also works on compiled AutoIt executables.
    &#34;&#34;&#34;

    def unpack(self, data: bytearray):
        view = memoryview(data)
        cursor = 0
        errors: dict[int, Exception] = {}
        script_count = 0
        truncated: set[A3xRecord] = set()
        intact: set[A3xRecord] = set()

        def _package(records: Iterable[A3xRecord]) -&gt; Generator[UnpackResult]:
            for k, record in enumerate(records, 1):
                self.log_info(F&#39;record {k} type:&#39;, record.type)
                self.log_info(F&#39;record {k} path:&#39;, record.src_path)
                if record.path is None:
                    continue
                yield UnpackResult(
                    record.path,
                    record.extract,
                    srcpath=record.src_path,
                    created=record.created.isoformat(&#39; &#39;, &#39;seconds&#39;),
                    written=record.written.isoformat(&#39; &#39;, &#39;seconds&#39;),
                )

        while cursor &lt; len(view):
            self.log_debug(F&#39;searching at offset 0x{cursor:08X}&#39;)
            nc = data.find(A3xScript.MAGIC, cursor)
            if nc &gt;= 0:
                cursor = nc
            else:
                rp = data.find(A3xRecord.MAGIC, cursor) - A3xScript.WIDTH
                if rp &lt;= cursor:
                    break
                cursor = rp
            try:
                script = A3xScript(view[cursor:])
            except Exception as E:
                errors[cursor] = E
                cursor += 1
                continue
            else:
                valid = script.has_valid_magic()
                if valid:
                    _m = &#39;correct&#39;
                else:
                    _m = &#39;invalid&#39;
                if not script.body:
                    cursor += A3xScript.WIDTH
                    if not script.has_valid_magic():
                        cursor += len(A3xRecord.MAGIC)
                    continue
                if script.truncated:
                    _a = &#39;truncated&#39;
                    truncated.update(script.body)
                else:
                    script_count += 1
                    _a = &#39;intact&#39;
                    intact.update(script.body)
                self.log_info(
                    F&#39;{_a} script of type&#39;, script.type,
                    F&#39;and length 0x{len(script):08X}&#39;,
                    F&#39;with {len(script.body)} records and {_m} magic:&#39;,
                    script.magic
                )
                cursor += len(script)
                if script.truncated:
                    if not script.has_valid_magic():
                        cursor += len(A3xRecord.MAGIC)
                    continue

            yield from _package(script.body)

        remaining = truncated - intact
        if remaining:
            self.log_warn(&#39;emitting records from truncated scripts&#39;)
            yield from _package(remaining)
            return
        elif truncated:
            self.log_debug(&#39;good news: intact scripts contained all records from truncated scripts&#39;)
        if script_count == 0:
            error = None
            for offset, error in errors.items():
                self.log_warn(F&#39;error at offset 0x{offset:08X}:&#39;, error)
            if error:
                raise error

    @classmethod
    def handles(cls, data) -&gt; bool | None:
        return buffer_contains(data, A3xScript.MAGIC) or buffer_contains(data, A3xRecord.MAGIC)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="refinery.units.formats.a3x.a3x_number_representation"><code class="name flex">
<span>def <span class="ident">a3x_number_representation</span></span>(<span>value)</span>
</code></dt>
<dd>
<section class="desc"><p>The AutoIt3 compiler will emit constants for -inf/inf/nan. However, AutoIt3 itself has no
keywords for these values; The output of this function is valid AutoIt3 code that will
produce these constants.</p>
<p><a href="https://www.autoitscript.com/autoit3/docs/functions/Dec.htm">https://www.autoitscript.com/autoit3/docs/functions/Dec.htm</a></p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L518-L532" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def a3x_number_representation(value: float | int) -&gt; str:
    &#34;&#34;&#34;
    The AutoIt3 compiler will emit constants for -inf/inf/nan. However, AutoIt3 itself has no
    keywords for these values; The output of this function is valid AutoIt3 code that will
    produce these constants.

    https://www.autoitscript.com/autoit3/docs/functions/Dec.htm
    &#34;&#34;&#34;
    if isinstance(value, int):
        return str(value)
    elif math.isnan(value) or math.isinf(value):
        value = struct.pack(&#39;&gt;d&#39;, value).hex().upper()
        return RF&#39;Dec(&#34;{value}&#34;, 3)&#39;
    else:
        return RF&#39;{value!s}&#39;</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.a3x_decompile"><code class="name flex">
<span>def <span class="ident">a3x_decompile</span></span>(<span>bytecode)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L535-L626" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def a3x_decompile(bytecode: bytearray) -&gt; Generator[tuple[int, str]]:
    class _decompiler(dict):
        def __missing__(self, key):
            if key == &#39;s&#39;:
                string = reader.read_length_prefixed_string()
                return _PRETTY.get(string.lower(), string)
            elif key == &#39;r&#39;:
                string = reader.read_length_prefixed_string()
                return &#39;&#34;{}&#34;&#39;.format(string.replace(&#39;&#34;&#39;, &#39;&#34;&#34;&#39;))
            elif key == &#39;k&#39;:
                return A3X_KEYWORDS[reader.u32()]
            elif key == &#39;a&#39;:
                return A3X_APICALLS[reader.u32()]
            elif key == &#39;i&#39;:
                number = reader.i32()
            elif key == &#39;q&#39;:
                number = reader.i64()
            elif key == &#39;d&#39;:
                number = reader.f64()
            else:
                raise KeyError(key)
            if number &lt; 0 and tokens and tokens[~0] == &#39;+&#39;:
                number = -number
                tokens[~0] = &#39;-&#39;
            return a3x_number_representation(number)

    decompiler = _decompiler()
    reader = A3xReader(bytecode)
    num_lines = reader.u32()
    tokens: list[str] = []
    expected_terminators: list[str] = []
    line = 0

    while line &lt; num_lines and not reader.eof:
        opc = reader.u8()
        if opc == 0x7f:
            if not tokens:
                continue
            indent = len(expected_terminators)
            lt = [t.lower() for t in tokens]
            if lt[0] == &#39;if&#39; and lt[~0] == &#39;then&#39;:
                expected_terminators.append(&#39;endif&#39;)
            elif lt[0] == &#39;else&#39;:
                if not expected_terminators or expected_terminators[~0] != &#39;endif&#39;:
                    raise ValueError(F&#39;Unexpected {tokens[0]} in line {line}.&#39;)
                indent -= 1
            elif lt[0] == &#39;case&#39;:
                if not expected_terminators or not expected_terminators[~0].startswith(&#39;ends&#39;):
                    raise ValueError(F&#39;Unexpected {tokens[0]} in line {line}.&#39;)
                indent -= 1
            elif lt[0] == &#39;while&#39;:
                expected_terminators.append(&#39;wend&#39;)
            elif lt[0] == &#39;do&#39;:
                expected_terminators.append(&#39;until&#39;)
            elif lt[0] == &#39;for&#39;:
                expected_terminators.append(&#39;next&#39;)
            elif lt[0] == &#39;select&#39;:
                expected_terminators.append(&#39;endselect&#39;)
            elif lt[0] == &#39;switch&#39;:
                expected_terminators.append(&#39;endswitch&#39;)
            elif lt[0] == &#39;func&#39;:
                expected_terminators.append(&#39;endfunc&#39;)
            elif lt[0] == &#39;with&#39;:
                expected_terminators.append(&#39;endwith&#39;)
            elif lt[0].startswith(&#39;end&#39;) or lt[0] in {&#39;next&#39;, &#39;until&#39;, &#39;wend&#39;}:
                try:
                    expected = expected_terminators.pop()
                except IndexError:
                    expected = None
                if lt[0] != expected:
                    raise ValueError(F&#39;Unexpected {tokens[0]} in line {line}, expected {_PRETTY[expected]}.&#39;)
                indent -= 1
            if not indent and len(expected_terminators) &gt; 0:
                yield (0, &#39;&#39;)
            output = io.StringIO()
            for k, token in enumerate(tokens):
                space = True
                space = space and k &gt; 0
                space = space and token not in &#39;)],&#39;
                space = space and not (token in &#39;([&#39; and tokens[k - 1][~0].isalnum())
                space = space and tokens[k - 1] not in &#39;([&#39;
                space = space and not token.startswith(&#39;.&#39;)
                if space:
                    output.write(&#39; &#39;)
                output.write(token)
            yield (indent, output.getvalue())
            line += 1
            tokens.clear()
        else:
            tokens.append(A3X_OPCODES.get(opc).format_map(decompiler))
    if expected_terminators:
        raise ValueError(&#39;Script truncated.&#39;)</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.a3x_decompress"><code class="name flex">
<span>def <span class="ident">a3x_decompress</span></span>(<span>data, is_current)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L629-L664" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def a3x_decompress(data: bytearray, is_current: bool) -&gt; bytearray:
    output = MemoryFile()
    cursor = 0
    view = memoryview(data)
    size = int.from_bytes(view[4:8], &#39;big&#39;)
    bit_reader = StructReader(view[8:], bigendian=True)
    bits = bit_reader.read_integer
    while cursor &lt; size:
        check = bits(1)
        if check == is_current:
            output.write_byte(bits(8))
            cursor += 1
            continue
        delta = 0
        offset = bits(15)
        length = bits(2)
        if length == 0b00000011:
            delta = 0x003
            length = bits(3)
            if length == 0b00000111:
                delta = 0x00A
                length = bits(5)
                if length == 0b00011111:
                    delta = 0x029
                    length = bits(8)
                    if length == 0b11111111:
                        delta = 0x128
                        length = bits(8)
        while length == 0b11111111:
            delta += 0xFF
            length = bits(8)
        length += delta + 3
        length &amp;= 0xFFFFFFFF
        output.replay(offset, length)
        cursor += length
    return output.getvalue()</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.a3x_decrypt_current"><code class="name flex">
<span>def <span class="ident">a3x_decrypt_current</span></span>(<span>data, key)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L667-L698" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def a3x_decrypt_current(data: memoryview, key: int) -&gt; bytearray:
    a, b, t = 16, 6, []

    for _ in range(17):
        key = 1 - key * 0x53A9B4FB &amp; 0xFFFFFFFF
        t.append(key)

    t.reverse()

    for _ in range(9):
        r = (t[a] &lt;&lt; 9 | t[a] &gt;&gt; 23) + (t[b] &lt;&lt; 13 | t[b] &gt;&gt; 19) &amp; 0xFFFFFFFF
        t[a] = r
        a = (a + 1) % 17
        b = (b + 1) % 17

    def _decrypted():
        nonlocal a, b
        for v in data:
            x = t[a]
            y = t[b]
            t[a] = (x &lt;&lt; 9 | x &gt;&gt; 23) + (y &lt;&lt; 13 | y &gt;&gt; 19) &amp; 0xFFFFFFFF
            a = (a + 1) % 17
            b = (b + 1) % 17
            x = t[a]
            y = t[b]
            r = (x &lt;&lt; 9 | x &gt;&gt; 23) + (y &lt;&lt; 13 | y &gt;&gt; 19) &amp; 0xFFFFFFFF
            t[a] = r
            a = (a + 1) % 17
            b = (b + 1) % 17
            yield (r &gt;&gt; 24) ^ v

    return bytearray(_decrypted())</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.a3x_decrypt_legacy"><code class="name flex">
<span>def <span class="ident">a3x_decrypt_legacy</span></span>(<span>data, key)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L701-L765" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def a3x_decrypt_legacy(data: memoryview, key: int) -&gt; bytearray:
    a, b, t = 1, 0, []

    t.append(key)
    for i in range(1, 624):
        key = ((((key ^ key &gt;&gt; 30) * 0x6C078965) &amp; 0xFFFFFFFF) + i) &amp; 0xFFFFFFFF
        t.append(key)

    def _refactor_state():
        for i in range(0, 0xe3):
            x = t[i] ^ t[i + 1]
            x &amp;= 0x7FFFFFFE
            x ^= t[i]
            x &gt;&gt;= 1
            y = 0x9908B0DF
            if (t[i + 1] % 2 == 0):
                y = 0
            x ^= y
            x ^= t[i + 397]
            t[i] = x

        for i in range(0xe3, 0x18c + 0xe3):
            x = t[i] ^ t[i + 1]
            x &amp;= 0x7FFFFFFE
            x ^= t[i]
            x &gt;&gt;= 1
            y = 0x9908B0DF
            if (t[i + 1] % 2 == 0):
                y = 0
            x ^= y
            x ^= t[i - 227]
            t[i] = x

        x = t[0]
        y = t[0x18c + 0xe3] ^ x
        y &amp;= 0x7FFFFFFE
        y ^= t[0x18c + 0xe3]
        y &gt;&gt;= 1
        if (x % 2 == 1):
            x = 0x9908B0DF
        else:
            x = 0
        y ^= x
        y ^= t[0x18c + 0xe3 - 227]
        t[0x18c + 0xe3] = y

    def _decrypted():
        nonlocal a, b
        for v in data:
            a -= 1
            b += 1
            if a == 0:
                a = 0x270
                b = 0
                _refactor_state()
            x = t[b]
            x = x ^ x &gt;&gt; 11
            y = ((x &amp; 0xFF3A58AD) &lt;&lt; 7) &amp; 0xFFFFFFFF
            x ^= y
            y = ((x &amp; 0xFFFFDF8C) &lt;&lt; 15) &amp; 0xFFFFFFFF
            x ^= y
            y = x ^ x &gt;&gt; 0x12
            yield ((y &gt;&gt; 1) ^ v) &amp; 0xFF

    return bytearray(_decrypted())</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.a3x_decrypt"><code class="name flex">
<span>def <span class="ident">a3x_decrypt</span></span>(<span>data, key, is_current=True)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L768-L771" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def a3x_decrypt(data: memoryview, key: int, is_current: bool = True) -&gt; bytearray:
    if is_current:
        return a3x_decrypt_current(data, key)
    return a3x_decrypt_legacy(data, key)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="refinery.units.formats.a3x.A3xType"><code class="flex name class">
<span>class <span class="ident">A3xType</span></span>
<span>(</span><span>*args, **kwds)</span>
</code></dt>
<dd>
<section class="desc"><p>str(object='') -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.<strong>str</strong>() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L774-L779" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xType(str, Enum):
    UNICODE = &#39;AUTOIT UNICODE SCRIPT&#39;
    SCRIPT = &#39;AUTOIT SCRIPT&#39;
    NOEXEC = &#39;AUTOIT NO CMDEXECUTE&#39;
    AHK_SCRIPT = &#39;AUTOHOTKEY SCRIPT&#39;
    AHK_WITH_ICON = &#39;AHK WITH ICON&#39;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.str</li>
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.units.formats.a3x.A3xType.UNICODE"><code class="name">var <span class="ident">UNICODE</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.formats.a3x.A3xType.SCRIPT"><code class="name">var <span class="ident">SCRIPT</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.formats.a3x.A3xType.NOEXEC"><code class="name">var <span class="ident">NOEXEC</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.formats.a3x.A3xType.AHK_SCRIPT"><code class="name">var <span class="ident">AHK_SCRIPT</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.formats.a3x.A3xType.AHK_WITH_ICON"><code class="name">var <span class="ident">AHK_WITH_ICON</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionConstants"><code class="flex name class">
<span>class <span class="ident">A3xEncryptionConstants</span></span>
<span>(</span><span>version, tag_size, tag, path_size, path, compressed_size, decompressed_size, checksum, data, is_current)</span>
</code></dt>
<dd>
<section class="desc"><p>A3xEncryptionConstants(version, tag_size, tag, path_size, path, compressed_size, decompressed_size, checksum, data, is_current)</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L782-L792" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.tuple</li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="refinery.units.formats.a3x.A3xEncryptionType" href="#refinery.units.formats.a3x.A3xEncryptionType">A3xEncryptionType</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.units.formats.a3x.A3xEncryptionConstants.version"><code class="name">var <span class="ident">version</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 0</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L782-L792" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionConstants.tag_size"><code class="name">var <span class="ident">tag_size</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 1</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L782-L792" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionConstants.tag"><code class="name">var <span class="ident">tag</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 2</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L782-L792" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionConstants.path_size"><code class="name">var <span class="ident">path_size</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 3</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L782-L792" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionConstants.path"><code class="name">var <span class="ident">path</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 4</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L782-L792" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionConstants.compressed_size"><code class="name">var <span class="ident">compressed_size</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 5</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L782-L792" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionConstants.decompressed_size"><code class="name">var <span class="ident">decompressed_size</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 6</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L782-L792" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionConstants.checksum"><code class="name">var <span class="ident">checksum</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 7</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L782-L792" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionConstants.data"><code class="name">var <span class="ident">data</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 8</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L782-L792" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionConstants.is_current"><code class="name">var <span class="ident">is_current</span></code></dt>
<dd>
<section class="desc"><p>Alias for field number 9</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L782-L792" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionConstants(NamedTuple):
    version: bytes
    tag_size: int
    tag: int
    path_size: int
    path: int
    compressed_size: int
    decompressed_size: int
    checksum: int
    data: int
    is_current: bool</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionType"><code class="flex name class">
<span>class <span class="ident">A3xEncryptionType</span></span>
<span>(</span><span>*args, **kwds)</span>
</code></dt>
<dd>
<section class="desc"><p>A3xEncryptionConstants(version, tag_size, tag, path_size, path, compressed_size, decompressed_size, checksum, data, is_current)</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L795-L797" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xEncryptionType(A3xEncryptionConstants, Enum):
    EA06 = (b&#39;AU3!EA06&#39;, 0xADBC, 0xB33F, 0xF820, 0xF479, 0x87BC, 0x87BC, 0xA685, 0x2477, True)
    EA05 = (b&#39;AU3!EA05&#39;, 0x29BC, 0xA25E, 0x29AC, 0xF25E, 0x45AA, 0x45AA, 0xC3D2, 0x22AF, False)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.units.formats.a3x.A3xEncryptionConstants" href="#refinery.units.formats.a3x.A3xEncryptionConstants">A3xEncryptionConstants</a></li>
<li>builtins.tuple</li>
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.units.formats.a3x.A3xEncryptionType.EA06"><code class="name">var <span class="ident">EA06</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.formats.a3x.A3xEncryptionType.EA05"><code class="name">var <span class="ident">EA05</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="refinery.units.formats.a3x.A3xEncryptionConstants" href="#refinery.units.formats.a3x.A3xEncryptionConstants">A3xEncryptionConstants</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.formats.a3x.A3xEncryptionConstants.checksum" href="#refinery.units.formats.a3x.A3xEncryptionConstants.checksum">checksum</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xEncryptionConstants.compressed_size" href="#refinery.units.formats.a3x.A3xEncryptionConstants.compressed_size">compressed_size</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xEncryptionConstants.data" href="#refinery.units.formats.a3x.A3xEncryptionConstants.data">data</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xEncryptionConstants.decompressed_size" href="#refinery.units.formats.a3x.A3xEncryptionConstants.decompressed_size">decompressed_size</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xEncryptionConstants.is_current" href="#refinery.units.formats.a3x.A3xEncryptionConstants.is_current">is_current</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xEncryptionConstants.path" href="#refinery.units.formats.a3x.A3xEncryptionConstants.path">path</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xEncryptionConstants.path_size" href="#refinery.units.formats.a3x.A3xEncryptionConstants.path_size">path_size</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xEncryptionConstants.tag" href="#refinery.units.formats.a3x.A3xEncryptionConstants.tag">tag</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xEncryptionConstants.tag_size" href="#refinery.units.formats.a3x.A3xEncryptionConstants.tag_size">tag_size</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xEncryptionConstants.version" href="#refinery.units.formats.a3x.A3xEncryptionConstants.version">version</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="refinery.units.formats.a3x.A3xReader"><code class="flex name class">
<span>class <span class="ident">A3xReader</span></span>
<span>(</span><span>data, bigendian=False)</span>
</code></dt>
<dd>
<section class="desc"><p>An extension of a <code><a title="refinery.lib.structures.MemoryFile" href="../../lib/structures.html#refinery.lib.structures.MemoryFile">MemoryFile</a></code> which provides methods to read
structured data.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L800-L825" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xReader(StructReader[memoryview]):

    def read_encrypted_data(self, size_key, seed, is_current=True):
        if is_current:
            size = 2 * (self.u32() ^ size_key)
            seed = int(size // 2) + seed
        else:
            size = (self.u32() ^ size_key)
            seed += size

        return a3x_decrypt(self.read_exactly(size), seed, is_current)

    def read_encrypted_string(self, size_key, seed, is_current=True):
        if is_current:
            return self.read_encrypted_data(size_key, seed).decode(&#39;utf-16le&#39;)
        return self.read_encrypted_data(size_key, seed, is_current=False).decode(&#39;utf-8&#39;)

    def read_time(self):
        H = self.u32()
        L = self.u32()
        T = (H &lt;&lt; 32) | L
        return date_from_timestamp((T - 116444736000000000) / 10000000)

    def read_length_prefixed_string(self):
        length = self.i32()
        return &#39;&#39;.join(chr((self.u16() ^ length) &amp; 0xFFFF) for _ in range(length))</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.lib.structures.StructReader" href="../../lib/structures.html#refinery.lib.structures.StructReader">StructReader</a></li>
<li><a title="refinery.lib.structures.MemoryFile" href="../../lib/structures.html#refinery.lib.structures.MemoryFile">MemoryFile</a></li>
<li><a title="refinery.lib.structures.MemoryFileMethods" href="../../lib/structures.html#refinery.lib.structures.MemoryFileMethods">MemoryFileMethods</a></li>
<li>typing.Generic</li>
<li>_io.BytesIO</li>
<li>_io._BufferedIOBase</li>
<li>_io._IOBase</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="refinery.units.formats.a3x.A3xReader.read_encrypted_data"><code class="name flex">
<span>def <span class="ident">read_encrypted_data</span></span>(<span>self, size_key, seed, is_current=True)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L802-L810" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def read_encrypted_data(self, size_key, seed, is_current=True):
    if is_current:
        size = 2 * (self.u32() ^ size_key)
        seed = int(size // 2) + seed
    else:
        size = (self.u32() ^ size_key)
        seed += size

    return a3x_decrypt(self.read_exactly(size), seed, is_current)</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xReader.read_encrypted_string"><code class="name flex">
<span>def <span class="ident">read_encrypted_string</span></span>(<span>self, size_key, seed, is_current=True)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L812-L815" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def read_encrypted_string(self, size_key, seed, is_current=True):
    if is_current:
        return self.read_encrypted_data(size_key, seed).decode(&#39;utf-16le&#39;)
    return self.read_encrypted_data(size_key, seed, is_current=False).decode(&#39;utf-8&#39;)</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xReader.read_time"><code class="name flex">
<span>def <span class="ident">read_time</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L817-L821" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def read_time(self):
    H = self.u32()
    L = self.u32()
    T = (H &lt;&lt; 32) | L
    return date_from_timestamp((T - 116444736000000000) / 10000000)</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xReader.read_length_prefixed_string"><code class="name flex">
<span>def <span class="ident">read_length_prefixed_string</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L823-L825" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def read_length_prefixed_string(self):
    length = self.i32()
    return &#39;&#39;.join(chr((self.u16() ^ length) &amp; 0xFFFF) for _ in range(length))</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="refinery.lib.structures.StructReader" href="../../lib/structures.html#refinery.lib.structures.StructReader">StructReader</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.lib.structures.StructReader.SEEK" href="../../lib/structures.html#refinery.lib.structures.MemoryFileMethods.SEEK">SEEK</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.Unaligned" href="../../lib/structures.html#refinery.lib.structures.StructReader.Unaligned">Unaligned</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.byte_align" href="../../lib/structures.html#refinery.lib.structures.StructReader.byte_align">byte_align</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.byte_aligned" href="../../lib/structures.html#refinery.lib.structures.StructReader.byte_aligned">byte_aligned</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.read_bit" href="../../lib/structures.html#refinery.lib.structures.StructReader.read_bit">read_bit</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.read_bits" href="../../lib/structures.html#refinery.lib.structures.StructReader.read_bits">read_bits</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.read_bytes" href="../../lib/structures.html#refinery.lib.structures.StructReader.read_bytes">read_bytes</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.read_exactly" href="../../lib/structures.html#refinery.lib.structures.StructReader.read_exactly">read_exactly</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.read_flags" href="../../lib/structures.html#refinery.lib.structures.StructReader.read_flags">read_flags</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.read_integer" href="../../lib/structures.html#refinery.lib.structures.StructReader.read_integer">read_integer</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.read_nibble" href="../../lib/structures.html#refinery.lib.structures.StructReader.read_nibble">read_nibble</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.read_struct" href="../../lib/structures.html#refinery.lib.structures.StructReader.read_struct">read_struct</a></code></li>
<li><code><a title="refinery.lib.structures.StructReader.seek" href="../../lib/structures.html#refinery.lib.structures.StructReader.seek">seek</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="refinery.units.formats.a3x.A3xRecord"><code class="flex name class">
<span>class <span class="ident">A3xRecord</span></span>
<span>(</span><span>reader, encryption_type)</span>
</code></dt>
<dd>
<section class="desc"><p>A class to parse structured data. A <code><a title="refinery.lib.structures.Struct" href="../../lib/structures.html#refinery.lib.structures.Struct">Struct</a></code> class can be instantiated
as follows:</p>
<pre><code>foo = Struct(data, bar=29)
</code></pre>
<p>The initialization routine of the structure will be called with a single argument <code>reader</code>. If
the object <code>data</code> is already a <code><a title="refinery.lib.structures.StructReader" href="../../lib/structures.html#refinery.lib.structures.StructReader">StructReader</a></code>, then it will be passed
as <code>reader</code>. Otherwise, the argument will be wrapped in a <code><a title="refinery.lib.structures.StructReader" href="../../lib/structures.html#refinery.lib.structures.StructReader">StructReader</a></code>.
Additional arguments to the struct are passed through.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L828-L904" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xRecord(Struct, parser=A3xReader):
    MAGIC = b&#39;\x6B\x43\xCA\x52&#39;

    def __init__(self, reader: A3xReader, encryption_type: A3xEncryptionType):
        self.magic = reader.read(4)
        self.encryption_type = encryption_type
        self.type = reader.read_encrypted_string(
            encryption_type.tag_size,
            encryption_type.tag,
            encryption_type.is_current
        ).lstrip(&#39;&gt;&#39;).rstrip(&#39;&lt;&#39;)
        self.src_path = reader.read_encrypted_string(
            encryption_type.path_size,
            encryption_type.path,
            encryption_type.is_current
        )
        self.is_compressed = bool(reader.u8())
        self.is_encrypted = True
        self.size = reader.u32() ^ encryption_type.compressed_size
        self.size_decompressed = reader.u32() ^ encryption_type.decompressed_size
        self.checksum = reader.u32() ^ encryption_type.checksum
        self.created = reader.read_time()
        self.written = reader.read_time()
        self.data = bytes(reader.read_exactly(self.size))

    def __hash__(self):
        return hash((self.path, self.type))

    def __eq__(self, other: A3xRecord):
        return self.path == other.path and self.type == other.type

    def extract(self) -&gt; bytearray:
        output = io.BytesIO()
        it = self.extract_linewise()
        output.write(next(it))
        for line in it:
            output.write(B&#39;\n&#39;)
            output.write(line)
        return output.getvalue()

    def extract_linewise(self) -&gt; Generator[bytes]:
        if self.is_encrypted:
            a3x.log_info(&#39;decryption:&#39;, self.path)
            if self.encryption_type.is_current:
                self.data = a3x_decrypt(self.data, self.encryption_type.data, self.encryption_type.is_current)
            else:
                seed = self.encryption_type.data + 0x849
                self.data = a3x_decrypt(self.data, seed, self.encryption_type.is_current)
            self.is_encrypted = False
        if self.is_compressed:
            a3x.log_info(&#39;decompress:&#39;, self.path)
            self.data = a3x_decompress(self.data, self.encryption_type.is_current)
            self.is_compressed = False
        if not self.is_script():
            yield self.data
            return
        a3x.log_info(&#39;decompiler:&#39;, self.path)
        for indent, line in a3x_decompile(self.data):
            yield F&#39;{indent * 4 * &#34; &#34;}{line}&#39;.encode(a3x.codec)

    def is_script(self):
        return self.type == A3xType.SCRIPT

    @property
    def path(self):
        try:
            tv = A3xType(self.type)
        except Exception:
            return self.type
        if tv is A3xType.SCRIPT:
            return &#39;script.au3&#39;
        if tv is A3xType.UNICODE:
            return &#39;unicode-script.au3&#39;
        if tv is A3xType.NOEXEC:
            return None
        if tv in (A3xType.AHK_WITH_ICON, A3xType.AHK_SCRIPT):
            return &#39;script.ahk&#39;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.lib.structures.Struct" href="../../lib/structures.html#refinery.lib.structures.Struct">Struct</a></li>
<li>typing.Generic</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.units.formats.a3x.A3xRecord.MAGIC"><code class="name">var <span class="ident">MAGIC</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="refinery.units.formats.a3x.A3xRecord.path"><code class="name">var <span class="ident">path</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L891-L904" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@property
def path(self):
    try:
        tv = A3xType(self.type)
    except Exception:
        return self.type
    if tv is A3xType.SCRIPT:
        return &#39;script.au3&#39;
    if tv is A3xType.UNICODE:
        return &#39;unicode-script.au3&#39;
    if tv is A3xType.NOEXEC:
        return None
    if tv in (A3xType.AHK_WITH_ICON, A3xType.AHK_SCRIPT):
        return &#39;script.ahk&#39;</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="refinery.units.formats.a3x.A3xRecord.extract"><code class="name flex">
<span>def <span class="ident">extract</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L859-L866" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def extract(self) -&gt; bytearray:
    output = io.BytesIO()
    it = self.extract_linewise()
    output.write(next(it))
    for line in it:
        output.write(B&#39;\n&#39;)
        output.write(line)
    return output.getvalue()</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xRecord.extract_linewise"><code class="name flex">
<span>def <span class="ident">extract_linewise</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L868-L886" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def extract_linewise(self) -&gt; Generator[bytes]:
    if self.is_encrypted:
        a3x.log_info(&#39;decryption:&#39;, self.path)
        if self.encryption_type.is_current:
            self.data = a3x_decrypt(self.data, self.encryption_type.data, self.encryption_type.is_current)
        else:
            seed = self.encryption_type.data + 0x849
            self.data = a3x_decrypt(self.data, seed, self.encryption_type.is_current)
        self.is_encrypted = False
    if self.is_compressed:
        a3x.log_info(&#39;decompress:&#39;, self.path)
        self.data = a3x_decompress(self.data, self.encryption_type.is_current)
        self.is_compressed = False
    if not self.is_script():
        yield self.data
        return
    a3x.log_info(&#39;decompiler:&#39;, self.path)
    for indent, line in a3x_decompile(self.data):
        yield F&#39;{indent * 4 * &#34; &#34;}{line}&#39;.encode(a3x.codec)</code></pre>
</details>
</dd>
<dt id="refinery.units.formats.a3x.A3xRecord.is_script"><code class="name flex">
<span>def <span class="ident">is_script</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L888-L889" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def is_script(self):
    return self.type == A3xType.SCRIPT</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="refinery.units.formats.a3x.A3xScript"><code class="flex name class">
<span>class <span class="ident">A3xScript</span></span>
<span>(</span><span>reader)</span>
</code></dt>
<dd>
<section class="desc"><p>A class to parse structured data. A <code><a title="refinery.lib.structures.Struct" href="../../lib/structures.html#refinery.lib.structures.Struct">Struct</a></code> class can be instantiated
as follows:</p>
<pre><code>foo = Struct(data, bar=29)
</code></pre>
<p>The initialization routine of the structure will be called with a single argument <code>reader</code>. If
the object <code>data</code> is already a <code><a title="refinery.lib.structures.StructReader" href="../../lib/structures.html#refinery.lib.structures.StructReader">StructReader</a></code>, then it will be passed
as <code>reader</code>. Otherwise, the argument will be wrapped in a <code><a title="refinery.lib.structures.StructReader" href="../../lib/structures.html#refinery.lib.structures.StructReader">StructReader</a></code>.
Additional arguments to the struct are passed through.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L907-L939" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class A3xScript(Struct, parser=A3xReader):
    MAGIC = b&#39;\xA3\x48\x4B\xBE\x98\x6C\x4A\xA9\x99\x4C\x53\x0A\x86\xD6\x48\x7D&#39;
    WIDTH = 0x28

    def has_valid_magic(self):
        return self.magic == self.MAGIC

    def __init__(self, reader: A3xReader):
        self.magic = reader.read(0x10)
        self.type = bytes(reader.read(8))
        self._unk = reader.read(16)
        self.truncated = False
        if not self.type.startswith(B&#39;AU3!&#39;):
            self.body = []
            return
        self.body: list[A3xRecord] = []
        last_known_good_position = reader.tell()
        types = {at.version: at for at in A3xEncryptionType}
        while not reader.eof:
            pos = reader.tell()
            try:
                rt = types.get(self.type, A3xEncryptionType.EA06)
                self.body.append(A3xRecord(reader, rt))
            except (ValueError, EOFError):
                reader.seekset(pos)
                break
            else:
                last_known_good_position = pos
        if reader.read(8) != self.type:
            self.truncated = True
            reader.seekset(last_known_good_position)
            if self.body:
                self.body.pop()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.lib.structures.Struct" href="../../lib/structures.html#refinery.lib.structures.Struct">Struct</a></li>
<li>typing.Generic</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.units.formats.a3x.A3xScript.MAGIC"><code class="name">var <span class="ident">MAGIC</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.formats.a3x.A3xScript.WIDTH"><code class="name">var <span class="ident">WIDTH</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="refinery.units.formats.a3x.A3xScript.has_valid_magic"><code class="name flex">
<span>def <span class="ident">has_valid_magic</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L911-L912" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def has_valid_magic(self):
    return self.magic == self.MAGIC</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="refinery.units.formats.a3x.a3x"><code class="flex name class">
<span>class <span class="ident">a3x</span></span>
<span>(</span><span>*paths, list=False, join_path=False, drop_path=False, fuzzy=0, exact=False, regex=False, path=b'path')</span>
</code></dt>
<dd>
<section class="desc"><p>Extracts embedded resources from compiled AutoIt scripts and decompiles the embedded script
bytecode. The unit also works on compiled AutoIt executables.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L942-L1034" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class a3x(PathExtractorUnit):
    &#34;&#34;&#34;
    Extracts embedded resources from compiled AutoIt scripts and decompiles the embedded script
    bytecode. The unit also works on compiled AutoIt executables.
    &#34;&#34;&#34;

    def unpack(self, data: bytearray):
        view = memoryview(data)
        cursor = 0
        errors: dict[int, Exception] = {}
        script_count = 0
        truncated: set[A3xRecord] = set()
        intact: set[A3xRecord] = set()

        def _package(records: Iterable[A3xRecord]) -&gt; Generator[UnpackResult]:
            for k, record in enumerate(records, 1):
                self.log_info(F&#39;record {k} type:&#39;, record.type)
                self.log_info(F&#39;record {k} path:&#39;, record.src_path)
                if record.path is None:
                    continue
                yield UnpackResult(
                    record.path,
                    record.extract,
                    srcpath=record.src_path,
                    created=record.created.isoformat(&#39; &#39;, &#39;seconds&#39;),
                    written=record.written.isoformat(&#39; &#39;, &#39;seconds&#39;),
                )

        while cursor &lt; len(view):
            self.log_debug(F&#39;searching at offset 0x{cursor:08X}&#39;)
            nc = data.find(A3xScript.MAGIC, cursor)
            if nc &gt;= 0:
                cursor = nc
            else:
                rp = data.find(A3xRecord.MAGIC, cursor) - A3xScript.WIDTH
                if rp &lt;= cursor:
                    break
                cursor = rp
            try:
                script = A3xScript(view[cursor:])
            except Exception as E:
                errors[cursor] = E
                cursor += 1
                continue
            else:
                valid = script.has_valid_magic()
                if valid:
                    _m = &#39;correct&#39;
                else:
                    _m = &#39;invalid&#39;
                if not script.body:
                    cursor += A3xScript.WIDTH
                    if not script.has_valid_magic():
                        cursor += len(A3xRecord.MAGIC)
                    continue
                if script.truncated:
                    _a = &#39;truncated&#39;
                    truncated.update(script.body)
                else:
                    script_count += 1
                    _a = &#39;intact&#39;
                    intact.update(script.body)
                self.log_info(
                    F&#39;{_a} script of type&#39;, script.type,
                    F&#39;and length 0x{len(script):08X}&#39;,
                    F&#39;with {len(script.body)} records and {_m} magic:&#39;,
                    script.magic
                )
                cursor += len(script)
                if script.truncated:
                    if not script.has_valid_magic():
                        cursor += len(A3xRecord.MAGIC)
                    continue

            yield from _package(script.body)

        remaining = truncated - intact
        if remaining:
            self.log_warn(&#39;emitting records from truncated scripts&#39;)
            yield from _package(remaining)
            return
        elif truncated:
            self.log_debug(&#39;good news: intact scripts contained all records from truncated scripts&#39;)
        if script_count == 0:
            error = None
            for offset, error in errors.items():
                self.log_warn(F&#39;error at offset 0x{offset:08X}:&#39;, error)
            if error:
                raise error

    @classmethod
    def handles(cls, data) -&gt; bool | None:
        return buffer_contains(data, A3xScript.MAGIC) or buffer_contains(data, A3xRecord.MAGIC)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="refinery.units.formats.PathExtractorUnit" href="index.html#refinery.units.formats.PathExtractorUnit">PathExtractorUnit</a></li>
<li><a title="refinery.units.Unit" href="../index.html#refinery.units.Unit">Unit</a></li>
<li><a title="refinery.units.UnitBase" href="../index.html#refinery.units.UnitBase">UnitBase</a></li>
<li><a title="refinery.units.Entry" href="../index.html#refinery.units.Entry">Entry</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="refinery.units.formats.a3x.a3x" href="#refinery.units.formats.a3x.a3x">a3x</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="refinery.units.formats.a3x.a3x.required_dependencies"><code class="name">var <span class="ident">required_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.formats.a3x.a3x.optional_dependencies"><code class="name">var <span class="ident">optional_dependencies</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.formats.a3x.a3x.console"><code class="name">var <span class="ident">console</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt id="refinery.units.formats.a3x.a3x.reverse"><code class="name">var <span class="ident">reverse</span></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="refinery.units.formats.a3x.a3x.unpack"><code class="name flex">
<span>def <span class="ident">unpack</span></span>(<span>self, data)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/binref/refinery/blob/2c887cef6f2560025a1ac871b535f0d84fa3f321/refinery/units/formats/a3x.py#L948-L1030" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def unpack(self, data: bytearray):
    view = memoryview(data)
    cursor = 0
    errors: dict[int, Exception] = {}
    script_count = 0
    truncated: set[A3xRecord] = set()
    intact: set[A3xRecord] = set()

    def _package(records: Iterable[A3xRecord]) -&gt; Generator[UnpackResult]:
        for k, record in enumerate(records, 1):
            self.log_info(F&#39;record {k} type:&#39;, record.type)
            self.log_info(F&#39;record {k} path:&#39;, record.src_path)
            if record.path is None:
                continue
            yield UnpackResult(
                record.path,
                record.extract,
                srcpath=record.src_path,
                created=record.created.isoformat(&#39; &#39;, &#39;seconds&#39;),
                written=record.written.isoformat(&#39; &#39;, &#39;seconds&#39;),
            )

    while cursor &lt; len(view):
        self.log_debug(F&#39;searching at offset 0x{cursor:08X}&#39;)
        nc = data.find(A3xScript.MAGIC, cursor)
        if nc &gt;= 0:
            cursor = nc
        else:
            rp = data.find(A3xRecord.MAGIC, cursor) - A3xScript.WIDTH
            if rp &lt;= cursor:
                break
            cursor = rp
        try:
            script = A3xScript(view[cursor:])
        except Exception as E:
            errors[cursor] = E
            cursor += 1
            continue
        else:
            valid = script.has_valid_magic()
            if valid:
                _m = &#39;correct&#39;
            else:
                _m = &#39;invalid&#39;
            if not script.body:
                cursor += A3xScript.WIDTH
                if not script.has_valid_magic():
                    cursor += len(A3xRecord.MAGIC)
                continue
            if script.truncated:
                _a = &#39;truncated&#39;
                truncated.update(script.body)
            else:
                script_count += 1
                _a = &#39;intact&#39;
                intact.update(script.body)
            self.log_info(
                F&#39;{_a} script of type&#39;, script.type,
                F&#39;and length 0x{len(script):08X}&#39;,
                F&#39;with {len(script.body)} records and {_m} magic:&#39;,
                script.magic
            )
            cursor += len(script)
            if script.truncated:
                if not script.has_valid_magic():
                    cursor += len(A3xRecord.MAGIC)
                continue

        yield from _package(script.body)

    remaining = truncated - intact
    if remaining:
        self.log_warn(&#39;emitting records from truncated scripts&#39;)
        yield from _package(remaining)
        return
    elif truncated:
        self.log_debug(&#39;good news: intact scripts contained all records from truncated scripts&#39;)
    if script_count == 0:
        error = None
        for offset, error in errors.items():
            self.log_warn(F&#39;error at offset 0x{offset:08X}:&#39;, error)
        if error:
            raise error</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="refinery.units.formats.PathExtractorUnit" href="index.html#refinery.units.formats.PathExtractorUnit">PathExtractorUnit</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.formats.PathExtractorUnit.CustomPathSeparator" href="index.html#refinery.units.formats.PathExtractorUnit.CustomPathSeparator">CustomPathSeparator</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.Requires" href="../index.html#refinery.units.Unit.Requires">Requires</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.assemble" href="../index.html#refinery.units.Unit.assemble">assemble</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.filter" href="../index.html#refinery.units.UnitBase.filter">filter</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.finish" href="../index.html#refinery.units.UnitBase.finish">finish</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.handles" href="../index.html#refinery.units.UnitBase.handles">handles</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.is_quiet" href="../index.html#refinery.units.Unit.is_quiet">is_quiet</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.labelled" href="../index.html#refinery.units.Unit.labelled">labelled</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.leniency" href="../index.html#refinery.units.Unit.leniency">leniency</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.log_always" href="../index.html#refinery.units.Unit.log_always">log_always</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.log_debug" href="../index.html#refinery.units.Unit.log_debug">log_debug</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.log_detach" href="../index.html#refinery.units.Unit.log_detach">log_detach</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.log_fail" href="../index.html#refinery.units.Unit.log_fail">log_fail</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.log_info" href="../index.html#refinery.units.Unit.log_info">log_info</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.log_level" href="../index.html#refinery.units.Unit.log_level">log_level</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.log_warn" href="../index.html#refinery.units.Unit.log_warn">log_warn</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.nozzle" href="../index.html#refinery.units.Unit.nozzle">nozzle</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.read" href="../index.html#refinery.units.Unit.read">read</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.read1" href="../index.html#refinery.units.Unit.read1">read1</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.run" href="../index.html#refinery.units.Unit.run">run</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.source" href="../index.html#refinery.units.Unit.source">source</a></code></li>
<li><code><a title="refinery.units.formats.PathExtractorUnit.superinit" href="../index.html#refinery.units.Unit.superinit">superinit</a></code></li>
</ul>
</li>
<li><code><b><a title="refinery.units.UnitBase" href="../index.html#refinery.units.UnitBase">UnitBase</a></b></code>:
<ul class="hlist">
<li><code><a title="refinery.units.UnitBase.process" href="../index.html#refinery.units.UnitBase.process">process</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="refinery.units.formats" href="index.html">refinery.units.formats</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="refinery.units.formats.a3x.a3x_number_representation" href="#refinery.units.formats.a3x.a3x_number_representation">a3x_number_representation</a></code></li>
<li><code><a title="refinery.units.formats.a3x.a3x_decompile" href="#refinery.units.formats.a3x.a3x_decompile">a3x_decompile</a></code></li>
<li><code><a title="refinery.units.formats.a3x.a3x_decompress" href="#refinery.units.formats.a3x.a3x_decompress">a3x_decompress</a></code></li>
<li><code><a title="refinery.units.formats.a3x.a3x_decrypt_current" href="#refinery.units.formats.a3x.a3x_decrypt_current">a3x_decrypt_current</a></code></li>
<li><code><a title="refinery.units.formats.a3x.a3x_decrypt_legacy" href="#refinery.units.formats.a3x.a3x_decrypt_legacy">a3x_decrypt_legacy</a></code></li>
<li><code><a title="refinery.units.formats.a3x.a3x_decrypt" href="#refinery.units.formats.a3x.a3x_decrypt">a3x_decrypt</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="refinery.units.formats.a3x.A3xType" href="#refinery.units.formats.a3x.A3xType">A3xType</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.units.formats.a3x.A3xEncryptionConstants" href="#refinery.units.formats.a3x.A3xEncryptionConstants">A3xEncryptionConstants</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.units.formats.a3x.A3xEncryptionType" href="#refinery.units.formats.a3x.A3xEncryptionType">A3xEncryptionType</a></code></h4>
</li>
<li>
<h4><code><a title="refinery.units.formats.a3x.A3xReader" href="#refinery.units.formats.a3x.A3xReader">A3xReader</a></code></h4>
<ul class="">
<li><code><a title="refinery.units.formats.a3x.A3xReader.read_encrypted_data" href="#refinery.units.formats.a3x.A3xReader.read_encrypted_data">read_encrypted_data</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xReader.read_encrypted_string" href="#refinery.units.formats.a3x.A3xReader.read_encrypted_string">read_encrypted_string</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xReader.read_time" href="#refinery.units.formats.a3x.A3xReader.read_time">read_time</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xReader.read_length_prefixed_string" href="#refinery.units.formats.a3x.A3xReader.read_length_prefixed_string">read_length_prefixed_string</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="refinery.units.formats.a3x.A3xRecord" href="#refinery.units.formats.a3x.A3xRecord">A3xRecord</a></code></h4>
<ul class="">
<li><code><a title="refinery.units.formats.a3x.A3xRecord.extract" href="#refinery.units.formats.a3x.A3xRecord.extract">extract</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xRecord.extract_linewise" href="#refinery.units.formats.a3x.A3xRecord.extract_linewise">extract_linewise</a></code></li>
<li><code><a title="refinery.units.formats.a3x.A3xRecord.is_script" href="#refinery.units.formats.a3x.A3xRecord.is_script">is_script</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="refinery.units.formats.a3x.A3xScript" href="#refinery.units.formats.a3x.A3xScript">A3xScript</a></code></h4>
<ul class="">
<li><code><a title="refinery.units.formats.a3x.A3xScript.has_valid_magic" href="#refinery.units.formats.a3x.A3xScript.has_valid_magic">has_valid_magic</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="refinery.units.formats.a3x.a3x" href="#refinery.units.formats.a3x.a3x">a3x</a></code></h4>
<ul class="">
<li><code><a title="refinery.units.formats.a3x.a3x.unpack" href="#refinery.units.formats.a3x.a3x.unpack">unpack</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>
hljs.configure({languages: []})
hljs.initHighlightingOnLoad()
</script>
</body>
</html>
